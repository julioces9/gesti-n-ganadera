<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GANADERO SG â€” Sistema de GestiÃ³n Ganadera</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,300;0,500;0,700;0,900;1,400&family=Sora:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --pasto: #1b5e35;
  --pasto-claro: #2d8a52;
  --pasto-vivo: #38a169;
  --pasto-suave: #e8f5ee;
  --pasto-medio: #c6e8d4;
  --tierra: #7c4d2d;
  --tierra-claro: #a0673d;
  --sol: #d97706;
  --sol-claro: #f59e0b;
  --cielo: #1e5fa8;
  --cielo-claro: #3b82f6;
  --noche: #0f1f13;
  --carbon: #1a2e1e;
  --musgo: #2d4a32;
  --hoja: #3d6b45;
  --crema: #f9f6f0;
  --hueso: #f0ebe0;
  --arena: #e8dfc9;
  --gris-calido: #8a8278;
  --gris-suave: #c5bfb4;
  --texto: #1a1a18;
  --texto-medio: #4a4740;
  --rojo: #c0392b;
  --rojo-claro: #fee2e2;
  --sombra-sm: 0 2px 8px rgba(15,31,19,0.08);
  --sombra: 0 4px 20px rgba(15,31,19,0.10);
  --sombra-lg: 0 12px 48px rgba(15,31,19,0.18);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{font-size:14px;}
body{font-family:'Sora',sans-serif;background:var(--crema);color:var(--texto);display:flex;min-height:100vh;overflow-x:hidden;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SIDEBAR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sidebar{
  width:248px;min-height:100vh;
  background:var(--noche);
  display:flex;flex-direction:column;
  position:fixed;left:0;top:0;bottom:0;z-index:200;
  transition:width .3s;
  overflow:hidden;
}
#sidebar.collapsed{width:60px;}
.sb-logo{
  padding:22px 20px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;align-items:center;gap:12px;
  flex-shrink:0;
}
.sb-logo-icon{
  width:38px;height:38px;border-radius:10px;
  background:linear-gradient(135deg,var(--pasto-vivo),var(--pasto));
  display:flex;align-items:center;justify-content:center;
  font-size:20px;flex-shrink:0;
}
.sb-logo-text{overflow:hidden;white-space:nowrap;}
.sb-logo-title{font-family:'Fraunces',serif;font-size:17px;font-weight:700;color:#fff;line-height:1.2;}
.sb-logo-sub{font-size:10px;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:2px;margin-top:2px;}
.sb-finca{
  margin:12px 12px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1);
  border-radius:10px;padding:10px 12px;
  cursor:pointer;transition:all .2s;overflow:hidden;
}
.sb-finca:hover{background:rgba(255,255,255,.1);}
.sb-finca-name{font-size:12px;font-weight:600;color:#fff;white-space:nowrap;}
.sb-finca-meta{font-size:10px;color:rgba(255,255,255,.4);margin-top:2px;white-space:nowrap;}
.sb-nav{flex:1;overflow-y:auto;padding:4px 0 12px;}
.sb-section{
  padding:12px 20px 4px;
  font-size:9px;color:rgba(255,255,255,.3);
  text-transform:uppercase;letter-spacing:2.5px;font-weight:700;
  white-space:nowrap;overflow:hidden;
}
.sb-item{
  display:flex;align-items:center;gap:12px;
  padding:9px 20px;
  color:rgba(255,255,255,.55);
  cursor:pointer;transition:all .18s;
  position:relative;white-space:nowrap;
  font-size:13px;font-weight:400;
}
.sb-item:hover{color:#fff;background:rgba(255,255,255,.06);}
.sb-item.act{color:#fff;background:rgba(45,138,82,.25);font-weight:600;}
.sb-item.act::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--pasto-vivo);border-radius:0 2px 2px 0;}
.sb-icon{font-size:17px;width:20px;text-align:center;flex-shrink:0;}
.sb-badge{margin-left:auto;background:var(--sol);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px;flex-shrink:0;}
.sb-toggle{
  padding:12px 20px;border-top:1px solid rgba(255,255,255,.08);
  color:rgba(255,255,255,.35);cursor:pointer;display:flex;align-items:center;gap:10px;
  font-size:12px;transition:color .2s;flex-shrink:0;
}
.sb-toggle:hover{color:rgba(255,255,255,.7);}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   MAIN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#main{margin-left:248px;flex:1;min-height:100vh;display:flex;flex-direction:column;transition:margin-left .3s;}
#sidebar.collapsed~#main{margin-left:60px;}
.topbar{
  background:#fff;border-bottom:1px solid var(--arena);
  padding:12px 28px;display:flex;align-items:center;gap:12px;
  position:sticky;top:0;z-index:100;
}
.topbar-title{font-family:'Fraunces',serif;font-size:19px;font-weight:700;color:var(--texto);}
.topbar-breadcrumb{font-size:11px;color:var(--gris-calido);margin-left:4px;}
.topbar-actions{margin-left:auto;display:flex;gap:8px;align-items:center;}

/* BTN */
.btn{padding:8px 16px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;border:none;transition:all .18s;font-family:'Sora',sans-serif;display:inline-flex;align-items:center;gap:6px;white-space:nowrap;}
.btn-primary{background:var(--pasto);color:#fff;}
.btn-primary:hover{background:var(--pasto-claro);}
.btn-success{background:var(--pasto-vivo);color:#fff;}
.btn-success:hover{background:var(--pasto-claro);}
.btn-danger{background:var(--rojo);color:#fff;}
.btn-danger:hover{background:#a93226;}
.btn-ghost{background:transparent;border:1.5px solid var(--arena);color:var(--texto-medio);}
.btn-ghost:hover{border-color:var(--pasto);color:var(--pasto);}
.btn-sm{padding:5px 11px;font-size:11px;}
.btn-icon{padding:7px;width:34px;height:34px;justify-content:center;}

/* CONTENT */
.content{padding:24px 28px;flex:1;}
.page{display:none;}
.page.act{display:block;animation:fadeSlide .25s ease;}
@keyframes fadeSlide{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   KPI CARDS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kpi-grid{display:grid;gap:14px;margin-bottom:22px;}
.kpi-4{grid-template-columns:repeat(4,1fr);}
.kpi-3{grid-template-columns:repeat(3,1fr);}
.kpi-card{
  background:#fff;border-radius:14px;padding:18px 20px;
  box-shadow:var(--sombra-sm);border:1px solid var(--hueso);
  position:relative;overflow:hidden;cursor:default;
  transition:transform .18s,box-shadow .18s;
}
.kpi-card:hover{transform:translateY(-2px);box-shadow:var(--sombra);}
.kpi-card-accent{
  position:absolute;top:0;right:0;width:72px;height:72px;
  border-radius:0 14px 0 100%;opacity:.07;
}
.kpi-lbl{font-size:10px;color:var(--gris-calido);text-transform:uppercase;letter-spacing:1.5px;font-weight:700;}
.kpi-val{font-family:'Fraunces',serif;font-size:32px;font-weight:700;margin:6px 0 4px;line-height:1;}
.kpi-delta{font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:20px;}
.delta-up{color:#14532d;background:#dcfce7;}
.delta-dn{color:#7f1d1d;background:#fee2e2;}
.delta-neu{color:#374151;background:#f3f4f6;}
.kpi-icon-bg{position:absolute;right:14px;top:16px;font-size:28px;opacity:.12;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CARDS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:#fff;border-radius:14px;padding:22px 24px;box-shadow:var(--sombra-sm);border:1px solid var(--hueso);}
.card-title{font-family:'Fraunces',serif;font-size:15px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.card-subtitle{font-size:11px;color:var(--gris-calido);margin-left:auto;font-family:'Sora',sans-serif;font-weight:400;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;}
.grid-32{display:grid;grid-template-columns:3fr 2fr;gap:16px;}
.grid-23{display:grid;grid-template-columns:2fr 3fr;gap:16px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TABLE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tbl-wrap{overflow-x:auto;border-radius:10px;-webkit-overflow-scrolling:touch;}
.tbl-wrap::-webkit-scrollbar{height:6px;}
.tbl-wrap::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px;}
.tbl-wrap::-webkit-scrollbar-thumb{background:var(--pasto-medio);border-radius:3px;}
.tbl-wrap::-webkit-scrollbar-thumb:hover{background:var(--pasto);}
/* â”€â”€ IA Chat â”€â”€ */
.ia-msg{display:flex;gap:10px;align-items:flex-start;}
.ia-msg-user{flex-direction:row-reverse;}
.ia-avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;background:#e8f5e9;}
.ia-msg-user .ia-avatar{background:#e3f2fd;}
.ia-bubble{background:#fff;border:1px solid var(--borde);border-radius:14px;padding:10px 14px;font-size:13px;line-height:1.55;max-width:85%;box-shadow:0 1px 3px rgba(0,0,0,.06);}
.ia-msg-user .ia-bubble{background:var(--pasto);color:#fff;border-color:var(--pasto);}
.ia-bubble-thinking{background:#f3f4f6;color:var(--gris-calido);font-style:italic;}
.ia-sug{background:rgba(255,255,255,0.2);color:#fff;border:1px solid rgba(255,255,255,0.4);border-radius:20px;padding:5px 12px;font-size:11px;cursor:pointer;font-family:inherit;transition:background .15s;}
.ia-sug:hover{background:rgba(255,255,255,0.35);}
#ia-mensajes::-webkit-scrollbar{width:5px;}
#ia-mensajes::-webkit-scrollbar-thumb{background:var(--pasto-medio);border-radius:3px;}
table{width:100%;border-collapse:collapse;font-size:12.5px;}
thead tr{background:var(--crema);}
th{padding:9px 12px;text-align:left;font-size:10px;text-transform:uppercase;letter-spacing:1.2px;color:var(--gris-calido);font-weight:700;border-bottom:2px solid var(--arena);white-space:nowrap;}
td{padding:10px 12px;border-bottom:1px solid var(--hueso);vertical-align:middle;}
tbody tr{transition:background .12s;cursor:pointer;}
tbody tr:hover td{background:var(--pasto-suave);}
tbody tr:last-child td{border-bottom:none;}
.mono{font-family:'JetBrains Mono',monospace;font-size:11.5px;color:var(--pasto);font-weight:500;}
.tag{display:inline-block;padding:3px 9px;border-radius:20px;font-size:10px;font-weight:700;}
.tag-verde{background:#dcfce7;color:#14532d;}
.tag-amarillo{background:#fef9c3;color:#713f12;}
.tag-azul{background:#dbeafe;color:#1e3a5f;}
.tag-rojo{background:#fee2e2;color:#7f1d1d;}
.tag-gris{background:#f3f4f6;color:#374151;}
.tag-morado{background:#ede9fe;color:#3b0764;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PROGRESS / BARS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pbar-wrap{height:6px;background:var(--arena);border-radius:10px;overflow:hidden;min-width:70px;}
.pbar-fill{height:100%;border-radius:10px;background:linear-gradient(90deg,var(--pasto-vivo),var(--pasto));transition:width .5s ease;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SEARCH & FILTERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.search-row{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;}
.search-input{
  flex:1;min-width:200px;
  display:flex;align-items:center;gap:8px;
  background:#fff;border:1.5px solid var(--arena);border-radius:9px;padding:0 12px;
  transition:all .18s;
}
.search-input:focus-within{border-color:var(--pasto);box-shadow:0 0 0 3px rgba(29,94,53,.08);}
.search-input input{border:none;background:transparent;padding:9px 0;font-size:13px;font-family:'Sora',sans-serif;color:var(--texto);width:100%;outline:none;}
.filter-chips{display:flex;gap:6px;flex-wrap:wrap;}
.chip{padding:5px 13px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;border:1.5px solid var(--arena);background:#fff;color:var(--texto-medio);transition:all .18s;}
.chip:hover,.chip.act{border-color:var(--pasto);color:var(--pasto);background:var(--pasto-suave);}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FORM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-grid{display:grid;gap:14px;}
.fg-2{grid-template-columns:1fr 1fr;}
.fg-3{grid-template-columns:1fr 1fr 1fr;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-label{font-size:10px;font-weight:700;color:var(--texto-medio);text-transform:uppercase;letter-spacing:.8px;}
.form-control{
  padding:9px 12px;border:1.5px solid var(--arena);border-radius:9px;
  font-size:13px;font-family:'Sora',sans-serif;color:var(--texto);
  background:var(--crema);outline:none;transition:all .18s;width:100%;
}
.form-control:focus{border-color:var(--pasto);background:#fff;box-shadow:0 0 0 3px rgba(29,94,53,.07);}
.form-control::placeholder{color:var(--gris-suave);}
textarea.form-control{resize:vertical;min-height:80px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   MODAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay{
  display:none;position:fixed;inset:0;
  background:rgba(10,20,12,.55);backdrop-filter:blur(4px);
  z-index:500;align-items:center;justify-content:center;padding:20px;
}
.overlay.show{display:flex;}
.modal{
  background:#fff;border-radius:18px;
  width:100%;max-width:640px;max-height:90vh;overflow-y:auto;
  box-shadow:var(--sombra-lg);animation:modalIn .25s ease;
}
@keyframes modalIn{from{transform:scale(.95) translateY(20px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
.modal-header{padding:24px 28px 0;display:flex;align-items:flex-start;gap:12px;}
.modal-icon{width:44px;height:44px;border-radius:12px;background:var(--pasto-suave);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.modal-title{font-family:'Fraunces',serif;font-size:19px;font-weight:700;}
.modal-sub{font-size:12px;color:var(--gris-calido);margin-top:3px;}
.modal-close{margin-left:auto;cursor:pointer;color:var(--gris-calido);font-size:20px;line-height:1;padding:4px;transition:color .15s;}
.modal-close:hover{color:var(--texto);}
.modal-body{padding:20px 28px;}
.modal-footer{padding:0 28px 24px;display:flex;gap:10px;justify-content:flex-end;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ALERT ITEMS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.alert-list{display:flex;flex-direction:column;gap:8px;}
.alert-item{
  display:flex;gap:11px;padding:12px 14px;border-radius:10px;
  border-left:3px solid transparent;font-size:12.5px;
}
.alert-urgente{background:#fef2f2;border-color:#ef4444;}
.alert-media{background:#fffbeb;border-color:#f59e0b;}
.alert-info{background:var(--pasto-suave);border-color:var(--pasto-vivo);}
.alert-dot{width:7px;height:7px;border-radius:50%;margin-top:5px;flex-shrink:0;}
.ad-rojo{background:#ef4444;}
.ad-amarillo{background:#f59e0b;}
.ad-verde{background:var(--pasto-vivo);}
.alert-body{flex:1;}
.alert-animal{font-weight:700;color:var(--pasto);}
.alert-time{font-size:10px;color:var(--gris-calido);margin-top:3px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   EVENT ITEMS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.event-item{
  display:flex;align-items:center;gap:12px;
  padding:10px 14px;background:var(--crema);border-radius:10px;
  cursor:pointer;transition:all .18s;margin-bottom:7px;
}
.event-item:hover{background:var(--pasto-suave);}
.event-date-box{
  background:var(--pasto);color:#fff;border-radius:8px;
  padding:5px 8px;text-align:center;min-width:42px;flex-shrink:0;
}
.ed-day{font-family:'Fraunces',serif;font-size:16px;font-weight:700;line-height:1;}
.ed-mon{font-size:9px;text-transform:uppercase;letter-spacing:1px;opacity:.8;}
.event-info{flex:1;}
.event-name{font-weight:600;font-size:13px;}
.event-meta{font-size:11px;color:var(--gris-calido);margin-top:2px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HOJA DE VIDA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hoja-wrap{display:none;}
.hoja-wrap.show{display:block;}
.hoja-header{
  background:linear-gradient(130deg,var(--pasto) 0%,var(--carbon) 100%);
  border-radius:14px;padding:24px 28px;
  color:#fff;display:flex;align-items:center;gap:20px;
  margin-bottom:16px;
}
.hoja-avatar{
  width:60px;height:60px;border-radius:14px;
  background:rgba(255,255,255,.15);
  display:flex;align-items:center;justify-content:center;font-size:30px;
  flex-shrink:0;
}
.hoja-name{font-family:'Fraunces',serif;font-size:22px;font-weight:700;}
.hoja-id{font-size:11px;opacity:.65;margin-top:3px;font-family:'JetBrains Mono',monospace;}
.hoja-stats{display:flex;gap:24px;margin-left:auto;}
.hstat{text-align:center;}
.hstat-val{font-family:'Fraunces',serif;font-size:20px;font-weight:700;}
.hstat-lbl{font-size:10px;opacity:.6;margin-top:2px;}
.hoja-tabs{display:flex;border-bottom:2px solid var(--arena);margin-bottom:18px;}
.hoja-tab{
  padding:9px 16px;font-size:12px;font-weight:600;
  color:var(--gris-calido);cursor:pointer;
  border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .18s;
}
.hoja-tab.act{color:var(--pasto);border-color:var(--pasto);}
.htab-body{display:none;}
.htab-body.act{display:block;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TIMELINE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.timeline{display:flex;flex-direction:column;gap:0;}
.tl-item{display:flex;gap:14px;padding-bottom:16px;position:relative;}
.tl-item::before{content:'';position:absolute;left:16px;top:28px;bottom:0;width:2px;background:var(--arena);}
.tl-item:last-child::before{display:none;}
.tl-dot{
  width:32px;height:32px;border-radius:50%;
  background:#fff;border:2px solid var(--pasto-vivo);
  display:flex;align-items:center;justify-content:center;
  font-size:14px;flex-shrink:0;z-index:1;
}
.tl-content{flex:1;padding-top:4px;}
.tl-title{font-weight:600;font-size:13px;}
.tl-date{font-size:11px;color:var(--gris-calido);margin-top:2px;}
.tl-detail{font-size:12px;color:var(--texto-medio);margin-top:5px;background:var(--crema);padding:8px 12px;border-radius:8px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INDICATOR GRID
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ind-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:18px;}
.ind-card{
  background:var(--crema);border:1px solid var(--arena);
  border-radius:12px;padding:14px 16px;text-align:center;
}
.ind-val{font-family:'Fraunces',serif;font-size:26px;font-weight:700;}
.ind-lbl{font-size:10px;color:var(--gris-calido);text-transform:uppercase;letter-spacing:1px;margin-top:3px;font-weight:700;}
.ind-status{font-size:10px;font-weight:700;margin-top:6px;}
.s-ok{color:#14532d;}.s-warn{color:#92400e;}.s-bad{color:#7f1d1d;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SIM SLIDERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sim-row{display:flex;align-items:center;gap:14px;margin-bottom:14px;}
.sim-lbl{font-size:12px;font-weight:600;width:175px;flex-shrink:0;color:var(--texto-medio);}
.sim-slider{flex:1;accent-color:var(--pasto);height:4px;}
.sim-val{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--pasto);font-weight:700;width:70px;text-align:right;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RESULT BOXES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.res-box{background:var(--pasto-suave);border-radius:12px;padding:16px;border:1px solid var(--pasto-medio);}
.res-big{font-family:'Fraunces',serif;font-size:28px;font-weight:700;color:var(--pasto);}
.res-lbl{font-size:10px;color:var(--gris-calido);text-transform:uppercase;letter-spacing:1.5px;font-weight:700;margin-bottom:4px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   COST TABLE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cost-row{
  display:flex;justify-content:space-between;align-items:center;
  padding:9px 0;border-bottom:1px solid var(--hueso);font-size:13px;
}
.cost-row:last-child{border-bottom:none;}
.cost-lbl{color:var(--texto-medio);}
.cost-pos{color:var(--pasto);font-weight:700;}
.cost-neg{color:var(--rojo);font-weight:700;}
.cost-total{font-weight:800;font-size:15px;color:var(--pasto);}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NOTIFICATION TOAST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast{
  position:fixed;bottom:24px;right:24px;
  background:var(--carbon);color:#fff;
  padding:12px 18px;border-radius:12px;
  font-size:13px;font-weight:600;
  box-shadow:var(--sombra-lg);
  transform:translateY(100px);opacity:0;
  transition:all .3s cubic-bezier(.34,1.56,.64,1);
  z-index:9999;display:flex;align-items:center;gap:10px;
  max-width:340px;
}
#toast.show{transform:translateY(0);opacity:1;}
#toast.success{background:var(--pasto);}
#toast.error{background:var(--rojo);}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   MISC
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-header{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:18px;}
.section-title{font-family:'Fraunces',serif;font-size:21px;font-weight:700;}
.section-sub{font-size:12px;color:var(--gris-calido);margin-top:3px;}
.divider{height:1px;background:var(--hueso);margin:16px 0;}
.empty-state{
  text-align:center;padding:40px;color:var(--gris-calido);
}
.empty-state .es-icon{font-size:40px;margin-bottom:12px;}
.empty-state .es-text{font-size:14px;font-weight:600;margin-bottom:6px;color:var(--texto-medio);}
.empty-state .es-sub{font-size:12px;}

/* scrollbar */
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--arena);border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:var(--gris-suave);}

/* Radar */
.radar-lbl{font-size:9px;fill:var(--gris-calido);font-family:'Sora',sans-serif;}

/* color helpers */
.c-verde{color:var(--pasto);}
.c-sol{color:var(--sol);}
.c-cielo{color:var(--cielo);}
.c-tierra{color:var(--tierra);}
.c-rojo{color:var(--rojo);}
.fw7{font-weight:700;}
.font-mono{font-family:'JetBrains Mono',monospace;}
.text-sm{font-size:12px;}
.text-xs{font-size:11px;}
.muted{color:var(--gris-calido);}
.mt4{margin-top:4px;}.mt8{margin-top:8px;}.mt12{margin-top:12px;}.mt16{margin-top:16px;}
.flex{display:flex;}.ai-c{align-items:center;}.jc-sb{justify-content:space-between;}
.gap4{gap:4px;}.gap8{gap:8px;}.gap12{gap:12px;}.gap16{gap:16px;}
.w100{width:100%;}
.number-input{-moz-appearance:textfield;}
.number-input::-webkit-outer-spin-button,.number-input::-webkit-inner-spin-button{-webkit-appearance:none;}

/* â”€â”€ PestaÃ±as praderas â”€â”€ */
.ptab{padding:8px 18px;border:none;background:none;font-size:13px;font-weight:600;color:var(--gris-calido);cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;border-radius:6px 6px 0 0;transition:all .2s;}
.ptab:hover{background:var(--pasto-suave);color:var(--pasto);}
.ptab-act{color:var(--pasto);border-bottom:3px solid var(--pasto);background:var(--pasto-suave);}

.sw-label{display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none;}
.sw-label input{display:none;}
.sw-track{position:relative;width:44px;height:24px;background:#ccc;border-radius:12px;transition:background .25s;flex-shrink:0;}
.sw-label input:checked + .sw-track{background:var(--pasto);}
.sw-thumb{position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:left .25s;box-shadow:0 1px 3px rgba(0,0,0,.3);}
.sw-label input:checked + .sw-track .sw-thumb{left:23px;}
.sw-text{font-size:11px;font-weight:600;color:var(--texto-medio);min-width:52px;}

</style>
</head>
<body>

<!-- â•â•â• SIDEBAR â•â•â• -->
<nav id="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-icon">ğŸ„</div>
    <div class="sb-logo-text">
      <div class="sb-logo-title">GANADERO SG</div>
      <div class="sb-logo-sub">GestiÃ³n Ganadera</div>
    </div>
  </div>
  <div class="sb-finca" onclick="openFincaModal()">
    <div class="sb-finca-name" id="sb-finca-name">ğŸ¡ INKA</div>
    <div class="sb-finca-meta" id="sb-finca-meta">43 ha Â· cargando...</div>
  </div>
  <div class="sb-nav">
    <div class="sb-section">Principal</div>
    <div class="sb-item act" data-page="dashboard"><span class="sb-icon">ğŸ“Š</span><span>Tablero de Control</span></div>
    <div class="sb-section">Inventario</div>
    <div class="sb-item" data-page="inventario"><span class="sb-icon">ğŸ®</span><span>Animales</span></div>
    <div class="sb-item" data-page="hojavida"><span class="sb-icon">ğŸ“‹</span><span>Hoja de Vida</span></div>
    <div class="sb-section">ProducciÃ³n</div>
    <div class="sb-item" data-page="leche"><span class="sb-icon">ğŸ¥›</span><span>ProducciÃ³n de Leche</span></div>
    <div class="sb-item" data-page="peso"><span class="sb-icon">âš–ï¸</span><span>Control de Peso</span></div>
    <div class="sb-section">GestiÃ³n</div>
    <div class="sb-item" data-page="reproduccion"><span class="sb-icon">ğŸ”¬</span><span>ReproducciÃ³n</span></div>
    <div class="sb-item" data-page="salud"><span class="sb-icon">ğŸ’‰</span><span>Salud</span><span class="sb-badge" id="badge-salud">0</span></div>
    <div class="sb-item" data-page="costos"><span class="sb-icon">ğŸ’°</span><span>Costos</span></div>
    <div class="sb-item" data-page="praderas"><span class="sb-icon">ğŸŒ¿</span><span>Praderas</span></div>
    <div class="sb-item" data-page="lotes"><span class="sb-icon">ğŸ„</span><span>Lotes</span></div>
    <div class="sb-item" data-page="secados"><span class="sb-icon">ğŸ¼</span><span>Secados / Destetes</span></div>
    <div class="sb-section">AnÃ¡lisis</div>
    <div class="sb-item" data-page="simulacion"><span class="sb-icon">ğŸ”®</span><span>Simulaciones</span></div>
    <div class="sb-item" data-page="alertas"><span class="sb-icon">ğŸ””</span><span>Alertas</span><span class="sb-badge" id="badge-alertas">0</span></div>
    <div class="sb-item" data-page="reportes"><span class="sb-icon">ğŸ“‘</span><span>Reportes</span></div>
    <div class="sb-section">ConfiguraciÃ³n</div>
    <div class="sb-item" data-page="ia"><span class="sb-icon">ğŸ¤–</span><span>Asistente IA</span></div>
    <div class="sb-item" data-page="config"><span class="sb-icon">âš™ï¸</span><span>ConfiguraciÃ³n</span></div>
  </div>
  <div class="sb-toggle" onclick="toggleSidebar()">
    <span id="sb-toggle-icon">â—€</span><span id="sb-toggle-text">Colapsar menÃº</span>
  </div>
</nav>

<!-- â•â•â• MAIN â•â•â• -->
<main id="main">
  <div class="topbar">
    <div>
      <div class="topbar-title" id="topbar-title">Tablero de Control</div>
      <div class="topbar-breadcrumb" id="topbar-sub">INKA Â· resumen general</div>
    </div>
    <div class="topbar-actions" id="topbar-actions">
      <!-- dinÃ¡mico por pÃ¡gina -->
    </div>
  </div>

  <div class="content">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DASHBOARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page act" id="page-dashboard">
      <div class="kpi-grid kpi-4" id="dash-kpis"></div>
      <div class="grid-32" style="margin-bottom:16px;">
        <!-- GrÃ¡fica leche -->
        <div class="card">
          <div class="card-title">ğŸ¥› ProducciÃ³n de Leche â€” Ãšltimos 8 meses <span class="card-subtitle" id="dash-leche-total"></span></div>
          <div style="height:170px;position:relative;" id="dash-bar-chart"></div>
          <div style="display:flex;gap:14px;margin-top:10px;font-size:11px;color:var(--gris-calido);">
            <span style="display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:3px;background:var(--pasto);display:inline-block;"></span>Este aÃ±o (L/mes)</span>
            <span style="display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:3px;background:var(--pasto-medio);display:inline-block;"></span>AÃ±o anterior</span>
          </div>
        </div>
        <!-- Radar reproductivo -->
        <div class="card">
          <div class="card-title">ğŸ”¬ Indicadores Clave</div>
          <svg width="100%" viewBox="0 0 220 200" id="dash-radar"></svg>
        </div>
      </div>
      <div class="grid-3">
        <!-- Alertas -->
        <div class="card">
          <div class="card-title">ğŸ”” Alertas Activas</div>
          <div class="alert-list" id="dash-alerts"></div>
          <div style="margin-top:12px;"><button class="btn btn-ghost btn-sm w100" onclick="nav('alertas')">Ver todas â†’</button></div>
        </div>
        <!-- PrÃ³ximos eventos -->
        <div class="card">
          <div class="card-title">ğŸ“… PrÃ³ximos Eventos</div>
          <div id="dash-events"></div>
        </div>
        <!-- Estructura hato -->
        <div class="card">
          <div class="card-title">ğŸ„ Estructura del Hato</div>
          <svg width="100%" viewBox="0 0 220 140" id="dash-donut"></svg>
          <div id="dash-donut-legend" style="display:flex;flex-direction:column;gap:5px;margin-top:10px;font-size:11.5px;"></div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         INVENTARIO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-inventario">
      <div class="search-row">
        <div class="search-input">
          <span style="color:var(--gris-calido);">ğŸ”</span>
          <input type="text" id="inv-search" placeholder="Buscar por nombre, ID, arete, raza..." oninput="renderInventario()">
        </div>
        <label style="display:flex;align-items:center;gap:7px;font-size:13px;font-weight:600;color:var(--texto);cursor:pointer;user-select:none;background:var(--fondo);border:1.5px solid var(--borde);border-radius:8px;padding:6px 12px;">
          <input type="checkbox" id="chk-mostrar-inactivos" onchange="renderInventario()"
            style="width:16px;height:16px;accent-color:var(--pasto);cursor:pointer;">
          Mostrar inactivos
        </label>
        <button class="btn btn-primary" onclick="openModal('modalAnimal')">+ Registrar Animal</button>
        <button class="btn btn-ghost" onclick="abrirImportadorAsoceby()" title="Importar desde certificado PDF de AsocebÃº" style="display:flex;align-items:center;gap:6px;">
          <span>ğŸ„</span> Importar AsocebÃº PDF
        </button>
        <button class="btn btn-ghost" onclick="exportCSV()">ğŸ“¥ Exportar CSV</button>
      </div>
      <div class="filter-chips" style="margin-bottom:14px;" id="inv-chips">
        <span class="chip act" data-cat="Todos">Todos</span>
        <span class="chip" data-cat="Vaca">Vacas</span>
        <span class="chip" data-cat="Novilla">Novillas</span>
        <span class="chip" data-cat="Ternero">Terneros</span>
        <span class="chip" data-cat="Ternera">Terneras</span>
        <span class="chip" data-cat="Toro">Toros</span>
      </div>
      <div class="card" style="padding:0 0 8px;">
        <div class="tbl-wrap">
          <table>
            <thead>
              <tr>
                <th onclick="sortTbl('id')" style="cursor:pointer;">ID â†•</th>
                <th onclick="sortTbl('nombre')" style="cursor:pointer;">Nombre â†•</th>
                <th>CategorÃ­a</th>
                <th>Raza</th>
                <th onclick="sortTbl('edad')" style="cursor:pointer;">Edad â†•</th>
                <th onclick="sortTbl('peso')" style="cursor:pointer;">Peso kg â†•</th>
                <th>Estado</th>
                <th onclick="sortTbl('litros')" style="cursor:pointer;">kg/dÃ­a â†•</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="inv-tbody"></tbody>
          </table>
        </div>
        <div style="padding:12px 16px 4px;display:flex;justify-content:space-between;align-items:center;font-size:11px;color:var(--gris-calido);" id="inv-footer"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HOJA DE VIDA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-hojavida">
      <div id="hoja-empty" class="empty-state">
        <div class="es-icon">ğŸ“‹</div>
        <div class="es-text">Selecciona un animal</div>
        <div class="es-sub">Ve al inventario y haz clic en "Ver" para abrir la hoja de vida</div>
        <div style="margin-top:16px;"><button class="btn btn-ghost" onclick="nav('inventario')">Ir a Inventario</button></div>
      </div>
      <div class="hoja-wrap" id="hoja-content">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
          <button class="btn btn-ghost btn-sm" onclick="nav('inventario')">â† Volver</button>
          <div style="font-size:12px;color:var(--gris-calido);">Hoja de Vida del Animal</div>
          <div style="margin-left:auto;display:flex;gap:8px;">
            <button class="btn btn-ghost btn-sm" onclick="editAnimalActivo()">âœï¸ Editar</button>
            <button class="btn btn-danger btn-sm" onclick="deleteAnimalActivo()">ğŸ—‘ Eliminar</button>
          </div>
        </div>
        <div class="hoja-header" id="hoja-header-content"></div>
        <div class="hoja-tabs" id="hoja-tabs">
          <span class="hoja-tab act" data-htab="info">InformaciÃ³n</span>
          <span class="hoja-tab" data-htab="reproductivo">Reproductivo</span>
          <span class="hoja-tab" data-htab="produccion">ProducciÃ³n</span>
          <span class="hoja-tab" data-htab="salud-tab">Salud</span>
          <span class="hoja-tab" data-htab="historia">Historial</span>
        </div>
        <div id="hoja-tab-info" class="htab-body act"></div>
        <div id="hoja-tab-reproductivo" class="htab-body"></div>
        <div id="hoja-tab-produccion" class="htab-body"></div>
        <div id="hoja-tab-salud-tab" class="htab-body"></div>
        <div id="hoja-tab-historia" class="htab-body"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LECHE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-leche">
      <div class="kpi-grid kpi-4" id="leche-kpis"></div>
      <div class="grid-32" style="margin-bottom:16px;">
        <div class="card">
          <div class="card-title">ğŸ“ˆ Curva de Lactancia del Hato</div>
          <svg width="100%" viewBox="0 0 520 180" id="lactancia-svg"></svg>
        </div>
        <div class="card">
          <div class="card-title">ğŸ† Ranking Vacas Productoras</div>
          <div id="ranking-vacas"></div>
        </div>
      </div>
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">Control de Leche â€” Registro Diario</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalLeche')">+ Registrar Control</button>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead>
              <tr><th>Fecha</th><th>Animal</th><th>OrdeÃ±o 1 (kg)</th><th>OrdeÃ±o 2 (kg)</th><th>Total kg</th><th>ObservaciÃ³n</th><th>Acciones</th></tr>
            </thead>
            <tbody id="leche-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PESO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-peso">
      <div class="kpi-grid kpi-4" id="peso-kpis"></div>

      <!-- PestaÃ±as por categorÃ­a -->
      <div class="card" style="margin-bottom:16px;padding-bottom:0;">
        <div style="display:flex;align-items:center;gap:0;border-bottom:2px solid var(--borde);overflow-x:auto;" id="peso-tabs-bar">
          <!-- generado por JS -->
        </div>
        <div style="padding:16px 0 0 0;" id="peso-tab-content">
          <!-- generado por JS -->
        </div>
      </div>

      <!-- GrÃ¡fica y distribuciÃ³n general -->
      <div class="grid-2" style="margin-bottom:16px;">
        <div class="card">
          <div class="card-title">âš–ï¸ Curva de Crecimiento â€” CategorÃ­a activa</div>
          <svg width="100%" viewBox="0 0 520 200" id="peso-svg"></svg>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“Š Peso promedio por categorÃ­a</div>
          <div id="peso-distrib"></div>
        </div>
      </div>

      <!-- Registros generales -->
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">Todos los Pesajes</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalPeso')">+ Registrar Peso</button>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>Fecha</th><th>Animal</th><th>CategorÃ­a</th><th>Peso kg</th><th>Ganancia g/dÃ­a</th><th>ObservaciÃ³n</th><th>AcciÃ³n</th></tr></thead>
            <tbody id="peso-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         REPRODUCCIÃ“N
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-reproduccion">
      <div class="ind-grid" id="repro-indicadores"></div>
      <div class="grid-2" style="margin-bottom:16px;">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
            <div class="card-title" style="margin:0;">ğŸ£ Partos Registrados</div>
            <button class="btn btn-primary btn-sm" onclick="openModal('modalParto')">+ Registrar Parto</button>
          </div>
          <div class="tbl-wrap">
            <table>
              <thead><tr><th>Fecha</th><th>Madre</th><th>Peso Madre (kg)</th><th>CrÃ­a</th><th>Sexo</th><th>Peso CrÃ­a (kg)</th><th>MÃ©todo</th><th>Tipo</th><th>Estado</th></tr></thead>
              <tbody id="partos-tbody"></tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
            <div class="card-title" style="margin:0;">ğŸ”¬ Servicios / Inseminaciones</div>
            <button class="btn btn-primary btn-sm" onclick="openModal('modalServicio')">+ Registrar Servicio</button>
          </div>
          <div class="tbl-wrap">
            <table>
              <thead><tr><th>Fecha</th><th>Animal</th><th>MÃ©todo</th><th>Toro/Semen</th><th>DiagnÃ³stico</th><th>Resultado</th></tr></thead>
              <tbody id="servicios-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">ğŸ—“ Partos Esperados â€” PrÃ³ximos 90 dÃ­as</div>
        </div>
        <div id="partos-esperados"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SALUD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-salud">
      <div class="kpi-grid kpi-4" id="salud-kpis"></div>
      <div class="card" style="margin-bottom:16px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">ğŸ’Š Animales en Tratamiento</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalSalud')">+ Registrar Evento</button>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>Animal</th><th>DiagnÃ³stico</th><th>Tratamiento</th><th>Fecha Inicio</th><th>Retiro Leche</th><th>Retiro Carne</th><th>Estado</th><th>AcciÃ³n</th></tr></thead>
            <tbody id="salud-tbody"></tbody>
          </table>
        </div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ’‰ PrÃ³ximas Vacunaciones</div>
          <div id="vacunaciones-list"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“Š Enfermedades Frecuentes</div>
          <div id="enfermedades-chart"></div>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <div class="card-title">ğŸ§ª Protocolos de InducciÃ³n del Estro / FIV</div>
        <div id="salud-protocolos"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         COSTOS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-costos">

      <!-- Barra de control: perÃ­odo + vista -->
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:18px;flex-wrap:wrap;">
        <div style="font-family:'Fraunces',serif;font-size:18px;font-weight:700;">ğŸ’° EconomÃ­a de la Finca</div>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <!-- Vista mes / aÃ±o -->
          <div style="display:flex;border:1.5px solid var(--arena);border-radius:9px;overflow:hidden;">
            <button id="costo-vista-mes-btn" onclick="setCostoVista('mes')"
              style="padding:6px 14px;font-size:12px;font-weight:700;border:none;cursor:pointer;background:var(--pasto);color:#fff;font-family:'Sora',sans-serif;">Por Mes</button>
            <button id="costo-vista-aÃ±o-btn" onclick="setCostoVista('aÃ±o')"
              style="padding:6px 14px;font-size:12px;font-weight:700;border:none;cursor:pointer;background:#fff;color:var(--texto-medio);font-family:'Sora',sans-serif;">Por AÃ±o</button>
          </div>
          <!-- Selector mes -->
          <select class="form-control" style="width:auto;padding:6px 10px;font-size:12px;" id="costo-mes-sel" onchange="renderCostos()"></select>
          <!-- Selector aÃ±o -->
          <select class="form-control" style="width:auto;padding:6px 10px;font-size:12px;" id="costo-aÃ±o-sel" onchange="renderCostos()">
            <option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option>
          </select>
          <button class="btn btn-ghost btn-sm" onclick="openModal('modalCostosFijos')">âš™ï¸ Costos Fijos</button>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalGasto')">+ Registrar Gasto</button>
        </div>
      </div>

      <div class="kpi-grid kpi-4" id="costos-kpis"></div>

      <!-- GrÃ¡fico tendencia anual (siempre visible) -->
      <div class="card" style="margin-bottom:16px;">
        <div class="card-title" id="costos-chart-title">ğŸ“Š Ingresos vs Costos â€” Tendencia</div>
        <div id="costos-chart-bars" style="display:flex;align-items:flex-end;gap:4px;height:120px;padding-bottom:20px;position:relative;overflow-x:auto;"></div>
      </div>

      <div class="grid-32" style="margin-bottom:16px;">
        <div class="card">
          <div class="card-title" id="costos-er-title">ğŸ’¹ Estado de Resultados</div>
          <div id="costos-er"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ© DistribuciÃ³n de Costos</div>
          <svg width="100%" viewBox="0 0 220 200" id="costos-donut"></svg>
          <div id="costos-legend" style="display:flex;flex-direction:column;gap:5px;margin-top:8px;font-size:11.5px;"></div>
        </div>
      </div>

      <!-- Costos Fijos del mes / aÃ±o -->
      <div class="card" style="margin-bottom:16px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">ğŸ“Œ Costos Fijos Configurados</div>
          <button class="btn btn-ghost btn-sm" onclick="openModal('modalCostosFijos')">âœï¸ Editar</button>
        </div>
        <div id="costos-fijos-resumen"></div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">ğŸ“ Registro de Gastos Variables</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalGasto')">+ Registrar Gasto</button>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>Fecha</th><th>CategorÃ­a</th><th>Concepto</th><th>Monto</th><th>Proveedor</th><th>AcciÃ³n</th></tr></thead>
            <tbody id="gastos-tbody"></tbody>
          </table>
        </div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div class="card-title">ğŸ¥› HistÃ³rico Venta de Leche</div>
        <div id="costos-leche-hist"></div>
      </div>
    </div>
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-praderas">
      <div class="kpi-grid kpi-4" id="praderas-kpis"></div>

      <!-- PestaÃ±as -->
      <div style="display:flex;gap:4px;margin-bottom:16px;border-bottom:2px solid var(--borde);padding-bottom:0;">
        <button id="ptab-potreros" class="ptab ptab-act" onclick="switchPraderaTab('potreros')">ğŸŒ¿ Potreros</button>
        <button id="ptab-historial" class="ptab" onclick="switchPraderaTab('historial')">ğŸ“‹ Historial de Potreros</button>
        <button id="ptab-produccion" class="ptab" onclick="switchPraderaTab('produccion')">ğŸ“Š ProducciÃ³n / ha</button>
      </div>

      <!-- Tab: Potreros -->
      <div id="pradera-tab-potreros">
        <div class="card" style="margin-bottom:16px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
            <div class="card-title" style="margin:0;">ğŸŒ¿ GestiÃ³n de Potreros â€” 43 ha Â· 25 potreros Â· La Casa: Ã¡rea real medida</div>
            <button class="btn btn-primary btn-sm" onclick="openModal('modalPotrero')">+ Nuevo Potrero</button>
          </div>
          <div class="tbl-wrap">
            <table>
              <thead><tr><th>Nombre</th><th>Ãrea</th><th>Pasto</th><th>Estado</th><th>Anim.</th><th>Kg vivos</th><th>ğŸ¥› L/dÃ­a</th><th>L/ha/d</th><th>ğŸ“… Entrada</th><th>ğŸ“… Salida</th><th>DÃ­as Ocup.</th><th>DÃ­as Desc.</th><th style="min-width:160px">Ocupar / Descanso</th></tr></thead>
              <tbody id="praderas-tbody"></tbody>
            </table>
          </div>
        </div>
        <div id="praderas-especial"></div>
      </div>

      <!-- Tab: Historial de Potreros -->
      <div id="pradera-tab-historial" style="display:none;">
        <div id="praderas-historial-content" style="overflow-x:auto;"></div>
      </div>

      <!-- Tab: ProducciÃ³n / ha -->
      <div id="pradera-tab-produccion" style="display:none;">
        <div id="praderas-produccion"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LOTES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-lotes">
      <div class="kpi-grid kpi-4" id="lotes-kpis"></div>
      <div class="card" style="margin-bottom:16px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;">
          <div class="card-title" style="margin:0;">ğŸ„ Lotes de Animales</div>
          <button class="btn btn-primary btn-sm" onclick="openModalNuevoLote()">+ Nuevo Lote</button>
        </div>
        <div id="lotes-lista"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SECADOS / DESTETES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-secados">
      <div style="margin-bottom:6px;">
        <div class="section-title">ğŸ¼ Secados / Destetes</div>
        <div class="section-sub">Registro de secado de vacas (fin de lactancia) y destete de terneros â€” Inversiones Kosta Azul / Finca INKA</div>
      </div>
      <div class="kpi-grid kpi-4" id="secados-kpis"></div>

      <!-- PestaÃ±as -->
      <div class="card" style="margin-bottom:16px;padding-bottom:0;">
        <div style="display:flex;gap:0;border-bottom:2px solid var(--borde);overflow-x:auto;">
          <button class="tab-btn act" id="stab-secados" onclick="setSecadoTab('secados')" style="padding:10px 18px;border:none;background:none;cursor:pointer;font-weight:600;color:var(--pasto);border-bottom:2px solid var(--pasto);margin-bottom:-2px;">ğŸ›‘ Secados</button>
          <button class="tab-btn" id="stab-destetes" onclick="setSecadoTab('destetes')" style="padding:10px 18px;border:none;background:none;cursor:pointer;font-weight:500;color:var(--gris-calido);border-bottom:2px solid transparent;margin-bottom:-2px;">ğŸ¼ Destetes</button>
          <button class="tab-btn" id="stab-histsecados" onclick="setSecadoTab('histsecados')" style="padding:10px 18px;border:none;background:none;cursor:pointer;font-weight:500;color:var(--gris-calido);border-bottom:2px solid transparent;margin-bottom:-2px;">ğŸ“Š AnÃ¡lisis</button>
        </div>
      </div>

      <!-- Contenido pestaÃ±a Secados -->
      <div id="secados-panel-secados">
        <div class="card" style="margin-bottom:16px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;">
            <div class="card-title" style="margin:0;">ğŸ›‘ Registro de Secados (Fin de lactancia)</div>
            <button class="btn btn-primary btn-sm" onclick="openModal('modalSecado')">+ Registrar Secado</button>
          </div>
          <div class="tbl-wrap">
            <table>
              <thead>
                <tr>
                  <th>Fecha Secado</th><th>Vaca</th><th>Peso Madre (kg)</th>
                  <th>Ãšltima leche</th><th>DÃ­as en ordeÃ±o</th>
                  <th>Parto siguiente (estimado)</th><th>ObservaciÃ³n</th><th>AcciÃ³n</th>
                </tr>
              </thead>
              <tbody id="secados-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Contenido pestaÃ±a Destetes -->
      <div id="secados-panel-destetes" style="display:none;">
        <div class="card" style="margin-bottom:16px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;">
            <div class="card-title" style="margin:0;">ğŸ¼ Registro de Destetes</div>
            <button class="btn btn-primary btn-sm" onclick="openModal('modalDestete')">+ Registrar Destete</button>
          </div>
          <div class="tbl-wrap">
            <table>
              <thead>
                <tr>
                  <th>Fecha Destete</th><th>Madre</th><th>Peso Madre (kg)</th>
                  <th>CrÃ­a</th><th>Peso CrÃ­a (kg)</th><th>Edad crÃ­a</th>
                  <th>Sexo</th><th>ObservaciÃ³n</th><th>AcciÃ³n</th>
                </tr>
              </thead>
              <tbody id="destetes-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Contenido pestaÃ±a AnÃ¡lisis -->
      <div id="secados-panel-histsecados" style="display:none;">
        <div class="grid-2" style="margin-bottom:16px;">
          <div class="card">
            <div class="card-title">ğŸ“ˆ Peso madre vs peso crÃ­a al destete</div>
            <div id="secados-chart-scatter" style="min-height:180px;"></div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ“Š Destetes por mes</div>
            <svg width="100%" viewBox="0 0 400 180" id="secados-chart-mes"></svg>
          </div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“‹ Resumen tÃ©cnico 2024</div>
          <div id="secados-resumen"></div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SIMULACIÃ“N
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-simulacion">
      <div style="margin-bottom:6px;">
        <div class="section-title">ğŸ”® Simulador de Escenarios</div>
        <div class="section-sub">Â¿QuÃ© pasarÃ­a siâ€¦? â€” Cambia las variables y ve el impacto en tiempo real</div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">âš™ï¸ Variables del Modelo</div>
          <div id="sim-controls"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“Š Resultado del Escenario</div>
          <div id="sim-results"></div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ALERTAS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-alertas">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ”´ Alertas Urgentes</div>
          <div class="alert-list" id="alertas-urgentes"></div>
        </div>
        <div class="card">
          <div class="card-title">ğŸŸ¡ Alertas Medias</div>
          <div class="alert-list" id="alertas-medias"></div>
        </div>
      </div>
      <div style="margin-top:16px;">
        <div class="card">
          <div class="card-title">ğŸŸ¢ Informativas</div>
          <div class="alert-list" id="alertas-info"></div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         REPORTES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-reportes">
      <div class="section-title" style="margin-bottom:18px;">ğŸ“‘ Reportes y Exportaciones</div>
      <div class="grid-3">
        <div class="card" style="text-align:center;cursor:pointer;" onclick="generarReporte('inventario')">
          <div style="font-size:36px;margin-bottom:10px;">ğŸ“‹</div>
          <div style="font-weight:700;font-size:14px;">Inventario Completo</div>
          <div class="muted text-xs mt4">Todos los animales con datos completos</div>
          <div style="margin-top:12px;"><span class="tag tag-verde">CSV Â· PDF</span></div>
        </div>
        <div class="card" style="text-align:center;cursor:pointer;" onclick="generarReporte('produccion')">
          <div style="font-size:36px;margin-bottom:10px;">ğŸ¥›</div>
          <div style="font-weight:700;font-size:14px;">Reporte de ProducciÃ³n</div>
          <div class="muted text-xs mt4">Leche, pesos, lactancias por perÃ­odo</div>
          <div style="margin-top:12px;"><span class="tag tag-azul">Mensual Â· Anual</span></div>
        </div>
        <div class="card" style="text-align:center;cursor:pointer;" onclick="generarReporte('reproductivo')">
          <div style="font-size:36px;margin-bottom:10px;">ğŸ”¬</div>
          <div style="font-weight:700;font-size:14px;">Informe Reproductivo</div>
          <div class="muted text-xs mt4">Tasas, intervalos, natalidad</div>
          <div style="margin-top:12px;"><span class="tag tag-morado">Completo</span></div>
        </div>
        <div class="card" style="text-align:center;cursor:pointer;" onclick="generarReporte('costos')">
          <div style="font-size:36px;margin-bottom:10px;">ğŸ’°</div>
          <div style="font-weight:700;font-size:14px;">Estado de Resultados</div>
          <div class="muted text-xs mt4">Ingresos, costos, utilidad</div>
          <div style="margin-top:12px;"><span class="tag tag-amarillo">Gerencial</span></div>
        </div>
        <div class="card" style="text-align:center;cursor:pointer;" onclick="generarReporte('salud')">
          <div style="font-size:36px;margin-bottom:10px;">ğŸ’Š</div>
          <div style="font-weight:700;font-size:14px;">Reporte Sanitario</div>
          <div class="muted text-xs mt4">Tratamientos, vacunaciones, morbilidad</div>
          <div style="margin-top:12px;"><span class="tag tag-rojo">Historial</span></div>
        </div>
        <div class="card" style="text-align:center;cursor:pointer;" onclick="generarReporte('ranking')">
          <div style="font-size:36px;margin-bottom:10px;">ğŸ†</div>
          <div style="font-weight:700;font-size:14px;">Ranking de Vacas</div>
          <div class="muted text-xs mt4">De la mejor a la menos productiva</div>
          <div style="margin-top:12px;"><span class="tag tag-verde">Ãndice SG</span></div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ASISTENTE IA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-ia">
      <div style="max-width:760px;margin:0 auto;">

        <!-- ConfiguraciÃ³n API Key (se muestra solo si no estÃ¡ guardada) -->
        <div class="card" id="ia-apikey-card" style="margin-bottom:16px;border:2px solid var(--sol);display:none;">
          <div class="card-title">ğŸ”‘ Configurar API Key de Anthropic</div>
          <p style="font-size:13px;color:var(--gris-calido);margin-bottom:12px;">
            Para usar el Asistente IA necesitas una API Key de Anthropic.
            Puedes obtenerla gratis en <a href="https://console.anthropic.com" target="_blank" style="color:var(--pasto);">console.anthropic.com</a>.
            La clave se guarda solo en tu navegador (localStorage) y nunca se envÃ­a a ningÃºn servidor externo.
          </p>
          <div style="display:flex;gap:10px;align-items:center;">
            <input type="password" id="ia-apikey-input" placeholder="sk-ant-api03-..."
              style="flex:1;border:1.5px solid var(--borde);border-radius:8px;padding:9px 12px;font-size:13px;font-family:monospace;">
            <button onclick="iaGuardarKey()" class="btn btn-primary">Guardar y activar</button>
            <button onclick="document.getElementById('ia-apikey-card').style.display='none'" class="btn btn-ghost">Cancelar</button>
          </div>
        </div>

        <!-- Header -->
        <div class="card" style="margin-bottom:16px;background:linear-gradient(135deg,#1b5e35 0%,#2d7a4f 100%);color:#fff;border:none;">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div style="display:flex;align-items:center;gap:14px;">
              <div style="font-size:40px;">ğŸ¤–</div>
              <div>
                <div style="font-size:18px;font-weight:800;letter-spacing:-0.5px;">Asistente IA â€” Finca INKA</div>
                <div style="font-size:12px;opacity:0.85;margin-top:2px;">Pregunta sobre tus animales, reproducciÃ³n, producciÃ³n, costos o manejo del hato</div>
              </div>
            </div>
            <button onclick="iaConfigKey()" title="Configurar API Key"
              style="background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.4);color:#fff;border-radius:8px;padding:6px 12px;cursor:pointer;font-size:12px;">
              ğŸ”‘ API Key
            </button>
          </div>
          <!-- Sugerencias rÃ¡pidas -->
          <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:14px;" id="ia-sugerencias">
            <button onclick="iaPreguntar('Â¿QuÃ© vacas tienen mÃ¡s de 120 dÃ­as abiertos?')" class="ia-sug">ğŸ„ DÃ­as abiertos crÃ­ticos</button>
            <button onclick="iaPreguntar('Â¿CuÃ¡les son los partos esperados prÃ³ximamente?')" class="ia-sug">ğŸ£ Partos prÃ³ximos</button>
            <button onclick="iaPreguntar('Â¿CuÃ¡l es el estado reproductivo del hato?')" class="ia-sug">ğŸ”¬ Estado reproductivo</button>
            <button onclick="iaPreguntar('Â¿QuÃ© animales no han sido pesados en mÃ¡s de 30 dÃ­as?')" class="ia-sug">âš–ï¸ Sin pesar +30d</button>
            <button onclick="iaPreguntar('Â¿CuÃ¡l es la producciÃ³n de leche del hato?')" class="ia-sug">ğŸ¥› ProducciÃ³n leche</button>
            <button onclick="iaPreguntar('Dame un resumen general del hato con recomendaciones')" class="ia-sug">ğŸ“Š Resumen del hato</button>
          </div>
        </div>

        <!-- Estado API key -->
        <div id="ia-status-bar" style="margin-bottom:12px;padding:8px 14px;border-radius:8px;font-size:12px;font-weight:600;"></div>

        <!-- Chat window -->
        <div class="card" style="padding:0;overflow:hidden;">
          <div id="ia-mensajes" style="height:420px;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px;background:#fafaf8;">
            <div class="ia-msg">
              <div class="ia-avatar">ğŸ¤–</div>
              <div class="ia-bubble">
                Â¡Hola! Soy el asistente IA de la Finca INKA. Tengo acceso completo al hato: inventario, producciÃ³n de leche, pesajes, reproducciÃ³n, salud y costos.<br><br>
                <strong>Para empezar</strong>, haz clic en <strong>ğŸ”‘ API Key</strong> (arriba a la derecha) e ingresa tu clave de Anthropic. Es gratuita y solo se guarda en tu navegador.
              </div>
            </div>
          </div>
          <!-- Input -->
          <div style="padding:14px 16px;border-top:1px solid var(--borde);display:flex;gap:10px;background:#fff;">
            <input id="ia-input" type="text" placeholder="Escribe tu pregunta sobre el hato..."
              style="flex:1;border:1.5px solid var(--borde);border-radius:10px;padding:10px 14px;font-size:13px;font-family:inherit;outline:none;"
              onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();iaEnviar();}"
              onfocus="this.style.borderColor='var(--pasto)'" onblur="this.style.borderColor='var(--borde)'">
            <button onclick="iaEnviar()" id="ia-btn-enviar"
              style="background:var(--pasto);color:#fff;border:none;border-radius:10px;padding:10px 20px;font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap;">
              Enviar â†‘
            </button>
          </div>
        </div>
        <div style="margin-top:10px;font-size:11px;color:var(--gris-calido);text-align:center;">
          ğŸ”’ La API Key se guarda solo en tu navegador. Los datos del hato se envÃ­an a Anthropic Ãºnicamente al hacer una consulta.
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         CONFIG
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-config">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">ğŸ¡ Datos de la Finca</div>
          <div class="form-grid fg-2" id="config-finca-form"></div>
          <div style="margin-top:14px;"><button class="btn btn-primary" onclick="guardarConfig()">ğŸ’¾ Guardar</button></div>
        </div>
        <div class="card">
          <div class="card-title">âš™ï¸ ParÃ¡metros del Sistema</div>
          <div id="config-params"></div>
          <div style="margin-top:14px;"><button class="btn btn-primary" onclick="guardarParams()">ğŸ’¾ Guardar</button></div>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <div class="card-title">ğŸ—‘ GestiÃ³n de Datos</div>
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <button class="btn btn-ghost" onclick="exportarTodo()">ğŸ“¤ Exportar todo (JSON)</button>
          <button class="btn btn-ghost" onclick="importarDatos()">ğŸ“¥ Importar datos</button>
          <button class="btn btn-danger" onclick="resetDatos()">âš ï¸ Limpiar todos los datos</button>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- ANIMAL -->
<div class="overlay" id="modalAnimal">
  <div class="modal" style="max-width:680px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ„</div>
      <div><div class="modal-title" id="modal-animal-title">Registrar Animal</div><div class="modal-sub">Complete todos los datos del animal</div></div>
      <span class="modal-close" onclick="closeModal('modalAnimal')">âœ•</span>
    </div>
    <div class="modal-body">
      <input type="hidden" id="anim-edit-id">
      <div class="form-grid fg-3" style="margin-bottom:14px;">
        <div class="form-group">
          <label class="form-label">ID / NÃºmero</label>
          <input class="form-control" id="anim-id" placeholder="VCA-0001">
        </div>
        <div class="form-group" style="grid-column:span 2;">
          <label class="form-label">Nombre</label>
          <input class="form-control" id="anim-nombre" placeholder="Nombre del animal">
        </div>
      </div>
      <div class="form-grid fg-3" style="margin-bottom:14px;">
        <div class="form-group">
          <label class="form-label">CategorÃ­a</label>
          <select class="form-control" id="anim-categoria">
            <option>Vaca</option><option>Novilla</option><option>Ternera</option><option>Ternero</option><option>Toro</option><option>BÃºfalo</option>
          </select>
        </div>
        <div class="form-group" style="grid-column:span 2;">
          <label class="form-label">ComposiciÃ³n GenÃ©tica (razas + %)</label>
          <div id="genetica-rows" style="display:flex;flex-direction:column;gap:6px;margin-bottom:6px;"></div>
          <button type="button" class="btn btn-ghost btn-sm" onclick="addRazaRow()" style="width:100%;">+ Agregar raza</button>
          <div style="margin-top:6px;font-size:11px;" id="genetica-resumen"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Color / SeÃ±ales</label>
          <input class="form-control" id="anim-color" placeholder="Ej: Negro manchado">
        </div>
      </div>
      <div class="form-grid fg-3" style="margin-bottom:14px;">
        <div class="form-group">
          <label class="form-label">Fecha de Nacimiento</label>
          <input type="date" class="form-control" id="anim-nacimiento">
        </div>
        <div class="form-group">
          <label class="form-label">Peso actual (kg)</label>
          <input type="number" class="form-control number-input" id="anim-peso" placeholder="450">
        </div>
        <div class="form-group">
          <label class="form-label">CondiciÃ³n Corporal (1-5)</label>
          <input type="number" class="form-control number-input" id="anim-cc" placeholder="3.0" min="1" max="5" step="0.5">
        </div>
      </div>
      <div class="form-grid fg-3" style="margin-bottom:14px;">
        <div class="form-group">
          <label class="form-label">Estado Productivo</label>
          <select class="form-control" id="anim-estado">
            <option value="activa">En producciÃ³n</option>
            <option value="seca">Seca</option>
            <option value="gestante">Gestante</option>
            <option value="preparto">Preparto</option>
            <option value="venta">Para venta</option>
            <option value="baja">Baja</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Potrero / Lote</label>
          <select class="form-control" id="anim-potrero">
            <option>Potrero 1 â€” El Palmar</option>
            <option>Potrero 2 â€” La Sabana</option>
            <option>Potrero 3 â€” El RincÃ³n</option>
            <option>Potrero 4 â€” Los Nogales</option>
            <option>Corral Maternidad</option>
            <option>Corral Destete</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ProducciÃ³n L/dÃ­a</label>
          <input type="number" class="form-control number-input" id="anim-litros" placeholder="0">
        </div>
      </div>
      <div class="form-grid fg-3" style="margin-bottom:14px;">
        <div class="form-group">
          <label class="form-label">Nombre del Padre</label>
          <input class="form-control" id="anim-padre" placeholder="Semen / Toro">
        </div>
        <div class="form-group">
          <label class="form-label">Nombre de la Madre</label>
          <input class="form-control" id="anim-madre" placeholder="Nombre madre">
        </div>
        <div class="form-group">
          <label class="form-label">NÂº CrÃ­as nacidas</label>
          <input type="number" class="form-control number-input" id="anim-partos" placeholder="0">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Observaciones</label>
        <textarea class="form-control" id="anim-obs" placeholder="Notas adicionales..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalAnimal')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarAnimal()">ğŸ’¾ Guardar Animal</button>
    </div>
  </div>
</div>

<!-- CONTROL LECHE -->
<div class="overlay" id="modalLeche">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ¥›</div>
      <div><div class="modal-title">Registrar Control de Leche</div><div class="modal-sub">Ingrese la producciÃ³n del dÃ­a</div></div>
      <span class="modal-close" onclick="closeModal('modalLeche')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group">
          <label class="form-label">Fecha</label>
          <input type="date" class="form-control" id="leche-fecha">
        </div>
        <div class="form-group">
          <label class="form-label">Animal</label>
          <select class="form-control" id="leche-animal"></select>
        </div>
        <div class="form-group">
          <label class="form-label">OrdeÃ±o 1 (kg)</label>
          <input type="number" class="form-control number-input" id="leche-o1" placeholder="0">
        </div>
        <div class="form-group">
          <label class="form-label">OrdeÃ±o 2 (kg)</label>
          <input type="number" class="form-control number-input" id="leche-o2" placeholder="0">
        </div>
        <div class="form-group" style="grid-column:span 2;">
          <label class="form-label">ObservaciÃ³n</label>
          <input class="form-control" id="leche-obs" placeholder="Ej: muestra mastitis, color anormal...">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalLeche')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarLeche()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- PESO -->
<div class="overlay" id="modalPeso">
  <div class="modal" style="max-width:480px;">
    <div class="modal-header">
      <div class="modal-icon">âš–ï¸</div>
      <div><div class="modal-title">Registrar Pesaje</div><div class="modal-sub">Control de peso del animal</div></div>
      <span class="modal-close" onclick="closeModal('modalPeso')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-control" id="peso-fecha"></div>
        <div class="form-group"><label class="form-label">Animal</label><select class="form-control" id="peso-animal"></select></div>
        <div class="form-group"><label class="form-label">Peso (kg)</label><input type="number" class="form-control number-input" id="peso-kg" placeholder="450"></div>
        <div class="form-group"><label class="form-label">CondiciÃ³n Corporal</label><input type="number" class="form-control number-input" id="peso-cc" placeholder="3.0" min="1" max="5" step="0.5"></div>
        <div class="form-group" style="grid-column:span 2;"><label class="form-label">ObservaciÃ³n</label><input class="form-control" id="peso-obs" placeholder="Notas..."></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalPeso')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarPeso()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- PARTO -->
<div class="overlay" id="modalParto">
  <div class="modal" style="max-width:560px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ£</div>
      <div><div class="modal-title">Registrar Parto</div><div class="modal-sub">Datos del nacimiento</div></div>
      <span class="modal-close" onclick="closeModal('modalParto')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group"><label class="form-label">Fecha del Parto</label><input type="date" class="form-control" id="parto-fecha"></div>
        <div class="form-group"><label class="form-label">Madre</label><select class="form-control" id="parto-madre"></select></div>
        <div class="form-group"><label class="form-label">ID de la CrÃ­a</label><input class="form-control" id="parto-cria-id" placeholder="TRN-0001"></div>
        <div class="form-group"><label class="form-label">Nombre CrÃ­a (opcional)</label><input class="form-control" id="parto-cria-nombre"></div>
        <div class="form-group"><label class="form-label">Sexo</label><select class="form-control" id="parto-sexo"><option>Macho</option><option>Hembra</option></select></div>
        <div class="form-group"><label class="form-label">Peso Madre (kg)</label><input type="number" class="form-control number-input" id="parto-peso-madre" placeholder="450"></div>
        <div class="form-group"><label class="form-label">Peso CrÃ­a al nacer (kg)</label><input type="number" class="form-control number-input" id="parto-peso" placeholder="35"></div>
        <div class="form-group"><label class="form-label">Tipo de parto</label><select class="form-control" id="parto-tipo"><option>Natural</option><option>Asistido</option><option>CesÃ¡rea</option></select></div>
        <div class="form-group"><label class="form-label">Facilidad de parto (1-5)</label><input type="number" class="form-control number-input" id="parto-facilidad" min="1" max="5"></div>
        <div class="form-group" style="grid-column:span 2;"><label class="form-label">Observaciones</label><textarea class="form-control" id="parto-obs" rows="2"></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalParto')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarParto()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- SERVICIO -->
<div class="overlay" id="modalServicio">
  <div class="modal" style="max-width:540px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ”¬</div>
      <div><div class="modal-title">Registrar Servicio</div><div class="modal-sub">Monta o inseminaciÃ³n artificial</div></div>
      <span class="modal-close" onclick="closeModal('modalServicio')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-control" id="serv-fecha"></div>
        <div class="form-group"><label class="form-label">Animal</label><select class="form-control" id="serv-animal"></select></div>
        <div class="form-group"><label class="form-label">MÃ©todo</label><select class="form-control" id="serv-metodo"><option>IA â€” InseminaciÃ³n Artificial</option><option>IATF â€” Tiempo Fijo</option><option>Monta Natural</option><option>TE â€” Transferencia Embriones</option></select></div>
        <div class="form-group"><label class="form-label">Toro / Semen</label><input class="form-control" id="serv-toro" placeholder="Nombre o cÃ³digo"></div>
        <div class="form-group"><label class="form-label">DiagnÃ³stico a los 45d</label><select class="form-control" id="serv-diag"><option value="">Pendiente</option><option value="preÃ±ada">PreÃ±ada</option><option value="vacia">VacÃ­a</option></select></div>
        <div class="form-group"><label class="form-label">Inseminador</label><input class="form-control" id="serv-insem" placeholder="Nombre del inseminador"></div>
        <div class="form-group" style="grid-column:span 2;"><label class="form-label">Observaciones</label><input class="form-control" id="serv-obs"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalServicio')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarServicio()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- SALUD -->
<div class="overlay" id="modalSalud">
  <div class="modal" style="max-width:560px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ’Š</div>
      <div><div class="modal-title">Registrar Evento Sanitario</div><div class="modal-sub">DiagnÃ³stico y tratamiento</div></div>
      <span class="modal-close" onclick="closeModal('modalSalud')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-control" id="sal-fecha"></div>
        <div class="form-group"><label class="form-label">Animal</label><select class="form-control" id="sal-animal"></select></div>
        <div class="form-group"><label class="form-label">DiagnÃ³stico</label><input class="form-control" id="sal-diagnostico" placeholder="Ej: Mastitis ClÃ­nica"></div>
        <div class="form-group"><label class="form-label">Tratamiento</label><input class="form-control" id="sal-tratamiento" placeholder="Medicamento y dosis"></div>
        <div class="form-group"><label class="form-label">DÃ­as de retiro â€” Leche</label><input type="number" class="form-control number-input" id="sal-retiro-leche" placeholder="0"></div>
        <div class="form-group"><label class="form-label">DÃ­as de retiro â€” Carne</label><input type="number" class="form-control number-input" id="sal-retiro-carne" placeholder="0"></div>
        <div class="form-group"><label class="form-label">Veterinario</label><input class="form-control" id="sal-vet" placeholder="Nombre del veterinario"></div>
        <div class="form-group"><label class="form-label">Estado</label><select class="form-control" id="sal-estado"><option>En tratamiento</option><option>Mejorando</option><option>Alta</option><option>Grave</option></select></div>
        <div class="form-group" style="grid-column:span 2;"><label class="form-label">Observaciones</label><textarea class="form-control" id="sal-obs" rows="2"></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalSalud')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarSalud()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- GASTO -->
<div class="overlay" id="modalGasto">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ’¸</div>
      <div><div class="modal-title">Registrar Gasto</div><div class="modal-sub">Egresos de la ganaderÃ­a</div></div>
      <span class="modal-close" onclick="closeModal('modalGasto')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-control" id="gasto-fecha"></div>
        <div class="form-group"><label class="form-label">CategorÃ­a</label><select class="form-control" id="gasto-cat"><option>AlimentaciÃ³n</option><option>Sanidad</option><option>NÃ³mina</option><option>Insumos</option><option>Mantenimiento</option><option>Transporte</option><option>Otros</option></select></div>
        <div class="form-group" style="grid-column:span 2;"><label class="form-label">Concepto</label><input class="form-control" id="gasto-concepto" placeholder="DescripciÃ³n del gasto"></div>
        <div class="form-group"><label class="form-label">Monto ($)</label><input type="number" class="form-control number-input" id="gasto-monto"></div>
        <div class="form-group"><label class="form-label">Proveedor</label><input class="form-control" id="gasto-proveedor"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalGasto')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarGasto()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- POTRERO -->
<div class="overlay" id="modalPotrero">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸŒ¿</div>
      <div><div class="modal-title">Registrar Potrero</div></div>
      <span class="modal-close" onclick="closeModal('modalPotrero')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group"><label class="form-label">Nombre</label><input class="form-control" id="pot-nombre" placeholder="Ej: P01 â€” La Casa"></div>
        <div class="form-group"><label class="form-label">Sector</label><select class="form-control" id="pot-sector"><option>La Casa</option><option>RincÃ³n</option><option>La Herencia</option></select></div>
        <div class="form-group"><label class="form-label">Ãrea (ha)</label><input type="number" class="form-control number-input" id="pot-area"></div>
        <div class="form-group"><label class="form-label">Tipo de Pasto</label><input class="form-control" id="pot-pasto" placeholder="Ej: Estrella africana"></div>
        <div class="form-group"><label class="form-label">Estado</label><select class="form-control" id="pot-estado"><option>Ocupado</option><option>Descanso</option><option>En renovaciÃ³n</option></select></div>
        <div class="form-group"><label class="form-label">DÃ­as de OcupaciÃ³n</label><input type="number" class="form-control number-input" id="pot-dias-oc"></div>
        <div class="form-group"><label class="form-label">DÃ­as de Descanso</label><input type="number" class="form-control number-input" id="pot-dias-des"></div>
        <div class="form-group"><label class="form-label">Aforo kg MS/ha</label><input type="number" class="form-control number-input" id="pot-aforo"></div>
        <div class="form-group"><label class="form-label">Animales actuales</label><input type="number" class="form-control number-input" id="pot-animales"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalPotrero')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarPotrero()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL INGRESAR ANIMAL INDIVIDUAL AL LOTE -->
<!-- MODAL NUEVO LOTE -->
<div class="overlay" id="modalNuevoLote">
  <div class="modal" style="max-width:440px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ„</div>
      <div><div class="modal-title">Nuevo Lote</div></div>
      <span class="modal-close" onclick="closeModal('modalNuevoLote')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2">
        <div class="form-group">
          <label class="form-label">NÃºmero</label>
          <input type="number" class="form-control number-input" id="lote-numero" placeholder="1">
        </div>
        <div class="form-group">
          <label class="form-label">Nombre del lote</label>
          <input class="form-control" id="lote-nombre" placeholder="Ej: Vacas OrdeÃ±o, Terneras...">
        </div>
        <div class="form-group">
          <label class="form-label">ğŸ“… Fecha de creaciÃ³n</label>
          <input type="date" class="form-control" id="lote-fecha-creacion">
        </div>
        <div class="form-group fg-full">
          <label class="form-label">Observaciones (opcional)</label>
          <input class="form-control" id="lote-obs" placeholder="">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalNuevoLote')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarNuevoLote()">ğŸ’¾ Crear Lote</button>
    </div>
  </div>
</div>

<!-- MODAL MOVER LOTE A POTRERO -->
<div class="overlay" id="modalMoverLote">
  <div class="modal" style="max-width:420px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸŒ¿</div>
      <div><div class="modal-title" id="mv-titulo">Asignar / Mover Potrero</div></div>
      <span class="modal-close" onclick="closeModal('modalMoverLote')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Potrero destino</label>
        <select class="form-control" id="mv-potrero"></select>
      </div>
      <div class="form-group">
        <label class="form-label">ğŸ“… Fecha de traslado</label>
        <input type="date" class="form-control" id="mv-fecha">
      </div>
      <div class="form-group">
        <label class="form-label">ObservaciÃ³n (opcional)</label>
        <input class="form-control" id="mv-obs" placeholder="">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalMoverLote')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarMoverLote()">ğŸ”„ Confirmar traslado</button>
    </div>
  </div>
</div>

<!-- MODAL INGRESAR ANIMAL INDIVIDUAL AL LOTE -->
<div class="overlay" id="modalIngresarAnimal">
  <div class="modal" style="max-width:420px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ„</div>
      <div><div class="modal-title" id="ing-titulo">Ingresar animal</div></div>
      <span class="modal-close" onclick="closeModal('modalIngresarAnimal')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Animal</label>
        <select class="form-control" id="ing-animal"></select>
      </div>
      <div class="form-group">
        <label class="form-label">ğŸ“… Fecha de ingreso al lote</label>
        <input type="date" class="form-control" id="ing-fecha">
      </div>
      <div class="form-group">
        <label class="form-label">ObservaciÃ³n (opcional)</label>
        <input class="form-control" id="ing-obs" placeholder="">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalIngresarAnimal')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarIngresarAnimal()">âœ… Ingresar</button>
    </div>
  </div>
</div>

<!-- MODAL INGRESAR GRUPO AL LOTE -->
<div class="overlay" id="modalIngresarGrupo">
  <div class="modal" style="max-width:520px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ„</div>
      <div><div class="modal-title" id="grp-titulo">Ingresar grupo</div></div>
      <span class="modal-close" onclick="closeModal('modalIngresarGrupo')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-grid fg-2" style="margin-bottom:12px;">
        <div class="form-group">
          <label class="form-label">ğŸ“… Fecha de ingreso</label>
          <input type="date" class="form-control" id="grp-fecha">
        </div>
        <div class="form-group">
          <label class="form-label">ObservaciÃ³n (opcional)</label>
          <input class="form-control" id="grp-obs" placeholder="">
        </div>
      </div>
      <div id="grp-lista" style="max-height:320px;overflow-y:auto;border:1px solid var(--borde);border-radius:8px;padding:6px;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalIngresarGrupo')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarIngresarGrupo()">âœ… Ingresar seleccionados</button>
    </div>
  </div>
</div>

<!-- MODAL SALIDA ANIMAL DEL LOTE -->
<div class="overlay" id="modalSalidaAnimal">
  <div class="modal" style="max-width:400px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸšª</div>
      <div><div class="modal-title" id="sal-anim-titulo">Salida del lote</div></div>
      <span class="modal-close" onclick="closeModal('modalSalidaAnimal')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">ğŸ“… Fecha de salida</label>
        <input type="date" class="form-control" id="sal-anim-fecha">
      </div>
      <div class="form-group">
        <label class="form-label">Motivo (opcional)</label>
        <input class="form-control" id="sal-anim-obs" placeholder="Ej: Traslado, vendida, seca...">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalSalidaAnimal')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarSacarAnimal()">âœ… Registrar salida</button>
    </div>
  </div>
</div>

<!-- modalOcuparPotrero eliminado â€” reemplazado por switch inline -->

<!-- MODAL COSTOS FIJOS -->
<div class="overlay" id="modalCostosFijos">
  <div class="modal" style="max-width:620px;">
    <div class="modal-header">
      <div class="modal-icon">ğŸ“Œ</div>
      <div><div class="modal-title">Costos Fijos Mensuales</div><div class="modal-sub">Configura los costos recurrentes de la operaciÃ³n</div></div>
      <span class="modal-close" onclick="closeModal('modalCostosFijos')">âœ•</span>
    </div>
    <div class="modal-body">
      <div style="font-size:12px;color:var(--gris-calido);margin-bottom:14px;">
        Estos costos se aplican todos los meses. El valor anual se calcula automÃ¡ticamente Ã— 12.
        Los costos variables se registran individualmente en "Registrar Gasto".
      </div>
      <div id="costos-fijos-form"></div>
      <div style="margin-top:14px;display:flex;gap:10px;align-items:center;">
        <button class="btn btn-ghost btn-sm" onclick="agregarFilaCostoFijo()">+ Agregar Ã­tem</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalCostosFijos')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarCostosFijos()">ğŸ’¾ Guardar costos fijos</button>
    </div>
  </div>
</div>

<!-- MODAL SECADO -->
<div class="overlay" id="modalSecado">
  <div class="modal" style="max-width:520px;">
    <div class="modal-header">
      <span class="modal-title">ğŸ›‘ Registrar Secado de Vaca</span>
      <span class="modal-close" onclick="closeModal('modalSecado')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>Fecha de Secado</label><input type="date" id="sec-fecha"></div>
        <div class="form-group"><label>Vaca (ID o nombre)</label><input type="text" id="sec-vaca" placeholder="Ej: VCA-0001 / Bella"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Peso Madre (kg)</label><input type="number" id="sec-peso-madre" placeholder="ej: 450"></div>
        <div class="form-group"><label>Ãšltimo control de leche (L/dÃ­a)</label><input type="number" id="sec-ultima-leche" placeholder="ej: 4.5"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>DÃ­as en ordeÃ±o (esta lactancia)</label><input type="number" id="sec-dias-ordeno" placeholder="ej: 305"></div>
        <div class="form-group"><label>Parto siguiente (estimado)</label><input type="date" id="sec-parto-estimado"></div>
      </div>
      <div class="form-group"><label>ObservaciÃ³n</label><textarea id="sec-obs" rows="2" placeholder="Razones del secado, estado corporal, tratamiento..."></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalSecado')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarSecado()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL DESTETE -->
<div class="overlay" id="modalDestete">
  <div class="modal" style="max-width:560px;">
    <div class="modal-header">
      <span class="modal-title">ğŸ¼ Registrar Destete</span>
      <span class="modal-close" onclick="closeModal('modalDestete')">âœ•</span>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>Fecha de Destete</label><input type="date" id="dest-fecha"></div>
        <div class="form-group"><label>Sexo crÃ­a</label>
          <select id="dest-sexo"><option value="Macho">Macho (Ternero)</option><option value="Hembra">Hembra (Ternera)</option></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Madre (ID o nombre)</label><input type="text" id="dest-madre" placeholder="Ej: VCA-0001 / Bella"></div>
        <div class="form-group"><label>Peso Madre al Destete (kg)</label><input type="number" id="dest-peso-madre" placeholder="ej: 420"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>CrÃ­a (ID o nombre)</label><input type="text" id="dest-cria" placeholder="Ej: TRN-0001"></div>
        <div class="form-group"><label>Peso CrÃ­a al Destete (kg)</label><input type="number" id="dest-peso-cria" placeholder="ej: 145"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Fecha de nacimiento de la crÃ­a</label><input type="date" id="dest-nacimiento"></div>
        <div class="form-group"><label>ObservaciÃ³n</label><input type="text" id="dest-obs" placeholder="Estado, destino de la crÃ­a..."></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modalDestete')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarDestete()">ğŸ’¾ Guardar</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ESTADO GLOBAL (localStorage)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DB = {
  load(key, def=[]) {
    try { return JSON.parse(localStorage.getItem('sg_'+key)) ?? def; } catch { return def; }
  },
  save(key, val) {
    try { localStorage.setItem('sg_'+key, JSON.stringify(val)); } catch {}
  }
};

let animales    = DB.load('animales', getDefaultAnimales());
let registrosLeche = DB.load('leche', getDefaultLeche());
let registrosPeso  = DB.load('pesos', getDefaultPesos());
let partos      = DB.load('partos', getDefaultPartos());
let servicios   = DB.load('servicios', getDefaultServicios());
let eventosS    = DB.load('salud', getDefaultSalud());
let gastos      = DB.load('gastos', getDefaultGastos());
let praderas    = DB.load('praderas', getDefaultPraderas());
let config      = DB.load('config', { finca:'INKA', area:'43', propietario:'Julio CÃ©sar', municipio:'', departamento:'', telefono:'3106329590' });
// Siempre mantener datos fijos de INKA
config.finca = 'INKA'; config.propietario = 'Julio CÃ©sar'; config.telefono = '3106329590'; config.area = '43';
let params      = DB.load('params', { precio_leche:1850, meta_litros:30, meta_preÃ±ez:28, dias_abiertos_meta:120, meta_natalidad:75 });

let lotes       = DB.load('lotes', []);
let costosFijos = DB.load('costosFijos', [
  {id:1, concepto:'NÃ³mina JosÃ© Javier (sueldo planta â€” 2 quincenas)',   monto:600000,  categoria:'NÃ³mina'},
  {id:2, concepto:'Costos operativos (combustible, insumos, mantenimiento)', monto:450000, categoria:'Insumos'},
]);
let secados = DB.load('secados', getDefaultSecados());

let sortKey = 'id', sortAsc = true;
let invFilter = 'Todos';
let animalActivoId = null;
let activeHtab = 'info';
let sidebarCollapsed = false;


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CATEGORÃA REAL segÃºn regla de negocio
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function categoriaReal(animal) {
  // Fuente de verdad: categorÃ­a guardada en el inventario
  return animal.categoria;
}

function hembrasActivas() {
  return animales.filter(a =>
    ['Vaca','Novilla','Ternera'].includes(a.categoria) && a.estado !== 'baja'
  );
}
function vacasReales() {
  // Vacas reales = categorÃ­a Vaca activas
  return animales.filter(a => a.categoria === 'Vaca' && a.estado !== 'baja');
}

function persist() {
  DB.save('animales', animales);
  DB.save('leche', registrosLeche);
  DB.save('pesos', registrosPeso);
  DB.save('partos', partos);
  DB.save('servicios', servicios);
  DB.save('salud', eventosS);
  DB.save('gastos', gastos);
  DB.save('praderas', praderas);
  DB.save('lotes',    lotes);
  DB.save('config', config);
  DB.save('params', params);
  DB.save('costosFijos', costosFijos);
  DB.save('secados', secados);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEFAULT DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getDefaultAnimales() {
  const r = (a,b) => Math.floor(Math.random()*(b-a)+a);
  const nombres = ['Bella','Lupita','Mora','Canela','Nieve','Rosita','Paloma','Estrella','Linda','Flor','Catira','Mochita','Petra','Azucena','Violeta','Diana','Pepita','Gloria','Reina','Dulce','Negra','Blanca','Manchada','Pinta','Carmela','Esperanza','RocÃ­o','Consuelo','Mariposa','Amapola'];
  const razas = ['Holstein','Jersey','Normando','Gyrolando','Brahman','Pardo Suizo','Simmental'];
  const estados = ['activa','activa','activa','activa','seca','gestante','gestante','preparto'];
  const potreros = ['Potrero 1 â€” El Palmar','Potrero 2 â€” La Sabana','Potrero 3 â€” El RincÃ³n','Potrero 4 â€” Los Nogales'];
  const cats = ['Vaca','Vaca','Vaca','Vaca','Vaca','Novilla','Novilla','Ternera','Toro'];
  let arr = [];
  for(let i=1;i<=45;i++){
    const cat = cats[r(0,cats.length)];
    const es = cat==='Vaca' ? estados[r(0,estados.length)] : (cat==='Novilla'?'activa':'activa');
    const litros = (cat==='Vaca' && (es==='activa'||es==='preparto')) ? r(12,38) : 0;
    const aÃ±oNac = 2025 - r(0, cat==='Vaca'?7:cat==='Novilla'?2:1);
    const mesNac = String(r(1,12)).padStart(2,'0');
    const diaNac = String(r(1,28)).padStart(2,'0');
    arr.push({
      id:`${cat==='Vaca'?'VCA':cat==='Novilla'?'NOV':cat==='Toro'?'TOR':'TRN'}-${String(i).padStart(4,'0')}`,
      nombre: nombres[i % nombres.length] + (i > nombres.length ? ' ' + (i-nombres.length) : ''),
      categoria: cat,
      raza: razas[r(0,razas.length)],
      color: ['Negro manchado','Blanco con manchas negras','Rojo','CastaÃ±o','Amarillo'][r(0,5)],
      nacimiento: `${aÃ±oNac}-${mesNac}-${diaNac}`,
      peso: cat==='Vaca'?r(420,600):cat==='Novilla'?r(280,380):r(60,180),
      cc: (r(25,40)/10).toFixed(1),
      estado: es,
      potrero: potreros[r(0,potreros.length)],
      litros,
      padre: ['Bambu','Titan','Orion','Semen NÃ³rdico'][r(0,4)],
      madre: nombres[r(0,nombres.length)],
      partos: cat==='Vaca'?r(1,7):0,
      obs:'',
      _ts: Date.now()-r(0,90)*86400000
    });
  }
  return arr;
}

function getDefaultLeche() {
  return [{"id": 1760000100, "fecha": "2024-02-22", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 225.6, "o2": 150.4, "total": 376.0, "precio": 1800, "obs": "$1,800/L Â· Pago $677,000"}, {"id": 1760000101, "fecha": "2024-03-01", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 109.8, "o2": 73.2, "total": 183.0, "precio": 1800, "obs": "$1,800/L Â· Pago $329,000"}, {"id": 1760000102, "fecha": "2024-03-08", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 103.2, "o2": 68.8, "total": 172.0, "precio": 1850, "obs": "$1,850/L Â· Pago $318,000"}, {"id": 1760000103, "fecha": "2024-03-15", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 118.2, "o2": 78.8, "total": 197.0, "precio": 1850, "obs": "$1,850/L Â· Pago $364,000"}, {"id": 1760000104, "fecha": "2024-03-22", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 136.8, "o2": 91.2, "total": 228.0, "precio": 1850, "obs": "$1,850/L Â· Pago $421,000"}, {"id": 1760000105, "fecha": "2024-03-29", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 111.6, "o2": 74.4, "total": 186.0, "precio": 1850, "obs": "$1,850/L Â· Pago $344,000"}, {"id": 1760000106, "fecha": "2024-04-04", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 128.4, "o2": 85.6, "total": 214.0, "precio": 1850, "obs": "$1,850/L Â· Pago $396,000"}, {"id": 1760000107, "fecha": "2024-04-11", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 123.6, "o2": 82.4, "total": 206.0, "precio": 1900, "obs": "$1,900/L Â· Pago $391,000"}, {"id": 1760000108, "fecha": "2024-04-18", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 115.2, "o2": 76.8, "total": 192.0, "precio": 1900, "obs": "$1,900/L Â· Pago $364,000"}, {"id": 1760000109, "fecha": "2024-04-25", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 127.2, "o2": 84.8, "total": 212.0, "precio": 1900, "obs": "$1,900/L Â· Pago $402,000"}, {"id": 1760000110, "fecha": "2024-05-03", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 145.8, "o2": 97.2, "total": 243.0, "precio": 1700, "obs": "$1,700/L Â· Pago $413,000"}, {"id": 1760000111, "fecha": "2024-05-09", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 168.0, "o2": 112.0, "total": 280.0, "precio": 1600, "obs": "$1,600/L Â· Pago $448,000"}, {"id": 1760000112, "fecha": "2024-05-16", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 174.0, "o2": 116.0, "total": 290.0, "precio": 1550, "obs": "$1,550/L Â· Pago $449,000"}, {"id": 1760000113, "fecha": "2024-05-23", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 194.4, "o2": 129.6, "total": 324.0, "precio": 1550, "obs": "$1,550/L Â· Pago $502,000"}, {"id": 1760000114, "fecha": "2024-05-31", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 217.8, "o2": 145.2, "total": 363.0, "precio": 1400, "obs": "$1,400/L Â· Pago $508,000"}, {"id": 1760000115, "fecha": "2024-06-07", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 225.6, "o2": 150.4, "total": 376.0, "precio": 1350, "obs": "$1,350/L Â· Pago $507,000"}, {"id": 1760000116, "fecha": "2024-06-14", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 227.4, "o2": 151.6, "total": 379.0, "precio": 1350, "obs": "$1,350/L Â· Pago $511,000"}, {"id": 1760000117, "fecha": "2024-06-20", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 224.4, "o2": 149.6, "total": 374.0, "precio": 1300, "obs": "$1,300/L Â· Pago $486,000"}, {"id": 1760000118, "fecha": "2024-06-27", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 211.8, "o2": 141.2, "total": 353.0, "precio": 1300, "obs": "$1,300/L Â· Pago $459,000"}, {"id": 1760000119, "fecha": "2024-07-04", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 194.4, "o2": 129.6, "total": 324.0, "precio": 1300, "obs": "$1,300/L Â· Pago $421,000"}, {"id": 1760000120, "fecha": "2024-07-11", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 211.8, "o2": 141.2, "total": 353.0, "precio": 1300, "obs": "$1,300/L Â· Pago $459,000"}, {"id": 1760000121, "fecha": "2024-07-18", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 244.8, "o2": 163.2, "total": 408.0, "precio": 1300, "obs": "$1,300/L Â· Pago $530,000"}, {"id": 1760000122, "fecha": "2024-07-25", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 241.2, "o2": 160.8, "total": 402.0, "precio": 1300, "obs": "$1,300/L Â· Pago $522,000"}, {"id": 1760000123, "fecha": "2024-08-01", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 247.8, "o2": 165.2, "total": 413.0, "precio": 1400, "obs": "$1,400/L Â· Pago $578,000"}, {"id": 1760000124, "fecha": "2024-08-08", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 220.2, "o2": 146.8, "total": 367.0, "precio": 1400, "obs": "$1,400/L Â· Pago $513,000"}, {"id": 1760000125, "fecha": "2024-08-15", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 180.6, "o2": 120.4, "total": 301.0, "precio": 1400, "obs": "$1,400/L Â· Pago $421,000"}, {"id": 1760000126, "fecha": "2024-08-22", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 205.2, "o2": 136.8, "total": 342.0, "precio": 1400, "obs": "$1,400/L Â· Pago $478,000"}, {"id": 1760000127, "fecha": "2024-08-30", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 210.0, "o2": 140.0, "total": 350.0, "precio": 1300, "obs": "$1,300/L Â· Pago $455,000"}, {"id": 1760000128, "fecha": "2024-09-05", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 204.6, "o2": 136.4, "total": 341.0, "precio": 1300, "obs": "$1,300/L Â· Pago $443,000"}, {"id": 1760000129, "fecha": "2024-09-12", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 208.2, "o2": 138.8, "total": 347.0, "precio": 1300, "obs": "$1,300/L Â· Pago $451,000"}, {"id": 1760000130, "fecha": "2024-09-19", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 219.0, "o2": 146.0, "total": 365.0, "precio": 1300, "obs": "$1,300/L Â· Pago $474,000"}, {"id": 1760000131, "fecha": "2024-09-26", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 200.4, "o2": 133.6, "total": 334.0, "precio": 1300, "obs": "$1,300/L Â· Pago $434,000"}, {"id": 1760000132, "fecha": "2024-10-03", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 172.2, "o2": 114.8, "total": 287.0, "precio": 1300, "obs": "$1,300/L Â· Pago $373,000"}, {"id": 1760000133, "fecha": "2024-10-10", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 159.0, "o2": 106.0, "total": 265.0, "precio": 1300, "obs": "$1,300/L Â· Pago $344,000"}, {"id": 1760000134, "fecha": "2024-10-17", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 178.8, "o2": 119.2, "total": 298.0, "precio": 1300, "obs": "$1,300/L Â· Pago $387,000"}, {"id": 1760000135, "fecha": "2024-10-24", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 75.6, "o2": 50.4, "total": 126.0, "precio": 1300, "obs": "$1,300/L Â· Pago $163,000"}, {"id": 1760000136, "fecha": "2024-10-28", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 183.0, "o2": 122.0, "total": 305.0, "precio": 1400, "obs": "$1,400/L Â· Pago $427,000"}, {"id": 1760000137, "fecha": "2024-11-03", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 177.0, "o2": 118.0, "total": 295.0, "precio": 1400, "obs": "$1,400/L Â· Pago $413,000"}, {"id": 1760000138, "fecha": "2024-11-10", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 174.0, "o2": 116.0, "total": 290.0, "precio": 1400, "obs": "$1,400/L Â· Pago $406,000"}, {"id": 1760000139, "fecha": "2024-11-17", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 158.4, "o2": 105.6, "total": 264.0, "precio": 1400, "obs": "$1,400/L Â· Pago $369,000"}, {"id": 1760000140, "fecha": "2024-11-24", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 157.2, "o2": 104.8, "total": 262.0, "precio": 1400, "obs": "$1,400/L Â· Pago $367,000"}, {"id": 1760000141, "fecha": "2024-12-01", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 136.2, "o2": 90.8, "total": 227.0, "precio": 1400, "obs": "$1,400/L Â· Pago $318,000"}, {"id": 1760000142, "fecha": "2024-12-08", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 135.6, "o2": 90.4, "total": 226.0, "precio": 1450, "obs": "$1,450/L Â· Pago $328,000"}, {"id": 1760000143, "fecha": "2024-12-15", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 122.4, "o2": 81.6, "total": 204.0, "precio": 1500, "obs": "$1,500/L Â· Pago $306,000"}, {"id": 1760000144, "fecha": "2024-12-22", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 101.4, "o2": 67.6, "total": 169.0, "precio": 1500, "obs": "$1,500/L Â· Pago $253,000"}, {"id": 1760000145, "fecha": "2024-12-29", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 87.6, "o2": 58.4, "total": 146.0, "precio": 1500, "obs": "$1,500/L Â· Pago $219,000"}, {"id": 1760000146, "fecha": "2025-01-05", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 85.8, "o2": 57.2, "total": 143.0, "precio": 1500, "obs": "$1,500/L Â· Pago $214,500"}, {"id": 1760000147, "fecha": "2025-01-12", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 97.8, "o2": 65.2, "total": 163.0, "precio": 1500, "obs": "$1,500/L Â· Pago $244,500"}, {"id": 1760000148, "fecha": "2025-01-19", "animalId": "HATO", "animalNombre": "Hato INKA (consolidado)", "o1": 104.4, "o2": 69.6, "total": 174.0, "precio": 1600, "obs": "$1,600/L Â· Pago $278,000"}];
}

function getDefaultPesos() {
  const todos = getDefaultAnimales().slice(0,20);
  let arr = [];
  todos.forEach(a=>{
    for(let w=0;w<4;w++){
      const fecha = new Date(Date.now()-(w*21+Math.floor(Math.random()*5))*86400000);
      arr.push({id:Date.now()+Math.random(), fecha:fecha.toISOString().split('T')[0], animalId:a.id, animalNombre:a.nombre, categoria:a.categoria, peso:a.peso - w*Math.floor(Math.random()*8), cc:a.cc, obs:''});
    }
  });
  return arr.sort((a,b)=>b.fecha.localeCompare(a.fecha)).slice(0,60);
}

function getDefaultPartos() {
  const meses = [1,2,3,4,5,6];
  return meses.map((m,i)=>({
    id: i+1,
    fecha: `2025-${String(m).padStart(2,'0')}-${String(Math.floor(Math.random()*25)+1).padStart(2,'0')}`,
    madreId:'VCA-'+(String(i+1).padStart(4,'0')),
    madreNombre:['Bella','Lupita','Mora','Canela','Nieve','Rosita'][i],
    criaId:`TRN-${String(200+i).padStart(4,'0')}`,
    criaNombre:`CrÃ­a ${200+i}`,
    sexo: i%2===0?'Macho':'Hembra',
    peso: Math.floor(Math.random()*12+28),
    tipo: i===2?'Asistido':'Natural',
    facilidad: Math.floor(Math.random()*2+1),
    obs:''
  }));
}

function getDefaultServicios() {
  return Array.from({length:8},(_,i)=>({
    id:i+1,
    fecha:`2025-0${(i%4)+1}-${String(Math.floor(Math.random()*25)+1).padStart(2,'0')}`,
    animalId:'VCA-'+String(i+1).padStart(4,'0'),
    animalNombre:['Bella','Lupita','Mora','Canela','Nieve','Rosita','Paloma','Estrella'][i],
    metodo: i%3===0?'IATF â€” Tiempo Fijo':'IA â€” InseminaciÃ³n Artificial',
    toro:['Bambu CRI','Titan HO','Orion JE','NÃ³rdico HO'][i%4],
    diagnostico: i<5 ? (i%2===0?'preÃ±ada':'vacia') : '',
    inseminador:'Dr. MartÃ­nez',
    obs:''
  }));
}

function getDefaultSalud() {
  return [
    {id:1,fecha:'2025-02-10',animalId:'VCA-0001',animalNombre:'Bella',diagnostico:'Mastitis ClÃ­nica',tratamiento:'Oxitetraciclina 500mg/dÃ­a',retiroLeche:6,retiroCarne:10,veterinario:'Dr. LÃ³pez',estado:'En tratamiento',obs:'CCS elevada en ordeÃ±o AM'},
    {id:2,fecha:'2025-02-12',animalId:'VCA-0005',animalNombre:'Nieve',diagnostico:'Metritis',tratamiento:'Penicilina + Flunixin',retiroLeche:4,retiroCarne:8,veterinario:'Dr. LÃ³pez',estado:'Mejorando',obs:'Posparto 10 dÃ­as'},
    {id:3,fecha:'2025-02-13',animalId:'TRN-0015',animalNombre:'Ternero 15',diagnostico:'Diarrea neonatal',tratamiento:'Suero oral + Electrolitos',retiroLeche:0,retiroCarne:1,veterinario:'Dr. MartÃ­nez',estado:'Mejorando',obs:''}
  ];
}

function getDefaultGastos() {
  return [
    // â”€â”€ INGRESOS REALES POR VENTA DE LECHE 2024â€“2025 â”€â”€
    // Fuente: Planillas de recolecciÃ³n y venta (Libro manual Inversiones Kosta Azul)
    // Totales mensuales exactos extraÃ­dos fielmente del libro
    {"id":1750000100,"fecha":"2024-02-29","categoria":"Ingresos","concepto":"Venta leche â€” Febrero 2024 (376 L Ã— $1.800 prom.)","monto":677000,"proveedor":"Comprador leche","tipo":"ingreso","litros":376},
    {"id":1750000101,"fecha":"2024-03-31","categoria":"Ingresos","concepto":"Venta leche â€” Marzo 2024 (780 L Ã— $1.835 prom.)","monto":1432000,"proveedor":"Comprador leche","tipo":"ingreso","litros":780},
    {"id":1750000102,"fecha":"2024-04-30","categoria":"Ingresos","concepto":"Venta leche â€” Abril 2024 (798 L Ã— $1.875 prom.)","monto":1495000,"proveedor":"Comprador leche","tipo":"ingreso","litros":798},
    {"id":1750000103,"fecha":"2024-05-31","categoria":"Ingresos","concepto":"Venta leche â€” Mayo 2024 (1.349 L Ã— $1.640 prom.)","monto":2214000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1349},
    {"id":1750000104,"fecha":"2024-06-30","categoria":"Ingresos","concepto":"Venta leche â€” Junio 2024 (1.492 L Ã— $1.350 prom.)","monto":2012000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1492},
    {"id":1750000105,"fecha":"2024-07-31","categoria":"Ingresos","concepto":"Venta leche â€” Julio 2024 (1.030 L Ã— $1.300 prom.)","monto":1339000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1030},
    {"id":1750000106,"fecha":"2024-08-31","categoria":"Ingresos","concepto":"Venta leche â€” Agosto 2024 (1.825 L Ã— $1.375 prom.)","monto":2512000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1825},
    {"id":1750000107,"fecha":"2024-09-30","categoria":"Ingresos","concepto":"Venta leche â€” Septiembre 2024 (1.403 L Ã— $1.300 prom.)","monto":1823000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1403},
    {"id":1750000108,"fecha":"2024-10-31","categoria":"Ingresos","concepto":"Venta leche â€” Octubre 2024 (1.310 L Ã— $1.300 prom.)","monto":1701000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1310},
    {"id":1750000109,"fecha":"2024-11-30","categoria":"Ingresos","concepto":"Venta leche â€” Noviembre 2024 (1.154 L Ã— $1.400 prom.)","monto":1615000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1154},
    {"id":1750000110,"fecha":"2024-12-31","categoria":"Ingresos","concepto":"Venta leche â€” Diciembre 2024 (1.088 L Ã— $1.445 prom.)","monto":1572000,"proveedor":"Comprador leche","tipo":"ingreso","litros":1088},
    {"id":1750000111,"fecha":"2025-01-31","categoria":"Ingresos","concepto":"Venta leche â€” Enero 2025 (626 L Ã— $1.525 prom.) â€” ProducciÃ³n baja","monto":955000,"proveedor":"Comprador leche","tipo":"ingreso","litros":626},

    // â”€â”€ PAGOS REALES NÃ“MINA JOSÃ‰ JAVIER 2024 â”€â”€
    // Registro fiel de los egresos del libro manual.
    // Sueldo planta: $300.000 quincenal = $600.000/mes
    // Nota: Algunos meses no hay registro de pago (Feb, Abr, Sep, Oct, Nov) â€” se dejÃ³ pendiente o se consolidÃ³ en siguiente perÃ­odo
    {"id":1760000001,"fecha":"2024-03-31","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” Sueldo planta marzo (2 quincenas)","monto":600000,"proveedor":"JosÃ© Javier","tipo":"egreso"},
    {"id":1760000002,"fecha":"2024-05-31","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” Sueldo planta mayo (2 quincenas)","monto":600000,"proveedor":"JosÃ© Javier","tipo":"egreso"},
    {"id":1760000003,"fecha":"2024-06-15","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” 1Âª quincena junio (pago fraccionado)","monto":150000,"proveedor":"JosÃ© Javier","tipo":"egreso"},
    {"id":1760000004,"fecha":"2024-07-15","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” Saldo jun/jul: complemento $450.000 (pago fraccionado)","monto":450000,"proveedor":"JosÃ© Javier","tipo":"egreso"},
    {"id":1760000005,"fecha":"2024-08-31","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” Sueldo planta agosto (2 quincenas)","monto":600000,"proveedor":"JosÃ© Javier","tipo":"egreso"},
    {"id":1760000006,"fecha":"2024-12-31","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” Sueldo planta diciembre (2 quincenas)","monto":600000,"proveedor":"JosÃ© Javier","tipo":"egreso"},
    {"id":1760000007,"fecha":"2025-01-15","categoria":"NÃ³mina","concepto":"NÃ³mina JosÃ© Javier â€” 1Âª quincena enero 2025 (saldo pendiente por baja producciÃ³n)","monto":300000,"proveedor":"JosÃ© Javier","tipo":"egreso","obs":"Saldo pendiente anotado por baja producciÃ³n del mes (626 L)"},

    // â”€â”€ GASTOS OPERACIÃ“N 2024 â”€â”€
    // Fuente: cifra REAL anual confirmada por el productor = $5.400.000
    // (combustible, herbicidas, venenos, mantenimiento cercas, trabajos extras JosÃ© Javier)
    // Desglose mensual pendiente de ingresar manualmente desde el libro
    {"id":1760000100,"fecha":"2024-12-31","categoria":"Insumos","concepto":"Costos operativos 2024 â€” combustible, herbicidas, mantenimiento y trabajos extras (total anual real)","monto":5400000,"proveedor":"Varios","tipo":"egreso","obs":"Cifra real confirmada por el productor. Pendiente desglose mensual desde libro manual."},
  ];
}

function getDefaultSecados() {
  // Registro de Secados (fin de lactancia) y Destetes (separaciÃ³n ternero/madre)
  // Fuente: planillas de campo agosto 2025 â€” Ãºltimo pesaje antes del corte
  return [
    // â”€â”€ SECADOS AGOSTO 2025 (lactancias anteriores) â”€â”€
    // Vacas que dejaron de pesarse en agosto 2025; en Feb 2026 estÃ¡n en nueva lactancia
    // 226/4 caso especial: secado/destete transitorio entre partos (nuevo parto confirmado)
    {id:1770000001, tipo:'secado', fecha:'2025-08-07', vaca:'012/72', obs:'Ãšltimo pesaje 06/08/2025. Secado por baja producciÃ³n â€” nueva lactancia en curso (parto posterior).'},
    {id:1770000002, tipo:'secado', fecha:'2025-08-14', vaca:'026/4',  obs:'Ãšltimo pesaje 13/08/2025. Secado en agosto 2025 â€” activa en feb 2026.'},
    {id:1770000003, tipo:'secado', fecha:'2025-08-14', vaca:'039/8',  obs:'Ãšltimo pesaje 13/08/2025. Secado en agosto 2025 â€” activa en feb 2026.'},
    {id:1770000004, tipo:'secado', fecha:'2025-08-14', vaca:'003/5',  obs:'Ãšltimo pesaje 13/08/2025. Secado en agosto 2025 â€” activa en feb 2026.'},
    {id:1770000005, tipo:'secado', fecha:'2025-08-28', vaca:'226/4',  obs:'Ãšltimo pesaje 27/08/2025. Secado/destete transitorio entre partos â€” 226/4 tiene nuevo parto y lactancia en curso (producciÃ³n 4.47 kg/dÃ­a al 25/02/2026).'},
  ];
}

function getDefaultPraderas() {
  // Finca DOBLE PROPOSITO INKA â€” 43 ha totales
  // Sector La Casa: 12 potreros (Ã¡reas reales medidas)
  // Sector RincÃ³n: Ã¡rea no especificada / 10 potreros
  // Sector La Herencia: 9 ha / 2 potreros (~4.5 ha c/u)
  const lacasa = [
    {num:1, area:1.803, diasOcupado:9},
    {num:2, area:1.776, diasOcupado:9},
    {num:3, area:0.5492,diasOcupado:3},
    {num:4, area:0.6685,diasOcupado:3},
    {num:5, area:1.179, diasOcupado:6},
    {num:6, area:1.344, diasOcupado:7},
    {num:7, area:2.085, diasOcupado:12},
    {num:8, area:2.058, diasOcupado:11},
    {num:9, area:1.560, diasOcupado:8},
    {num:10,area:2.156, diasOcupado:12},
    {num:11,area:1.738, diasOcupado:10},
    {num:12,area:0.30,  diasOcupado:2},
  ];
  const pr = (n,id)=>({id, nombre:`P${String(id-12).padStart(2,'0')} â€” RincÃ³n`,  sector:'RincÃ³n',   area:1.70, pasto:'', estado:'Descanso', animales:0, diasOcupado:0, diasDescanso:0, aforo:0});
  const ph = (n,id,area)=>({id, nombre:`P${String(n).padStart(2,'0')} â€” La Herencia`, sector:'La Herencia', area, pasto:'', estado:'Descanso', animales:0, diasOcupado:0, diasDescanso:0, aforo:0});
  return [
    ...lacasa.map(p=>({id:p.num, nombre:`P${String(p.num).padStart(2,'0')} â€” La Casa`, sector:'La Casa', area:p.area, pasto:'', estado:'Descanso', animales:0, diasOcupado:p.diasOcupado, diasDescanso:0, aforo:0})),
    pr(1,13),pr(2,14),pr(3,15),pr(4,16),pr(5,17),
    pr(6,18),pr(7,19),pr(8,20),pr(9,21),pr(10,22),
    ph(1,23,3.0),ph(2,24,3.0),ph(3,25,3.0),
  ];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILIDADES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fNum(n, d=0) { return Number(n).toLocaleString('es-CO',{maximumFractionDigits:d}); }
function fMon(n) { return '$'+fNum(n); }
function edad(fecha) {
  if(!fecha) return 'â€”';
  const d = (Date.now() - new Date(fecha+'T00:00:00').getTime())/(1000*60*60*24);
  if(d<30) return Math.floor(d)+'d';
  const m = Math.floor(d/30.4);
  if(m<24) return m+'m';
  return Math.floor(m/12)+'a '+(m%12)+'m';
}
function hoy() { return new Date().toISOString().split('T')[0]; }
function addDays(date, days) {
  const d = new Date(date+'T00:00:00');
  d.setDate(d.getDate()+days);
  return d.toISOString().split('T')[0];
}
// Calcula dÃ­as de gestaciÃ³n transcurridos y dÃ­as restantes al parto (283 dÃ­as CebÃº)
function infoGestacion(animal) {
  if(!['gestante','preparto'].includes(animal.estado)) return null;
  // Buscar servicio con diagnÃ³stico preÃ±ada
  const serv = servicios
    .filter(s => s.animalId === animal.id && (s.diagnostico === 'preÃ±ada' || (s.diagnostico||'').startsWith('+')))
    .sort((a,b) => b.fecha.localeCompare(a.fecha))[0];
  if(!serv) return null;
  const hoyDt    = new Date(hoy()+'T00:00:00');
  const servDt   = new Date(serv.fecha+'T00:00:00');
  const transcurridos = Math.floor((hoyDt - servDt) / 86400000);
  const partoEsp = addDays(serv.fecha, 283);
  const partoDt  = new Date(partoEsp+'T00:00:00');
  const restantes = Math.floor((partoDt - hoyDt) / 86400000);
  const pct = Math.min(100, Math.round(transcurridos / 283 * 100));
  return { transcurridos, restantes, partoEsp, pct, servFecha: serv.fecha };
}

function toast(msg, type='success') {
  const el = document.getElementById('toast');
  el.textContent = (type==='success'?'âœ… ':type==='error'?'âŒ ':'â„¹ï¸ ') + msg;
  el.className = 'show ' + type;
  clearTimeout(el._t);
  el._t = setTimeout(()=>{ el.className=''; }, 3200);
}
function tagEstado(est) {
  const m = {activa:'tag-verde',seca:'tag-amarillo',gestante:'tag-morado',preparto:'tag-azul',venta:'tag-rojo',baja:'tag-gris'};
  const l = {activa:'En producciÃ³n',seca:'Seca',gestante:'Gestante',preparto:'Preparto',venta:'Para venta',baja:'Baja'};
  return `<span class="tag ${m[est]||'tag-gris'}">${l[est]||est}</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVEGACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const pageTitles = {
  dashboard:'Tablero de Control', inventario:'Inventario Ganadero', hojavida:'Hoja de Vida',
  leche:'ProducciÃ³n de Leche', peso:'Control de Peso', reproduccion:'ReproducciÃ³n y Fertilidad',
  salud:'Control de Salud', costos:'Costos y Resultados', praderas:'GestiÃ³n de Praderas',
  lotes:'Lotes de Animales',
  simulacion:'Simulador de Escenarios', alertas:'Centro de Alertas', reportes:'Reportes', config:'ConfiguraciÃ³n'
};

function nav(page) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('act'));
  document.querySelectorAll('.sb-item').forEach(i=>i.classList.remove('act'));
  document.getElementById('page-'+page)?.classList.add('act');
  document.querySelector(`[data-page="${page}"]`)?.classList.add('act');
  document.getElementById('topbar-title').textContent = pageTitles[page]||page;
  const subs = {
    dashboard:'resumen general', inventario:'todos los animales registrados',
    leche:'control de lactancias', reproduccion:'servicios y partos',
    salud:'monitoreo sanitario', costos:'estado de resultados',
    praderas:'pastoreo rotacional', simulacion:'anÃ¡lisis de escenarios'
  };
  document.getElementById('topbar-sub').textContent = (config.finca||'Mi Finca') + ' Â· ' + (subs[page]||'');
  renderPage(page);
}

document.querySelectorAll('.sb-item[data-page]').forEach(el=>{
  el.addEventListener('click', ()=>nav(el.dataset.page));
});

function renderPage(p) {
  const fn = {
    dashboard: renderDashboard,
    ia: ()=>{},  // renderizado estÃ¡tico, sin funciÃ³n especial
    inventario: renderInventario,
    leche: renderLeche,
    peso: renderPeso,
    reproduccion: renderReproduccion,
    salud: renderSalud,
    costos: renderCostos,
    praderas: renderPraderas,
    lotes: renderLotes,
    secados: renderSecados,
    simulacion: renderSimulacion,
    alertas: renderAlertas,
    config: renderConfig,
  }[p];
  if(fn) fn();
}

function toggleSidebar() {
  sidebarCollapsed = !sidebarCollapsed;
  document.getElementById('sidebar').classList.toggle('collapsed', sidebarCollapsed);
  document.getElementById('sb-toggle-icon').textContent = sidebarCollapsed ? 'â–¶' : 'â—€';
  document.getElementById('sb-toggle-text').textContent = sidebarCollapsed ? '' : 'Colapsar menÃº';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id) {
  // Initialize genetics form when opening fresh animal modal
  if(id==='modalAnimal' && !document.getElementById('anim-edit-id').value) {
    document.getElementById('modal-animal-title').textContent = 'Registrar Animal';
    document.getElementById('anim-edit-id').value = '';
    // Clear all text fields
    ['anim-id','anim-nombre','anim-color','anim-nacimiento','anim-peso','anim-cc','anim-litros','anim-padre','anim-madre','anim-partos','anim-obs'].forEach(f=>{ const el=document.getElementById(f); if(el) el.value=''; });
    cargarGeneticaEnForm([]);
  }
  const selects = { leche:{sel:'leche-animal'}, peso:{sel:'peso-animal'}, parto:{sel:'parto-madre'}, servicio:{sel:'serv-animal'}, salud:{sel:'sal-animal'} };
  if(selects[id.replace('modal','').toLowerCase()]) {
    const key = id.replace('modal','').toLowerCase();
    const selId = selects[key]?.sel;
    if(selId) {
      const sel = document.getElementById(selId);
      if(sel) {
        const cats = {leche:['Vaca'],peso:null,parto:['Vaca','Novilla'],servicio:['Vaca','Novilla'],salud:null};
        const filt = cats[key];
        const opts = animales.filter(a=>!filt||filt.includes(a.categoria));
        sel.innerHTML = opts.map(a=>`<option value="${a.id}">${a.id} â€” ${a.nombre}</option>`).join('');
      }
    }
  }
  // Default dates
  const dateFields = {modalLeche:'leche-fecha',modalPeso:'peso-fecha',modalParto:'parto-fecha',modalServicio:'serv-fecha',modalSalud:'sal-fecha',modalGasto:'gasto-fecha'};
  if(dateFields[id]) {
    const el = document.getElementById(dateFields[id]);
    if(el && !el.value) el.value = hoy();
  }
  document.getElementById(id).classList.add('show');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('show');
  if(id==='modalAnimal') document.getElementById('anim-edit-id').value='';
}
document.querySelectorAll('.overlay').forEach(o=>{
  o.addEventListener('click', e=>{ if(e.target===o) o.classList.remove('show'); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GUARDAR REGISTROS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function guardarAnimal() {
  const editId = document.getElementById('anim-edit-id').value;
  const composicion = getGenetica();
  const totalPct = composicion.reduce((s,c)=>s+c.pct,0);
  if(composicion.length>0 && totalPct!==100) { toast('Los porcentajes deben sumar 100%','error'); return; }
  const raza = composicion.length ? geneticaStr(composicion) : 'Sin definir';
  const obj = {
    id: document.getElementById('anim-id').value.trim() || ('AN-'+Date.now()),
    nombre: document.getElementById('anim-nombre').value.trim(),
    categoria: document.getElementById('anim-categoria').value,
    raza,
    composicion,
    color: document.getElementById('anim-color').value,
    nacimiento: document.getElementById('anim-nacimiento').value,
    peso: +document.getElementById('anim-peso').value || 0,
    cc: document.getElementById('anim-cc').value,
    estado: document.getElementById('anim-estado').value,
    potrero: document.getElementById('anim-potrero').value,
    litros: +document.getElementById('anim-litros').value || 0,
    padre: document.getElementById('anim-padre').value,
    madre: document.getElementById('anim-madre').value,
    partos: +document.getElementById('anim-partos').value || 0,
    obs: document.getElementById('anim-obs').value,
    _ts: Date.now()
  };
  if(!obj.nombre) { toast('El nombre es obligatorio','error'); return; }
  if(editId) {
    const idx = animales.findIndex(a=>a.id===editId);
    if(idx>=0) animales[idx] = {...animales[idx], ...obj, id:editId};
  } else {
    if(animales.find(a=>a.id===obj.id)) { toast('Ya existe un animal con ese ID','error'); return; }
    animales.push(obj);
  }
  persist();
  closeModal('modalAnimal');
  toast(editId ? 'Animal actualizado' : 'Animal registrado âœ”');
  renderPage(document.querySelector('.sb-item.act')?.dataset.page||'inventario');
}

function guardarLeche() {
  const animalId = document.getElementById('leche-animal').value;
  const anim = animales.find(a=>a.id===animalId);
  const o1 = +document.getElementById('leche-o1').value||0;
  const o2 = +document.getElementById('leche-o2').value||0;
  const reg = { id:Date.now(), fecha:document.getElementById('leche-fecha').value, animalId, animalNombre:anim?.nombre||'', o1, o2, total:+(o1+o2).toFixed(1), obs:document.getElementById('leche-obs').value };
  registrosLeche.unshift(reg);
  if(anim){ anim.litros = reg.total; }
  persist();
  closeModal('modalLeche');
  toast('Control de leche guardado âœ”');
  renderLeche();
}

function guardarPeso() {
  const animalId = document.getElementById('peso-animal').value;
  const anim = animales.find(a=>a.id===animalId);
  const kg = +document.getElementById('peso-kg').value||0;
  const reg = { id:Date.now(), fecha:document.getElementById('peso-fecha').value, animalId, animalNombre:anim?.nombre||'', categoria:anim?.categoria||'', peso:kg, cc:document.getElementById('peso-cc').value, obs:document.getElementById('peso-obs').value };
  registrosPeso.unshift(reg);
  if(anim) anim.peso = kg;
  persist();
  closeModal('modalPeso');
  toast('Pesaje guardado âœ”');
  renderPeso();
}

function guardarParto() {
  const madreId = document.getElementById('parto-madre').value;
  const madre = animales.find(a=>a.id===madreId);
  const criaId = document.getElementById('parto-cria-id').value.trim() || ('TRN-'+Date.now());
  const criaNombre = document.getElementById('parto-cria-nombre').value.trim() || ('CrÃ­a '+criaId);
  const pesoPadre = +document.getElementById('parto-peso-madre').value||0;
  const pesoCria = +document.getElementById('parto-peso').value||0;
  
  // Buscar al padre: Ãºltimo servicio registrado con diagnÃ³stico 'preÃ±ada' para esta madre
  const servicioPreno = servicios.filter(s=>s.animalId===madreId&&s.diagnostico==='preÃ±ada').sort((a,b)=>b.fecha.localeCompare(a.fecha))[0];
  const padreId = servicioPreno?.toro||'';
  const metodoReproduccion = servicioPreno?.metodo||'Monta Natural';
  
  const parto = {
    id:Date.now(), fecha:document.getElementById('parto-fecha').value,
    madreId, madreNombre:madre?.nombre||'',
    padreId, padreNombre:padreId,
    criaId, criaNombre,
    sexo:document.getElementById('parto-sexo').value,
    pesoMadre:pesoPadre,
    peso:pesoCria,
    tipo:document.getElementById('parto-tipo').value,
    facilidad:+document.getElementById('parto-facilidad').value||1,
    metodoReproduccion,
    obs:document.getElementById('parto-obs').value
  };
  partos.unshift(parto);
  if(madre){ madre.partos = (madre.partos||0)+1; madre.estado='activa'; }
  
  // Crear ternero en inventario con genealogÃ­a completa
  const genealogiaMadre = madre?.genealogia || {padre:madre?.padre||'',madre:madre?.madre||'',abuelos:{paternos:{padre:madre?.abuelos?.paternos?.padre||'',madre:madre?.abuelos?.paternos?.madre||''},maternos:{padre:madre?.abuelos?.maternos?.padre||'',madre:madre?.abuelos?.maternos?.madre||''}}};
  const genealogiaPadre = {padre:'',madre:'',abuelos:{paternos:{padre:'',madre:''},maternos:{padre:'',madre:''}}};
  
  animales.push({
    id:criaId, nombre:criaNombre, categoria:parto.sexo==='Macho'?'Ternero':'Ternera',
    raza:madre?.raza||'Criollo', color:'', nacimiento:parto.fecha,
    peso:pesoCria, cc:'2.5', estado:'activa', potrero:madre?.potrero||'Potrero 1',
    litros:0, padre:padreId, madre:madreId, partos:0, 
    genealogia:{padre:padreId,madre:madreId,abuelos:{paternos:{padre:genealogiaPadre.padre,madre:genealogiaPadre.madre},maternos:{padre:genealogiaMadre.padre,madre:genealogiaMadre.madre}}},
    obs:'Nacido el '+parto.fecha+' | MÃ©todo: '+metodoReproduccion, _ts:Date.now()
  });
  persist();
  closeModal('modalParto');
  toast('Parto registrado âœ” â€” CrÃ­a agregada al inventario con genealogÃ­a');
  renderReproduccion();
}


function guardarServicio() {
  const animalId = document.getElementById('serv-animal').value;
  const anim = animales.find(a=>a.id===animalId);
  const serv = {
    id:Date.now(), fecha:document.getElementById('serv-fecha').value,
    animalId, animalNombre:anim?.nombre||'',
    metodo:document.getElementById('serv-metodo').value,
    toro:document.getElementById('serv-toro').value,
    diagnostico:document.getElementById('serv-diag').value,
    inseminador:document.getElementById('serv-insem').value,
    obs:document.getElementById('serv-obs').value
  };
  servicios.unshift(serv);
  if(anim && serv.diagnostico==='preÃ±ada') anim.estado='gestante';
  persist();
  closeModal('modalServicio');
  toast('Servicio registrado âœ”');
  renderReproduccion();
}

function guardarSalud() {
  const animalId = document.getElementById('sal-animal').value;
  const anim = animales.find(a=>a.id===animalId);
  const rl = +document.getElementById('sal-retiro-leche').value||0;
  const rc = +document.getElementById('sal-retiro-carne').value||0;
  const fechaI = document.getElementById('sal-fecha').value;
  const ev = {
    id:Date.now(), fecha:fechaI,
    animalId, animalNombre:anim?.nombre||'',
    diagnostico:document.getElementById('sal-diagnostico').value,
    tratamiento:document.getElementById('sal-tratamiento').value,
    retiroLeche:rl, retiroCarne:rc,
    fechaRetiroLeche: rl>0 ? addDays(fechaI,rl) : null,
    fechaRetiroCarne: rc>0 ? addDays(fechaI,rc) : null,
    veterinario:document.getElementById('sal-vet').value,
    estado:document.getElementById('sal-estado').value,
    obs:document.getElementById('sal-obs').value
  };
  eventosS.unshift(ev);
  persist();
  closeModal('modalSalud');
  toast('Evento sanitario registrado âœ”');
  renderSalud();
}

function guardarGasto() {
  const g = {
    id:Date.now(), fecha:document.getElementById('gasto-fecha').value,
    categoria:document.getElementById('gasto-cat').value,
    concepto:document.getElementById('gasto-concepto').value,
    monto:+document.getElementById('gasto-monto').value||0,
    proveedor:document.getElementById('gasto-proveedor').value
  };
  if(!g.concepto || !g.monto){ toast('Complete concepto y monto','error'); return; }
  gastos.unshift(g);
  persist();
  closeModal('modalGasto');
  toast('Gasto registrado âœ”');
  renderCostos();
}

function guardarPotrero() {
  const p = {
    id:Date.now(),
    nombre:document.getElementById('pot-nombre').value,
    sector:document.getElementById('pot-sector').value||'La Casa',
    area:+document.getElementById('pot-area').value||1,
    pasto:document.getElementById('pot-pasto').value,
    estado:document.getElementById('pot-estado').value,
    animales:+document.getElementById('pot-animales').value||0,
    diasOcupado:+document.getElementById('pot-dias-oc').value||0,
    diasDescanso:+document.getElementById('pot-dias-des').value||0,
    aforo:+document.getElementById('pot-aforo').value||0
  };
  if(!p.nombre){ toast('Ingrese nombre del potrero','error'); return; }
  praderas.push(p);
  persist();
  closeModal('modalPotrero');
  toast('Potrero registrado âœ”');
  renderPraderas();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
  const vacasP = animales.filter(a=>a.categoria==='Vaca'&&a.estado==='activa');
  const totalL = vacasP.reduce((s,a)=>s+a.litros,0);
  const gestantes = animales.filter(a=>a.estado==='gestante'||a.estado==='preparto').length;
  const enTrat = eventosS.filter(e=>e.estado==='En tratamiento'||e.estado==='Mejorando').length;

  document.getElementById('dash-kpis').innerHTML = [
    {lbl:'Total Animales',val:fNum(animales.filter(a=>a.estado!=='baja').length),delta:'activos en hato',type:'up',icon:'ğŸ„',color:'var(--pasto)'},
    {lbl:'Leche Hoy (L)',val:fNum(totalL),delta:'â–² producciÃ³n',type:'up',icon:'ğŸ¥›',color:'var(--sol)'},
    {lbl:'Gestantes',val:gestantes,delta:'hembras',type:'neu',icon:'ğŸ”¬',color:'var(--cielo)'},
    {lbl:'En Tratamiento',val:enTrat,delta:enTrat>0?'âš  revisar':'âœ“ sin novedades',type:enTrat>0?'dn':'up',icon:'ğŸ’Š',color:'var(--tierra)'},
  ].map(k=>`
    <div class="kpi-card">
      <div class="kpi-card-accent" style="background:${k.color};"></div>
      <div class="kpi-icon-bg">${k.icon}</div>
      <div class="kpi-lbl">${k.lbl}</div>
      <div class="kpi-val" style="color:${k.color};">${k.val}</div>
      <span class="kpi-delta delta-${k.type}">${k.delta}</span>
    </div>`).join('');

  // Bar chart leche
  const meses = ['Jul','Ago','Sep','Oct','Nov','Dic','Ene','Feb'];
  const base = totalL*30;
  const vals = [0.82,0.85,0.88,0.94,0.91,0.89,0.96,1].map(f=>Math.round(base*f));
  const prevs = vals.map(v=>Math.round(v*0.93));
  const maxV = Math.max(...vals,...prevs);
  const H=150;
  document.getElementById('dash-bar-chart').innerHTML = `
    <div style="display:flex;align-items:flex-end;height:${H}px;gap:6px;padding-bottom:20px;position:relative;">
      ${meses.map((m,i)=>`
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;height:100%;justify-content:flex-end;">
          <div style="display:flex;gap:2px;align-items:flex-end;">
            <div style="width:12px;height:${Math.round((prevs[i]/maxV)*(H-24))}px;background:var(--pasto-medio);border-radius:4px 4px 0 0;" title="${fNum(prevs[i])} L"></div>
            <div style="width:12px;height:${Math.round((vals[i]/maxV)*(H-24))}px;background:var(--pasto);border-radius:4px 4px 0 0;" title="${fNum(vals[i])} L"></div>
          </div>
          <span style="font-size:9px;color:var(--gris-calido);font-weight:700;position:absolute;bottom:0;">${m}</span>
        </div>`).join('')}
    </div>`;
  document.getElementById('dash-leche-total').textContent = fNum(vals[7])+' L/mes';

  // Radar
  renderRadar('dash-radar');

  // Alertas
  const alertas = getAlertas();
  document.getElementById('dash-alerts').innerHTML = alertas.slice(0,4).map(a=>`
    <div class="alert-item alert-${a.tipo}">
      <div class="alert-dot ad-${a.tipo==='urgente'?'rojo':a.tipo==='media'?'amarillo':'verde'}"></div>
      <div class="alert-body">
        <div>${a.texto}</div>
        <div class="alert-time">${a.sub||''}</div>
      </div>
    </div>`).join('') || '<div class="muted text-sm">Sin alertas activas ğŸ‰</div>';
  document.getElementById('badge-alertas').textContent = alertas.filter(a=>a.tipo!=='info').length;
  document.getElementById('badge-salud').textContent = eventosS.filter(e=>e.estado==='En tratamiento').length;

  // Eventos
  const eventos = [
    {dia:17,mes:'Feb',nombre:'VacunaciÃ³n Brucelosis',meta:'34 novillas',color:'var(--pasto)'},
    {dia:19,mes:'Feb',nombre:'Control LÃ¡cteo',meta:vacasP.length+' vacas',color:'var(--sol)'},
    {dia:22,mes:'Feb',nombre:'Chequeo Reproductivo',meta:'Posparto',color:'var(--tierra)'},
  ];
  document.getElementById('dash-events').innerHTML = eventos.map(e=>`
    <div class="event-item">
      <div class="event-date-box" style="background:${e.color};">
        <div class="ed-day">${e.dia}</div>
        <div class="ed-mon">${e.mes}</div>
      </div>
      <div class="event-info">
        <div class="event-name">${e.nombre}</div>
        <div class="event-meta">${e.meta}</div>
      </div>
    </div>`).join('');

  // Donut estructura hato â€” usa categorÃ­a real (partosâ†’Vaca, gestante sin partosâ†’Novilla)
  const cats = {};
  animales.filter(a=>a.estado!=='baja').forEach(a=>{
    const cat = categoriaReal(a);
    cats[cat]=(cats[cat]||0)+1;
  });
  const colors = {'Vaca':'#1b5e35','Novilla':'#2563a8','Ternero':'#7c4d2d','Ternera':'#d97706','Toro':'#374151','BÃºfalo':'#6b21a8'};
  const donutData = Object.entries(cats).sort((a,b)=>b[1]-a[1]).map(([k,v])=>({label:k+'s',val:v,color:colors[k]||'#999'}));
  renderDonut('dash-donut','dash-donut-legend',donutData,110,70);
}

function renderRadar(svgId) {
  const svg = document.getElementById(svgId);
  if(!svg) return;
  const cx=110,cy=100,r=72;
  const items=[
    {lbl:'PreÃ±ez',v:0.84},{lbl:'Natalidad',v:0.78},{lbl:'DÃ­as Ab.',v:0.62},
    {lbl:'S/Concep',v:0.86},{lbl:'Int.Parto',v:0.65},{lbl:'Ed.1Â°Parto',v:0.92}
  ];
  const n=items.length;
  const ang=i=>(2*Math.PI*i/n)-Math.PI/2;
  const px=(i,rr)=>cx+rr*Math.cos(ang(i));
  const py=(i,rr)=>cy+rr*Math.sin(ang(i));
  let h='';
  [.25,.5,.75,1].forEach(s=>{
    h+=`<polygon points="${items.map((_,i)=>`${px(i,r*s)},${py(i,r*s)}`).join(' ')}" fill="none" stroke="#e8dfc9" stroke-width="1"/>`;
  });
  items.forEach((_,i)=>{ h+=`<line x1="${cx}" y1="${cy}" x2="${px(i,r)}" y2="${py(i,r)}" stroke="#e8dfc9" stroke-width="1"/>`; });
  const dpts=items.map((it,i)=>`${px(i,r*it.v)},${py(i,r*it.v)}`).join(' ');
  h+=`<polygon points="${dpts}" fill="rgba(27,94,53,.15)" stroke="var(--pasto-vivo)" stroke-width="2"/>`;
  items.forEach((it,i)=>{
    h+=`<circle cx="${px(i,r*it.v)}" cy="${py(i,r*it.v)}" r="3.5" fill="var(--pasto)"/>`;
    h+=`<text x="${px(i,r*1.22)}" y="${py(i,r*1.22)}" text-anchor="middle" dominant-baseline="middle" class="radar-lbl" font-size="9">${it.lbl}</text>`;
  });
  svg.innerHTML=h;
}

function renderDonut(svgId, legId, data, cy, ri) {
  const svg=document.getElementById(svgId);
  const leg=document.getElementById(legId);
  if(!svg) return;
  const total=data.reduce((s,d)=>s+d.val,0);
  const r=85, cx=110;
  let start=-Math.PI/2;
  let paths='';
  data.forEach(d=>{
    const a=(d.val/total)*2*Math.PI;
    const x1=cx+r*Math.cos(start),y1=cy+r*Math.sin(start);
    const x2=cx+r*Math.cos(start+a),y2=cy+r*Math.sin(start+a);
    const xi1=cx+ri*Math.cos(start),yi1=cy+ri*Math.sin(start);
    const xi2=cx+ri*Math.cos(start+a),yi2=cy+ri*Math.sin(start+a);
    const lg=a>Math.PI?1:0;
    paths+=`<path d="M${xi1},${yi1}L${x1},${y1}A${r},${r} 0 ${lg},1 ${x2},${y2}L${xi2},${yi2}A${ri},${ri} 0 ${lg},0 ${xi1},${yi1}" fill="${d.color}" opacity=".9" style="cursor:default"/>`;
    start+=a;
  });
  paths+=`<text x="${cx}" y="${cy-7}" text-anchor="middle" font-size="17" font-weight="700" font-family="Fraunces,serif" fill="var(--texto)">${total}</text><text x="${cx}" y="${cy+9}" text-anchor="middle" font-size="9" fill="var(--gris-calido)">animales</text>`;
  svg.innerHTML=paths;
  if(leg) leg.innerHTML=data.map(d=>`<div style="display:flex;align-items:center;gap:7px;"><span style="width:9px;height:9px;border-radius:2px;background:${d.color};display:inline-block;flex-shrink:0;"></span><span>${d.label}</span><span style="margin-left:auto;font-weight:700;">${d.val}</span></div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER INVENTARIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderInventario() {
  const q = document.getElementById('inv-search')?.value.toLowerCase()||'';
  const mostrarInactivos = document.getElementById('chk-mostrar-inactivos')?.checked || false;
  let list = [...animales];
  // Filtrar inactivos (baja) salvo que el checkbox estÃ© marcado
  if(!mostrarInactivos) list = list.filter(a => a.estado !== 'baja');
  if(invFilter!=='Todos') list=list.filter(a=>a.categoria===invFilter);
  if(q) list=list.filter(a=>(a.id+a.nombre+a.raza+a.categoria).toLowerCase().includes(q));
  list.sort((a,b)=>{
    let va=a[sortKey],vb=b[sortKey];
    if(sortKey==='edad') { va=a.nacimiento; vb=b.nacimiento; }
    if(typeof va==='string') return sortAsc?va.localeCompare(vb):vb.localeCompare(va);
    return sortAsc?(va-vb):(vb-va);
  });

  // Etiqueta de estado legible
  const etiquetaEstado = (estado) => {
    if(estado === 'baja')       return '<span class="tag tag-gris">Inactivo</span>';
    if(estado === 'activa')     return '<span class="tag tag-verde">Activo</span>';
    if(estado === 'gestante')   return '<span class="tag tag-morado">Gestante</span>';
    if(estado === 'preparto')   return '<span class="tag tag-amarillo">Preparto</span>';
    if(estado === 'en secado')  return '<span class="tag tag-amarillo">En secado</span>';
    return `<span class="tag tag-gris">${estado}</span>`;
  };
  document.getElementById('inv-tbody').innerHTML = list.map(a=>`
    <tr onclick="verHoja('${a.id}')" ${a.estado==='baja'?'style="opacity:0.55;"':''}>
      <td><span class="mono">${a.id}</span></td>
      <td class="fw7">${a.nombre}</td>
      <td>${a.categoria}</td>
      <td style="max-width:160px;">
        ${a.composicion && a.composicion.length
          ? a.composicion.map(c=>`<span style="display:inline-block;background:${BOS_TAURUS.has(c.raza)?'#dbeafe':BOS_INDICUS.has(c.raza)?'#fef9c3':'#dcfce7'};color:${BOS_TAURUS.has(c.raza)?'#1e3a5f':BOS_INDICUS.has(c.raza)?'#713f12':'#14532d'};padding:2px 7px;border-radius:10px;font-size:10px;font-weight:700;margin:1px;">${c.raza} ${c.pct}%</span>`).join('')
          : `<span class="muted">${a.raza||'â€”'}</span>`}
      </td>
      <td>${edad(a.nacimiento)}</td>
      <td>${fNum(a.peso)}</td>
      <td>
        ${etiquetaEstado(a.estado)}
        ${(()=>{const g=infoGestacion(a);if(!g)return '';const col=g.restantes<=30?'var(--rojo)':g.restantes<=60?'var(--sol)':'var(--cielo)';return '<div style="margin-top:4px;font-size:10px;color:'+col+';font-weight:700;">ğŸ¤° '+g.transcurridos+'d / 283<div style="background:#e5e7eb;border-radius:3px;height:4px;margin-top:2px;width:70px;"><div style="background:'+col+';width:'+g.pct+'%;height:100%;border-radius:3px;"></div></div><span style="color:var(--gris-calido);font-weight:400;"> Parto: '+g.partoEsp+'</span></div>';})()}
      </td>
      <td>${a.litros>0?`<div style="display:flex;align-items:center;gap:7px;"><span class="fw7 c-verde">${a.litros} kg</span><div class="pbar-wrap"><div class="pbar-fill" style="width:${Math.min(100,(a.litros/40)*100)}%"></div></div></div>`:'<span class="muted">â€”</span>'}</td>
      <td onclick="event.stopPropagation()">
        <div style="display:flex;gap:4px;">
          <button class="btn btn-ghost btn-sm btn-icon" onclick="verHoja('${a.id}')" title="Ver hoja">ğŸ‘</button>
          <button class="btn btn-ghost btn-sm btn-icon" onclick="editAnimal('${a.id}')" title="Editar">âœï¸</button>
          <button class="btn btn-ghost btn-sm btn-icon" onclick="deleteAnimal('${a.id}')" title="Eliminar">ğŸ—‘</button>
        </div>
      </td>
    </tr>`).join('') || `<tr><td colspan="9"><div class="empty-state"><div class="es-icon">ğŸ„</div><div class="es-text">No hay animales</div><div class="es-sub">Registra tu primer animal</div></div></td></tr>`;

  // Chips
  document.querySelectorAll('#inv-chips .chip').forEach(c=>{
    c.classList.toggle('act',c.dataset.cat===invFilter);
    c.onclick=()=>{ invFilter=c.dataset.cat; renderInventario(); };
  });
  const activos = animales.filter(a=>a.estado!=='baja' && (invFilter==='Todos'||a.categoria===invFilter)).length;
  const inactivos = animales.filter(a=>a.estado==='baja' && (invFilter==='Todos'||a.categoria===invFilter)).length;
  document.getElementById('inv-footer').innerHTML = `Mostrando <strong>${list.length}</strong> animales Â· <span class="c-verde fw7">${activos} activos</span> Â· <span class="muted">${inactivos} inactivos</span>`;
}

function sortTbl(key) {
  if(sortKey===key) sortAsc=!sortAsc; else { sortKey=key; sortAsc=true; }
  renderInventario();
}

function verHoja(id) {
  animalActivoId = id;
  nav('hojavida');
  renderHoja();
}

function renderHoja() {
  const a = animales.find(x=>x.id===animalActivoId);
  if(!a) { document.getElementById('hoja-empty').style.display='block'; document.getElementById('hoja-content').classList.remove('show'); return; }
  document.getElementById('hoja-empty').style.display='none';
  document.getElementById('hoja-content').classList.add('show');

  // Header
  const avatarEmoji = a.categoria==='Toro'?'ğŸ‚':a.categoria==='Ternero'?'ğŸ‚':a.categoria==='Ternera'?'ğŸ„':a.categoria==='Novilla'?'ğŸ„':'ğŸ„';
  document.getElementById('hoja-header-content').innerHTML = `
    <div class="hoja-avatar">${avatarEmoji}</div>
    <div class="hoja-info" style="flex:1;">
      <div class="hoja-name">${a.nombre}</div>
      <div class="hoja-id">${a.id} Â· ${a.raza||a.categoria} Â· ${a.categoria}</div>
      <div style="margin-top:6px;display:flex;align-items:center;gap:8px;">
        ${tagEstado(a.estado)}
        <span style="font-size:11px;color:var(--gris-calido);">INKA Â· Julio CÃ©sar Â· 310 632 9590</span>
      </div>
    </div>
    <div class="hoja-stats">
      <div class="hstat"><div class="hstat-val">${a.litros||0} kg</div><div class="hstat-lbl">Hoy</div></div>
      <div class="hstat"><div class="hstat-val">${a.peso||'â€”'}</div><div class="hstat-lbl">kg</div></div>
      <div class="hstat"><div class="hstat-val">${a.partos||0}</div><div class="hstat-lbl">Partos</div></div>
      <div class="hstat"><div class="hstat-val">${edad(a.nacimiento)}</div><div class="hstat-lbl">Edad</div></div>
    </div>`;

  // Tabs
  document.querySelectorAll('.hoja-tab').forEach(t=>{
    t.classList.toggle('act',t.dataset.htab===activeHtab);
    t.onclick=()=>{ activeHtab=t.dataset.htab; renderHoja(); };
  });
  document.querySelectorAll('.htab-body').forEach(b=>b.classList.remove('act'));
  document.getElementById('hoja-tab-'+activeHtab).classList.add('act');

  // Info
  const taurus = (a.composicion||[]).filter(c=>BOS_TAURUS.has(c.raza)).reduce((s,c)=>s+c.pct,0);
  const indicus = (a.composicion||[]).filter(c=>BOS_INDICUS.has(c.raza)).reduce((s,c)=>s+c.pct,0);
  const geneticaDisplay = a.composicion && a.composicion.length
    ? `<div style="margin-top:6px;display:flex;flex-wrap:wrap;gap:5px;">
        ${a.composicion.map(c=>`<span style="background:${BOS_TAURUS.has(c.raza)?'#dbeafe':BOS_INDICUS.has(c.raza)?'#fef9c3':'#dcfce7'};color:${BOS_TAURUS.has(c.raza)?'#1e3a5f':BOS_INDICUS.has(c.raza)?'#713f12':'#14532d'};padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;">${c.raza} ${c.pct}%</span>`).join('')}
        ${taurus>0?`<span style="background:#eff6ff;color:#1d4ed8;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700;">ğŸ‡ªğŸ‡º Taurus ${taurus}%</span>`:''}
        ${indicus>0?`<span style="background:#fefce8;color:#a16207;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700;">ğŸ‡®ğŸ‡³ Indicus ${indicus}%</span>`:''}
       </div>`
    : a.raza || 'â€”';

  document.getElementById('hoja-tab-info').innerHTML = `
    <div class="grid-2">
      <div class="card">
        <div class="card-title">ğŸ“‹ Datos Generales</div>
        <div>
          ${(()=>{
            const _g=infoGestacion(a);
            const _rows=[['ID / Arete',a.id],['Nombre',a.nombre],['CategorÃ­a',a.categoria],['Color/SeÃ±ales',a.color||'â€”'],['Nacimiento',a.nacimiento||'â€”'],['Edad',edad(a.nacimiento)],['Peso',a.peso+' kg'],['CondiciÃ³n Corporal',a.cc||'â€”'],['Estado',a.estado]];
            if(_g){_rows.push(['ğŸ¤° DÃ­as de gestaciÃ³n',_g.transcurridos+' dÃ­as (de 283)'],['ğŸ“… Parto esperado',_g.partoEsp],['â³ DÃ­as restantes',_g.restantes>0?_g.restantes+' dÃ­as':_g.restantes===0?'Â¡Hoy!':Math.abs(_g.restantes)+'d retrasado']);}
            _rows.push(['Potrero',a.potrero||'â€”'],['ProducciÃ³n',a.litros>0?a.litros+' kg/dÃ­a':'â€”']);
            return _rows.map(([l,v])=>`
          <div class="cost-row">
            <span class="cost-lbl">${l}</span>
            <span class="fw7">${v}</span>
          </div>`).join('');
          })()}
        </div>
      </div>
        <div class="card-title">ğŸ§¬ GenÃ©tica y GenealogÃ­a</div>
        <div>
          <div class="cost-row" style="flex-direction:column;align-items:flex-start;gap:6px;padding-bottom:10px;">
            <span class="cost-lbl">ComposiciÃ³n GenÃ©tica</span>
            ${geneticaDisplay}
          </div>
          ${[['Padre',a.padre||'â€”'],['Madre',a.madre||'â€”'],['NÂº Partos',a.partos||0],
             ...(a.registro?[['Registro AsocebÃº',a.registro+(a.tipo_reg?' ('+a.tipo_reg+')':'')]]:
             []),
             ...(a.criador?[['Criador',a.criador]]:
             [])
            ].map(([l,v])=>`
          <div class="cost-row"><span class="cost-lbl">${l}</span><span class="fw7" style="max-width:60%;text-align:right;font-size:12px;">${v}</span></div>`).join('')}
          ${a.genealogia ? `
          <div class="divider"></div>
          <div style="font-size:11px;color:var(--gris-calido);font-weight:700;margin-bottom:6px;">ğŸŒ³ PEDIGREE (4 generaciones)</div>
          <div style="font-size:10.5px;line-height:1.8;">
            <div style="margin-left:0px;">â¬› <strong>Padre:</strong> ${a.genealogia.padre?.nombre} ${a.genealogia.padre?.numero} <span style="color:var(--gris-calido);">${a.genealogia.padre?.registro}</span></div>
            <div style="margin-left:14px;">â”œâ”€ PP: ${a.genealogia.abuelos_paternos?.pp||'â€”'}</div>
            <div style="margin-left:14px;">â””â”€ PM: ${a.genealogia.abuelos_paternos?.pm||'â€”'}</div>
            <div style="margin-left:14px;">â”œâ”€ MP: ${a.genealogia.abuelos_paternos?.mp||'â€”'}</div>
            <div style="margin-left:14px;">â””â”€ MM: ${a.genealogia.abuelos_paternos?.mm||'â€”'}</div>
            <div style="margin-left:0;margin-top:4px;">â¬œ <strong>Madre:</strong> ${a.genealogia.madre?.nombre} ${a.genealogia.madre?.numero} <span style="color:var(--gris-calido);">${a.genealogia.madre?.registro}</span></div>
            <div style="margin-left:14px;">â”œâ”€ PP: ${a.genealogia.abuelos_maternos?.pp||'â€”'}</div>
            <div style="margin-left:14px;">â””â”€ PM: ${a.genealogia.abuelos_maternos?.pm||'â€”'}</div>
            <div style="margin-left:14px;">â”œâ”€ MP: ${a.genealogia.abuelos_maternos?.mp||'â€”'}</div>
            <div style="margin-left:14px;">â””â”€ MM: ${a.genealogia.abuelos_maternos?.mm||'â€”'}</div>
          </div>` : ''}
        </div>
        ${a.obs?`<div class="divider"></div><div class="card-title">ğŸ“ Observaciones</div><div style="font-size:13px;color:var(--texto-medio);">${a.obs}</div>`:''}
      </div>
    </div>`;

  // Reproductivo
  const misServicios = servicios.filter(s=>s.animalId===a.id);
  const misPartos = partos.filter(p=>p.madreId===a.id && !p.obs?.includes('estimada'));
  // CrÃ­as: buscar por criaId en partos de esta madre
  const criaIds = new Set(misPartos.map(p=>p.criaId).filter(Boolean));
  const misCrias = animales.filter(x=>criaIds.has(x.id));
  // Para terneros/terneras: buscar parto de origen y madre
  const partoOrigen = (a.categoria==='Ternero'||a.categoria==='Ternera')
    ? partos.find(p=>p.criaId===a.id) : null;
  const madreAnimal = partoOrigen ? animales.find(x=>x.id===partoOrigen.madreId) : null;

  document.getElementById('hoja-tab-reproductivo').innerHTML = `
    <div class="grid-2">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
          <div class="card-title" style="margin:0;">ğŸ’‰ Servicios</div>
          <button class="btn btn-primary btn-sm" onclick="openModalAnimalServicio('${a.id}')">+ Registrar</button>
        </div>
        ${misServicios.length ? `<div class="tbl-wrap"><table><thead><tr><th>Fecha</th><th>MÃ©todo</th><th>Toro/Semen</th><th>Resultado</th></tr></thead><tbody>${misServicios.map(s=>`<tr><td>${s.fecha}</td><td>${s.metodo.split('â€”')[0]}</td><td>${s.toro}</td><td>${s.diagnostico?`<span class="tag ${s.diagnostico==='preÃ±ada'?'tag-verde':'tag-rojo'}">${s.diagnostico}</span>`:'<span class="muted">Pendiente</span>'}</td></tr>`).join('')}</tbody></table></div>` : '<div class="muted text-sm">Sin servicios registrados</div>'}
        ${madreAnimal ? `
        <div class="divider"></div>
        <div class="card-title">ğŸ„ Madre</div>
        <div style="display:flex;align-items:center;gap:12px;padding:6px 0;">
          <div style="font-size:26px;">ğŸ„</div>
          <div style="flex:1;">
            <div style="font-weight:700;">${madreAnimal.nombre}</div>
            <div style="font-size:12px;color:var(--gris-calido);">${madreAnimal.id} Â· ${madreAnimal.raza||'â€”'}</div>
            <div style="font-size:12px;color:var(--gris-calido);">Nacimiento: ${partoOrigen.fecha} Â· Peso al nacer: ${partoOrigen.peso||0} kg Â· Sexo: ${partoOrigen.sexo||partoOrigen.sexoCria||'?'}</div>
          </div>
          <button class="btn btn-sm" onclick="abrirHoja('${madreAnimal.id}')">Ver ficha madre</button>
        </div>` : ''}
      </div>
      <div class="card">
        <div class="card-title">ğŸ£ Partos y CrÃ­as</div>
        ${misPartos.length ? `
        <div class="tbl-wrap"><table>
          <thead><tr><th>Fecha</th><th>CrÃ­a</th><th>Sexo</th><th>Peso</th><th>Estado</th><th></th></tr></thead>
          <tbody>${misPartos.map(p=>{
            const cria=animales.find(x=>x.id===p.criaId);
            const est=cria?.estado||'activa';
            return `<tr>
              <td>${p.fecha}</td>
              <td><div style="font-weight:600;font-size:12px;">${p.criaNombre||p.criaId||'â€”'}</div>${cria?`<div style="font-size:10px;color:var(--gris-calido);">${p.criaId}</div>`:''}</td>
              <td>${(p.sexo||p.sexoCria)==='Hembra'?'â™€ Hembra':'â™‚ Macho'}</td>
              <td>${p.peso?p.peso+' kg':'â€”'}</td>
              <td>${est==='baja'?'<span class="tag tag-rojo">Baja</span>':'<span class="tag tag-verde">Activa</span>'}</td>
              <td>${cria?`<button class="btn btn-ghost btn-sm btn-icon" onclick="abrirHoja('${p.criaId}')" title="Ver ficha crÃ­a">ğŸ‘</button>`:''}</td>
            </tr>`;
          }).join('')}</tbody>
        </table></div>` : '<div class="muted text-sm">Sin partos registrados</div>'}
      </div>
    </div>
    ${misCrias.length ? `
    <div class="card" style="margin-top:14px;">
      <div class="card-title">ğŸ® CrÃ­as en Inventario (${misCrias.length})</div>
      <div class="tbl-wrap"><table>
        <thead><tr><th>ID</th><th>Nombre</th><th>Cat.</th><th>Nacimiento</th><th>Peso</th><th>Estado</th><th></th></tr></thead>
        <tbody>${misCrias.map(c=>`
          <tr>
            <td><span class="mono">${c.id}</span></td>
            <td>${c.nombre}</td>
            <td>${c.categoria==='Ternero'?'ğŸ‚':'ğŸ„'} ${c.categoria}</td>
            <td>${c.nacimiento||'â€”'}</td>
            <td>${c.peso?c.peso+' kg':'â€”'}</td>
            <td>${tagEstado(c.estado)}</td>
            <td><button class="btn btn-ghost btn-sm btn-icon" onclick="abrirHoja('${c.id}')" title="Ver ficha">ğŸ‘</button></td>
          </tr>`).join('')}
        </tbody>
      </table></div>
    </div>` : ''}`;
  // ProducciÃ³n
  const misLeche = registrosLeche.filter(r=>r.animalId===a.id).sort((x,y)=>x.fecha.localeCompare(y.fecha));
  const totalProdAnimal = +misLeche.reduce((s,r)=>s+r.total,0).toFixed(2);
  const promProd = misLeche.length ? +(totalProdAnimal/misLeche.length).toFixed(1) : 0;
  const maxControl = misLeche.length ? Math.max(...misLeche.map(r=>r.total)) : 0;
  const minControl = misLeche.length ? Math.min(...misLeche.map(r=>r.total)) : 0;

  // â”€â”€ LACTANCIAS: agrupar controles en bloques por gap >45 dÃ­as â”€â”€
  // Cada bloque = una lactancia distinta (destete â†’ nuevo parto entre bloques)
  function detectarLactancias(registros, partosAnimal) {
    if(!registros.length) return [];
    const sorted = [...registros].sort((a,b)=>a.fecha.localeCompare(b.fecha));
    const bloques = [];
    let bloque = [sorted[0]];
    for(let i=1;i<sorted.length;i++){
      const d1=new Date(sorted[i-1].fecha+'T00:00:00');
      const d2=new Date(sorted[i].fecha+'T00:00:00');
      const gap = (d2-d1)/86400000;
      if(gap>45){ bloques.push(bloque); bloque=[sorted[i]]; }
      else bloque.push(sorted[i]);
    }
    bloques.push(bloque);

    // Para cada bloque buscar parto registrado cercano al inicio (Â±90 dÃ­as)
    return bloques.map((b, idx)=>{
      const primerFecha = b[0].fecha;
      const primerDt   = new Date(primerFecha+'T00:00:00');
      let partoCercano = null;
      for(const p of partosAnimal){
        const pd = new Date(p.fecha+'T00:00:00');
        const diff = Math.abs((primerDt-pd)/86400000);
        if(diff<=90){ partoCercano=p; break; }
      }
      const fechaParto  = partoCercano ? partoCercano.fecha : null;
      const partoDt     = fechaParto ? new Date(fechaParto+'T00:00:00') : null;
      const controles   = b.map(r=>({
        ...r,
        del: partoDt ? Math.floor((new Date(r.fecha+'T00:00:00')-partoDt)/86400000) : null,
      }));
      const hoy = new Date();
      const ultiDt = new Date(b[b.length-1].fecha+'T00:00:00');
      const diasDesde = partoDt ? Math.floor((hoy-partoDt)/86400000) : null;
      return {
        num: idx+1,
        fechaParto,
        partoCercano,
        controles,
        n: b.length,
        diasEnLeche: diasDesde,
        fuente: partoCercano ? 'registrado' : 'estimado',
      };
    });
  }

  const partosAnimal = partos.filter(p=>p.madreId===a.id).sort((a,b)=>a.fecha.localeCompare(b.fecha));
  const lactanciasAnimal = detectarLactancias(misLeche, partosAnimal);
  // Ãšltima lactancia = la activa
  const lactActiva = lactanciasAnimal[lactanciasAnimal.length-1] || null;
  const fparto = lactActiva?.partoCercano || partosAnimal[partosAnimal.length-1] || null;
  const diasDesdePartoDia = lactActiva?.diasEnLeche || null;

  // â”€â”€ GrÃ¡fica SVG por lactancia â”€â”€
  function graficaLactancia(controles, color='var(--pasto)', uid='') {
    if(controles.length<2) return '';
    const W=460,H=140,pl=38,pr=20,pt=8,pb=28;
    const vals=controles.map(r=>r.total);
    const maxV=Math.max(...vals)*1.12||1;
    const minV=Math.max(0,Math.min(...vals)*0.85);
    const useDel=controles.some(r=>r.del!==null);
    const xs=controles.map((_,i)=>pl+i*(W-pl-pr)/(controles.length-1||1));
    const sy=v=>H-pb-(v-minV)/(maxV-minV||1)*(H-pt-pb);
    const pts=controles.map((r,i)=>`${xs[i].toFixed(1)},${sy(r.total).toFixed(1)}`).join(' ');
    const area=`M${xs[0].toFixed(1)},${sy(controles[0].total).toFixed(1)}`+
      controles.slice(1).map((r,i)=>`L${xs[i+1].toFixed(1)},${sy(r.total).toFixed(1)}`).join('')+
      `L${xs[controles.length-1].toFixed(1)},${H-pb}L${xs[0].toFixed(1)},${H-pb}Z`;
    const gid=`mlg${uid}`.replace(/[^a-z0-9]/gi,'');
    const prom=vals.reduce((s,v)=>s+v,0)/vals.length;
    let svg=`<svg width="100%" viewBox="0 0 ${W} ${H}" style="overflow:visible;">
      <defs><linearGradient id="${gid}" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="${color}" stop-opacity=".2"/>
        <stop offset="100%" stop-color="${color}" stop-opacity="0"/>
      </linearGradient></defs>
      <path d="${area}" fill="url(#${gid})"/>
      <polyline points="${pts}" fill="none" stroke="${color}" stroke-width="2.5" stroke-linejoin="round"/>`;
    controles.forEach((r,i)=>{
      const cx=xs[i].toFixed(1),cy=sy(r.total).toFixed(1);
      svg+=`<circle cx="${cx}" cy="${cy}" r="3.5" fill="${color}" stroke="#fff" stroke-width="1.5"/>`;
      svg+=`<text x="${cx}" y="${(+cy-7).toFixed(0)}" text-anchor="middle" font-size="8.5" font-weight="700" fill="${color}">${r.total}L</text>`;
      const lbl=useDel&&r.del!==null?`d${r.del}`:r.fecha.slice(5);
      svg+=`<text x="${cx}" y="${H-3}" text-anchor="middle" font-size="8" fill="var(--gris-calido)">${lbl}</text>`;
    });
    const yp=sy(prom);
    svg+=`<line x1="${pl}" y1="${yp.toFixed(0)}" x2="${W-pr}" y2="${yp.toFixed(0)}" stroke="var(--sol)" stroke-width="1" stroke-dasharray="4,3"/>`;
    svg+=`<text x="${W-pr+2}" y="${yp.toFixed(0)}" dominant-baseline="middle" font-size="7.5" fill="var(--sol)" font-weight="700">xÌ„${prom.toFixed(1)}</text>`;
    svg+=`</svg>`;
    return svg;
  }

  const coloresLact=['var(--pasto)','var(--cielo)','var(--sol)'];

  // â”€â”€ HTML secciÃ³n producciÃ³n â”€â”€
  // â”€â”€ CÃ¡lculo correcto de acumulado y proyecciÃ³n 305d â”€â”€
  // MÃ©todo: Ã¡rea trapezoidal entre controles / dÃ­as span = L/dÃ­a promedio
  // Acumulado = L/dÃ­a Ã— DEL actual | ProyecciÃ³n = L/dÃ­a Ã— 305
  function calcularLactancia305(controles) {
    const c = controles.filter(r=>r.del!==null).sort((a,b)=>a.del-b.del);
    if(!c.length) return {promDia:null, acumReal:null, proy305:null, delFin:null};
    if(c.length===1) {
      const pd = c[0].total;
      return {promDia:pd, acumReal:+(pd*c[0].del).toFixed(1), proy305:+(pd*305).toFixed(1), delFin:c[0].del};
    }
    // Regla trapezoidal
    let area=0;
    for(let i=1;i<c.length;i++){
      area += (c[i-1].total + c[i].total)/2 * (c[i].del - c[i-1].del);
    }
    const delFin  = c[c.length-1].del;
    const delSpan = delFin - c[0].del;
    const promDia = delSpan>0 ? area/delSpan : c[0].total;
    const acumReal= +(promDia * delFin).toFixed(1);
    const proy305 = +(promDia * 305).toFixed(1);
    return {promDia:+promDia.toFixed(3), acumReal, proy305, delFin};
  }

  const lactHTMLs = lactanciasAnimal.map((l,idx)=>{
    const color = coloresLact[idx % coloresLact.length];
    const {promDia, acumReal, proy305, delFin} = calcularLactancia305(l.controles);
    const max_  = l.controles.length ? Math.max(...l.controles.map(r=>r.total)) : 'â€”';
    const pctProy = proy305 ? Math.min(100, Math.round((acumReal/proy305)*100)) : 0;
    const delAct= idx===lactanciasAnimal.length-1 && l.diasEnLeche!==null ? `<span style="color:${color};font-weight:700;">${l.diasEnLeche}d en leche hoy</span>` : '';
    return `
    <div class="card" style="margin-bottom:14px;border-left:4px solid ${color};">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <div class="card-title" style="color:${color};margin:0;">ğŸ„ Lactancia ${l.num} ${idx===lactanciasAnimal.length-1?'<span style="font-size:11px;background:'+color+';color:#fff;padding:2px 8px;border-radius:10px;">ACTIVA</span>':''}</div>
        ${delAct}
      </div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px;">
        <div class="res-box"><div class="res-lbl">Parto</div><div style="font-size:13px;font-weight:700;">${l.fechaParto||'â€”'} ${l.fuente==='estimado'?'<span title="Estimado del historial" style="font-size:10px;color:var(--sol);">est.</span>':''}</div></div>
        <div class="res-box"><div class="res-lbl">DEL actual</div><div class="res-big" style="font-size:20px;">${delFin!==null?delFin+'d':'â€”'}</div></div>
        <div class="res-box"><div class="res-lbl">L/dÃ­a (prom.)</div><div class="res-big" style="font-size:20px;color:${color};">${promDia!==null?promDia+'L':'â€”'}</div></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;">
        <div class="res-box" style="border:2px solid ${color}20;">
          <div class="res-lbl">ğŸ“Š Acumulado real (DEL ${delFin||0})</div>
          <div style="font-size:22px;font-weight:800;color:${color};">${acumReal!==null?acumReal+'L':'â€”'}</div>
          ${proy305?`<div style="margin-top:6px;">
            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--gris-calido);margin-bottom:3px;">
              <span>Avance hacia 305d</span><span>${pctProy}%</span>
            </div>
            <div style="background:#e5e7eb;border-radius:4px;height:7px;">
              <div style="background:${color};width:${pctProy}%;height:100%;border-radius:4px;transition:width .4s;"></div>
            </div>
          </div>`:''}
        </div>
        <div class="res-box" style="border:2px solid var(--sol)20;background:var(--sol)08;">
          <div class="res-lbl">ğŸ¯ ProyecciÃ³n 305 dÃ­as</div>
          <div style="font-size:22px;font-weight:800;color:var(--sol);">${proy305!==null?proy305+'L':'â€”'}</div>
          <div style="font-size:10px;color:var(--gris-calido);margin-top:4px;">
            ${promDia!==null?`a ${promDia}L/dÃ­a Ã— 305d`:''}
          </div>
        </div>
      </div>
      ${l.controles.length>=2?graficaLactancia(l.controles, color, a.id+idx):'<div class="muted text-sm">Solo '+l.n+' control â€” se requieren â‰¥2 para graficar</div>'}
      <div style="margin-top:8px;font-size:11px;color:var(--gris-calido);">
        Eje X: dÃ­as en leche (DEL) desde el parto Â· ${l.n} controles Â· MÃ¡x: <strong>${max_}L</strong>
      </div>
    </div>`;
  }).join('');

  // Tabla detalle de todos los controles con nÃºmero de lactancia
  let acum2=0;
  const todosOrdenados = misLeche.map(r=>{
    // Encontrar a quÃ© lactancia pertenece
    for(const l of lactanciasAnimal){
      if(l.controles.find(c=>c.fecha===r.fecha&&c.total===r.total)){
        const ctrl=l.controles.find(c=>c.fecha===r.fecha&&c.total===r.total);
        return {...r, lact:l.num, del:ctrl?.del};
      }
    }
    return {...r, lact:'?', del:null};
  }).sort((a,b)=>a.fecha.localeCompare(b.fecha));
  todosOrdenados.forEach(r=>{ acum2+=r.total; r.acum=+acum2.toFixed(2); });

  document.getElementById('hoja-tab-produccion').innerHTML = `
    <div style="margin-bottom:6px;">
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px;">
        <div class="res-box"><div class="res-lbl">Ãšltimo control</div><div class="res-big">${a.litros||0} kg</div></div>
        <div class="res-box"><div class="res-lbl">Acumulado histÃ³rico</div><div class="res-big" style="font-size:20px;">${fNum(totalProdAnimal,1)}L</div></div>
        <div class="res-box"><div class="res-lbl">Lactancias</div><div class="res-big" style="font-size:20px;">${lactanciasAnimal.length}</div></div>
        <div class="res-box" style="border:2px solid var(--sol)30;"><div class="res-lbl">ğŸ¯ Proy. 305d (lact. activa)</div><div class="res-big" style="font-size:18px;color:var(--sol);">${(()=>{const la=lactanciasAnimal[lactanciasAnimal.length-1];if(!la)return 'â€”';const {proy305}=calcularLactancia305(la.controles);return proy305?proy305+'L':'â€”';})()}</div></div>
      </div>
    </div>
    ${lactanciasAnimal.length ? lactHTMLs : '<div class="muted text-sm">Sin controles de leche registrados.</div>'}
    <div class="card">
      <div class="card-title">ğŸ“‹ Historial Completo de Controles</div>
      ${todosOrdenados.length ? `
      <div class="tbl-wrap"><table>
        <thead><tr><th>Fecha</th><th>Lact.</th><th>DEL</th><th>Litros</th><th>Acumulado</th></tr></thead>
        <tbody>${todosOrdenados.map(r=>`
          <tr>
            <td>${r.fecha}</td>
            <td><span style="font-size:10px;background:${coloresLact[(r.lact-1)%coloresLact.length]};color:#fff;padding:1px 6px;border-radius:8px;">${r.lact}</span></td>
            <td>${r.del!==null?`<span class="mono">${r.del}d</span>`:'â€”'}</td>
            <td class="fw7 c-verde">${r.total}L</td>
            <td style="font-size:11px;color:var(--gris-calido);">${fNum(r.acum,1)}L</td>
          </tr>`).join('')}
        </tbody>
      </table></div>` : '<div class="muted text-sm">Sin registros</div>'}
    </div>
    <div class="card">
      <div class="card-title">âš–ï¸ Registros de Peso</div>
      ${registrosPeso.filter(p=>p.animalId===a.id).length
        ? registrosPeso.filter(p=>p.animalId===a.id).map(p=>`
          <div class="cost-row"><span>${p.fecha}</span><span class="fw7">${p.peso} kg</span></div>`).join('')
        : '<div class="muted text-sm">Sin pesajes registrados</div>'}
      ${fparto?`<div class="divider"></div>
      <div style="font-size:12px;">
        <div class="cost-row"><span class="cost-lbl">Ãšltimo parto</span><span class="fw7">${fparto.fecha}</span></div>
        <div class="cost-row"><span class="cost-lbl">DEL hoy</span><span class="fw7 c-verde">${diasDesdePartoDia!==null?diasDesdePartoDia+' dÃ­as':'â€”'}</span></div>
        <div class="cost-row"><span class="cost-lbl">Lactancias registradas</span><span class="fw7">${lactanciasAnimal.length}</span></div>
      </div>`:''  }
    </div>`;

  // Salud
  const misSalud = eventosS.filter(e=>e.animalId===a.id);
  document.getElementById('hoja-tab-salud-tab').innerHTML = `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
        <div class="card-title" style="margin:0;">ğŸ’Š Historial Sanitario</div>
        <button class="btn btn-primary btn-sm" onclick="openModalAnimalSalud('${a.id}')">+ Registrar</button>
      </div>
      ${misSalud.length ? `<div class="tbl-wrap"><table><thead><tr><th>Fecha</th><th>DiagnÃ³stico</th><th>Tratamiento</th><th>Estado</th></tr></thead><tbody>${misSalud.map(e=>`<tr><td>${e.fecha}</td><td>${e.diagnostico}</td><td>${e.tratamiento}</td><td><span class="tag ${e.estado==='Alta'?'tag-verde':e.estado==='En tratamiento'?'tag-rojo':'tag-amarillo'}">${e.estado}</span></td></tr>`).join('')}</tbody></table></div>` : '<div class="muted text-sm">Sin eventos sanitarios registrados</div>'}
    </div>`;

  // Historia (timeline de todos los eventos)
  const eventos = [];
  misPartos.forEach(p=>eventos.push({fecha:p.fecha,tipo:'Parto',desc:`NaciÃ³ ${p.criaNombre} (${p.sexo}, ${p.peso}kg)`,icon:'ğŸ£'}));
  misServicios.forEach(s=>eventos.push({fecha:s.fecha,tipo:'Servicio',desc:`${s.metodo.split('â€”')[0]} â€” ${s.toro}`,icon:'ğŸ”¬'}));
  misSalud.forEach(e=>eventos.push({fecha:e.fecha,tipo:'Salud',desc:`${e.diagnostico}: ${e.tratamiento}`,icon:'ğŸ’Š'}));
  registrosPeso.filter(p=>p.animalId===a.id).forEach(p=>eventos.push({fecha:p.fecha,tipo:'Peso',desc:`${p.peso} kg`,icon:'âš–ï¸'}));
  eventos.sort((a,b)=>b.fecha.localeCompare(a.fecha));
  document.getElementById('hoja-tab-historia').innerHTML = `
    <div class="card">
      <div class="card-title">ğŸ“œ Historial Completo</div>
      ${eventos.length ? `<div class="timeline">${eventos.map(e=>`
        <div class="tl-item">
          <div class="tl-dot">${e.icon}</div>
          <div class="tl-content">
            <div class="tl-title">${e.tipo}</div>
            <div class="tl-date">${e.fecha}</div>
            <div class="tl-detail">${e.desc}</div>
          </div>
        </div>`).join('')}</div>` : '<div class="muted text-sm">Sin historial registrado</div>'}
    </div>`;
}

function openModalAnimalServicio(id) {
  openModal('modalServicio');
  setTimeout(()=>{ const el=document.getElementById('serv-animal'); if(el) { el.value=id; } },100);
}
function openModalAnimalSalud(id) {
  openModal('modalSalud');
  setTimeout(()=>{ const el=document.getElementById('sal-animal'); if(el) el.value=id; },100);
}

function editAnimal(id) {
  const a = animales.find(x=>x.id===id);
  if(!a) return;
  document.getElementById('anim-edit-id').value = a.id;
  document.getElementById('modal-animal-title').textContent = 'Editar Animal';
  document.getElementById('anim-id').value = a.id;
  document.getElementById('anim-nombre').value = a.nombre;
  document.getElementById('anim-categoria').value = a.categoria;
  document.getElementById('anim-color').value = a.color||'';
  document.getElementById('anim-nacimiento').value = a.nacimiento||'';
  document.getElementById('anim-peso').value = a.peso||'';
  document.getElementById('anim-cc').value = a.cc||'';
  document.getElementById('anim-estado').value = a.estado||'activa';
  document.getElementById('anim-potrero').value = a.potrero||'';
  document.getElementById('anim-litros').value = a.litros||'';
  document.getElementById('anim-padre').value = a.padre||'';
  document.getElementById('anim-madre').value = a.madre||'';
  document.getElementById('anim-partos').value = a.partos||'';
  document.getElementById('anim-obs').value = a.obs||'';
  cargarGeneticaEnForm(a.composicion||[]);
  openModal('modalAnimal');
}

function editAnimalActivo() { editAnimal(animalActivoId); }

function deleteAnimal(id) {
  if(!confirm('Â¿EstÃ¡ seguro de eliminar este animal? Esta acciÃ³n no se puede deshacer.')) return;
  animales = animales.filter(a=>a.id!==id);
  persist();
  toast('Animal eliminado');
  renderInventario();
}

function deleteAnimalActivo() {
  if(!confirm('Â¿EstÃ¡ seguro de eliminar este animal? Esta acciÃ³n no se puede deshacer.')) return;
  animales = animales.filter(a=>a.id!==animalActivoId);
  persist();
  toast('Animal eliminado');
  nav('inventario');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LECHE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLeche() {
  const vacasP = animales.filter(a=>a.categoria==='Vaca'&&a.estado==='activa');
  const totalL = vacasP.reduce((s,a)=>s+a.litros,0);
  const promVaca = vacasP.length ? +(totalL/vacasP.length).toFixed(1) : 0;

  // Total histÃ³rico del hato
  const totalHistorico = registrosLeche.reduce((s,r)=>s+r.total,0);

  // Total por fecha (para mostrar en registros)
  const totalesFecha = {};
  registrosLeche.forEach(r=>{
    totalesFecha[r.fecha] = (totalesFecha[r.fecha]||0) + r.total;
  });

  // Total por animal (histÃ³rico)
  const totalPorAnimal = {};
  registrosLeche.forEach(r=>{
    totalPorAnimal[r.animalId] = (totalPorAnimal[r.animalId]||0) + r.total;
  });

  document.getElementById('leche-kpis').innerHTML = [
    {lbl:'ProducciÃ³n Ãšltimo Control',val:fNum(totalL,1)+' L',icon:'ğŸ¥›',color:'var(--pasto)'},
    {lbl:'Prom. Vaca/Control',val:promVaca+' L',icon:'ğŸ“ˆ',color:'var(--sol)'},
    {lbl:'Total HistÃ³rico Hato',val:fNum(totalHistorico,1)+' L',icon:'ğŸ“Š',color:'var(--cielo)'},
    {lbl:'Controles Registrados',val:new Set(registrosLeche.map(r=>r.fecha)).size,icon:'ğŸ“…',color:'var(--tierra)'},
  ].map(k=>`<div class="kpi-card"><div class="kpi-card-accent" style="background:${k.color};"></div><div class="kpi-icon-bg">${k.icon}</div><div class="kpi-lbl">${k.lbl}</div><div class="kpi-val" style="color:${k.color};">${k.val}</div></div>`).join('');

  // Curva lactancia
  const svg = document.getElementById('lactancia-svg');
  if(svg) {
    const pts=[];
    for(let d=1;d<=305;d+=5){ pts.push({x:d,y:12*Math.pow(d/77,.4)*Math.exp(-0.003*d)}); }
    const maxY=Math.max(...pts.map(p=>p.y));
    const W=520,H=160,pl=35,pr=10,pt=10,pb=25;
    const sx=x=>pl+(x/305)*(W-pl-pr);
    const sy=y=>H-pb-(y/maxY)*(H-pt-pb);
    const d='M'+pts.map(p=>`${sx(p.x).toFixed(1)},${sy(p.y).toFixed(1)}`).join('L');
    const area=d+`L${sx(305)},${H-pb}L${sx(1)},${H-pb}Z`;
    svg.innerHTML=`<defs><linearGradient id="lg1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="var(--pasto)" stop-opacity=".3"/><stop offset="100%" stop-color="var(--pasto)" stop-opacity="0"/></linearGradient></defs><path d="${area}" fill="url(#lg1)"/><path d="${d}" fill="none" stroke="var(--pasto)" stroke-width="2.5" stroke-linejoin="round"/>`+
      [0,50,100,150,200,250,305].map(x=>`<text x="${sx(x)}" y="${H-5}" text-anchor="middle" font-size="9" fill="var(--gris-calido)">${x}d</text>`).join('')+
      [0,10,20,30].map(y=>`<text x="${pl-4}" y="${sy(y)}" text-anchor="end" dominant-baseline="middle" font-size="9" fill="var(--gris-calido)">${y}L</text>`).join('');
  }

  // Ranking con total histÃ³rico
  const topV = [...vacasP].sort((a,b)=>b.litros-a.litros).slice(0,10);
  const maxL = topV[0]?.litros||1;
  document.getElementById('ranking-vacas').innerHTML = topV.map((v,i)=>`
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
      <span style="font-family:'Fraunces',serif;font-size:16px;font-weight:700;color:${i<3?'var(--sol)':'var(--gris-calido)'};width:22px;">${i+1}</span>
      <span style="flex:1;font-size:12.5px;font-weight:600;">${v.nombre} <span class="mono">${v.id}</span></span>
      <div style="text-align:right;">
        <div class="fw7 c-verde">${v.litros} kg</div>
        <div style="font-size:10px;color:var(--gris-calido);">total: ${fNum(totalPorAnimal[v.id]||0,1)}L</div>
      </div>
      <div class="pbar-wrap" style="width:70px;"><div class="pbar-fill" style="width:${(v.litros/maxL*100).toFixed(0)}%"></div></div>
    </div>`).join('');

  // Resumen por fecha de control (totales del hato por control)
  const fechasControl = [...new Set(registrosLeche.map(r=>r.fecha))].sort().reverse();
  const resumenFechas = fechasControl.map(f=>{
    const regs = registrosLeche.filter(r=>r.fecha===f);
    const total = regs.reduce((s,r)=>s+r.total,0);
    return {fecha:f, vacas:regs.length, total:+total.toFixed(2)};
  });

  // Tabla de registros con subtotales por fecha
  const regsPorFecha = {};
  registrosLeche.forEach(r=>{
    if(!regsPorFecha[r.fecha]) regsPorFecha[r.fecha]=[];
    regsPorFecha[r.fecha].push(r);
  });

  // Accordion colapsable por fecha
  if(!window._lecheAbiertos) window._lecheAbiertos = {};
  let tbodyHtml = '';
  fechasControl.forEach(fecha=>{
    const regs = regsPorFecha[fecha]||[];
    const totalFecha = regs.reduce((s,r)=>s+r.total,0);
    const abierto = window._lecheAbiertos[fecha] !== false; // abierto por defecto solo el primero
    const isFirst = fecha === fechasControl[0];
    const visible = window._lecheAbiertos[fecha] === true || (isFirst && window._lecheAbiertos[fecha] !== false);
    tbodyHtml += `<tr style="background:var(--pasto-suave);cursor:pointer;" onclick="toggleControlLeche('${fecha}')">
      <td colspan="5" style="font-weight:700;font-size:12px;padding:8px 12px;">
        <span style="margin-right:6px;">${visible?'â–¼':'â–¶'}</span>
        ğŸ“… Control del ${fecha} â€” <span class="c-verde">${fNum(totalFecha,2)} L total hato</span>
        <span class="muted" style="margin-left:8px;">${regs.length} vacas</span>
      </td>
      <td colspan="2" style="text-align:right;padding-right:10px;font-size:11px;color:var(--gris-calido);">
        ${visible?'Clic para colapsar':'Clic para ver detalle'}
      </td>
    </tr>`;
    if(visible){
      regs.forEach(r=>{
        tbodyHtml += `<tr class="leche-det-${fecha.replace(/[^a-z0-9]/gi,'_')}">
          <td>${r.fecha}</td>
          <td><span class="mono">${r.animalId}</span> ${r.animalNombre!==r.animalId?'â€” '+r.animalNombre:''}</td>
          <td>${r.o1}L</td>
          <td>${r.o2>0?r.o2+'L':'â€”'}</td>
          <td class="fw7 c-verde">${r.total}L</td>
          <td style="font-size:11px;color:var(--gris-calido);">${r.obs||'â€”'}</td>
          <td><button class="btn btn-ghost btn-sm btn-icon" onclick="event.stopPropagation();confirmarEliminar(()=>deleteLeche(${r.id}),'Â¿Eliminar este registro de leche?')">ğŸ—‘</button></td>
        </tr>`;
      });
    }
  });
  document.getElementById('leche-tbody').innerHTML = tbodyHtml || `<tr><td colspan="7"><div class="empty-state"><div class="es-icon">ğŸ¥›</div><div class="es-text">Sin registros de leche</div></div></td></tr>`;
}


function toggleControlLeche(fecha) {
  if(!window._lecheAbiertos) window._lecheAbiertos = {};
  // Si es el primero y no tiene estado, default era abierto
  const isFirst = fecha === [...new Set(registrosLeche.map(r=>r.fecha))].sort().reverse()[0];
  const currentState = window._lecheAbiertos[fecha];
  const wasOpen = currentState === true || (isFirst && currentState !== false);
  window._lecheAbiertos[fecha] = !wasOpen;
  renderLeche();
}

function confirmarEliminar(fn, mensaje) {
  if(confirm(mensaje || 'Â¿Confirmar eliminaciÃ³n?')) fn();
}
function deleteLeche(id) {
  registrosLeche = registrosLeche.filter(r=>r.id!==id);
  persist();
  toast('Registro eliminado');
  renderLeche();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PESO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Estado pestaÃ±a activa en pesos
let pesoTabActiva = 'Todos';

function renderPeso() {
  // â”€â”€ KPIs generales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const activos = animales.filter(a => a.estado !== 'baja');
  const conPeso  = activos.filter(a => a.peso > 0);
  const promPeso = conPeso.length ? Math.round(conPeso.reduce((s,a)=>s+(a.peso||0),0)/conPeso.length) : 0;

  // Ganancia diaria: comparar Ãºltimo pesaje vs anterior por animal
  const ganadoresAdg = [];
  activos.forEach(a => {
    const ps = registrosPeso.filter(p=>p.animalId===a.id).sort((x,y)=>x.fecha.localeCompare(y.fecha));
    if(ps.length >= 2) {
      const dias = Math.max(1,(new Date(ps[ps.length-1].fecha)-new Date(ps[0].fecha))/86400000);
      const adg  = (ps[ps.length-1].peso - ps[0].peso) / dias * 1000;
      ganadoresAdg.push(adg);
    }
  });
  const promAdg = ganadoresAdg.length ? Math.round(ganadoresAdg.reduce((s,v)=>s+v,0)/ganadoresAdg.length) : 0;
  const sinPesar = activos.filter(a=>{
    const up = registrosPeso.filter(p=>p.animalId===a.id).sort((x,y)=>y.fecha.localeCompare(x.fecha))[0];
    return !up || (Date.now()-new Date(up.fecha+'T00:00:00').getTime()) > 30*86400000;
  }).length;

  document.getElementById('peso-kpis').innerHTML = [
    {lbl:'Peso Prom. Hato',  val:promPeso+' kg',  icon:'âš–ï¸', color:'var(--pasto)'},
    {lbl:'ADG Prom.',        val:promAdg+' g/dÃ­a', icon:'ğŸ“ˆ', color:'var(--sol)'},
    {lbl:'Sin Pesar +30d',   val:sinPesar,          icon:'âš ï¸', color:'var(--rojo)'},
    {lbl:'Total Pesajes',    val:registrosPeso.length, icon:'ğŸ“‹', color:'var(--cielo)'},
  ].map(k=>`<div class="kpi-card"><div class="kpi-card-accent" style="background:${k.color};"></div><div class="kpi-icon-bg">${k.icon}</div><div class="kpi-lbl">${k.lbl}</div><div class="kpi-val" style="color:${k.color};">${k.val}</div></div>`).join('');

  // â”€â”€ PestaÃ±as por categorÃ­a â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // CategorÃ­as presentes en animales activos
  const catsPresentes = ['Todos', ...new Set(activos.map(a => a.categoria))].filter((c,i,arr) => arr.indexOf(c)===i);
  // Asegurar que pesoTabActiva existe
  if(!catsPresentes.includes(pesoTabActiva)) pesoTabActiva = 'Todos';

  const iconoCat = {
    'Todos':'ğŸ„','Vaca':'ğŸ„','Novilla':'ğŸ®','Ternera':'ğŸ£',
    'Ternero':'ğŸ‚','Toro':'ğŸ¦¬','BÃºfalo':'ğŸ¦¬'
  };

  // Barra de pestaÃ±as
  document.getElementById('peso-tabs-bar').innerHTML = catsPresentes.map(cat => {
    const animCat = cat === 'Todos' ? activos : activos.filter(a=>a.categoria===cat);
    const activa  = cat === pesoTabActiva;
    return `<button onclick="pesoTabActiva='${cat}';renderPeso();"
      style="padding:10px 18px;border:none;background:none;cursor:pointer;font-size:13px;font-weight:${activa?700:500};
             color:${activa?'var(--pasto)':'var(--gris-calido)'};
             border-bottom:${activa?'3px solid var(--pasto)':'3px solid transparent'};
             white-space:nowrap;transition:all 0.15s;">
      ${iconoCat[cat]||'ğŸ„'} ${cat}
      <span style="margin-left:5px;background:${activa?'var(--pasto)':'#e5e7eb'};color:${activa?'#fff':'var(--gris-calido)'};
             border-radius:10px;padding:1px 7px;font-size:10px;font-weight:700;">${animCat.length}</span>
    </button>`;
  }).join('');

  // Contenido de la pestaÃ±a activa
  const animsCat = pesoTabActiva === 'Todos' ? activos : activos.filter(a=>a.categoria===pesoTabActiva);

  // Para cada animal: Ãºltimo pesaje, pesaje anterior, ADG
  const filasPorAnimal = animsCat.map(a => {
    const ps = registrosPeso.filter(p=>p.animalId===a.id).sort((x,y)=>y.fecha.localeCompare(x.fecha));
    const ultimo  = ps[0];
    const anterior = ps[1];
    let adg = null;
    if(ultimo && anterior) {
      const dias = Math.max(1,(new Date(ultimo.fecha)-new Date(anterior.fecha))/86400000);
      adg = ((ultimo.peso - anterior.peso)/dias*1000).toFixed(0);
    }
    const diasSinPesar = ultimo
      ? Math.floor((Date.now()-new Date(ultimo.fecha+'T00:00:00'))/86400000)
      : null;
    const alertColor = diasSinPesar===null?'var(--rojo)':diasSinPesar>30?'var(--rojo)':diasSinPesar>15?'var(--sol)':'var(--pasto)';
    return { a, ultimo, anterior, adg, diasSinPesar, alertColor };
  }).sort((x,y) => {
    // Ordenar: sin pesar primero, luego por nombre
    if(x.diasSinPesar===null && y.diasSinPesar!==null) return -1;
    if(x.diasSinPesar!==null && y.diasSinPesar===null) return 1;
    if(x.diasSinPesar===null && y.diasSinPesar===null) return 0;
    return y.diasSinPesar - x.diasSinPesar;
  });

  // Usar el peso del inventario (campo a.peso) como fuente de verdad,
  // y el Ãºltimo pesaje solo para referencia de fecha y ADG
  const pesosTab   = animsCat.filter(a => a.peso > 0).map(a => a.peso);
  const promTab    = pesosTab.length ? Math.round(pesosTab.reduce((s,v)=>s+v,0)/pesosTab.length) : 'â€”';
  const totalTab   = pesosTab.length ? pesosTab.reduce((s,v)=>s+v,0) : 'â€”';
  const minTab     = pesosTab.length ? Math.min(...pesosTab) : 'â€”';
  const maxTab     = pesosTab.length ? Math.max(...pesosTab) : 'â€”';
  const sinPesarTab = filasPorAnimal.filter(f=>!f.ultimo||f.diasSinPesar>30).length;

  document.getElementById('peso-tab-content').innerHTML = `
    <!-- Stats rÃ¡pidas de la categorÃ­a -->
    <div style="display:flex;gap:12px;padding:0 16px 12px;flex-wrap:wrap;">
      <div style="background:var(--fondo);border-radius:8px;padding:8px 16px;text-align:center;min-width:90px;">
        <div style="font-size:18px;font-weight:800;color:var(--pasto);">${promTab}${promTab!=='â€”'?' kg':''}</div>
        <div style="font-size:10px;color:var(--gris-calido);font-weight:600;">PESO PROM.</div>
      </div>
      <div style="background:var(--fondo);border-radius:8px;padding:8px 16px;text-align:center;min-width:110px;">
        <div style="font-size:18px;font-weight:800;color:var(--tierra);">${totalTab!=='â€”'?totalTab.toLocaleString()+' kg':'â€”'}</div>
        <div style="font-size:10px;color:var(--gris-calido);font-weight:600;">PESO TOTAL CAT.</div>
      </div>
      <div style="background:var(--fondo);border-radius:8px;padding:8px 16px;text-align:center;min-width:90px;">
        <div style="font-size:18px;font-weight:800;color:var(--cielo);">${minTab}${minTab!=='â€”'?' kg':''}</div>
        <div style="font-size:10px;color:var(--gris-calido);font-weight:600;">MÃN.</div>
      </div>
      <div style="background:var(--fondo);border-radius:8px;padding:8px 16px;text-align:center;min-width:90px;">
        <div style="font-size:18px;font-weight:800;color:var(--rojo);">${maxTab}${maxTab!=='â€”'?' kg':''}</div>
        <div style="font-size:10px;color:var(--gris-calido);font-weight:600;">MÃX.</div>
      </div>
      <div style="background:var(--fondo);border-radius:8px;padding:8px 16px;text-align:center;min-width:90px;">
        <div style="font-size:18px;font-weight:800;color:${sinPesarTab>0?'var(--rojo)':'var(--pasto)'};">${sinPesarTab}</div>
        <div style="font-size:10px;color:var(--gris-calido);font-weight:600;">SIN PESAR +30d</div>
      </div>
      <div style="background:var(--fondo);border-radius:8px;padding:8px 16px;text-align:center;min-width:90px;">
        <div style="font-size:18px;font-weight:800;color:var(--texto);">${animsCat.length}</div>
        <div style="font-size:10px;color:var(--gris-calido);font-weight:600;">ANIMALES</div>
      </div>
    </div>
    <!-- Tabla por categorÃ­a -->
    <div class="tbl-wrap" style="padding:0 0 4px 0;">
      <table>
        <thead><tr>
          <th>Animal</th><th>CategorÃ­a</th><th>Peso actual</th>
          <th>Pesaje anterior</th><th>ADG g/dÃ­a</th>
          <th>Ãšltimo pesaje</th><th>DÃ­as sin pesar</th><th>AcciÃ³n</th>
        </tr></thead>
        <tbody>${filasPorAnimal.map(({a,ultimo,anterior,adg,diasSinPesar,alertColor})=>`<tr>
          <td onclick="verHoja('${a.id}')" style="cursor:pointer;">
            <span class="mono">${a.id}</span>
            ${a.nombre!==a.id?`<br><span style="font-size:10px;color:var(--gris-calido);">${a.nombre}</span>`:''}
          </td>
          <td>${a.categoria}</td>
          <td><strong>${a.peso>0?a.peso+' kg':'â€”'}</strong></td>
          <td>${anterior?anterior.peso+' kg â€” '+anterior.fecha:'â€”'}</td>
          <td>${adg!==null?`<span class="${+adg>0?'c-verde':+adg<0?'c-rojo':'muted'}">${+adg>0?'+':''}${adg} g</span>`:'â€”'}</td>
          <td>${ultimo?ultimo.fecha:'<span style="color:var(--rojo);font-weight:700;">Sin registros</span>'}</td>
          <td style="color:${alertColor};font-weight:700;">
            ${diasSinPesar===null?'âš  Nunca pesado':diasSinPesar===0?'Hoy':diasSinPesar+'d'}
          </td>
          <td><button class="btn btn-ghost btn-sm" onclick="openModalPesoAnimal('${a.id}')">+ Peso</button></td>
        </tr>`).join('')||'<tr><td colspan="8" style="text-align:center;color:var(--gris-calido);">Sin animales en esta categorÃ­a</td></tr>'}
        </tbody>
      </table>
    </div>`;

  // â”€â”€ GrÃ¡fica curva â€” animales de la categorÃ­a activa con mÃ¡s pesajes â”€â”€
  const svg = document.getElementById('peso-svg');
  if(svg) {
    // Tomar el animal con mÃ¡s registros de la categorÃ­a activa
    const candidatos = animsCat.map(a=>({a, ps:registrosPeso.filter(p=>p.animalId===a.id).sort((x,y)=>x.fecha.localeCompare(y.fecha))})).filter(x=>x.ps.length>1).sort((x,y)=>y.ps.length-x.ps.length);
    const best = candidatos[0];
    if(best) {
      const ps = best.ps;
      const W=520,H=190,pl=45,pr=10,pt=10,pb=30;
      const minP=Math.min(...ps.map(p=>p.peso))-10;
      const maxP=Math.max(...ps.map(p=>p.peso))+10;
      const sx=i=>pl+i*(W-pl-pr)/(Math.max(ps.length-1,1));
      const sy=y=>H-pb-(y-minP)/(maxP-minP)*(H-pt-pb);
      const d='M'+ps.map((p,i)=>`${sx(i).toFixed(0)},${sy(p.peso).toFixed(0)}`).join('L');
      const area=d+`L${sx(ps.length-1)},${H-pb}L${sx(0)},${H-pb}Z`;
      svg.innerHTML=`<defs><linearGradient id="pgrad" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="var(--sol)" stop-opacity=".3"/>
        <stop offset="100%" stop-color="var(--sol)" stop-opacity="0"/></linearGradient></defs>
        <path d="${area}" fill="url(#pgrad)"/>
        <path d="${d}" fill="none" stroke="var(--sol)" stroke-width="2.5" stroke-linejoin="round"/>
        ${ps.map((p,i)=>`<circle cx="${sx(i)}" cy="${sy(p.peso)}" r="4" fill="var(--sol)" stroke="#fff" stroke-width="1.5"/>
          <title>${p.fecha}: ${p.peso}kg</title>`).join('')}
        ${[minP+10,Math.round((minP+maxP)/2),maxP-10].map(y=>`<text x="${pl-5}" y="${sy(y)}" text-anchor="end" dominant-baseline="middle" font-size="9" fill="var(--gris-calido)">${Math.round(y)}</text>`).join('')}
        <text x="${W/2}" y="${H-2}" text-anchor="middle" font-size="9" fill="var(--gris-calido)">${best.a.id} â€” ${best.a.nombre!==best.a.id?best.a.nombre:best.a.categoria}</text>`;
    } else {
      svg.innerHTML = `<text x="260" y="100" text-anchor="middle" font-size="12" fill="var(--gris-calido)">Sin suficientes pesajes para graficar</text>`;
    }
  }

  // â”€â”€ DistribuciÃ³n promedio por categorÃ­a â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const catP = {};
  activos.forEach(a=>{
    const c = a.categoria;
    if(!catP[c]) catP[c]={sum:0,nTotal:0,nConPeso:0};
    catP[c].nTotal++;
    if(a.peso>0){ catP[c].sum += a.peso; catP[c].nConPeso++; }
  });
  const maxProm = Math.max(...Object.values(catP).map(x=>x.nConPeso>0?x.sum/x.nConPeso:0),1);
  const colorCat = {'Vaca':'var(--pasto)','Novilla':'var(--cielo)','Ternera':'var(--sol)','Ternero':'var(--tierra)','Toro':'var(--rojo)'};
  document.getElementById('peso-distrib').innerHTML = Object.entries(catP).map(([cat,{sum,nTotal,nConPeso}])=>{
    const prom = nConPeso>0 ? Math.round(sum/nConPeso) : 'â€”';
    const pct  = nConPeso>0 ? (Math.round(sum/nConPeso)/maxProm*100).toFixed(0) : 0;
    return `<div style="margin-bottom:14px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:5px;font-size:12px;">
        <span class="fw7">${cat}s</span>
        <span class="muted">${prom} kg prom Â· ${nTotal} animales</span>
      </div>
      <div class="pbar-wrap" style="height:9px;">
        <div class="pbar-fill" style="width:${pct}%;background:${colorCat[cat]||'var(--sol)'};">
        </div>
      </div>
    </div>`;
  }).join('') || '<div class="muted text-sm">Sin pesos registrados</div>';

  // â”€â”€ Tabla global todos los pesajes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pesosOrden = registrosPeso.slice().sort((a,b)=>b.fecha.localeCompare(a.fecha));
  document.getElementById('peso-tbody').innerHTML = pesosOrden.slice(0,40).map(r=>`
    <tr>
      <td>${r.fecha}</td>
      <td><span class="mono">${r.animalId}</span> ${r.animalNombre&&r.animalNombre!==r.animalId?'â€” '+r.animalNombre:''}</td>
      <td>${r.categoria||'â€”'}</td>
      <td class="fw7">${r.peso} kg</td>
      <td><span class="${+r.ganancia>0?'c-verde':+r.ganancia<0?'c-rojo':'muted'}">${r.ganancia||'â€”'}</span></td>
      <td style="font-size:11px;">${r.obs||'â€”'}</td>
      <td><button class="btn btn-ghost btn-sm btn-icon" onclick="confirmarEliminar(()=>deletePeso(${r.id}),'Â¿Eliminar este pesaje?')">ğŸ—‘</button></td>
    </tr>`).join('') || '<tr><td colspan="7"><div class="empty-state"><div class="es-icon">âš–ï¸</div><div class="es-text">Sin pesajes registrados</div></div></td></tr>';
}

function openModalPesoAnimal(animalId) {
  // Pre-llenar el modal de peso con el animal seleccionado
  openModal('modalPeso');
  setTimeout(()=>{
    const sel = document.getElementById('peso-animal');
    if(sel) sel.value = animalId;
  }, 100);
}

function deletePeso(id) { registrosPeso=registrosPeso.filter(r=>r.id!==id); persist(); toast('Eliminado'); renderPeso(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REPRODUCCIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderReproduccion() {
  // Vacas reales = animales con al menos 1 parto registrado y activos
  const vacasR = vacasReales();
  const hembrasAct = animales.filter(a=>['Vaca','Novilla'].includes(a.categoria)&&a.estado!=='baja');
  const gestantes = animales.filter(a=>a.estado==='gestante'||a.estado==='preparto').length;

  // Natalidad = partos del Ãºltimo aÃ±o / vacas reales activas Ã— 100
  const haceUnAÃ±o = new Date(); haceUnAÃ±o.setFullYear(haceUnAÃ±o.getFullYear()-1);
  const partosAnio = partos.filter(p=>new Date(p.fecha+'T00:00:00')>=haceUnAÃ±o).length;
  const natalidad = vacasR.length ? ((partosAnio/vacasR.length)*100).toFixed(1) : 0;

  // Tasa preÃ±ez = servicios con dx preÃ±ada / total servicios con diagnÃ³stico Ã— 100
  const servConDx = servicios.filter(s=>s.diagnostico && !s.metodo?.includes('OPU'));
  const preÃ±ez = servConDx.length ? ((servConDx.filter(s=>s.diagnostico==='preÃ±ada').length/servConDx.length)*100).toFixed(1) : 0;

  // Intervalo entre partos â€” promedio real desde partos registrados
  let intervalo = 'â€”';
  if(partos.length >= 2) {
    const porMadre = {};
    partos.forEach(p=>{ if(!porMadre[p.madreId]) porMadre[p.madreId]=[]; porMadre[p.madreId].push(p.fecha); });
    const intervalos = [];
    Object.values(porMadre).forEach(fechas=>{
      const sorted = fechas.slice().sort();
      for(let i=1;i<sorted.length;i++){
        const d = (new Date(sorted[i]+'T00:00:00')-new Date(sorted[i-1]+'T00:00:00'))/(86400000*30.44);
        if(d>6 && d<30) intervalos.push(d);
      }
    });
    if(intervalos.length) intervalo = (intervalos.reduce((s,v)=>s+v,0)/intervalos.length).toFixed(1);
  }
  const vacas = vacasR; // alias para dÃ­as abiertos abajo

  // Calcular promedio de dÃ­as abiertos
  const dasValores = vacas.filter(a=>partos.some(p=>p.madreId===a.id)).map(a=>calcularDiasAbiertos(a)).filter(Boolean);
  const promDA = dasValores.length ? Math.round(dasValores.reduce((s,d)=>s+d.dias,0)/dasValores.length) : 'â€”';
  const colorDA = promDA!=='â€”'?(promDA>120?'rojo':promDA>90?'sol':'verde'):'gris';

  document.getElementById('repro-indicadores').innerHTML = [
    {val:preÃ±ez+'%',lbl:'Tasa de PreÃ±ez',st:+preÃ±ez>=params.meta_preÃ±ez?'ok':+preÃ±ez>=20?'warn':'bad',meta:'Meta: '+params.meta_preÃ±ez+'%'},
    {val:natalidad+'%',lbl:'Natalidad',st:+natalidad>=75?'ok':'warn',meta:'Meta: 75%'},
    {val:gestantes,lbl:'Gestantes',st:'ok',meta:'hembras'},
    {val:servicios.filter(s=>!s.diagnostico).length,lbl:'Diag. Pendiente',st:'warn',meta:'servicios sin dx'},
    {val:intervalo+(intervalo!=='â€”'?'m':''),lbl:'Interv. Parto-Parto',st:intervalo!=='â€”'&&+intervalo<=12?'ok':intervalo!=='â€”'?'bad':'warn',meta:'Meta: â‰¤12 meses'},
    {val:partos.length,lbl:'Partos Registrados',st:'ok',meta:'total'},
    {val:promDA+(promDA!=='â€”'?' dÃ­as':''),lbl:'DÃ­as Abiertos Prom.',st:colorDA==='verde'?'ok':colorDA==='sol'?'warn':'bad',meta:'Meta: â‰¤90 dÃ­as'},
  ].map(i=>`<div class="ind-card"><div class="ind-val c-${i.st==='ok'?'verde':i.st==='warn'?'sol':'rojo'}">${i.val}</div><div class="ind-lbl">${i.lbl}</div><div class="ind-status s-${i.st}">${i.meta}</div></div>`).join('');

  document.getElementById('partos-tbody').innerHTML = partos.slice(0,15).map(p=>`
    <tr>
      <td>${p.fecha}</td>
      <td><span class="mono">${p.madreId}</span> ${p.madreNombre}</td>
      <td>${p.pesoMadre>0?p.pesoMadre+' kg':'â€”'}</td>
      <td>${p.criaNombre}</td>
      <td><span class="tag ${p.sexo==='Macho'?'tag-azul':'tag-morado'}">${p.sexo}</span></td>
      <td>${p.peso} kg</td>
      <td><span class="tag tag-gris" title="Padre: ${p.padreId||'â€”'}">${p.metodoReproduccion||'Natural'}</span></td>
      <td>${p.tipo}</td>
      <td><span class="tag tag-verde">Registrado</span></td>
    </tr>`).join('') || '<tr><td colspan="7"><div class="empty-state"><div class="es-icon">ğŸ£</div><div class="es-text">Sin partos registrados</div></div></td></tr>';

  document.getElementById('servicios-tbody').innerHTML = servicios.slice(0,15).map(s=>`
    <tr>
      <td>${s.fecha}</td>
      <td>${s.animalNombre}</td>
      <td>${s.metodo.split('â€”')[0]}</td>
      <td>${s.toro}</td>
      <td>${s.inseminador||'â€”'}</td>
      <td>${s.diagnostico?`<span class="tag ${s.diagnostico==='preÃ±ada'?'tag-verde':'tag-rojo'}">${s.diagnostico}</span>`:'<span class="tag tag-gris">Pendiente</span>'}</td>
    </tr>`).join('') || '<tr><td colspan="6"><div class="empty-state"><div class="es-icon">ğŸ”¬</div><div class="es-text">Sin servicios registrados</div></div></td></tr>';

  // Partos esperados â€” tabla enriquecida con fecha exacta y dÃ­as restantes
  const esperados = animales.filter(a=>a.estado==='gestante'||a.estado==='preparto');
  if(esperados.length) {
    const rows = esperados.map(a=>{
      // Calcular gestaciÃ³n dinÃ¡micamente
      const g = infoGestacion(a);
      const fechaParto    = g ? g.partoEsp   : 'â€”';
      const diasGest      = g ? g.transcurridos : null;
      const ultServFecha  = g ? g.servFecha  : 'â€”';
      const colorBar = g ? (g.restantes<=30?'var(--rojo)':g.restantes<=60?'var(--sol)':'var(--pasto)') : 'var(--pasto)';
      const diasRestantes = g ? (g.restantes>0?`${g.restantes} dÃ­as`:g.restantes===0?'Â¡Hoy!':`${Math.abs(g.restantes)}d retrasado`) : 'â€”';
      const pctGest = g ? g.pct : 0;
      const progBar = `<div style="background:#e5e7eb;border-radius:4px;height:6px;width:80px;display:inline-block;vertical-align:middle;margin-left:6px;">
        <div style="background:${colorBar};width:${pctGest}%;height:100%;border-radius:4px;"></div></div>`;
      return `<tr>
        <td><span class="mono">${a.id}</span><br><span style="font-size:11px;color:var(--gris-calido);">${a.nombre!==a.id?a.nombre:''}</span></td>
        <td>${tagEstado(a.estado)}</td>
        <td>${ultServFecha}</td>
        <td>${diasGest!==null?`<span class="fw7">${diasGest}d</span> de 283 ${progBar}`:'â€”'}</td>
        <td class="fw7 c-verde">${fechaParto}</td>
        <td style="color:${colorBar};font-weight:700;">${diasRestantes}</td>
      </tr>`;
    }).join('');
    document.getElementById('partos-esperados').innerHTML =
      `<div class="card-title" style="margin-bottom:10px;">ğŸ„ Partos Esperados â€” ${esperados.length} gestantes</div>
       <div class="tbl-wrap"><table>
         <thead><tr><th>Animal</th><th>Estado</th><th>Servicio</th><th>DÃ­as gestaciÃ³n</th><th>ğŸ“… Parto esperado</th><th>DÃ­as restantes</th></tr></thead>
         <tbody>${rows}</tbody>
       </table></div>`;
  } else {
    document.getElementById('partos-esperados').innerHTML =
      '<div class="empty-state"><div class="es-icon">ğŸ“…</div><div class="es-text">Sin partos prÃ³ximos registrados</div><div class="es-sub">Registra servicios y diagnÃ³sticos de preÃ±ez</div></div>';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SALUD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSalud() {
  const enTrat = eventosS.filter(e=>e.estado==='En tratamiento');
  document.getElementById('salud-kpis').innerHTML = [
    {lbl:'En Tratamiento',val:enTrat.length,icon:'ğŸ’Š',color:'var(--rojo)'},
    {lbl:'Alta hoy',val:eventosS.filter(e=>e.estado==='Alta'&&e.fecha===hoy()).length,icon:'âœ…',color:'var(--pasto)'},
    {lbl:'Retiro de leche',val:enTrat.filter(e=>e.retiroLeche>0&&e.fechaRetiroLeche>=hoy()).length,icon:'ğŸš«',color:'var(--sol)'},
    {lbl:'Total eventos',val:eventosS.length,icon:'ğŸ“‹',color:'var(--cielo)'},
  ].map(k=>`<div class="kpi-card"><div class="kpi-card-accent" style="background:${k.color};"></div><div class="kpi-icon-bg">${k.icon}</div><div class="kpi-lbl">${k.lbl}</div><div class="kpi-val" style="color:${k.color};">${k.val}</div></div>`).join('');
  document.getElementById('badge-salud').textContent = enTrat.length;

  document.getElementById('salud-tbody').innerHTML = eventosS.slice(0,20).map(e=>`
    <tr>
      <td><span class="mono">${e.animalId}</span> ${e.animalNombre}</td>
      <td>${e.diagnostico}</td>
      <td>${e.tratamiento}</td>
      <td>${e.fecha}</td>
      <td>${e.fechaRetiroLeche?`<span class="tag tag-rojo">${e.fechaRetiroLeche}</span>`:'â€”'}</td>
      <td>${e.fechaRetiroCarne?`<span class="tag tag-amarillo">${e.fechaRetiroCarne}</span>`:'â€”'}</td>
      <td><span class="tag ${e.estado==='Alta'?'tag-verde':e.estado==='En tratamiento'?'tag-rojo':e.estado==='Grave'?'tag-rojo':'tag-amarillo'}">${e.estado}</span></td>
      <td>
        <div style="display:flex;gap:4px;">
          <button class="btn btn-ghost btn-sm" onclick="cambiarEstadoSalud(${e.id},'Alta')">Alta</button>
          <button class="btn btn-ghost btn-sm btn-icon" onclick="deleteSalud(${e.id})">ğŸ—‘</button>
        </div>
      </td>
    </tr>`).join('') || '<tr><td colspan="8"><div class="empty-state"><div class="es-icon">ğŸ’š</div><div class="es-text">Sin animales en tratamiento</div></div></td></tr>';

  // Vacunaciones prÃ³ximas
  document.getElementById('vacunaciones-list').innerHTML = [
    {fecha:'17/Feb/2025',desc:'Brucelosis â€” 34 novillas 4-8 meses',urgente:true},
    {fecha:'28/Feb/2025',desc:'Fiebre Aftosa â€” Hato general',urgente:false},
    {fecha:'15/Mar/2025',desc:'Rabia bovina â€” Bovinos >1 aÃ±o',urgente:false},
    {fecha:'01/Abr/2025',desc:'CarbÃ³n bacteridiano',urgente:false},
  ].map(v=>`<div class="event-item"><div class="event-date-box" style="background:${v.urgente?'var(--rojo)':'var(--pasto)'}"><div class="ed-day">${v.fecha.split('/')[0]}</div><div class="ed-mon">${v.fecha.split('/')[1]}</div></div><div class="event-info"><div class="event-name">${v.desc}</div></div></div>`).join('');

  // Enfermedades
  const freq={};
  eventosS.forEach(e=>{ freq[e.diagnostico]=(freq[e.diagnostico]||0)+1; });
  const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,6);
  const maxF = sorted[0]?.[1]||1;
  document.getElementById('enfermedades-chart').innerHTML = sorted.map(([diag,n])=>`
    <div style="margin-bottom:10px;">
      <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:3px;">
        <span class="fw7">${diag}</span><span class="muted">${n}</span>
      </div>
      <div class="pbar-wrap" style="height:7px;"><div class="pbar-fill" style="width:${(n/maxF*100).toFixed(0)}%;background:var(--rojo);"></div></div>
    </div>`).join('') || '<div class="muted text-sm">Sin datos de enfermedades</div>';

  // â”€â”€ Protocolos de inducciÃ³n del estro / FIV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const protocolos = servicios.filter(s=>
    s.metodo?.includes('OPU') || s.metodo?.includes('TE') ||
    s.obs?.includes('DIB') || s.obs?.includes('Benzoato') ||
    s.obs?.includes('Cipionato') || s.obs?.includes('InserciÃ³n DIB')
  ).sort((a,b)=>b.fecha.localeCompare(a.fecha));

  const protDiv = document.getElementById('salud-protocolos');
  if(protDiv) {
    protDiv.innerHTML = protocolos.length ? `
      <div class="tbl-wrap"><table>
        <thead><tr>
          <th>Fecha</th><th>Animal</th><th>Protocolo / MÃ©todo</th>
          <th>Toro / Semen</th><th>Resultado / DiagnÃ³stico</th>
        </tr></thead>
        <tbody>${protocolos.map(s=>`<tr>
          <td>${s.fecha}</td>
          <td><span class="mono">${s.animalId}</span><br>
              <span style="font-size:10px;color:var(--gris-calido);">${s.animalNombre||''}</span></td>
          <td>${s.metodo}</td>
          <td style="font-size:11px;">${(s.toro||'â€”').substring(0,40)}</td>
          <td>${s.diagnostico
              ? `<span class="tag ${s.diagnostico==='preÃ±ada'?'tag-verde':s.diagnostico.includes('reemplazado')?'tag-amarillo':'tag-rojo'}">${s.diagnostico}</span>`
              : `<span style="font-size:10px;color:var(--gris-calido);">${(s.obs||'â€”').substring(0,60)}</span>`}</td>
        </tr>`).join('')}</tbody>
      </table></div>` :
      '<div class="empty-state"><div class="es-icon">ğŸ§ª</div><div class="es-text">Sin protocolos registrados</div><div class="es-sub">Los protocolos OPU, TE y DIB aparecerÃ¡n aquÃ­ automÃ¡ticamente</div></div>';
  }
}

function cambiarEstadoSalud(id, est) {
  const ev = eventosS.find(e=>e.id===id);
  if(ev) { ev.estado=est; persist(); toast('Estado actualizado'); renderSalud(); }
}
function deleteSalud(id) { eventosS=eventosS.filter(e=>e.id!==id); persist(); toast('Eliminado'); renderSalud(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COSTOS â€” VISTA MES / AÃ‘O + COSTOS FIJOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let _costoVista = 'mes'; // 'mes' o 'aÃ±o'

function setCostoVista(v) {
  _costoVista = v;
  document.getElementById('costo-vista-mes-btn').style.background = v==='mes' ? 'var(--pasto)' : '#fff';
  document.getElementById('costo-vista-mes-btn').style.color = v==='mes' ? '#fff' : 'var(--texto-medio)';
  document.getElementById('costo-vista-aÃ±o-btn').style.background = v==='aÃ±o' ? 'var(--pasto)' : '#fff';
  document.getElementById('costo-vista-aÃ±o-btn').style.color = v==='aÃ±o' ? '#fff' : 'var(--texto-medio)';
  document.getElementById('costo-mes-sel').style.display = v==='mes' ? '' : 'none';
  renderCostos();
}

function initCostoSelectors() {
  const sel = document.getElementById('costo-mes-sel');
  if(!sel) return;
  const MESES = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
  const aÃ±oSel = document.getElementById('costo-aÃ±o-sel');
  const aÃ±o = aÃ±oSel ? +aÃ±oSel.value : 2025;
  const now = new Date();
  let opts = '';
  for(let m=11;m>=0;m--) {
    const val = `${aÃ±o}-${String(m+1).padStart(2,'0')}`;
    const label = `${MESES[m]} ${aÃ±o}`;
    const sel2 = (aÃ±o===now.getFullYear() && m===now.getMonth()) ? 'selected' : '';
    opts += `<option value="${val}" ${sel2}>${label}</option>`;
  }
  sel.innerHTML = opts;
  document.getElementById('costo-mes-sel').style.display = _costoVista==='mes' ? '' : 'none';
}

function renderCostos() {
  initCostoSelectors();
  const vacasP = animales.filter(a=>a.categoria==='Vaca'&&a.estado==='activa');
  const totalLDia = vacasP.reduce((s,a)=>s+a.litros,0);
  const aÃ±oSel = +document.getElementById('costo-aÃ±o-sel').value || new Date().getFullYear();
  const mesSel = document.getElementById('costo-mes-sel')?.value || `${aÃ±oSel}-${String(new Date().getMonth()+1).padStart(2,'0')}`;

  // Factor multiplicador: mes = 1, aÃ±o = 12
  const factor = _costoVista==='aÃ±o' ? 12 : 1;
  const diasPeriodo = _costoVista==='aÃ±o' ? 365 : 30;

  // Filtrar gastos variables del perÃ­odo
  let gastosPerio;
  if(_costoVista==='mes') {
    gastosPerio = gastos.filter(g=>g.fecha&&g.fecha.startsWith(mesSel));
  } else {
    gastosPerio = gastos.filter(g=>g.fecha&&g.fecha.startsWith(String(aÃ±oSel)));
  }

  // Ingresos leche estimados
  const ingL = totalLDia * diasPeriodo * params.precio_leche;

  // Ingreso venta animales (de gastos con tipo ingreso)
  const ingV_var = gastos.filter(g=>g.tipo==='ingreso'&&(_costoVista==='aÃ±o'?g.fecha?.startsWith(String(aÃ±oSel)):g.fecha?.startsWith(mesSel))).reduce((s,g)=>s+g.monto,0);
  const ingV_base = _costoVista==='aÃ±o' ? 12400000*12 : 12400000;
  const ingV = ingV_var > 0 ? ingV_var : ingV_base;
  const totalI = ingL + ingV;

  // Costos fijos del perÃ­odo
  const totalFijos = costosFijos.reduce((s,c)=>s+c.monto,0) * factor;

  // Costos variables del perÃ­odo (registros de gastos)
  const gastosVarCats = {};
  gastosPerio.filter(g=>g.tipo!=='ingreso').forEach(g=>{
    gastosVarCats[g.categoria]=(gastosVarCats[g.categoria]||0)+g.monto;
  });
  const totalVar = gastosPerio.filter(g=>g.tipo!=='ingreso').reduce((s,g)=>s+g.monto,0);

  // Costos fijos por categorÃ­a
  const fijosCats = {};
  costosFijos.forEach(c=>{ fijosCats[c.categoria]=(fijosCats[c.categoria]||0)+c.monto*factor; });

  // Total combinado
  const totalG = totalFijos + totalVar;
  const utilidad = totalI - totalG;
  const label = _costoVista==='aÃ±o' ? `AÃ±o ${aÃ±oSel}` : mesSel;

  document.getElementById('costos-er-title').textContent = `ğŸ’¹ Estado de Resultados â€” ${label}`;
  document.getElementById('costos-chart-title').textContent = `ğŸ“Š ${_costoVista==='aÃ±o'?'Ingresos vs Costos por Mes â€” '+aÃ±oSel:'EvoluciÃ³n mensual â€” '+aÃ±oSel}`;

  // KPIs (4)
  document.getElementById('costos-kpis').innerHTML = [
    {lbl:`Ingresos ${_costoVista==='aÃ±o'?'Anuales':'del Mes'}`,val:fMon(totalI),icon:'ğŸ’µ',color:'var(--pasto)'},
    {lbl:'Costos Fijos',val:fMon(totalFijos),icon:'ğŸ“Œ',color:'var(--tierra)'},
    {lbl:'Costos Variables',val:fMon(totalVar),icon:'ğŸ’¸',color:'var(--rojo)'},
    {lbl:'Utilidad Neta',val:fMon(utilidad),icon:utilidad>0?'ğŸ“ˆ':'ğŸ“‰',color:utilidad>0?'var(--pasto)':'var(--rojo)'},
  ].map(k=>`<div class="kpi-card"><div class="kpi-card-accent" style="background:${k.color};"></div><div class="kpi-icon-bg">${k.icon}</div><div class="kpi-lbl">${k.lbl}</div><div class="kpi-val" style="color:${k.color};font-size:22px;">${k.val}</div></div>`).join('');

  // Estado de resultados
  const allCats = {...fijosCats};
  Object.entries(gastosVarCats).forEach(([k,v])=>{ allCats[k]=(allCats[k]||0)+v; });

  document.getElementById('costos-er').innerHTML = `
    <div style="display:flex;flex-direction:column;gap:6px;">
      <div class="cost-row"><span>ğŸ¥› Venta de leche (${fNum(totalLDia*diasPeriodo)} L Ã— $${fNum(params.precio_leche)})</span><span class="cost-pos">${fMon(ingL)}</span></div>
      <div class="cost-row"><span>ğŸ„ Venta de animales (estimado)</span><span class="cost-pos">${fMon(ingV)}</span></div>
      <div class="cost-row" style="font-weight:800;background:var(--pasto-suave);padding:8px 10px;border-radius:8px;margin:6px 0;">
        <span>INGRESOS TOTALES</span><span class="cost-pos">${fMon(totalI)}</span>
      </div>
      <div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--gris-calido);margin-top:4px;padding:4px 0;border-bottom:1px solid var(--arena);">Costos Fijos (${factor===12?'anuales':''} $${fNum(costosFijos.reduce((s,c)=>s+c.monto,0))}/mes)</div>
      ${costosFijos.map(c=>`<div class="cost-row"><span style="color:var(--tierra);">ğŸ“Œ ${c.concepto}</span><span class="cost-neg">-${fMon(c.monto*factor)}</span></div>`).join('')}
      <div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--gris-calido);margin-top:4px;padding:4px 0;border-bottom:1px solid var(--arena);">Costos Variables registrados</div>
      ${Object.entries(gastosVarCats).length
        ? Object.entries(gastosVarCats).map(([c,v])=>`<div class="cost-row"><span class="cost-lbl">ğŸ’¸ ${c}</span><span class="cost-neg">-${fMon(v)}</span></div>`).join('')
        : `<div class="cost-row muted"><span>Sin gastos variables registrados en este perÃ­odo</span><span>$0</span></div>`}
      <div class="cost-row" style="font-weight:800;font-size:15px;border-top:2px solid var(--pasto);padding-top:10px;margin-top:6px;">
        <span>UTILIDAD NETA</span><span class="${utilidad>0?'cost-pos':'cost-neg'}">${fMon(utilidad)}</span>
      </div>
      <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
        <div class="res-box" style="flex:1;"><div class="res-lbl">Costo/litro</div><div class="res-big" style="font-size:20px;">${totalLDia*diasPeriodo>0?fMon(Math.round(totalG/(totalLDia*diasPeriodo))):'â€”'}</div></div>
        <div class="res-box" style="flex:1;"><div class="res-lbl">Margen bruto</div><div class="res-big" style="font-size:20px;">${totalI>0?(((utilidad/totalI)*100).toFixed(1))+'%':'â€”'}</div></div>
        <div class="res-box" style="flex:1;"><div class="res-lbl">Ing. leche/mes</div><div class="res-big" style="font-size:20px;">${fMon(Math.round(ingL/factor))}</div></div>
      </div>
    </div>`;

  // Donut (combina fijos + variables)
  const costColors = {AlimentaciÃ³n:'#1b5e35',Sanidad:'#c0392b',NÃ³mina:'#d97706',Insumos:'#2563a8',Mantenimiento:'#7c4d2d',Transporte:'#6b7280',Arriendo:'#7c3aed',ReproducciÃ³n:'#0891b2',Otros:'#9ca3af'};
  const donutData = Object.entries(allCats).map(([k,v])=>({label:k,val:v,color:costColors[k]||'#999'}));
  if(donutData.length) renderDonut('costos-donut','costos-legend',donutData,100,40);

  // Resumen costos fijos card
  const totalFijosMes = costosFijos.reduce((s,c)=>s+c.monto,0);
  document.getElementById('costos-fijos-resumen').innerHTML = `
    <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px;">
      <div style="background:var(--pasto-suave);border-radius:8px;padding:10px 16px;border-left:3px solid var(--pasto);">
        <div style="font-size:10px;color:#888;text-transform:uppercase;">Total/mes</div>
        <div style="font-size:20px;font-weight:800;color:var(--pasto);">${fMon(totalFijosMes)}</div>
      </div>
      <div style="background:#fff7ed;border-radius:8px;padding:10px 16px;border-left:3px solid var(--sol);">
        <div style="font-size:10px;color:#888;text-transform:uppercase;">Total/aÃ±o</div>
        <div style="font-size:20px;font-weight:800;color:var(--sol);">${fMon(totalFijosMes*12)}</div>
      </div>
      <div style="background:#fef2f2;border-radius:8px;padding:10px 16px;border-left:3px solid var(--rojo);">
        <div style="font-size:10px;color:#888;text-transform:uppercase;">Ãtems configurados</div>
        <div style="font-size:20px;font-weight:800;color:var(--rojo);">${costosFijos.length}</div>
      </div>
    </div>
    <div class="tbl-wrap"><table>
      <thead><tr><th>Concepto</th><th>CategorÃ­a</th><th>Por Mes</th><th>Por AÃ±o</th></tr></thead>
      <tbody>${costosFijos.map(c=>`<tr>
        <td class="fw7">${c.concepto}</td>
        <td><span class="tag tag-gris">${c.categoria}</span></td>
        <td class="fw7 c-rojo">${fMon(c.monto)}</td>
        <td style="color:var(--tierra);font-weight:700;">${fMon(c.monto*12)}</td>
      </tr>`).join('')}
      <tr style="background:var(--pasto-suave);font-weight:800;">
        <td>TOTAL</td><td></td>
        <td class="c-rojo fw7">${fMon(totalFijosMes)}</td>
        <td style="color:var(--tierra);font-weight:800;">${fMon(totalFijosMes*12)}</td>
      </tr></tbody>
    </table></div>`;

  // GrÃ¡fico barras por mes (aÃ±o actual)
  renderCostosBarChart(aÃ±oSel, totalFijosMes, totalLDia);

  // Tabla gastos variables del perÃ­odo
  const gastosVarList = gastosPerio.filter(g=>g.tipo!=='ingreso').sort((a,b)=>b.fecha.localeCompare(a.fecha));
  document.getElementById('gastos-tbody').innerHTML = gastosVarList.slice(0,100).map(g=>`
    <tr>
      <td>${g.fecha}</td>
      <td><span class="tag tag-gris">${g.categoria}</span></td>
      <td>${g.concepto}</td>
      <td class="fw7 c-rojo">${fMon(g.monto)}</td>
      <td>${g.proveedor||'â€”'}</td>
      <td><button class="btn btn-ghost btn-sm btn-icon" onclick="deleteGasto(${g.id})">ğŸ—‘</button></td>
    </tr>`).join('') || '<tr><td colspan="6"><div class="empty-state"><div class="es-icon">ğŸ’¸</div><div class="es-text">Sin gastos variables en este perÃ­odo</div></div></td></tr>';

  // HistÃ³rico leche
  renderHistoricoLeche();
}

function renderCostosBarChart(aÃ±o, totalFijosMes, totalLDia) {
  const MESES_ES = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
  const datos = MESES_ES.map((m,i)=>{
    const mesKey = `${aÃ±o}-${String(i+1).padStart(2,'0')}`;
    const varMes = gastos.filter(g=>g.fecha?.startsWith(mesKey)&&g.tipo!=='ingreso').reduce((s,g)=>s+g.monto,0);
    const totalCost = totalFijosMes + varMes;
    const ingreso = totalLDia * 30 * params.precio_leche + 12400000; // estimado
    return {m, totalCost, ingreso};
  });
  const maxV = Math.max(...datos.map(d=>Math.max(d.totalCost,d.ingreso)),1);
  const H = 90;
  const container = document.getElementById('costos-chart-bars');
  if(!container) return;
  container.innerHTML = datos.map((d,i)=>`
    <div style="flex:1;min-width:36px;display:flex;flex-direction:column;align-items:center;gap:2px;height:100%;justify-content:flex-end;position:relative;">
      <div style="display:flex;gap:1px;align-items:flex-end;width:100%;justify-content:center;">
        <div style="width:42%;height:${Math.round((d.ingreso/maxV)*H)}px;background:var(--pasto-vivo);border-radius:3px 3px 0 0;min-height:3px;" title="Ing: ${fMon(d.ingreso)}"></div>
        <div style="width:42%;height:${Math.round((d.totalCost/maxV)*H)}px;background:${d.totalCost>d.ingreso?'var(--rojo)':'var(--tierra-claro)'};border-radius:3px 3px 0 0;min-height:3px;" title="Cost: ${fMon(d.totalCost)}"></div>
      </div>
      <span style="font-size:8px;color:var(--gris-calido);font-weight:700;position:absolute;bottom:0;">${d.m}</span>
    </div>`).join('');
}

function renderHistoricoLeche() {
  const elHist = document.getElementById('costos-leche-hist');
  if(!elHist) return;
  const porMes = {};
  gastos.filter(g=>g.tipo==='ingreso' && g.concepto.startsWith('Venta leche')).forEach(g=>{
    const mes = g.fecha.substring(0,7);
    if(!porMes[mes]) porMes[mes] = {litros:0, ingresos:0, semanas:0, precioMin:9999, precioMax:0};
    const mL = g.concepto.match(/\((\d+)L/);
    const mP = g.concepto.match(/Ã— \$([0-9.]+)/);
    const lts = mL ? +mL[1] : 0;
    const prc = mP ? +mP[1].replace('.','') : 0;
    porMes[mes].litros   += lts;
    porMes[mes].ingresos += g.monto;
    porMes[mes].semanas  += 1;
    if(prc && prc < porMes[mes].precioMin) porMes[mes].precioMin = prc;
    if(prc && prc > porMes[mes].precioMax) porMes[mes].precioMax = prc;
  });
  const meses = Object.keys(porMes).sort();
  if(!meses.length) { elHist.innerHTML='<div style="color:#aaa;padding:16px">Sin datos de venta de leche cargados. Registra ventas de leche con el botÃ³n "Registrar Gasto" seleccionando la categorÃ­a "Venta Leche".</div>'; return; }
  const totalLitros   = meses.reduce((s,m)=>s+porMes[m].litros,0);
  const totalIngresos = meses.reduce((s,m)=>s+porMes[m].ingresos,0);
  const promDia       = totalLitros > 0 ? (totalLitros / (meses.length*30)).toFixed(1) : 0;
  const precioPromG   = totalLitros>0 ? Math.round(totalIngresos/totalLitros) : 0;
  const MESES_ES = {'01':'Ene','02':'Feb','03':'Mar','04':'Abr','05':'May','06':'Jun','07':'Jul','08':'Ago','09':'Sep','10':'Oct','11':'Nov','12':'Dic'};
  const mesLabel = m => { const [y,mo]=m.split('-'); return `${MESES_ES[mo]} ${y.slice(2)}`; };
  const maxLitros = Math.max(...meses.map(m=>porMes[m].litros));
  elHist.innerHTML = `
    <div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:18px;">
      <div style="background:var(--pasto-suave);border-radius:10px;padding:12px 18px;min-width:130px;border-left:4px solid var(--pasto)"><div style="font-size:10px;color:#888;text-transform:uppercase">Total kg pesados</div><div style="font-size:26px;font-weight:800;color:var(--pasto)">${fNum(totalLitros)}</div></div>
      <div style="background:#e3f4fd;border-radius:10px;padding:12px 18px;min-width:130px;border-left:4px solid var(--cielo)"><div style="font-size:10px;color:#888;text-transform:uppercase">Total ingresos</div><div style="font-size:26px;font-weight:800;color:var(--cielo)">${fMon(totalIngresos)}</div></div>
      <div style="background:#fffbeb;border-radius:10px;padding:12px 18px;min-width:130px;border-left:4px solid var(--sol)"><div style="font-size:10px;color:#888;text-transform:uppercase">Precio promedio</div><div style="font-size:26px;font-weight:800;color:var(--sol)">$${fNum(precioPromG)}</div><div style="font-size:11px;color:#aaa">por litro</div></div>
      <div style="background:#f5f5f5;border-radius:10px;padding:12px 18px;min-width:130px;border-left:4px solid #aaa"><div style="font-size:10px;color:#888;text-transform:uppercase">Promedio diario</div><div style="font-size:26px;font-weight:800;color:#555">${promDia} L</div></div>
    </div>
    <div style="margin-bottom:16px;"><div style="font-size:11px;font-weight:700;color:#888;text-transform:uppercase;margin-bottom:8px;">Litros y precio por mes</div>
      <div style="display:flex;align-items:flex-end;gap:6px;height:100px;padding-bottom:4px;overflow-x:auto;">
        ${meses.map(m=>{const d=porMes[m];const h=Math.round((d.litros/maxLitros)*90);const pColor=d.precioMin>=1700?'var(--pasto)':d.precioMin>=1400?'var(--sol)':'var(--rojo)';return `<div style="flex:1;min-width:40px;display:flex;flex-direction:column;align-items:center;gap:2px;"><div style="font-size:9px;color:#888;font-weight:600">${fNum(d.litros)}</div><div style="width:100%;height:${h}px;background:${pColor};border-radius:4px 4px 0 0;min-height:4px;"></div><div style="font-size:9px;color:#555;text-align:center;white-space:nowrap">${mesLabel(m)}</div><div style="font-size:9px;color:${pColor};font-weight:700">$${fNum(Math.round(d.ingresos/d.litros))}</div></div>`;}).join('')}
      </div>
      <div style="font-size:10px;color:#aaa;margin-top:4px;">ğŸŸ¢ Precio â‰¥$1.700 &nbsp; ğŸŸ¡ $1.400-$1.699 &nbsp; ğŸ”´ &lt;$1.400</div>
    </div>
    <div class="tbl-wrap"><table style="font-size:12px;border-collapse:collapse;width:100%">
      <thead><tr style="background:var(--pasto-suave)"><th style="padding:5px 10px;text-align:left">Mes</th><th style="padding:5px 10px;text-align:right">Litros</th><th style="padding:5px 10px;text-align:right">L/dÃ­a prom</th><th style="padding:5px 10px;text-align:right">Precio rango</th><th style="padding:5px 10px;text-align:right">Ingresos</th><th style="padding:5px 10px;text-align:right">$/L promedio</th></tr></thead>
      <tbody>${meses.map(m=>{const d=porMes[m];const dias=d.semanas*7;const pL=d.litros>0?Math.round(d.ingresos/d.litros):0;const pColor=pL>=1700?'var(--pasto)':pL>=1400?'var(--sol)':'var(--rojo)';return `<tr style="border-bottom:1px solid var(--borde)"><td style="padding:5px 10px;font-weight:700">${mesLabel(m)}</td><td style="padding:5px 10px;text-align:right">${fNum(d.litros)}</td><td style="padding:5px 10px;text-align:right">${(d.litros/dias).toFixed(1)} L</td><td style="padding:5px 10px;text-align:right;color:#666">$${fNum(d.precioMin)} â€“ $${fNum(d.precioMax)}</td><td style="padding:5px 10px;text-align:right;font-weight:700;color:var(--pasto)">${fMon(d.ingresos)}</td><td style="padding:5px 10px;text-align:right;font-weight:700;color:${pColor}">$${fNum(pL)}</td></tr>`;}).join('')}
      <tr style="background:var(--pasto-suave);font-weight:800;"><td style="padding:6px 10px">TOTAL / PROMEDIO</td><td style="padding:6px 10px;text-align:right">${fNum(totalLitros)}</td><td style="padding:6px 10px;text-align:right">${promDia} L</td><td style="padding:6px 10px;text-align:right;color:#666">â€”</td><td style="padding:6px 10px;text-align:right;color:var(--pasto)">${fMon(totalIngresos)}</td><td style="padding:6px 10px;text-align:right;color:var(--sol)">$${fNum(precioPromG)}</td></tr>
      </tbody></table></div>`;
}

// â”€â”€ Modal costos fijos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModalCostosFijos() {
  renderFormCostosFijos();
  openModal('modalCostosFijos');
}

function renderFormCostosFijos() {
  const CATS = ['NÃ³mina','AlimentaciÃ³n','Sanidad','Mantenimiento','Transporte','Arriendo','ReproducciÃ³n','Insumos','Otros'];
  document.getElementById('costos-fijos-form').innerHTML = costosFijos.map((c,i)=>`
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;" id="cf-row-${c.id}">
      <input class="form-control" style="flex:2;" value="${c.concepto}" onchange="costosFijos[${i}].concepto=this.value" placeholder="Concepto">
      <select class="form-control" style="flex:1;" onchange="costosFijos[${i}].categoria=this.value">
        ${CATS.map(cat=>`<option ${cat===c.categoria?'selected':''}>${cat}</option>`).join('')}
      </select>
      <input type="number" class="form-control number-input" style="width:130px;" value="${c.monto}" onchange="costosFijos[${i}].monto=+this.value" placeholder="$/mes">
      <span style="font-size:11px;color:#888;min-width:90px;text-align:right;">${fMon(c.monto)}/aÃ±o</span>
      <button class="btn btn-ghost btn-sm btn-icon" onclick="eliminarCostoFijo(${c.id})">ğŸ—‘</button>
    </div>`).join('');
}

function agregarFilaCostoFijo() {
  const newId = Date.now();
  costosFijos.push({id:newId, concepto:'', monto:0, categoria:'Otros'});
  renderFormCostosFijos();
}

function eliminarCostoFijo(id) {
  costosFijos = costosFijos.filter(c=>c.id!==id);
  renderFormCostosFijos();
}

function guardarCostosFijos() {
  // Leer valores actuales del formulario
  const CATS = ['NÃ³mina','AlimentaciÃ³n','Sanidad','Mantenimiento','Transporte','Arriendo','ReproducciÃ³n','Insumos','Otros'];
  const rows = document.querySelectorAll('#costos-fijos-form > div');
  costosFijos.forEach((c,i)=>{
    const row = rows[i];
    if(!row) return;
    const inputs = row.querySelectorAll('input');
    const sel = row.querySelector('select');
    c.concepto = inputs[0]?.value || c.concepto;
    c.categoria = sel?.value || c.categoria;
    c.monto = +inputs[1]?.value || c.monto;
  });
  DB.save('costosFijos', costosFijos);
  closeModal('modalCostosFijos');
  toast('Costos fijos guardados âœ”');
  renderCostos();
}
function deleteGasto(id) { gastos=gastos.filter(g=>g.id!==id); persist(); toast('Eliminado'); renderCostos(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PRADERAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PESTAÃ‘AS PRADERAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _praderaTab = 'potreros';

function switchPraderaTab(tab) {
  _praderaTab = tab;
  ['potreros','historial','produccion'].forEach(t=>{
    const el = document.getElementById('pradera-tab-'+t);
    const btn= document.getElementById('ptab-'+t);
    if(el)  el.style.display  = t===tab ? '' : 'none';
    if(btn) btn.className = 'ptab' + (t===tab?' ptab-act':'');
  });
  if(tab==='historial')  renderHistorialPotreros();
  if(tab==='produccion') {} // ya se renderiza en renderPraderas
}

function renderHistorialPotreros() {
  const el = document.getElementById('praderas-historial-content');
  if(!el) return;

  // Para cada potrero, recopilar todos los movimientos de todos los lotes
  // que lo mencionan
  const resumen = {};
  praderas.forEach(p => { resumen[p.nombre] = { potrero:p, ocupaciones:[] }; });

  lotes.forEach(lote => {
    (lote.movimientos||[]).forEach(mv => {
      if(!resumen[mv.potrero]) {
        resumen[mv.potrero] = { potrero:{nombre:mv.potrero,area:0}, ocupaciones:[] };
      }
      // Calcular dÃ­as
      let dias = 'â€”';
      if(mv.fechaEntrada) {
        const d1 = new Date(mv.fechaEntrada+'T00:00:00');
        const d2 = mv.fechaSalida ? new Date(mv.fechaSalida+'T00:00:00') : new Date();
        dias = Math.round((d2-d1)/86400000);
      }
      // Calcular leche en ese perÃ­odo
      const miembrosEnFecha = (lote.miembros||[]).filter(m => {
        const ei = m.fechaIngreso||'2000-01-01';
        const es = m.fechaSalida ||'2099-01-01';
        const pe = mv.fechaEntrada||'2000-01-01';
        const ps = mv.fechaSalida ||'2099-01-01';
        return ei <= ps && es >= pe; // solapamiento
      }).map(m=>m.animalId);

      let lecheCalc = mv.lecheTotal||0;
      if(!lecheCalc && mv.fechaEntrada && miembrosEnFecha.length) {
        const ids = new Set(miembrosEnFecha);
        const d0  = new Date(mv.fechaEntrada+'T00:00:00');
        const d1  = mv.fechaSalida ? new Date(mv.fechaSalida+'T00:00:00') : new Date();
        lecheCalc = registrosLeche
          .filter(r=>ids.has(r.animalId)&&new Date(r.fecha+'T00:00:00')>=d0&&new Date(r.fecha+'T00:00:00')<=d1)
          .reduce((s,r)=>s+r.total,0);
      }

      resumen[mv.potrero].ocupaciones.push({
        loteId:   lote.id,
        loteNum:  lote.numero,
        loteNom:  lote.nombre,
        entrada:  mv.fechaEntrada,
        salida:   mv.fechaSalida,
        dias,
        animales: miembrosEnFecha.length,
        leche:    lecheCalc,
        obs:      mv.obs||''
      });
    });
  });

  // Ordenar potreros por nombre
  const potrerosList = Object.values(resumen)
    .filter(r=>r.ocupaciones.length>0)
    .sort((a,b)=>a.potrero.nombre.localeCompare(b.potrero.nombre));

  if(!potrerosList.length) {
    el.innerHTML = `<div style="text-align:center;padding:48px;color:#aaa;">
      <div style="font-size:40px;">ğŸŒ¿</div>
      <div style="margin-top:10px;">Sin historial registrado aÃºn</div>
      <div style="font-size:12px;margin-top:6px;">Los movimientos de lotes aparecerÃ¡n aquÃ­</div>
    </div>`;
    return;
  }

  el.innerHTML = potrerosList.map(({potrero:p, ocupaciones}) => {
    // Stats del potrero
    const totalDias   = ocupaciones.reduce((s,o)=>s+(typeof o.dias==='number'?o.dias:0),0);
    const totalLeche  = ocupaciones.reduce((s,o)=>s+o.leche,0);
    const ocupActual  = ocupaciones.find(o=>!o.salida);

    const rows = ocupaciones
      .slice()
      .sort((a,b)=>(a.entrada||'').localeCompare(b.entrada||''))
      .map(o=>{
        const activo = !o.salida;
        return `<tr style="border-bottom:1px solid var(--borde);background:${activo?'var(--pasto-suave)':''}">
          <td style="padding:5px 10px;font-weight:700;color:${activo?'var(--pasto)':'var(--texto)'}">
            Lote ${o.loteNum} â€” ${o.loteNom}
            ${activo?'<span style="background:var(--pasto);color:#fff;border-radius:3px;padding:0 4px;font-size:9px;margin-left:4px">HOY</span>':''}
          </td>
          <td style="padding:5px 10px;text-align:center;color:var(--pasto);font-weight:600">${o.entrada||'â€”'}</td>
          <td style="padding:5px 10px;text-align:center;color:var(--tierra);font-weight:600">${o.salida||'â€”'}</td>
          <td style="padding:5px 10px;text-align:right">${typeof o.dias==='number'?o.dias+'d':'â€”'}</td>
          <td style="padding:5px 10px;text-align:right">${o.animales>0?o.animales:'â€”'}</td>
          <td style="padding:5px 10px;text-align:right;color:var(--cielo);font-weight:600">${o.leche>0?fNum(o.leche,0)+' L':'â€”'}</td>
          <td style="padding:5px 10px;color:#aaa;font-size:11px">${o.obs}</td>
        </tr>`;
      }).join('');

    return `<div class="card" style="margin-bottom:14px;border-left:4px solid ${ocupActual?'var(--pasto)':'#ccc'}">
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:10px;">
        <div>
          <span style="font-size:17px;font-weight:800;color:${ocupActual?'var(--pasto)':'var(--texto)'}">${p.nombre}</span>
          ${p.area?`<span style="font-size:12px;color:#aaa;margin-left:6px">${p.area} ha</span>`:''}
          ${ocupActual
            ? `<span class="tag tag-verde" style="margin-left:8px;font-size:11px">Ocupado ahora</span>`
            : `<span class="tag tag-gris" style="margin-left:8px;font-size:11px">En descanso</span>`}
        </div>
        <div style="margin-left:auto;display:flex;gap:16px;font-size:12px;flex-wrap:wrap;">
          <div style="text-align:center">
            <div style="color:#aaa;font-size:10px;text-transform:uppercase">Ocupaciones</div>
            <div style="font-weight:800;color:var(--pasto);font-size:18px">${ocupaciones.length}</div>
          </div>
          <div style="text-align:center">
            <div style="color:#aaa;font-size:10px;text-transform:uppercase">Total dÃ­as</div>
            <div style="font-weight:800;color:var(--tierra);font-size:18px">${totalDias}d</div>
          </div>
          ${totalLeche>0?`<div style="text-align:center">
            <div style="color:#aaa;font-size:10px;text-transform:uppercase">Leche total</div>
            <div style="font-weight:800;color:var(--cielo);font-size:18px">${fNum(totalLeche,0)} L</div>
          </div>`:''}
        </div>
      </div>
      <div class="tbl-wrap" style="overflow-x:auto;">
        <table style="font-size:12px;border-collapse:collapse;width:100%;min-width:640px;">
          <thead><tr style="background:var(--pasto-suave)">
            <th style="padding:5px 10px;text-align:left">Lote</th>
            <th style="padding:5px 10px;text-align:center">Entrada</th>
            <th style="padding:5px 10px;text-align:center">Salida</th>
            <th style="padding:5px 10px;text-align:right">DÃ­as</th>
            <th style="padding:5px 10px;text-align:right">Animales</th>
            <th style="padding:5px 10px;text-align:right">ğŸ¥› Leche</th>
            <th style="padding:5px 10px;text-align:left">Obs</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    </div>`;
  }).join('');
}

function renderPraderas() {
  // Sincronizar pestaÃ±as
  switchPraderaTab(_praderaTab||'potreros');

  // â”€â”€ SYNC AUTOMÃTICO: estado, conteo y leche desde animales â”€â”€â”€
  // Para cada potrero, contar cuÃ¡ntos animales activos tienen ese nombre de potrero
  const hace7d = new Date(); hace7d.setDate(hace7d.getDate()-7);
  praderas.forEach(p => {
    const enPotrero = animales.filter(a =>
      a.estado !== 'baja' && a.potrero === p.nombre
    );
    p.animales = enPotrero.length;
    if (enPotrero.length > 0) {
      p.estado = 'Ocupado';
    } else if (p.estado === 'Ocupado') {
      p.estado = 'Descanso';
    }
    // kg peso vivo en el potrero
    p.kgVivo = enPotrero.reduce((s,a) => s + (a.peso||0), 0);
    // Leche: suma litros actuales (campo litros del animal = producciÃ³n del Ãºltimo control)
    p.litrosHoy = enPotrero.reduce((s,a) => s + (a.litros||0), 0);
    // Leche Ãºltimos 7 dÃ­as desde registrosLeche
    const idsEnPotrero = new Set(enPotrero.map(a=>a.id));
    p.litros7d = registrosLeche
      .filter(r => idsEnPotrero.has(r.animalId) && new Date(r.fecha+'T00:00:00') >= hace7d)
      .reduce((s,r) => s + r.total, 0);
    p.litrosProm7 = p.litros7d > 0 ? +(p.litros7d / 7).toFixed(1) : 0;
    p.litrosHaProm7 = (p.area > 0 && p.litrosProm7 > 0) ? +(p.litrosProm7 / p.area).toFixed(1) : 0;
  });

  // â”€â”€ Ãrea total por sector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const HA_CASA     = 17;
  const HA_RINCON   = praderas.filter(p=>p.sector==='RincÃ³n').reduce((s,p)=>s+p.area,0)||17;
  const HA_HERENCIA = 9;
  const HA_TOTAL    = 43;

  // â”€â”€ Animales activos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const vacasActivas   = animales.filter(a=>['Vaca','Novilla'].includes(a.categoria)&&a.estado!=='baja');
  const criasActivas   = animales.filter(a=>['Ternera','Ternero'].includes(a.categoria)&&a.estado==='activa');
  const descarte       = animales.filter(a=>a.estado==='baja'&&a.obs&&a.obs.toLowerCase().includes('vendid'));

  // â”€â”€ kg CARNE total hato (peso vivo actual) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const kgHatoTotal    = vacasActivas.reduce((s,a)=>s+(a.peso||0),0)
                       + criasActivas.reduce((s,a)=>s+(a.peso||0),0);
  const kgHaTotal      = HA_TOTAL>0 ? +(kgHatoTotal/HA_TOTAL).toFixed(1) : 0;

  // â”€â”€ kg CARNE CRÃAS (peso vivo, pesares mÃ¡s recientes cada ternero) â”€
  // Usamos registrosPeso (ctrl peso) para crÃ­as; si no hay, usamos peso actual del animal
  const kgCriasVivo = criasActivas.reduce((s,a)=>{
    const pesosAnim = registrosPeso.filter(r=>r.animalId===a.id).sort((x,y)=>y.fecha.localeCompare(x.fecha));
    return s + (pesosAnim.length ? pesosAnim[0].peso : (a.peso||0));
  },0);
  const kgCriasPorHa   = HA_TOTAL>0 ? +(kgCriasVivo/HA_TOTAL).toFixed(1) : 0;

  // â”€â”€ kg CARNE DESCARTE (animales vendidos con peso registrado) â”€
  const kgDescarte = descarte.reduce((s,a)=>{
    const m = (a.obs||'').match(/(\d+)\s*kg/i);
    return s + (m ? +m[1] : (a.peso||0));
  },0);
  const kgDescartePorHa = HA_TOTAL>0 ? +(kgDescarte/HA_TOTAL).toFixed(1) : 0;

  // â”€â”€ LECHE: Ãºltimos 30 dÃ­as â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const hoy    = new Date(); hoy.setHours(0,0,0,0);
  const hace30 = new Date(hoy); hace30.setDate(hace30.getDate()-30);
  const lecheUlt30 = registrosLeche.filter(r=>new Date(r.fecha+'T00:00:00')>=hace30)
                                   .reduce((s,r)=>s+r.total,0);
  // ProducciÃ³n diaria promedio Ã— 365 = producciÃ³n anual estimada
  const litrosDia    = lecheUlt30 / 30;
  const litrosAnual  = +(litrosDia * 365).toFixed(0);
  const litrosPorHa  = HA_TOTAL>0 ? +(litrosAnual/HA_TOTAL).toFixed(1) : 0;
  const litrosDiaHa  = HA_TOTAL>0 ? +(litrosDia/HA_TOTAL).toFixed(2) : 0;

  // â”€â”€ KPI cards superiores â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const totalHa    = praderas.reduce((s,p)=>s+p.area,0);
  const ocupados   = praderas.filter(p=>p.estado==='Ocupado');
  document.getElementById('praderas-kpis').innerHTML = [
    {lbl:'Potreros totales',    val:praderas.length+' (25)',           icon:'ğŸŒ¿', color:'var(--pasto)'},
    {lbl:'Ha en ganaderÃ­a',     val:'43 ha',                           icon:'ğŸ“', color:'var(--cielo)'},
    {lbl:'En pastoreo',         val:ocupados.length,                   icon:'ğŸ„', color:'var(--sol)'},
    {lbl:'Carga kg/ha (vivo)',  val:fNum(kgHaTotal,1)+' kg/ha',        icon:'âš–ï¸', color:'var(--tierra)'},
  ].map(k=>`<div class="kpi-card"><div class="kpi-card-accent" style="background:${k.color};"></div><div class="kpi-icon-bg">${k.icon}</div><div class="kpi-lbl">${k.lbl}</div><div class="kpi-val" style="color:${k.color};">${k.val}</div></div>`).join('');

  // â”€â”€ Tabla de potreros agrupada por sector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const sectores = ['La Casa','RincÃ³n','La Herencia'];
  const sectorHa = {'La Casa':HA_CASA,'RincÃ³n':HA_RINCON,'La Herencia':HA_HERENCIA};
  const sectorColor = {'La Casa':'var(--pasto)','RincÃ³n':'var(--sol)','La Herencia':'var(--tierra)'};

  let tbodyHtml = '';
  sectores.forEach(sec=>{
    const ps = praderas.filter(p=>p.sector===sec);
    if(!ps.length) return;
    const haS = sectorHa[sec];
    tbodyHtml += `<tr style="background:var(--pasto-suave);">
      <td colspan="9" style="font-weight:700;color:${sectorColor[sec]};padding:8px 12px;font-size:12px;">
        ğŸ“ Sector ${sec} â€” ${haS} ha â€” ${ps.length} potreros
      </td></tr>`;
    ps.forEach(p=>{
      tbodyHtml += `<tr>
        <td class="fw7">${p.nombre}</td>
        <td>${p.area} ha</td>
        <td>${p.pasto||'â€”'}</td>
        <td><span class="tag ${p.estado==='Ocupado'?'tag-verde':p.estado==='Descanso'?'tag-amarillo':'tag-gris'}">${p.estado}</span></td>
        <td>${p.animales||0}</td>
        <td>${p.kgVivo>0?`<span class="fw7">${fNum(p.kgVivo)} kg</span>`:'â€”'}</td>
        <td style="color:var(--cielo);font-weight:600;">${p.litrosProm7>0?fNum(p.litrosProm7,1)+' kg':'â€”'}</td>
        <td style="color:var(--cielo);">${p.litrosHaProm7>0?fNum(p.litrosHaProm7,1)+' kg/ha':'â€”'}</td>
        <td style="color:var(--pasto);font-weight:600;">${p.fechaEntrada||'â€”'}</td>
        <td style="color:var(--tierra);font-weight:600;">${p.fechaSalida||p.ultimaSalida||'â€”'}</td>
        <td>${p.diasOcupado||0}d</td>
        <td>${p.diasDescanso||0}d</td>
        <td>
          <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
            <input type="date" id="pot-fecha-${p.id}" value="${hoy()}"
              style="font-size:11px;padding:3px 6px;border:1px solid var(--borde);border-radius:6px;background:var(--fondo);color:var(--texto);width:118px;">
            <label class="sw-label" title="${p.estado==='Ocupado'?'Click para poner en Descanso':'Click para Ocupar'}">
              <input type="checkbox" ${p.estado==='Ocupado'?'checked':''} onchange="togglePotreroSwitch(${p.id},this)">
              <span class="sw-track"><span class="sw-thumb"></span></span>
              <span class="sw-text">${p.estado==='Ocupado'?'Ocupado':'Descanso'}</span>
            </label>
            <button class="btn btn-ghost btn-sm btn-icon" onclick="deletePotrero(${p.id})">ğŸ—‘</button>
          </div>
        </td></tr>`;
    });
  });
  document.getElementById('praderas-tbody').innerHTML = tbodyHtml;

  // â”€â”€ Ãrea agrÃ­cola especial (ensilaje) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const elEspecial = document.getElementById('praderas-especial');
  if(elEspecial) {
    elEspecial.innerHTML = `
      <div style="margin-top:18px;border:2px dashed var(--sol);border-radius:10px;padding:14px 18px;background:#fffde7;">
        <div style="font-weight:700;font-size:13px;color:var(--sol);margin-bottom:8px;">ğŸŒ½ Ãrea AgrÃ­cola de Ensilaje â€” P12 especial (No entra en rotaciÃ³n ganadera)</div>
        <div style="display:flex;gap:24px;flex-wrap:wrap;font-size:13px;">
          <div><span style="color:#888;">Ãrea:</span> <strong>0.60 ha</strong> (6.000 mÂ²)</div>
          <div><span style="color:#888;">Sector:</span> <strong>La Casa</strong></div>
          <div><span style="color:#888;">Cultivo:</span> <strong>MaÃ­z / Sorgo (rotaciÃ³n anual)</strong></div>
          <div><span style="color:#888;">Uso:</span> <strong>Ensilaje para suplementaciÃ³n del hato</strong></div>
          <div><span style="color:#888;">Estado:</span> <span class="tag tag-amarillo">Sembrado permanente</span></div>
        </div>
        <div style="margin-top:8px;font-size:11px;color:#aaa;">Esta Ã¡rea no se incluye en la carga animal ni en los KPIs de pastoreo rotacional. Puede usarse como pastoreo diferido (rastrojo) en Ã©pocas especÃ­ficas.</div>
      </div>`;
  }

  // â”€â”€ SecciÃ³n producciÃ³n por hectÃ¡rea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const elProd = document.getElementById('praderas-produccion');
  if(!elProd) return;

  // Detalle pesares crÃ­as (Ãºltimos 45 dÃ­as)
  const hace45 = new Date(hoy); hace45.setDate(hace45.getDate()-45);
  const pesaresCrias45 = registrosPeso
    .filter(r=>{
      const a = animales.find(x=>x.id===r.animalId);
      return a && ['Ternera','Ternero'].includes(a.categoria) && new Date(r.fecha+'T00:00:00')>=hace45;
    })
    .sort((a,b)=>b.fecha.localeCompare(a.fecha));

  // Agrupar Ãºltimo pesaje por crÃ­a (ciclo 45 dÃ­as)
  const ultimoPorCria = {};
  const anteriorPorCria = {};
  pesaresCrias45.forEach(r=>{
    if(!ultimoPorCria[r.animalId])      ultimoPorCria[r.animalId]   = r;
    else if(!anteriorPorCria[r.animalId]) anteriorPorCria[r.animalId] = r;
  });

  const filasGmc = Object.keys(ultimoPorCria).map(id=>{
    const u = ultimoPorCria[id];
    const ant = anteriorPorCria[id];
    const a = animales.find(x=>x.id===id)||{};
    let gmc = 'â€”', gDias = 'â€”';
    if(ant){
      const dias = (new Date(u.fecha)-new Date(ant.fecha))/(86400000);
      if(dias>0){ gmc=(((u.peso-ant.peso)/dias)*1000).toFixed(0)+' g/d'; gDias=dias+'d'; }
    }
    return `<tr>
      <td class="fw7">${id}</td>
      <td>${a.categoria||'â€”'}</td>
      <td>${u.fecha}</td>
      <td>${u.peso} kg</td>
      <td>${ant?ant.peso+' kg':'â€”'}</td>
      <td>${gmc}</td>
      <td>${gDias}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--gris-calido);">Sin pesares registrados en los Ãºltimos 45 dÃ­as</td></tr>';

  // Tabla animales descarte vendidos
  const filasDescarte = descarte.slice(0,10).map(a=>{
    const m = (a.obs||'').match(/(\d+)\s*kg/i);
    const kgV = m?+m[1]:(a.peso||0);
    return `<tr>
      <td class="fw7">${a.id}</td>
      <td>${a.nombre||a.id}</td>
      <td>${a.categoria||'â€”'}</td>
      <td>${kgV?kgV+' kg':'â€”'}</td>
      <td>${(a.obs||'').slice(0,60)}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--gris-calido);">Sin registros de descarte</td></tr>';

  elProd.innerHTML = `
  <!-- â”€â”€ MÃ‰TRICAS PRODUCCIÃ“N POR HECTÃREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-bottom:20px;">

    <!-- LECHE / ha -->
    <div class="card" style="border-left:4px solid var(--cielo);padding:18px 20px;">
      <div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gris-calido);margin-bottom:6px;">ğŸ¥› Leche / ha / aÃ±o</div>
      <div style="font-size:28px;font-weight:800;color:var(--cielo);">${fNum(litrosPorHa,1)} <span style="font-size:14px;font-weight:500;">kg/ha/aÃ±o</span></div>
      <div style="font-size:12px;color:var(--texto-medio);margin-top:4px;">${fNum(litrosDiaHa,2)} kg/ha/dÃ­a Â· Base: Ãºlt. 30 dÃ­as</div>
      <div style="font-size:11px;color:var(--gris-calido);margin-top:2px;">Total hato: ${fNum(litrosAnual)} kg/aÃ±o estimados Â· ${fNum(litrosDia,1)} kg/dÃ­a</div>
    </div>

    <!-- CARGA ANIMAL / ha -->
    <div class="card" style="border-left:4px solid var(--pasto);padding:18px 20px;">
      <div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gris-calido);margin-bottom:6px;">âš–ï¸ Carga animal / ha</div>
      <div style="font-size:28px;font-weight:800;color:var(--pasto);">${fNum(kgHaTotal,1)} <span style="font-size:14px;font-weight:500;">kg PV/ha</span></div>
      <div style="font-size:12px;color:var(--texto-medio);margin-top:4px;">Peso vivo total: ${fNum(kgHatoTotal)} kg en 43 ha</div>
      <div style="font-size:11px;color:var(--gris-calido);margin-top:2px;">${vacasActivas.length} vacas/novillas + ${criasActivas.length} crÃ­as activas</div>
    </div>

    <!-- CARNE CRÃAS / ha -->
    <div class="card" style="border-left:4px solid var(--sol);padding:18px 20px;">
      <div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gris-calido);margin-bottom:6px;">ğŸ® Carne en CrÃ­as / ha</div>
      <div style="font-size:28px;font-weight:800;color:var(--sol);">${fNum(kgCriasPorHa,1)} <span style="font-size:14px;font-weight:500;">kg PV/ha</span></div>
      <div style="font-size:12px;color:var(--texto-medio);margin-top:4px;">Peso vivo crÃ­as: ${fNum(kgCriasVivo)} kg Â· ${criasActivas.length} terneros/as</div>
      <div style="font-size:11px;color:var(--gris-calido);margin-top:2px;">Pesares cada 45 dÃ­as â€” ver detalle abajo</div>
    </div>

    <!-- CARNE DESCARTE / ha -->
    <div class="card" style="border-left:4px solid var(--rojo);padding:18px 20px;">
      <div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gris-calido);margin-bottom:6px;">ğŸ“¤ Descarte vendido / ha</div>
      <div style="font-size:28px;font-weight:800;color:var(--rojo);">${fNum(kgDescartePorHa,1)} <span style="font-size:14px;font-weight:500;">kg/ha</span></div>
      <div style="font-size:12px;color:var(--texto-medio);margin-top:4px;">Total vendido: ${fNum(kgDescarte)} kg (registros con peso)</div>
      <div style="font-size:11px;color:var(--gris-calido);margin-top:2px;">CrÃ­as + descarte: ${fNum(kgCriasPorHa+kgDescartePorHa,1)} kg/ha</div>
    </div>
  </div>

  <!-- â”€â”€ SECCIÃ“N EXCLUSIVA: CARNE PRODUCIDA EN CRÃAS â”€â”€â”€â”€ -->
  <div class="card" style="margin-bottom:16px;border:2px solid var(--sol);">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
      <span style="font-size:22px;">ğŸ®</span>
      <div>
        <div class="card-title" style="margin:0;color:var(--sol);">ProducciÃ³n de Carne en CrÃ­as â€” Pesares cada 45 dÃ­as</div>
        <div style="font-size:11px;color:var(--gris-calido);">Ãšltimos 45 dÃ­as Â· ${fNum(kgCriasVivo)} kg PV total Â· ${fNum(kgCriasPorHa,1)} kg/ha Â· ${criasActivas.length} crÃ­as activas</div>
      </div>
    </div>
    <div class="tbl-wrap">
      <table>
        <thead><tr>
          <th>ID CrÃ­a</th><th>CategorÃ­a</th><th>Fecha Ãºlt. pesaje</th>
          <th>Peso actual</th><th>Peso anterior</th><th>GMC</th><th>Intervalo</th>
        </tr></thead>
        <tbody>${filasGmc}</tbody>
      </table>
    </div>
    <div style="margin-top:10px;font-size:11px;color:var(--gris-calido);padding:8px 12px;background:var(--pasto-suave);border-radius:8px;">
      ğŸ’¡ <strong>GMC</strong> = Ganancia Media de Crecimiento (g/dÃ­a). Se calcula entre los dos Ãºltimos pesares registrados en Control de Peso.
      Registre pesares en el mÃ³dulo <em>Control de Peso</em> cada 45 dÃ­as para mantener este indicador actualizado.
    </div>
  </div>

  <!-- â”€â”€ TABLA ANIMALES DE DESCARTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="card" style="margin-bottom:16px;">
    <div class="card-title">ğŸ“¤ Animales de Descarte Vendidos</div>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>ID</th><th>Nombre</th><th>CategorÃ­a</th><th>Peso salida</th><th>ObservaciÃ³n</th></tr></thead>
        <tbody>${filasDescarte}</tbody>
      </table>
    </div>
  </div>

  <!-- â”€â”€ RESUMEN POR SECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="card">
    <div class="card-title">ğŸ“ Resumen por Sector</div>
    <div class="tbl-wrap">
      <table>
        <thead><tr><th>Sector</th><th>Ha</th><th>Potreros</th><th>Leche kg/ha/aÃ±o</th><th>Carga kg PV/ha</th><th>Carne CrÃ­as kg/ha</th><th>Descarte kg/ha</th></tr></thead>
        <tbody>
          <tr>
            <td class="fw7" style="color:var(--pasto);">La Casa</td>
            <td>${HA_CASA}</td><td>12</td>
            <td>${fNum(+(litrosPorHa*(HA_TOTAL/HA_CASA)/1).toFixed(1))}</td>
            <td>${fNum(kgHaTotal,1)}</td>
            <td>${fNum(kgCriasPorHa,1)}</td>
            <td>${fNum(kgDescartePorHa,1)}</td>
          </tr>
          <tr>
            <td class="fw7" style="color:var(--sol);">RincÃ³n</td>
            <td>~${fNum(HA_RINCON,1)}</td><td>10</td>
            <td>${fNum(litrosPorHa,1)}</td>
            <td>${fNum(kgHaTotal,1)}</td>
            <td>${fNum(kgCriasPorHa,1)}</td>
            <td>${fNum(kgDescartePorHa,1)}</td>
          </tr>
          <tr>
            <td class="fw7" style="color:var(--tierra);">La Herencia</td>
            <td>${HA_HERENCIA}</td><td>2</td>
            <td>${fNum(litrosPorHa,1)}</td>
            <td>${fNum(kgHaTotal,1)}</td>
            <td>${fNum(kgCriasPorHa,1)}</td>
            <td>${fNum(kgDescartePorHa,1)}</td>
          </tr>
          <tr style="background:var(--pasto-suave);font-weight:700;">
            <td>TOTAL FINCA</td>
            <td>43</td><td>24</td>
            <td style="color:var(--cielo);">${fNum(litrosPorHa,1)} kg/ha/aÃ±o</td>
            <td style="color:var(--pasto);">${fNum(kgHaTotal,1)} kg/ha</td>
            <td style="color:var(--sol);">${fNum(kgCriasPorHa,1)} kg/ha</td>
            <td style="color:var(--rojo);">${fNum(kgDescartePorHa,1)} kg/ha</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MÃ“DULO LOTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Estructura de un lote:
// { id, numero, nombre, obs,
//   miembros: [{animalId, fechaIngreso, fechaSalida, obs}],
//   movimientos: [{potrero, fechaEntrada, fechaSalida, lecheTotal}]
// }
// El potrero actual = Ãºltimo movimiento sin fechaSalida

let _loteModal = null;   // id del lote activo en cualquier modal

// â”€â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function lotePotreroActual(lote) {
  const mv = (lote.movimientos||[]).slice().reverse().find(m=>!m.fechaSalida);
  return mv ? mv.potrero : null;
}
function loteMiembrosActivos(lote) {
  return (lote.miembros||[]).filter(m=>!m.fechaSalida);
}
function selPotreros(selectedNombre) {
  return '<option value="">â€” Sin potrero â€”</option>' +
    praderas.filter(p=>p.sector!==undefined).map(p=>
      `<option value="${p.nombre}"${p.nombre===selectedNombre?' selected':''}>${p.nombre} (${p.area} ha)</option>`
    ).join('');
}
// Leche producida por un conjunto de animales entre dos fechas
function lechePeriodo(animalIds, fechaDesde, fechaHasta) {
  if(!fechaDesde) return 0;
  const ids = new Set(animalIds);
  const d0 = new Date(fechaDesde+'T00:00:00');
  const d1 = fechaHasta ? new Date(fechaHasta+'T00:00:00') : new Date();
  return registrosLeche
    .filter(r => ids.has(r.animalId) && new Date(r.fecha+'T00:00:00') >= d0 && new Date(r.fecha+'T00:00:00') <= d1)
    .reduce((s,r) => s + (r.total||0), 0);
}

// â”€â”€â”€ CREAR LOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModalNuevoLote() {
  const nextNum = lotes.length ? Math.max(...lotes.map(l=>l.numero||0))+1 : 1;
  document.getElementById('lote-numero').value   = nextNum;
  document.getElementById('lote-nombre').value   = '';
  document.getElementById('lote-obs').value      = '';
  document.getElementById('lote-fecha-creacion').value = hoy();
  openModal('modalNuevoLote');
}
function guardarNuevoLote() {
  const num  = +document.getElementById('lote-numero').value || 1;
  const nom  = document.getElementById('lote-nombre').value.trim();
  if(!nom){ toast('Ingresa un nombre para el lote','error'); return; }
  lotes.push({
    id: Date.now(), numero: num, nombre: nom,
    obs: document.getElementById('lote-obs').value,
    fechaCreacion: document.getElementById('lote-fecha-creacion').value,
    miembros: [], movimientos: []
  });
  persist(); closeModal('modalNuevoLote');
  toast(`Lote ${num} â€” ${nom} creado âœ”`); renderLotes();
}

// â”€â”€â”€ ASIGNAR POTRERO AL LOTE (mover) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirMoverLote(loteId) {
  _loteModal = loteId;
  const lote = lotes.find(l=>l.id===loteId); if(!lote) return;
  const potActual = lotePotreroActual(lote);
  document.getElementById('mv-titulo').textContent = `Mover Lote ${lote.numero}: ${lote.nombre}`;
  document.getElementById('mv-potrero').innerHTML = selPotreros(potActual);
  document.getElementById('mv-fecha').value = hoy();
  document.getElementById('mv-obs').value   = '';
  openModal('modalMoverLote');
}
function confirmarMoverLote() {
  const lote = lotes.find(l=>l.id===_loteModal); if(!lote) return;
  const nuevoPot = document.getElementById('mv-potrero').value;
  const fecha    = document.getElementById('mv-fecha').value;
  if(!nuevoPot){ toast('Selecciona un potrero','error'); return; }
  if(!fecha)   { toast('Ingresa la fecha','error'); return; }
  // Cerrar movimiento anterior y calcular leche producida en ese perÃ­odo
  const mvs = lote.movimientos||[];
  const ultimo = mvs.slice().reverse().find(m=>!m.fechaSalida);
  if(ultimo) {
    ultimo.fechaSalida = fecha;
    const ids = loteMiembrosActivos(lote).map(m=>m.animalId);
    ultimo.lecheTotal = lechePeriodo(ids, ultimo.fechaEntrada, fecha);
  }
  // Nuevo movimiento
  mvs.push({ potrero: nuevoPot, fechaEntrada: fecha, fechaSalida: null, obs: document.getElementById('mv-obs').value, lecheTotal: 0 });
  lote.movimientos = mvs;
  // Actualizar campo potrero en cada animal activo del lote
  loteMiembrosActivos(lote).forEach(m=>{
    const a = animales.find(x=>x.id===m.animalId);
    if(a) a.potrero = nuevoPot;
  });
  persist(); closeModal('modalMoverLote');
  toast(`Lote movido a ${nuevoPot} âœ”`); renderLotes();
}

// â”€â”€â”€ INGRESAR ANIMAL AL LOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirIngresarAnimal(loteId) {
  _loteModal = loteId;
  const lote = lotes.find(l=>l.id===loteId); if(!lote) return;
  const yaEnLote = new Set(loteMiembrosActivos(lote).map(m=>m.animalId));
  const disponibles = animales.filter(a=>a.estado!=='baja' && !yaEnLote.has(a.id))
                              .sort((a,b)=>a.id.localeCompare(b.id));
  document.getElementById('ing-titulo').textContent = `Ingresar animal â€” Lote ${lote.numero}: ${lote.nombre}`;
  document.getElementById('ing-animal').innerHTML =
    '<option value="">â€” Selecciona animal â€”</option>' +
    disponibles.map(a=>`<option value="${a.id}">${a.id} â€” ${a.nombre||a.categoria}</option>`).join('');
  document.getElementById('ing-fecha').value = hoy();
  document.getElementById('ing-obs').value   = '';
  openModal('modalIngresarAnimal');
}
function confirmarIngresarAnimal() {
  const lote = lotes.find(l=>l.id===_loteModal); if(!lote) return;
  const aid  = document.getElementById('ing-animal').value;
  const fecha= document.getElementById('ing-fecha').value;
  if(!aid)  { toast('Selecciona un animal','error'); return; }
  if(!fecha){ toast('Ingresa la fecha','error'); return; }
  lote.miembros.push({ animalId:aid, fechaIngreso:fecha, fechaSalida:null, obs:document.getElementById('ing-obs').value });
  // Asignar potrero actual del lote al animal
  const potActual = lotePotreroActual(lote);
  if(potActual){ const a = animales.find(x=>x.id===aid); if(a) a.potrero = potActual; }
  persist(); closeModal('modalIngresarAnimal');
  toast(`${aid} ingresado al lote âœ”`); renderLotes();
}

// â”€â”€â”€ INGRESAR GRUPO AL LOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirIngresarGrupo(loteId) {
  _loteModal = loteId;
  const lote = lotes.find(l=>l.id===loteId); if(!lote) return;
  const yaEnLote = new Set(loteMiembrosActivos(lote).map(m=>m.animalId));
  const disponibles = animales.filter(a=>a.estado!=='baja' && !yaEnLote.has(a.id))
                              .sort((a,b)=>a.id.localeCompare(b.id));
  document.getElementById('grp-titulo').textContent = `Ingresar grupo â€” Lote ${lote.numero}: ${lote.nombre}`;
  document.getElementById('grp-fecha').value = hoy();
  document.getElementById('grp-obs').value   = '';
  document.getElementById('grp-lista').innerHTML = disponibles.length
    ? disponibles.map(a=>`
        <label style="display:flex;align-items:center;gap:8px;padding:6px 4px;border-bottom:1px solid var(--borde);cursor:pointer;font-size:13px;">
          <input type="checkbox" value="${a.id}" style="width:16px;height:16px;flex-shrink:0;">
          <span class="fw7" style="min-width:58px;">${a.id}</span>
          <span style="flex:1;color:#555;">${a.nombre||'â€”'}</span>
          <span class="tag tag-gris" style="font-size:10px;">${a.categoria}</span>
        </label>`).join('')
    : '<div style="padding:16px;color:#aaa;text-align:center;">Sin animales disponibles para agregar</div>';
  openModal('modalIngresarGrupo');
}
function confirmarIngresarGrupo() {
  const lote = lotes.find(l=>l.id===_loteModal); if(!lote) return;
  const fecha = document.getElementById('grp-fecha').value;
  const obs   = document.getElementById('grp-obs').value;
  if(!fecha){ toast('Ingresa la fecha','error'); return; }
  const sel = [...document.querySelectorAll('#grp-lista input:checked')].map(c=>c.value);
  if(!sel.length){ toast('Selecciona al menos un animal','error'); return; }
  const potActual = lotePotreroActual(lote);
  sel.forEach(aid=>{
    lote.miembros.push({ animalId:aid, fechaIngreso:fecha, fechaSalida:null, obs });
    if(potActual){ const a = animales.find(x=>x.id===aid); if(a) a.potrero = potActual; }
  });
  persist(); closeModal('modalIngresarGrupo');
  toast(`${sel.length} animal(es) ingresado(s) âœ”`); renderLotes();
}

// â”€â”€â”€ SACAR ANIMAL DEL LOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _sacarLoteId=null, _sacarAnimId=null;
function abrirSacarAnimal(loteId, animalId) {
  _sacarLoteId=loteId; _sacarAnimId=animalId;
  const a = animales.find(x=>x.id===animalId);
  document.getElementById('sal-anim-titulo').textContent = `Salida del lote â€” ${animalId} ${a?.nombre||''}`;
  document.getElementById('sal-anim-fecha').value = hoy();
  document.getElementById('sal-anim-obs').value   = '';
  openModal('modalSalidaAnimal');
}
function confirmarSacarAnimal() {
  const lote = lotes.find(l=>l.id===_sacarLoteId); if(!lote) return;
  const m = lote.miembros.find(x=>x.animalId===_sacarAnimId && !x.fechaSalida);
  if(m){ m.fechaSalida=document.getElementById('sal-anim-fecha').value; m.obsSalida=document.getElementById('sal-anim-obs').value; }
  persist(); closeModal('modalSalidaAnimal');
  toast('Salida registrada âœ”'); renderLotes();
}

// â”€â”€â”€ ELIMINAR LOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function eliminarLote(loteId) {
  confirmarEliminar(()=>{ lotes=lotes.filter(l=>l.id!==loteId); persist(); toast('Lote eliminado'); renderLotes(); },
    'Â¿Eliminar este lote?');
}

// â”€â”€â”€ RENDER PRINCIPAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLotes() {
  const totalEnLote = new Set(lotes.flatMap(l=>loteMiembrosActivos(l).map(m=>m.animalId))).size;
  const sinLote = animales.filter(a=>a.estado!=='baja' && !lotes.some(l=>loteMiembrosActivos(l).some(m=>m.animalId===a.id))).length;
  document.getElementById('lotes-kpis').innerHTML = [
    {lbl:'Lotes',             val:lotes.length,    icon:'ğŸ“‹', color:'var(--pasto)'},
    {lbl:'Animales en lotes', val:totalEnLote,     icon:'ğŸ„', color:'var(--cielo)'},
    {lbl:'Sin lote asignado', val:sinLote,         icon:'â“', color:'var(--sol)'},
    {lbl:'Potreros ocupados', val:new Set(lotes.map(l=>lotePotreroActual(l)).filter(Boolean)).size, icon:'ğŸŒ¿', color:'var(--tierra)'},
  ].map(k=>`<div class="kpi-card"><div class="kpi-card-accent" style="background:${k.color}"></div><div class="kpi-icon-bg">${k.icon}</div><div class="kpi-lbl">${k.lbl}</div><div class="kpi-val" style="color:${k.color}">${k.val}</div></div>`).join('');

  if(!lotes.length){
    document.getElementById('lotes-lista').innerHTML=`<div style="text-align:center;padding:48px;color:#aaa;"><div style="font-size:48px;">ğŸ„</div><div style="margin-top:10px;font-size:15px;">No hay lotes â€” usa <strong>+ Nuevo Lote</strong></div></div>`;
    return;
  }

  document.getElementById('lotes-lista').innerHTML = lotes.map(lote=>{
    const activos   = loteMiembrosActivos(lote);
    const potActual = lotePotreroActual(lote);
    const potObj    = potActual ? praderas.find(p=>p.nombre===potActual) : null;
    const mvActual  = (lote.movimientos||[]).slice().reverse().find(m=>!m.fechaSalida);
    const animActivos = activos.map(m=>animales.find(a=>a.id===m.animalId)).filter(Boolean);

    // Stats
    const pesoTotal   = animActivos.reduce((s,a)=>s+(a.peso||0),0);
    const pesoPromedio= animActivos.length ? Math.round(pesoTotal/animActivos.length) : 0;
    const litrosHoy   = animActivos.reduce((s,a)=>s+(a.litros||0),0);
    const cargaHa     = (potObj&&potObj.area>0) ? Math.round(pesoTotal/potObj.area) : null;

    // Leche perÃ­odo actual (desde entrada al potrero)
    const lecheActual = mvActual
      ? lechePeriodo(activos.map(m=>m.animalId), mvActual.fechaEntrada, null)
      : 0;
    const diasEnPot = mvActual
      ? Math.max(1, Math.round((new Date()-new Date(mvActual.fechaEntrada+'T00:00:00'))/86400000))
      : 0;

    // Historial potreros
    const mvsTodos = lote.movimientos||[];
    const histKey  = 'hist_open_'+lote.id;
    if(window[histKey]===undefined) window[histKey] = false;
    const histAbierto = window[histKey];

    const histHtml = mvsTodos.length ? `
      <div style="margin-top:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;cursor:pointer;padding:6px 0;"
             onclick="window['${histKey}']=!window['${histKey}'];renderLotes()">
          <div style="font-size:11px;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:.5px;">
            ğŸ“ Historial de rotaciÃ³n (${mvsTodos.length} movimientos)
          </div>
          <span style="font-size:13px;color:#aaa">${histAbierto?'â–²':'â–¼'}</span>
        </div>
        ${histAbierto ? `
        <div class="tbl-wrap">
          <table style="font-size:11px;border-collapse:collapse;width:100%">
            <thead><tr style="background:var(--pasto-suave)">
              <th style="padding:4px 8px;text-align:left">#</th>
              <th style="padding:4px 8px;text-align:left">Potrero</th>
              <th style="padding:4px 8px;text-align:center">Entrada</th>
              <th style="padding:4px 8px;text-align:center">Salida</th>
              <th style="padding:4px 8px;text-align:right">DÃ­as</th>
              <th style="padding:4px 8px;text-align:right">ğŸ¥› Leche</th>
              <th style="padding:4px 8px;text-align:left">Obs</th>
            </tr></thead>
            <tbody>
              ${mvsTodos.map((mv,i)=>{
                const activo = !mv.fechaSalida;
                const dias = mv.fechaEntrada
                  ? activo
                    ? Math.round((new Date()-new Date(mv.fechaEntrada+'T00:00:00'))/86400000)
                    : Math.round((new Date(mv.fechaSalida)-new Date(mv.fechaEntrada+'T00:00:00'))/86400000)
                  : 'â€”';
                const leche = mv.lecheTotal||0;
                return `<tr style="border-bottom:1px solid var(--borde);background:${activo?'var(--pasto-suave)':''}">
                  <td style="padding:4px 8px;color:#aaa">${i+1}</td>
                  <td style="padding:4px 8px;font-weight:${activo?700:400};color:${activo?'var(--pasto)':'var(--texto)'}">${mv.potrero}${activo?' <span style="background:var(--pasto);color:#fff;border-radius:3px;padding:0 3px;font-size:9px">HOY</span>':''}</td>
                  <td style="padding:4px 8px;text-align:center;color:var(--pasto)">${mv.fechaEntrada||'â€”'}</td>
                  <td style="padding:4px 8px;text-align:center;color:var(--tierra)">${mv.fechaSalida||'â€”'}</td>
                  <td style="padding:4px 8px;text-align:right">${typeof dias==='number'?dias+'d':'â€”'}</td>
                  <td style="padding:4px 8px;text-align:right;color:var(--cielo)">${leche>0?fNum(leche,0)+' L':'â€”'}</td>
                  <td style="padding:4px 8px;color:#aaa">${mv.obs||''}</td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>
        </div>` : ''}
      </div>` : '';

    // Tabla animales
    const tablaHtml = `
      <div style="margin-top:14px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;flex-wrap:wrap;gap:6px;">
          <div style="font-size:11px;font-weight:700;color:#888;text-transform:uppercase;">ğŸ„ Animales (${activos.length} activos Â· ${lote.miembros.filter(m=>m.fechaSalida).length} histÃ³rico)</div>
          <div style="display:flex;gap:6px;">
            <button class="btn btn-primary btn-sm" onclick="abrirIngresarAnimal(${lote.id})">+ Animal</button>
            <button class="btn btn-ghost btn-sm" onclick="abrirIngresarGrupo(${lote.id})">+ Grupo</button>
          </div>
        </div>
        ${activos.length ? `<div class="tbl-wrap"><table style="font-size:12px;border-collapse:collapse;width:100%">
          <thead><tr style="background:var(--pasto-suave)">
            <th style="padding:5px 8px;text-align:left">ID</th>
            <th style="padding:5px 8px;text-align:left">Nombre</th>
            <th style="padding:5px 8px;text-align:left">Categ.</th>
            <th style="padding:5px 8px;text-align:right">Peso</th>
            <th style="padding:5px 8px;text-align:right">L/dÃ­a</th>
            <th style="padding:5px 8px;text-align:center">ğŸ“… Ingreso</th>
            <th style="padding:5px 8px;text-align:center">Salida</th>
          </tr></thead><tbody>
          ${activos.map(m=>{
            const a=animales.find(x=>x.id===m.animalId);
            if(!a) return `<tr><td colspan="7" style="padding:4px 8px;color:#aaa">Animal ${m.animalId} no encontrado</td></tr>`;
            return `<tr style="border-bottom:1px solid var(--borde)">
              <td style="padding:5px 8px" class="fw7">${a.id}</td>
              <td style="padding:5px 8px">${a.nombre||'â€”'}</td>
              <td style="padding:5px 8px">${a.categoria}</td>
              <td style="padding:5px 8px;text-align:right">${a.peso?fNum(a.peso)+' kg':'â€”'}</td>
              <td style="padding:5px 8px;text-align:right;color:var(--cielo)">${a.litros?fNum(a.litros,1)+' kg':'â€”'}</td>
              <td style="padding:5px 8px;text-align:center;color:var(--pasto);font-weight:600">${m.fechaIngreso||'â€”'}</td>
              <td style="padding:5px 8px;text-align:center"><button class="btn btn-ghost btn-sm" style="font-size:10px" onclick="abrirSacarAnimal(${lote.id},'${a.id}')">â†’ Salida</button></td>
            </tr>`;
          }).join('')}
          </tbody></table></div>`
        : `<div style="color:#aaa;font-size:12px;padding:12px 4px">Sin animales â€” usa <strong>+ Animal</strong> o <strong>+ Grupo</strong></div>`}
      </div>`;

    const cerrado = activos.length === 0 && lote.miembros.length > 0;
    const borderColor = cerrado ? '#ccc' : 'var(--pasto)';

    return `<div class="card" style="margin-bottom:16px;border-left:5px solid ${borderColor};${cerrado?'opacity:0.75':''}">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:8px">
        <div>
          <span style="font-size:20px;font-weight:800;color:${cerrado?'#aaa':'var(--pasto)'}">Lote ${lote.numero}</span>
          <span style="font-size:16px;font-weight:700;margin-left:8px">${lote.nombre}</span>
          ${cerrado
            ? `<span class="tag tag-gris" style="margin-left:8px;font-size:11px">ğŸ“¦ HistÃ³rico / Cerrado</span>`
            : potActual
              ? `<span class="tag tag-verde" style="margin-left:8px;font-size:11px">ğŸ“ ${potActual}</span>`
              : `<span class="tag tag-gris" style="margin-left:8px;font-size:11px">Sin potrero</span>`}
        </div>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          <button class="btn btn-primary btn-sm" onclick="abrirMoverLote(${lote.id})">ğŸŒ¿ ${potActual?'Mover potrero':'Asignar potrero'}</button>
          <button class="btn btn-ghost btn-sm btn-icon" onclick="eliminarLote(${lote.id})">ğŸ—‘</button>
        </div>
      </div>
      <!-- KPIs del lote -->
      <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:12px">
        <div style="background:var(--fondo);border-radius:8px;padding:8px 14px;min-width:100px">
          <div style="font-size:10px;color:#888;text-transform:uppercase">Animales</div>
          <div style="font-size:22px;font-weight:800;color:var(--pasto)">${activos.length}</div>
        </div>
        <div style="background:var(--fondo);border-radius:8px;padding:8px 14px;min-width:100px">
          <div style="font-size:10px;color:#888;text-transform:uppercase">Peso total</div>
          <div style="font-size:22px;font-weight:800;color:var(--tierra)">${fNum(pesoTotal)} kg</div>
          <div style="font-size:10px;color:#aaa">Prom ${fNum(pesoPromedio)} kg</div>
        </div>
        <div style="background:var(--fondo);border-radius:8px;padding:8px 14px;min-width:100px">
          <div style="font-size:10px;color:#888;text-transform:uppercase">Leche hoy</div>
          <div style="font-size:22px;font-weight:800;color:var(--cielo)">${fNum(litrosHoy,1)} kg</div>
        </div>
        ${cargaHa!==null?`<div style="background:var(--fondo);border-radius:8px;padding:8px 14px;min-width:100px">
          <div style="font-size:10px;color:#888;text-transform:uppercase">Carga</div>
          <div style="font-size:22px;font-weight:800;color:var(--sol)">${cargaHa} kg/ha</div>
          <div style="font-size:10px;color:#aaa">${potObj.area} ha</div>
        </div>`:''}
        ${mvActual&&lecheActual>0?`<div style="background:#e3f4fd;border-radius:8px;padding:8px 14px;min-width:120px;border:1px solid var(--cielo)">
          <div style="font-size:10px;color:var(--cielo);text-transform:uppercase">ğŸ¥› Leche en potrero</div>
          <div style="font-size:22px;font-weight:800;color:var(--cielo)">${fNum(lecheActual,0)} L</div>
          <div style="font-size:10px;color:#aaa">${diasEnPot} dÃ­as en ${potActual}</div>
        </div>`:''}
      </div>
      ${histHtml}
      ${tablaHtml}
      ${lote.obs?`<div style="margin-top:10px;font-size:11px;color:#888;padding:6px 8px;background:var(--fondo);border-radius:6px">ğŸ’¬ ${lote.obs}</div>`:''}
    </div>`;
  }).join('');
}
// â”€â”€ Switch Ocupar / Descanso â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function togglePotreroSwitch(id, checkbox) {
  const p = praderas.find(x=>x.id===id);
  if(!p) return;
  const fechaInput = document.getElementById('pot-fecha-'+id);
  const fecha = (fechaInput && fechaInput.value) ? fechaInput.value : hoy();
  if(checkbox.checked) {
    if(p.ultimaSalida) {
      const dias = Math.round((new Date(fecha)-new Date(p.ultimaSalida))/86400000);
      p.diasDescanso = dias > 0 ? dias : 0;
    }
    p.estado = 'Ocupado'; p.fechaEntrada = fecha; p.fechaSalida = null;
  } else {
    if(p.fechaEntrada) {
      const dias = Math.round((new Date(fecha)-new Date(p.fechaEntrada))/86400000);
      p.diasOcupado = dias > 0 ? dias : (p.diasOcupado||0);
    }
    p.estado = 'Descanso'; p.fechaSalida = fecha; p.ultimaSalida = fecha;
  }
  persist();
  toast(`${p.nombre} â†’ ${checkbox.checked?'Ocupado':'Descanso'} (${fecha}) âœ”`);
  renderPraderas();
}

function deletePotrero(id) { praderas=praderas.filter(p=>p.id!==id); persist(); toast('Potrero eliminado'); renderPraderas(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SECADOS / DESTETES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeSecadoTab = 'secados';

function setSecadoTab(tab) {
  activeSecadoTab = tab;
  ['secados','destetes','histsecados'].forEach(t => {
    const btn = document.getElementById(`stab-${t}`);
    const panel = document.getElementById(`secados-panel-${t}`);
    if(btn) { btn.style.color = t===tab?'var(--pasto)':'var(--gris-calido)'; btn.style.fontWeight = t===tab?'600':'500'; btn.style.borderBottom = t===tab?'2px solid var(--pasto)':'2px solid transparent'; }
    if(panel) panel.style.display = t===tab?'block':'none';
  });
  renderSecados();
}

function renderSecados() {
  // KPIs
  const secs = secados.filter(s=>s.tipo==='secado');
  const dests = secados.filter(s=>s.tipo==='destete');
  const pesoMadProm = dests.length ? Math.round(dests.reduce((a,d)=>a+(+d.pesoMadre||0),0)/dests.length) : 0;
  const pesoCriaProm = dests.length ? Math.round(dests.reduce((a,d)=>a+(+d.pesoCria||0),0)/dests.length) : 0;
  const kEl = document.getElementById('secados-kpis');
  if(kEl) kEl.innerHTML = `
    <div class="kpi-card"><div class="kpi-val">${secs.length}</div><div class="kpi-lbl">Secados registrados</div></div>
    <div class="kpi-card"><div class="kpi-val">${dests.length}</div><div class="kpi-lbl">Destetes registrados</div></div>
    <div class="kpi-card"><div class="kpi-val">${pesoMadProm ? pesoMadProm+' kg' : 'â€”'}</div><div class="kpi-lbl">Peso madre prom. al destete</div></div>
    <div class="kpi-card"><div class="kpi-val">${pesoCriaProm ? pesoCriaProm+' kg' : 'â€”'}</div><div class="kpi-lbl">Peso crÃ­a prom. al destete</div></div>
  `;

  if(activeSecadoTab==='secados') renderSecadosTabla();
  if(activeSecadoTab==='destetes') renderDesteteTabla();
  if(activeSecadoTab==='histsecados') renderSecadosAnalisis();
}

function renderSecadosTabla() {
  const secs = secados.filter(s=>s.tipo==='secado').sort((a,b)=>b.fecha.localeCompare(a.fecha));
  const tb = document.getElementById('secados-tbody');
  if(!tb) return;
  if(!secs.length) { tb.innerHTML = `<tr><td colspan="8" style="text-align:center;color:var(--gris-calido);padding:24px;">Sin registros de secado. Usa "+ Registrar Secado" para ingresar.</td></tr>`; return; }
  tb.innerHTML = secs.map(s => {
    const diasOrdeno = s.diasOrdeno ? `<span class="tag tag-verde">${s.diasOrdeno}d</span>` : 'â€”';
    const partoEst = s.partoEstimado ? `<span style="color:var(--cielo);">${s.partoEstimado}</span>` : 'â€”';
    return `<tr>
      <td>${s.fecha}</td>
      <td><strong>${s.vaca}</strong></td>
      <td>${s.pesoMadre ? fNum(s.pesoMadre)+' kg' : 'â€”'}</td>
      <td>${s.ultimaLeche ? s.ultimaLeche+' L/d' : 'â€”'}</td>
      <td>${diasOrdeno}</td>
      <td>${partoEst}</td>
      <td style="max-width:160px;font-size:.85rem;">${s.obs||'â€”'}</td>
      <td><button class="btn btn-ghost btn-sm" onclick="eliminarSecado(${s.id},'secado')">ğŸ—‘</button></td>
    </tr>`;
  }).join('');
}

function renderDesteteTabla() {
  const dests = secados.filter(s=>s.tipo==='destete').sort((a,b)=>b.fecha.localeCompare(a.fecha));
  const tb = document.getElementById('destetes-tbody');
  if(!tb) return;
  if(!dests.length) { tb.innerHTML = `<tr><td colspan="9" style="text-align:center;color:var(--gris-calido);padding:24px;">Sin registros de destete. Usa "+ Registrar Destete" para ingresar.</td></tr>`; return; }
  tb.innerHTML = dests.map(d => {
    const edadDias = d.nacimiento && d.fecha ? Math.round((new Date(d.fecha)-new Date(d.nacimiento))/(86400000)) : null;
    const edadStr = edadDias ? `${Math.floor(edadDias/30)}m ${edadDias%30}d` : 'â€”';
    return `<tr>
      <td>${d.fecha}</td>
      <td><strong>${d.madre}</strong></td>
      <td>${d.pesoMadre ? fNum(d.pesoMadre)+' kg' : 'â€”'}</td>
      <td>${d.cria||'â€”'}</td>
      <td>${d.pesoCria ? `<strong style="color:var(--pasto-vivo);">${fNum(d.pesoCria)} kg</strong>` : 'â€”'}</td>
      <td>${edadStr}</td>
      <td><span class="tag ${d.sexo==='Macho'?'tag-cielo':'tag-rojo'}">${d.sexo||'â€”'}</span></td>
      <td style="max-width:140px;font-size:.85rem;">${d.obs||'â€”'}</td>
      <td><button class="btn btn-ghost btn-sm" onclick="eliminarSecado(${d.id},'destete')">ğŸ—‘</button></td>
    </tr>`;
  }).join('');
}

function renderSecadosAnalisis() {
  const dests = secados.filter(s=>s.tipo==='destete');
  const el = document.getElementById('secados-resumen');
  if(!el) return;
  if(!dests.length) { el.innerHTML = '<p style="color:var(--gris-calido);padding:20px 0;">Sin datos de destetes para analizar.</p>'; return; }
  const pesoMadProm = Math.round(dests.reduce((a,d)=>a+(+d.pesoMadre||0),0)/dests.length);
  const pesoCriaProm = Math.round(dests.reduce((a,d)=>a+(+d.pesoCria||0),0)/dests.length);
  const machosN = dests.filter(d=>d.sexo==='Macho').length;
  const hembrasN = dests.filter(d=>d.sexo==='Hembra').length;
  const edadesD = dests.filter(d=>d.nacimiento&&d.fecha).map(d=>Math.round((new Date(d.fecha)-new Date(d.nacimiento))/86400000));
  const edadProm = edadesD.length ? Math.round(edadesD.reduce((a,b)=>a+b,0)/edadesD.length) : null;
  el.innerHTML = `
    <div class="kpi-grid kpi-4" style="margin-bottom:16px;">
      <div class="kpi-card"><div class="kpi-val">${pesoMadProm} kg</div><div class="kpi-lbl">Peso madre promedio</div></div>
      <div class="kpi-card"><div class="kpi-val">${pesoCriaProm} kg</div><div class="kpi-lbl">Peso crÃ­a promedio</div></div>
      <div class="kpi-card"><div class="kpi-val">${machosN} â™‚ / ${hembrasN} â™€</div><div class="kpi-lbl">DistribuciÃ³n por sexo</div></div>
      <div class="kpi-card"><div class="kpi-val">${edadProm ? edadProm+'d' : 'â€”'}</div><div class="kpi-lbl">Edad promedio al destete</div></div>
    </div>
    <table style="width:100%;border-collapse:collapse;font-size:.9rem;">
      <thead><tr style="background:var(--pasto-suave);">
        <th style="padding:8px;text-align:left;">Fecha</th>
        <th style="padding:8px;text-align:left;">Madre</th>
        <th style="padding:8px;text-align:left;">CrÃ­a</th>
        <th style="padding:8px;text-align:right;">Peso madre</th>
        <th style="padding:8px;text-align:right;">Peso crÃ­a</th>
        <th style="padding:8px;text-align:center;">Sexo</th>
        <th style="padding:8px;text-align:center;">Edad</th>
      </tr></thead>
      <tbody>
      ${dests.sort((a,b)=>b.fecha.localeCompare(a.fecha)).map(d=>{
        const dias = d.nacimiento&&d.fecha?Math.round((new Date(d.fecha)-new Date(d.nacimiento))/86400000):null;
        return `<tr style="border-bottom:1px solid var(--borde);">
          <td style="padding:6px 8px;">${d.fecha}</td>
          <td style="padding:6px 8px;">${d.madre}</td>
          <td style="padding:6px 8px;">${d.cria||'â€”'}</td>
          <td style="padding:6px 8px;text-align:right;">${d.pesoMadre?fNum(d.pesoMadre)+' kg':'â€”'}</td>
          <td style="padding:6px 8px;text-align:right;font-weight:600;color:var(--pasto-vivo);">${d.pesoCria?fNum(d.pesoCria)+' kg':'â€”'}</td>
          <td style="padding:6px 8px;text-align:center;">${d.sexo==='Macho'?'â™‚':'â™€'}</td>
          <td style="padding:6px 8px;text-align:center;">${dias?dias+'d':'â€”'}</td>
        </tr>`;
      }).join('')}
      </tbody>
    </table>`;
}

function guardarSecado() {
  const f = v('sec-fecha'), vaca = v('sec-vaca');
  if(!f||!vaca) { toast('Completa fecha y vaca âœ—','err'); return; }
  secados.push({
    id: Date.now(), tipo:'secado',
    fecha: f, vaca, pesoMadre: +v('sec-peso-madre')||null,
    ultimaLeche: +v('sec-ultima-leche')||null,
    diasOrdeno: +v('sec-dias-ordeno')||null,
    partoEstimado: v('sec-parto-estimado')||null,
    obs: v('sec-obs')
  });
  persist(); closeModal('modalSecado'); toast('Secado registrado âœ”');
  renderSecados();
}

function guardarDestete() {
  const f = v('dest-fecha'), madre = v('dest-madre');
  if(!f||!madre) { toast('Completa fecha y madre âœ—','err'); return; }
  secados.push({
    id: Date.now(), tipo:'destete',
    fecha: f, madre, pesoMadre: +v('dest-peso-madre')||null,
    cria: v('dest-cria'), pesoCria: +v('dest-peso-cria')||null,
    nacimiento: v('dest-nacimiento')||null,
    sexo: v('dest-sexo')||'Macho',
    obs: v('dest-obs')
  });
  persist(); closeModal('modalDestete'); toast('Destete registrado âœ”');
  renderSecados();
}

function eliminarSecado(id, tipo) {
  confirmarEliminar(()=>{
    secados = secados.filter(s=>s.id!==id);
    persist(); toast(`${tipo==='secado'?'Secado':'Destete'} eliminado`);
    renderSecados();
  }, `Â¿Eliminar este registro de ${tipo}?`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SIMULACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSimulacion() {
  const vacasP = animales.filter(a=>a.categoria==='Vaca'&&a.estado==='activa');
  const defVP = vacasP.length || 128;
  const defL = vacasP.length ? +(vacasP.reduce((s,a)=>s+a.litros,0)/vacasP.length).toFixed(0) : 30;

  const sliders = [
    {id:'sl-litros',lbl:'kg/vaca/dÃ­a (control lÃ¡cteo)',min:10,max:50,val:defL,unit:'kg'},
    {id:'sl-dias-ab',lbl:'DÃ­as abiertos prom.',min:80,max:280,val:142,unit:'d'},
    {id:'sl-vacas',lbl:'Vacas en producciÃ³n',min:30,max:250,val:defVP,unit:''},
    {id:'sl-precio',lbl:'Precio leche ($/L)',min:1000,max:3500,val:params.precio_leche,unit:''},
    {id:'sl-descarte',lbl:'Tasa de descarte (%)',min:5,max:35,val:15,unit:'%'},
    {id:'sl-mort',lbl:'Mortalidad (%)',min:0,max:12,val:2,unit:'%'},
    {id:'sl-natalidad',lbl:'Natalidad (%)',min:50,max:95,val:78,unit:'%'},
    {id:'sl-dias-leche',lbl:'DÃ­as en leche prom.',min:150,max:305,val:182,unit:'d'},
  ];

  document.getElementById('sim-controls').innerHTML = sliders.map(s=>`
    <div class="sim-row">
      <span class="sim-lbl">${s.lbl}</span>
      <input type="range" class="sim-slider" id="${s.id}" min="${s.min}" max="${s.max}" value="${s.val}" oninput="updateSim()">
      <span class="sim-val" id="${s.id}-val">${s.unit==='$'?'$':''}${fNum(s.val)}${s.unit!=='$'?s.unit:''}</span>
    </div>`).join('');

  updateSim();
}

function updateSim() {
  const g = id => +document.getElementById(id)?.value || 0;
  const sv = (id, v, unit='') => {
    const el = document.getElementById(id+'-val');
    if(el) el.textContent = (unit==='$'?'$':'')+fNum(v)+(unit!=='$'?unit:'');
  };
  const L = g('sl-litros');
  const da = g('sl-dias-ab');
  const VP = g('sl-vacas');
  const PL = g('sl-precio');
  const desc = g('sl-descarte');
  const mort = g('sl-mort');
  const natal = g('sl-natalidad');
  const DL = g('sl-dias-leche');

  sv('sl-litros',L,'kg'); sv('sl-dias-ab',da,'d'); sv('sl-vacas',VP,'');
  sv('sl-precio',PL,''); sv('sl-descarte',desc,'%'); sv('sl-mort',mort,'%');
  sv('sl-natalidad',natal,'%'); sv('sl-dias-leche',DL,'d');

  const prodMes = L * VP * 30;
  const ingMes = prodMes * PL;
  const costoEst = 45000000 + (VP * 180000);
  const utilidad = ingMes - costoEst;
  const costoL = prodMes > 0 ? Math.round(costoEst/prodMes) : 0;
  const tasaPreÃ±ez = Math.max(5, Math.min(35, 35 - (da-80)*0.07));
  const litrosLact = L * DL;
  const rentPct = ingMes > 0 ? ((utilidad/ingMes)*100).toFixed(1) : 0;
  const perdidasDA = da > 120 ? ((da-120)*VP*1800).toFixed(0) : 0;

  document.getElementById('sim-results').innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <div class="res-box"><div class="res-lbl">Ingreso mensual</div><div class="res-big">${fMon(ingMes)}</div></div>
      <div class="res-box" style="background:${utilidad>0?'var(--pasto-suave)':'var(--rojo-claro)'};border-color:${utilidad>0?'var(--pasto-medio)':'#fca5a5'};"><div class="res-lbl">Utilidad estimada</div><div class="res-big" style="color:${utilidad>0?'var(--pasto)':'var(--rojo)'};">${fMon(utilidad)}</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px;">
      <div class="ind-card"><div class="ind-val c-verde">${rentPct}%</div><div class="ind-lbl">Rentabilidad</div></div>
      <div class="ind-card"><div class="ind-val c-sol">${fMon(costoL)}</div><div class="ind-lbl">Costo/litro</div></div>
      <div class="ind-card"><div class="ind-val c-cielo">${tasaPreÃ±ez.toFixed(1)}%</div><div class="ind-lbl">Tasa preÃ±ez est.</div></div>
    </div>
    ${+perdidasDA>0?`<div style="background:#fff7ed;border:1px solid #fed7aa;border-radius:10px;padding:12px;margin-top:10px;font-size:12.5px;"><span style="font-weight:700;color:#c2410c;">âš  PÃ©rdidas por dÃ­as abiertos extras:</span> <span style="font-weight:700;">${fMon(+perdidasDA)}/mes</span><br><span class="muted">Reducir dÃ­as abiertos de ${da} a 120 generarÃ­a este ahorro.</span></div>`:''}
    <div style="background:var(--crema);border-radius:10px;padding:14px;margin-top:10px;">
      <div style="font-weight:700;font-size:13px;margin-bottom:10px;">ğŸ“Š AnÃ¡lisis de sensibilidad Â±10%</div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;font-size:12px;text-align:center;">
        <div><div style="color:var(--rojo);font-weight:700;">-10%: ${fMon(ingMes*.9-costoEst)}</div><div class="muted">Escenario bajo</div></div>
        <div><div style="color:var(--pasto);font-weight:700;">Base: ${fMon(utilidad)}</div><div class="muted">Actual</div></div>
        <div><div style="color:var(--cielo);font-weight:700;">+10%: ${fMon(ingMes*1.1-costoEst)}</div><div class="muted">Escenario alto</div></div>
      </div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALERTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getAlertas() {
  const alertas = [];
  // Sin pesar > 21 dÃ­as
  animales.forEach(a=>{
    const up = registrosPeso.find(p=>p.animalId===a.id);
    const dias = up ? Math.floor((Date.now()-new Date(up.fecha+'T00:00:00').getTime())/86400000) : 999;
    if(dias>21) alertas.push({tipo:'urgente',texto:`${a.id} â€” Sin control de peso hace ${dias} dÃ­as`,sub:a.nombre,animal:a.id});
  });
  // En tratamiento
  eventosS.filter(e=>e.estado==='En tratamiento').forEach(e=>{
    alertas.push({tipo:'urgente',texto:`${e.animalId} â€” En tratamiento: ${e.diagnostico}`,sub:`Inicio: ${e.fecha}`,animal:e.animalId});
  });
  // Retiro de leche activo
  eventosS.filter(e=>e.fechaRetiroLeche&&e.fechaRetiroLeche>=hoy()).forEach(e=>{
    alertas.push({tipo:'media',texto:`${e.animalId} â€” Retiro de leche hasta ${e.fechaRetiroLeche}`,sub:e.diagnostico});
  });
  // Gestantes sin servicio registrado
  animales.filter(a=>a.estado==='gestante').forEach(a=>{
    const serv = servicios.find(s=>s.animalId===a.id&&s.diagnostico==='preÃ±ada');
    if(!serv) alertas.push({tipo:'media',texto:`${a.id} â€” Gestante sin servicio registrado`,sub:a.nombre});
  });
  // ProducciÃ³n baja
  animales.filter(a=>a.estado==='activa'&&a.categoria==='Vaca'&&a.litros>0&&a.litros<15).forEach(a=>{
    alertas.push({tipo:'media',texto:`${a.id} â€” ProducciÃ³n baja: ${a.litros}kg/dÃ­a`,sub:a.nombre});
  });
  // Info: novillas para servicio
  const novillasListas = animales.filter(a=>a.categoria==='Novilla'&&a.peso>=320);
  if(novillasListas.length>0) alertas.push({tipo:'info',texto:`${novillasListas.length} novillas con peso â‰¥320kg listas para servicio`,sub:'Revisar condiciÃ³n corporal'});
  return alertas;
}

function renderAlertas() {
  const alertas = getAlertas();
  const urg = alertas.filter(a=>a.tipo==='urgente');
  const med = alertas.filter(a=>a.tipo==='media');
  const inf = alertas.filter(a=>a.tipo==='info');
  const render = arr => arr.length ? arr.map(a=>`<div class="alert-item alert-${a.tipo}"><div class="alert-dot ad-${a.tipo==='urgente'?'rojo':a.tipo==='media'?'amarillo':'verde'}"></div><div class="alert-body"><div>${a.texto}</div><div class="alert-time">${a.sub||''}</div></div>${a.animal?`<button class="btn btn-ghost btn-sm" onclick="verHoja('${a.animal}')">Ver</button>`:''}</div>`).join('') : '<div class="muted text-sm" style="padding:10px;">Sin alertas en esta categorÃ­a ğŸ‰</div>';
  document.getElementById('alertas-urgentes').innerHTML = render(urg);
  document.getElementById('alertas-medias').innerHTML = render(med);
  document.getElementById('alertas-info').innerHTML = render(inf);
  document.getElementById('badge-alertas').textContent = urg.length+med.length;
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GENEALOGÃA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGenealogiaAnimal(animalId) {
  const animal = animales.find(a=>a.id===animalId);
  if(!animal) return '';
  
  const gen = animal.genealogia || {padre:'',madre:'',abuelos:{paternos:{padre:'',madre:''},maternos:{padre:'',madre:''}}};
  const padre = animales.find(a=>a.id===gen.padre);
  const madre = animales.find(a=>a.id===gen.madre);
  
  return `
    <div style="background:var(--crema);border-radius:10px;padding:15px;margin-top:15px;">
      <div style="font-weight:700;margin-bottom:12px;font-size:13px;">ğŸ§¬ GenealogÃ­a</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;font-size:12px;">
        <div>
          <div style="font-weight:600;color:var(--pasto);margin-bottom:6px;">Padre</div>
          <div class="mono" style="background:#fff;padding:8px;border-radius:6px;border-left:3px solid var(--pasto);">
            ${gen.padre ? `<strong>${gen.padre}</strong><br><small>${padre?.nombre||'â€”'}</small>` : '<span class="muted">Sin registro</span>'}
          </div>
        </div>
        <div>
          <div style="font-weight:600;color:var(--cielo);margin-bottom:6px;">Madre</div>
          <div class="mono" style="background:#fff;padding:8px;border-radius:6px;border-left:3px solid var(--cielo);">
            ${gen.madre ? `<strong>${gen.madre}</strong><br><small>${madre?.nombre||'â€”'}</small>` : '<span class="muted">Sin registro</span>'}
          </div>
        </div>
      </div>
      ${(gen.abuelos?.paternos?.padre || gen.abuelos?.paternos?.madre || gen.abuelos?.maternos?.padre || gen.abuelos?.maternos?.madre) ? `
      <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(0,0,0,0.1);">
        <div style="font-weight:600;color:#666;margin-bottom:8px;font-size:11px;">ABUELOS</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:11px;">
          <div style="background:#f0f0f0;padding:8px;border-radius:6px;">
            <div style="font-weight:600;color:var(--pasto);">Paternos</div>
            <div class="muted">${gen.abuelos?.paternos?.padre||'â€”'} Ã— ${gen.abuelos?.paternos?.madre||'â€”'}</div>
          </div>
          <div style="background:#f0f0f0;padding:8px;border-radius:6px;">
            <div style="font-weight:600;color:var(--cielo);">Maternos</div>
            <div class="muted">${gen.abuelos?.maternos?.padre||'â€”'} Ã— ${gen.abuelos?.maternos?.madre||'â€”'}</div>
          </div>
        </div>
      </div>
      ` : ''}
    </div>
  `;
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderConfig() {
  document.getElementById('config-finca-form').innerHTML = [
    {id:'cfg-finca',lbl:'Nombre de la Finca',val:config.finca},
    {id:'cfg-area',lbl:'Ãrea (ha)',val:config.area},
    {id:'cfg-prop',lbl:'Propietario',val:config.propietario},
    {id:'cfg-mun',lbl:'Municipio',val:config.municipio},
    {id:'cfg-dep',lbl:'Departamento',val:config.departamento},
    {id:'cfg-tel',lbl:'TelÃ©fono',val:config.telefono},
  ].map(f=>`<div class="form-group"><label class="form-label">${f.lbl}</label><input class="form-control" id="${f.id}" value="${f.val||''}"></div>`).join('');

  document.getElementById('config-params').innerHTML = [
    {id:'prm-precio',lbl:'Precio leche ($/litro)',val:params.precio_leche},
    {id:'prm-litros',lbl:'Meta kg/vaca/dÃ­a (control lÃ¡cteo)',val:params.meta_litros},
    {id:'prm-preÃ±ez',lbl:'Meta tasa preÃ±ez (%)',val:params.meta_preÃ±ez},
    {id:'prm-da',lbl:'Meta dÃ­as abiertos',val:params.dias_abiertos_meta},
    {id:'prm-natal',lbl:'Meta natalidad (%)',val:params.meta_natalidad},
  ].map(p=>`<div class="form-group" style="margin-bottom:12px;"><label class="form-label">${p.lbl}</label><input type="number" class="form-control number-input" id="${p.id}" value="${p.val}"></div>`).join('');
}

function guardarConfig() {
  config = { finca:document.getElementById('cfg-finca').value, area:document.getElementById('cfg-area').value, propietario:document.getElementById('cfg-prop').value, municipio:document.getElementById('cfg-mun').value, departamento:document.getElementById('cfg-dep').value, telefono:document.getElementById('cfg-tel').value };
  persist();
  document.getElementById('sb-finca-name').textContent = 'ğŸ¡ '+(config.finca||'Mi Finca');
  toast('ConfiguraciÃ³n guardada âœ”');
}

function guardarParams() {
  params = { precio_leche:+document.getElementById('prm-precio').value||1850, meta_litros:+document.getElementById('prm-litros').value||30, meta_preÃ±ez:+document.getElementById('prm-preÃ±ez').value||28, dias_abiertos_meta:+document.getElementById('prm-da').value||120, meta_natalidad:+document.getElementById('prm-natal').value||75 };
  persist();
  toast('ParÃ¡metros guardados âœ”');
}

function exportarTodo() {
  const data = JSON.stringify({animales,registrosLeche,registrosPeso,partos,servicios,eventosS,gastos,praderas,config,params,costosFijos,secados}, null, 2);
  const blob = new Blob([data],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='ganadero-sg-backup.json'; a.click();
  URL.revokeObjectURL(url);
  toast('Exportado âœ”');
}

function importarDatos() {
  const input = document.createElement('input'); input.type='file'; input.accept='.json';
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const data = JSON.parse(ev.target.result);
        if(data.animales) animales=data.animales;
        if(data.registrosLeche) registrosLeche=data.registrosLeche;
        if(data.partos) partos=data.partos;
        if(data.servicios) servicios=data.servicios;
        if(data.eventosS) eventosS=data.eventosS;
        if(data.gastos) gastos=data.gastos;
        if(data.praderas) praderas=data.praderas;
        if(data.config) config=data.config;
        if(data.params) params=data.params;
        if(data.costosFijos) costosFijos=data.costosFijos;
        if(data.secados) secados=data.secados;
        persist();
        toast('Datos importados âœ”');
        nav('dashboard');
      } catch { toast('Error al importar: JSON invÃ¡lido','error'); }
    };
    reader.readAsText(file);
  };
  input.click();
}

function resetDatos() {
  if(!confirm('Â¿Limpiar TODOS los datos? Esta acciÃ³n no se puede deshacer.')) return;
  if(!confirm('Â¿EstÃ¡s seguro? Se borrarÃ¡n todos los animales, registros y configuraciÃ³n.')) return;
  ['sg_animales','sg_leche','sg_pesos','sg_partos','sg_servicios','sg_salud','sg_gastos','sg_praderas','sg_config','sg_params','sg_costosFijos','sg_secados'].forEach(k=>localStorage.removeItem(k));
  location.reload();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DÃAS ABIERTOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcularDiasAbiertos(animal) {
  // DÃ­as abiertos = dÃ­as desde el Ãºltimo parto hasta la fecha del servicio confirmado preÃ±ada
  // Si aÃºn no ha quedado preÃ±ada = dÃ­as desde Ãºltimo parto hasta hoy
  const misPartos = partos.filter(p=>p.madreId===animal.id).sort((a,b)=>b.fecha.localeCompare(a.fecha));
  if(!misPartos.length) return null;
  const ultimoParto = misPartos[0].fecha;
  const partoDt = new Date(ultimoParto+'T00:00:00');
  const hoyDt   = new Date(hoy()+'T00:00:00');
  // Buscar servicio preÃ±ada posterior al Ãºltimo parto
  const servPreÃ±ada = servicios.filter(s=>
    s.animalId===animal.id &&
    s.diagnostico==='preÃ±ada' &&
    s.fecha > ultimoParto
  ).sort((a,b)=>a.fecha.localeCompare(b.fecha))[0];
  if(servPreÃ±ada) {
    const servDt = new Date(servPreÃ±ada.fecha+'T00:00:00');
    return { dias: Math.floor((servDt-partoDt)/86400000), cerrado: true, fechaConc: servPreÃ±ada.fecha, ultimoParto };
  }
  return { dias: Math.floor((hoyDt-partoDt)/86400000), cerrado: false, fechaConc: null, ultimoParto };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROTOCOLOS HORMONALES (desde _SS con metodo OPU/TE/DIB)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getProtocolosAnimal(animalId) {
  return servicios.filter(s =>
    s.animalId === animalId && (
      s.metodo?.includes('OPU') ||
      s.metodo?.includes('TE') ||
      s.metodo?.includes('DIB') ||
      s.metodo?.includes('Protocolo') ||
      s.obs?.includes('DIB') ||
      s.obs?.includes('Benzoato') ||
      s.obs?.includes('Cipionato') ||
      s.obs?.includes('InserciÃ³n DIB')
    )
  ).sort((a,b)=>b.fecha.localeCompare(a.fecha));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GENERADOR DE REPORTES PDF
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generarReporte(tipo) {
  const finca = params?.finca || 'Finca INKA';
  const fechaHoy = new Date().toLocaleDateString('es-CO',{day:'2-digit',month:'long',year:'numeric'});

  let titulo='', html='';

  if(tipo==='inventario') {
    titulo = 'Inventario de Animales';
    const activos = animales.filter(a=>a.estado!=='baja');
    html = `
      <table>
        <thead><tr><th>ID/Arete</th><th>Nombre</th><th>CategorÃ­a</th><th>Raza</th><th>Nacimiento</th><th>Peso kg</th><th>Estado</th><th>Potrero</th><th>L/dÃ­a</th></tr></thead>
        <tbody>${activos.map(a=>`<tr>
          <td class="mono">${a.id}</td><td>${a.nombre}</td><td>${a.categoria}</td>
          <td>${a.raza||'â€”'}</td><td>${a.nacimiento||'â€”'}</td><td>${a.peso||0}</td>
          <td><span class="badge ${a.estado==='gestante'?'b-verde':a.estado==='activa'?'b-azul':'b-gris'}">${a.estado}</span></td>
          <td>${a.potrero||'â€”'}</td><td>${a.litros||0}</td>
        </tr>`).join('')}</tbody>
      </table>
      <div class="resumen">Total animales activos: <strong>${activos.length}</strong> Â· Peso total: <strong>${activos.reduce((s,a)=>s+(a.peso||0),0).toLocaleString()} kg</strong></div>`;

  } else if(tipo==='reproductivo') {
    titulo = 'Informe Reproductivo';
    const hembras = animales.filter(a=>['Vaca','Novilla'].includes(a.categoria)&&a.estado!=='baja');
    const gestantes = hembras.filter(a=>a.estado==='gestante'||a.estado==='preparto');
    html = `
      <h3>Indicadores Generales</h3>
      <table><thead><tr><th>Indicador</th><th>Valor</th></tr></thead><tbody>
        <tr><td>Total hembras activas</td><td>${hembras.length}</td></tr>
        <tr><td>Gestantes</td><td>${gestantes.length}</td></tr>
        <tr><td>Partos registrados</td><td>${partos.length}</td></tr>
        <tr><td>Servicios registrados</td><td>${servicios.length}</td></tr>
        <tr><td>Tasa de preÃ±ez</td><td>${servicios.length?(servicios.filter(s=>s.diagnostico==='preÃ±ada').length/servicios.length*100).toFixed(1):0}%</td></tr>
      </tbody></table>

      <h3>Partos Esperados â€” DÃ­as de GestaciÃ³n</h3>
      <table><thead><tr><th>Animal</th><th>Estado</th><th>Servicio</th><th>Toro/MÃ©todo</th><th>DÃ­as gestaciÃ³n</th><th>Parto esperado</th><th>DÃ­as restantes</th></tr></thead>
      <tbody>${gestantes.map(a=>{
        const g=infoGestacion(a);
        const s=servicios.filter(x=>x.animalId===a.id&&x.diagnostico==='preÃ±ada').sort((x,y)=>y.fecha.localeCompare(x.fecha))[0];
        return `<tr>
          <td class="mono">${a.id}<br><small>${a.nombre!==a.id?a.nombre:''}</small></td>
          <td><span class="badge b-verde">${a.estado}</span></td>
          <td>${g?g.servFecha:'â€”'}</td>
          <td>${s?s.toro.substring(0,30):'â€”'}</td>
          <td>${g?`<strong>${g.transcurridos}d</strong> / 283`:'â€”'}</td>
          <td><strong>${g?g.partoEsp:'â€”'}</strong></td>
          <td>${g?(g.restantes>0?g.restantes+'d':'Â¡Hoy!'):'â€”'}</td>
        </tr>`;
      }).join('')}</tbody></table>

      <h3>DÃ­as Abiertos por Animal</h3>
      <table><thead><tr><th>Animal</th><th>Ãšltimo parto</th><th>DÃ­as abiertos</th><th>Estado</th></tr></thead>
      <tbody>${hembras.filter(a=>partos.some(p=>p.madreId===a.id)).map(a=>{
        const da=calcularDiasAbiertos(a);
        if(!da) return '';
        const color = da.dias>120?'b-rojo':da.dias>90?'b-naranja':'b-verde';
        return `<tr>
          <td class="mono">${a.id} ${a.nombre!==a.id?'â€” '+a.nombre:''}</td>
          <td>${da.ultimoParto}</td>
          <td><strong>${da.dias} dÃ­as</strong></td>
          <td><span class="badge ${color}">${da.cerrado?'Concebida '+da.fechaConc:'Abierta'}</span></td>
        </tr>`;
      }).join('')}</tbody></table>

      <h3>Historial de Servicios</h3>
      <table><thead><tr><th>Fecha</th><th>Animal</th><th>MÃ©todo</th><th>Toro/Semen</th><th>DiagnÃ³stico</th></tr></thead>
      <tbody>${servicios.slice().reverse().map(s=>`<tr>
        <td>${s.fecha}</td>
        <td class="mono">${s.animalId}<br><small>${s.animalNombre||''}</small></td>
        <td>${s.metodo}</td>
        <td>${(s.toro||'').substring(0,35)}</td>
        <td><span class="badge ${s.diagnostico==='preÃ±ada'?'b-verde':s.diagnostico?'b-rojo':'b-gris'}">${s.diagnostico||'Pendiente'}</span></td>
      </tr>`).join('')}</tbody></table>`;

  } else if(tipo==='salud') {
    titulo = 'Reporte Sanitario';
    // Separar eventos normales de protocolos hormonales
    const eventosTx = eventosS.filter(e=>!e.medicamentos?.some?.(m=>/DIB|Benzoato|Cipionato|eCG|Dextrogenol/i.test(m)));
    const protocolos = servicios.filter(s=>
      s.metodo?.includes('OPU')||s.metodo?.includes('TE')||
      s.obs?.includes('DIB')||s.obs?.includes('Benzoato')||s.obs?.includes('Cipionato')
    );
    html = `
      <h3>Eventos Sanitarios</h3>
      <table><thead><tr><th>Fecha</th><th>Animal</th><th>DiagnÃ³stico</th><th>Tratamiento</th><th>Veterinario</th><th>Estado</th></tr></thead>
      <tbody>${eventosS.slice().reverse().map(e=>`<tr>
        <td>${e.fecha}</td>
        <td class="mono">${e.animalId}<br><small>${e.animalNombre||''}</small></td>
        <td>${e.diagnostico||'â€”'}</td>
        <td>${e.medicamento||e.tratamiento||'â€”'}</td>
        <td>${e.veterinario||'â€”'}</td>
        <td><span class="badge ${e.estado==='Finalizado'?'b-verde':e.estado==='En tratamiento'?'b-rojo':'b-gris'}">${e.estado||'â€”'}</span></td>
      </tr>`).join('')}</tbody></table>

      <h3>Protocolos de InducciÃ³n del Estro / FIV</h3>
      <table><thead><tr><th>Fecha</th><th>Animal</th><th>Protocolo</th><th>Toro/Semen</th><th>Resultado</th></tr></thead>
      <tbody>${protocolos.length ? protocolos.slice().reverse().map(s=>`<tr>
        <td>${s.fecha}</td>
        <td class="mono">${s.animalId}<br><small>${s.animalNombre||''}</small></td>
        <td>${s.metodo}</td>
        <td>${(s.toro||'â€”').substring(0,35)}</td>
        <td>${s.diagnostico||s.obs?.substring(0,60)||'â€”'}</td>
      </tr>`).join('') : '<tr><td colspan="5" style="text-align:center;color:#888;">Sin protocolos registrados</td></tr>'}</tbody></table>`;

  } else if(tipo==='produccion') {
    titulo = 'Reporte de ProducciÃ³n LÃ¡ctea';
    const agrupado = {};
    registrosLeche.forEach(r=>{ if(!agrupado[r.animalId]) agrupado[r.animalId]={nombre:r.animalNombre,total:0,dias:0}; agrupado[r.animalId].total+=r.total||0; agrupado[r.animalId].dias++; });
    html = `
      <h3>Resumen por Animal</h3>
      <table><thead><tr><th>ID</th><th>Nombre</th><th>DÃ­as registrados</th><th>Total kg</th><th>Promedio L/dÃ­a</th></tr></thead>
      <tbody>${Object.entries(agrupado).sort((a,b)=>b[1].total-a[1].total).map(([id,d])=>`<tr>
        <td class="mono">${id}</td><td>${d.nombre||id}</td><td>${d.dias}</td>
        <td><strong>${d.total.toFixed(1)} L</strong></td>
        <td>${d.dias?(d.total/d.dias).toFixed(1):0} L</td>
      </tr>`).join('')}</tbody></table>
      <h3>Registros Detallados</h3>
      <table><thead><tr><th>Fecha</th><th>Animal</th><th>OrdeÃ±o 1</th><th>OrdeÃ±o 2</th><th>Total</th></tr></thead>
      <tbody>${registrosLeche.slice().reverse().map(r=>`<tr>
        <td>${r.fecha}</td><td class="mono">${r.animalId}</td>
        <td>${r.o1||0} L</td><td>${r.o2||0} L</td><td><strong>${r.total||0} L</strong></td>
      </tr>`).join('')}</tbody></table>`;

  } else if(tipo==='costos') {
    titulo = 'Estado de Resultados';
    const ingresos = gastos.filter(g=>g.monto<0).reduce((s,g)=>s+Math.abs(g.monto),0);
    const costos   = gastos.filter(g=>g.monto>0).reduce((s,g)=>s+g.monto,0);
    html = `
      <div class="resumen-financiero">
        <div class="fin-box verde"><div class="fin-lbl">Ingresos</div><div class="fin-val">$${ingresos.toLocaleString()}</div></div>
        <div class="fin-box rojo"><div class="fin-lbl">Costos</div><div class="fin-val">$${costos.toLocaleString()}</div></div>
        <div class="fin-box ${ingresos-costos>=0?'verde':'rojo'}"><div class="fin-lbl">Utilidad</div><div class="fin-val">$${(ingresos-costos).toLocaleString()}</div></div>
      </div>
      <h3>Movimientos</h3>
      <table><thead><tr><th>Fecha</th><th>CategorÃ­a</th><th>Concepto</th><th>Monto</th></tr></thead>
      <tbody>${gastos.slice().reverse().map(g=>`<tr>
        <td>${g.fecha}</td><td>${g.categoria}</td><td>${g.concepto}</td>
        <td style="color:${g.monto<0?'#16a34a':'#dc2626'};font-weight:700;">${g.monto<0?'+':''} $${Math.abs(g.monto).toLocaleString()}</td>
      </tr>`).join('')}</tbody></table>`;

  } else if(tipo==='ranking') {
    titulo = 'Ranking de Vacas Productoras';
    const vacas = animales.filter(a=>a.categoria==='Vaca'&&a.estado!=='baja').sort((a,b)=>b.litros-a.litros);
    html = `
      <table><thead><tr><th>#</th><th>ID</th><th>Nombre</th><th>L/dÃ­a</th><th>Raza</th><th>Partos</th><th>Peso kg</th><th>Estado</th></tr></thead>
      <tbody>${vacas.map((v,i)=>`<tr>
        <td><strong>${i+1}</strong></td>
        <td class="mono">${v.id}</td><td>${v.nombre}</td>
        <td><strong>${v.litros||0} kg</strong></td>
        <td>${v.raza||'â€”'}</td><td>${v.partos||0}</td><td>${v.peso||0}</td>
        <td><span class="badge ${v.estado==='gestante'?'b-verde':'b-azul'}">${v.estado}</span></td>
      </tr>`).join('')}</tbody></table>`;
  }

  // Abrir ventana de impresiÃ³n PDF
  const win = window.open('','_blank');
  win.document.write(`<!DOCTYPE html><html lang="es"><head>
  <meta charset="UTF-8">
  <title>${titulo} â€” ${finca}</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',Arial,sans-serif;font-size:11px;color:#1a1a1a;padding:20px 28px;background:#fff;}
    .header{display:flex;justify-content:space-between;align-items:flex-start;border-bottom:3px solid #15803d;padding-bottom:12px;margin-bottom:20px;}
    .header-left .finca{font-size:20px;font-weight:800;color:#15803d;letter-spacing:-0.5px;}
    .header-left .sub{font-size:11px;color:#555;margin-top:2px;}
    .header-right{text-align:right;font-size:10px;color:#666;}
    .report-title{font-size:15px;font-weight:700;color:#1e293b;margin-bottom:14px;padding:8px 12px;background:#f0fdf4;border-left:4px solid #15803d;border-radius:0 6px 6px 0;}
    h3{font-size:12px;font-weight:700;color:#15803d;margin:18px 0 8px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #d1fae5;padding-bottom:4px;}
    table{width:100%;border-collapse:collapse;margin-bottom:12px;}
    thead th{background:#15803d;color:#fff;padding:6px 8px;text-align:left;font-size:10px;font-weight:600;}
    tbody tr:nth-child(even){background:#f9fafb;}
    tbody tr:hover{background:#f0fdf4;}
    td{padding:5px 8px;border-bottom:1px solid #e5e7eb;vertical-align:top;font-size:10.5px;}
    .mono{font-family:monospace;font-size:10px;color:#374151;}
    small{color:#888;font-size:9px;}
    .badge{display:inline-block;padding:2px 7px;border-radius:10px;font-size:9px;font-weight:700;}
    .b-verde{background:#dcfce7;color:#15803d;}
    .b-azul{background:#dbeafe;color:#1d4ed8;}
    .b-rojo{background:#fee2e2;color:#dc2626;}
    .b-naranja{background:#ffedd5;color:#c2410c;}
    .b-gris{background:#f3f4f6;color:#6b7280;}
    .resumen{margin-top:10px;font-size:11px;color:#374151;padding:8px 12px;background:#f0fdf4;border-radius:6px;}
    .resumen-financiero{display:flex;gap:12px;margin-bottom:16px;}
    .fin-box{flex:1;padding:12px;border-radius:8px;text-align:center;}
    .fin-box.verde{background:#dcfce7;}
    .fin-box.rojo{background:#fee2e2;}
    .fin-lbl{font-size:10px;font-weight:600;color:#374151;margin-bottom:4px;}
    .fin-val{font-size:16px;font-weight:800;color:#1a1a1a;}
    .footer{margin-top:24px;padding-top:10px;border-top:1px solid #e5e7eb;display:flex;justify-content:space-between;font-size:9px;color:#9ca3af;}
    @media print{
      body{padding:10px 16px;}
      @page{margin:1.2cm;size:A4;}
      thead{display:table-header-group;}
      tr{page-break-inside:avoid;}
    }
  </style>
  </head><body>
  <div class="header">
    <div class="header-left">
      <div class="finca">ğŸ„ ${finca}</div>
      <div class="sub">Sistema de GestiÃ³n Ganadera Â· Doble PropÃ³sito INKA</div>
    </div>
    <div class="header-right">
      Fecha: ${fechaHoy}<br>
      Generado por: SG Ganadero INKA<br>
      VersiÃ³n 2.0
    </div>
  </div>
  <div class="report-title">ğŸ“‹ ${titulo}</div>
  ${html}
  <div class="footer">
    <span>ğŸ„ ${finca} â€” Sistema de GestiÃ³n Ganadera</span>
    <span>${fechaHoy}</span>
  </div>
  <script>window.onload=()=>{window.print();}<\/script>
  </body></html>`);
  win.document.close();
}

function exportCSV() { generarReporte('inventario'); }

function openFincaModal() { nav('config'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMPOSICIÃ“N GENÃ‰TICA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RAZAS_LISTA = [
  // Bos taurus (europeas)
  'Holstein','Jersey','Normando','Pardo Suizo','Simmental','Angus','Hereford',
  'Charolais','Limousin','Fleckvieh','Ayrshire','Guernsey','Brown Swiss',
  // Bos indicus (cebuinas)
  'Brahman','Gyr','Nelore','Guzerat','Sindi','TabapuÃ£','Kankrej','Indo-Brasil',
  // Criollas / cruzas establecidas
  'Criollo','Gyrolando','Girolando','MambÃ­','Reyna','Romosinuano',
  'Blanco Orejinegro','HartÃ³n del Valle','CosteÃ±o con Cuernos',
  'BÃºfalo de Agua','BÃºfalo Murrah',
];

const BOS_TAURUS = new Set(['Holstein','Jersey','Normando','Pardo Suizo','Simmental','Angus','Hereford','Charolais','Limousin','Fleckvieh','Ayrshire','Guernsey','Brown Swiss','Fleckvieh']);
const BOS_INDICUS = new Set(['Brahman','Gyr','Nelore','Guzerat','Sindi','TabapuÃ£','Kankrej','Indo-Brasil']);

function addRazaRow(raza='', pct='') {
  const cont = document.getElementById('genetica-rows');
  const id = 'gr-'+Date.now()+'-'+Math.random().toString(36).slice(2);
  const div = document.createElement('div');
  div.id = id;
  div.style.cssText = 'display:flex;gap:6px;align-items:center;';
  div.innerHTML = `
    <select class="form-control" style="flex:2;" onchange="actualizarResumen()">
      <option value="">â€” Seleccionar raza â€”</option>
      <optgroup label="Bos taurus (Europeas)">${['Holstein','Jersey','Normando','Pardo Suizo','Simmental','Angus','Hereford','Charolais','Limousin','Ayrshire','Guernsey','Brown Swiss'].map(r=>`<option${r===raza?' selected':''}>${r}</option>`).join('')}</optgroup>
      <optgroup label="Bos indicus (Cebuinas)">${['Brahman','Gyr','Nelore','Guzerat','Sindi','TabapuÃ£','Kankrej','Indo-Brasil'].map(r=>`<option${r===raza?' selected':''}>${r}</option>`).join('')}</optgroup>
      <optgroup label="Criollas / Cruzas">${['Criollo','Gyrolando','Girolando','MambÃ­','Romosinuano','Blanco Orejinegro','HartÃ³n del Valle','CosteÃ±o con Cuernos'].map(r=>`<option${r===raza?' selected':''}>${r}</option>`).join('')}</optgroup>
      <optgroup label="BÃºfalos">${['BÃºfalo de Agua','BÃºfalo Murrah'].map(r=>`<option${r===raza?' selected':''}>${r}</option>`).join('')}</optgroup>
    </select>
    <input type="number" class="form-control number-input" placeholder="%" min="1" max="100" value="${pct}" style="flex:0 0 72px;text-align:center;" oninput="actualizarResumen()">
    <span style="font-size:10px;color:var(--gris-calido);width:36px;text-align:center;" class="gr-tipo"></span>
    <button type="button" class="btn btn-ghost btn-sm btn-icon" onclick="document.getElementById('${id}').remove();actualizarResumen();" title="Quitar">âœ•</button>`;
  cont.appendChild(div);
  actualizarResumen();
}

function getGenetica() {
  const rows = document.querySelectorAll('#genetica-rows > div');
  return Array.from(rows).map(row=>{
    const sel = row.querySelector('select');
    const inp = row.querySelector('input[type=number]');
    return { raza: sel?.value||'', pct: +inp?.value||0 };
  }).filter(r=>r.raza && r.pct>0);
}

function geneticaStr(comp) {
  if(!comp||!comp.length) return 'Sin definir';
  return comp.map(c=>c.raza+' '+c.pct+'%').join(' Ã— ');
}

function actualizarResumen() {
  const comp = getGenetica();
  const total = comp.reduce((s,c)=>s+c.pct,0);
  const taurus = comp.filter(c=>BOS_TAURUS.has(c.raza)).reduce((s,c)=>s+c.pct,0);
  const indicus = comp.filter(c=>BOS_INDICUS.has(c.raza)).reduce((s,c)=>s+c.pct,0);
  const res = document.getElementById('genetica-resumen');
  if(!comp.length) { if(res) res.innerHTML=''; return; }

  // Tipo por fila
  document.querySelectorAll('#genetica-rows > div').forEach(row=>{
    const sel = row.querySelector('select');
    const tipo = row.querySelector('.gr-tipo');
    if(!sel||!tipo) return;
    if(BOS_TAURUS.has(sel.value)) tipo.textContent='ğŸ‡ªğŸ‡º';
    else if(BOS_INDICUS.has(sel.value)) tipo.textContent='ğŸ‡®ğŸ‡³';
    else tipo.textContent='ğŸŒ±';
  });

  if(!res) return;
  const ok = total===100;
  res.innerHTML = `
    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
      <span style="font-weight:700;color:${ok?'var(--pasto)':'var(--rojo)'};">Total: ${total}% ${ok?'âœ“':'(debe ser 100%)'}</span>
      ${taurus>0?`<span style="background:#dbeafe;color:#1e3a5f;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700;">ğŸ‡ªğŸ‡º Taurus ${taurus}%</span>`:''}
      ${indicus>0?`<span style="background:#fef9c3;color:#713f12;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700;">ğŸ‡®ğŸ‡³ Indicus ${indicus}%</span>`:''}
    </div>
    ${comp.length>1?`<div style="margin-top:4px;font-size:11px;color:var(--gris-calido);">${geneticaStr(comp)}</div>`:''}`;
}

function cargarGeneticaEnForm(composicion) {
  document.getElementById('genetica-rows').innerHTML='';
  if(composicion && composicion.length) {
    composicion.forEach(c=>addRazaRow(c.raza, c.pct));
  } else {
    addRazaRow(); // fila vacÃ­a por defecto
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {

  // â”€â”€ Seed final v11 â”€â”€
  const _SA=[{"id":"638/3","nombre":"JJBT SIRENITA T.E.","categoria":"Novilla","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Blanco y Rojo","nacimiento":"2023-12-07","peso":276,"cc":"3.5","estado":"gestante","potrero":"P11 â€” La Casa","litros":0,"padre":"GIM FIV DO BASA BASP/246 (MGY246Z)","madre":"JJBT REINA ISABEL T.E. 428/9 (HGY053473)","partos":0,"obs":"Reg. AsocebÃº HGY094596 | PU | FIV | Lechero: No | Criador: Jose Juan Barrios Torres - Hda El Esfuerzo, SanjuÃ¡n de Betulia, Sucre | Gestante 129 dÃ­as al 20/02/26 â€” parto esperado 24/07/2026","_ts":1738800000000,"_dx":"(+) 114","_categoria_repro":"PreÃ±ada (confirmada)","_dias_gest":132,"_dias_rest":151,"_fecha_parto":"2026-07-24","registro":"HGY094596"},{"id":"0010","nombre":"0010","categoria":"Vaca","raza":"","composicion":[],"color":"","nacimiento":"","peso":333,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":3.89,"padre":"","madre":"","partos":1,"obs":"CrÃ­a muerta 29/01/26. Parto 25/01/26 | InvoluciÃ³n","_ts":1738800001000,"_dx":"InvoluciÃ³n","_categoria_repro":"InvoluciÃ³n","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"031/7","nombre":"CANDY CARAMELO DILUVIO MENCHO","categoria":"Vaca","raza":"Cebuino (CebÃº Comerc. 75.76%, GYR 21.88%, Holstein 1.57%, Brahman 0.79%)","composicion":[{"raza":"CebÃº Comercial","pct":75.76},{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":1.57},{"raza":"Brahman Gr.","pct":0.79}],"color":"Rojo","nacimiento":"2017-02-13","peso":341,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":1.05,"padre":"199-1","madre":"250-9","partos":2,"obs":"Parto distÃ³cico 12/01/26 â€” crÃ­a muerta. Tto: Benzoato estradiol 8ml + Cloprostenol 2ml + Edo Adesel 8ml + Fluvipen 6M UI. Alto riesgo clÃ­nico","_ts":1738800003000,"_dx":"InvoluciÃ³n","_categoria_repro":"InvoluciÃ³n","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"015/7","nombre":"TURCA DILUVIO MENCHO CARAMEL","categoria":"Vaca","raza":"Cebuino (CebÃº Comerc. 75.76%, GYR 21.88%, Holstein 1.57%, Brahman 0.79%)","composicion":[{"raza":"CebÃº Comercial","pct":75.76},{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":1.57},{"raza":"Brahman Gr.","pct":0.79}],"color":"Rojo","nacimiento":"2017-01-27","peso":505,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":4.92,"padre":"199-1","madre":"197-8","partos":2,"obs":"","_ts":1738800004000,"_dx":"InvoluciÃ³n","_categoria_repro":"InvoluciÃ³n","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"071/1","nombre":"DELFINA LA LEYENDA FAR","categoria":"Vaca","raza":"Taurino (Senepol 50.00%, Holstein 18.75%, CebÃº Comerc. 31.25%)","composicion":[{"raza":"Senepol","pct":50.0},{"raza":"Holstein Neg.","pct":18.75},{"raza":"CebÃº Comercial","pct":31.25}],"color":"Negro","nacimiento":"2021-08-16","peso":361,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":2.91,"padre":"017","madre":"247-4","partos":2,"obs":"VacÃ­a Ovarios EstÃ¡ticos","_ts":1738800005000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"0012","nombre":"0012","categoria":"Novilla","raza":"","composicion":[],"color":"","nacimiento":"","peso":290,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"","partos":0,"obs":"","_ts":1738800006000,"_dx":"InvoluciÃ³n","_categoria_repro":"InvoluciÃ³n","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"236/4","nombre":"LA NENA MAÃ‘OGENICO DILUVIO","categoria":"Vaca","raza":"Indeterminado (GYR 21.88%, Holstein 1.57%, Brahman 0.79%, CebÃº Comerc. 19.53%)","composicion":[{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":1.57},{"raza":"Brahman Gr.","pct":0.79},{"raza":"CebÃº Comercial","pct":19.53}],"color":"Bayo","nacimiento":"2014-12-15","peso":425,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":1.96,"padre":"","madre":"221-0","partos":2,"obs":"CLD sin confirmaciÃ³n â€” servicio 20/12/25 | ğŸ”´ Rechequeo urgente: confirmar preÃ±ez o luteinizaciÃ³n persistente | DX2 recomendado","_ts":1738800007000,"_dx":"CLD","_categoria_repro":"CLD","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"0018","nombre":"0018","categoria":"Novilla","raza":"","composicion":[],"color":"","nacimiento":"","peso":347,"cc":"3.0","estado":"gestante","potrero":"P01 â€” La Herencia","litros":0,"padre":"T-SPRUCE PHOENIX 2176-ET 7HO16468","madre":"012/1","partos":0,"obs":"EmbriÃ³n | DÃ­as gestaciÃ³n: 135 | Receptora TE â€” Donadora: SAUDITA GALAXIA 012/1 | Toro: PHOENIX 7HO16468 (Holstein Sexado A2A2) | Ciclo FIV/TE sept 2025","_ts":1738800008000,"_dx":"(+) 135","_categoria_repro":"PreÃ±ada (TE)","_dias_gest":146,"_dias_rest":137,"_fecha_parto":"2026-07-10"},{"id":"003/5","nombre":"PANQUEMAO DILUVIO MENCHO","categoria":"Vaca","raza":"Cebuino (GYR 21.88%, Holstein 1.57%, Brahman 0.79%, CebÃº Comerc. 75.76%)","composicion":[{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":1.57},{"raza":"Brahman Gr.","pct":0.79},{"raza":"CebÃº Comercial","pct":75.76}],"color":"Bayo","nacimiento":"2015-08-28","peso":385,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":4.4,"padre":"","madre":"208-0","partos":1,"obs":"CLD â€” posible reabsorciÃ³n, DX2 recomendado","_ts":1738800009000,"_dx":"CLD","_categoria_repro":"CLD","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"012/1","nombre":"SAUDITA GALAXIA","categoria":"Vaca","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Blanco y Rojo","nacimiento":"2021-05-15","peso":292,"cc":"2.5","estado":"activa","potrero":"P11 â€” La Casa","litros":3.19,"padre":"EL TESORO GENECO 433/7 (MGY042037)","madre":"RIO GRANDE 2573/17 T.E. (HGY041554)","partos":1,"obs":"Registro AsocebÃº HGY066183 | PU (Pura) | C.Lechero: SÃ­ | Hijos: 2 | Criador: Hermanos Arabia Torres SAS - Hda La Fortuna, Arjona, BolÃ­var","_ts":1738800010000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"0015","nombre":"0015","categoria":"Vaca","raza":"","composicion":[],"color":"","nacimiento":"","peso":301,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":2.14,"padre":"","madre":"","partos":1,"obs":"VacÃ­a Ovarios EstÃ¡ticos","_ts":1738800011000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"0007","nombre":"0007","categoria":"Vaca","raza":"","composicion":[],"color":"","nacimiento":"","peso":365,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":4.16,"padre":"","madre":"","partos":1,"obs":"VacÃ­a Ovarios EstÃ¡ticos","_ts":1738800012000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"001/6","nombre":"FRENTONA DILUVIO MENCHO","categoria":"Vaca","raza":"Cebuino (GYR 21.88%, Holstein 26.57%, Brahman 25.77%, CebÃº Comerc. 25.78%)","composicion":[{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":26.57},{"raza":"Brahman Gr.","pct":25.77},{"raza":"CebÃº Comercial","pct":25.78}],"color":"Osco","nacimiento":"2016-03-09","peso":417,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":5.36,"padre":"","madre":"220-0","partos":1,"obs":"Requiere DX2","_ts":1738800013000,"_dx":"CLD","_categoria_repro":"CLD","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"010/7","nombre":"010/7","categoria":"Vaca","raza":"","composicion":[],"color":"","nacimiento":"","peso":438,"cc":"3.0","estado":"gestante","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"","partos":1,"obs":"DÃ­as gestaciÃ³n: 30","_ts":1738800014000,"_dx":"+30","_categoria_repro":"PreÃ±ada (confirmada)","_dias_gest":30,"_dias_rest":253,"_fecha_parto":"2026-10-16"},{"id":"026/4","nombre":"CANDY DILUVIO MENCHO","categoria":"Vaca","raza":"Cebuino (GYR 21.88%, Holstein 26.57%, Brahman 0.79%, CebÃº Comerc. 50.76%)","composicion":[{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":26.57},{"raza":"Brahman Gr.","pct":0.79},{"raza":"CebÃº Comercial","pct":50.76}],"color":"Negro","nacimiento":"2014-12-07","peso":359,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":5.58,"padre":"","madre":"250-9","partos":2,"obs":"Parto 07/01/26 â€” crÃ­a macho activa","_ts":1738800015000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"069/1","nombre":"REBECA JB LAREDO SUGA","categoria":"Vaca","raza":"Taurino (Holstein R. 56.25%, CebÃº Comerc. 43.75%)","composicion":[{"raza":"Holstein R.","pct":56.25},{"raza":"CebÃº Comercial","pct":43.75}],"color":"Rojo","nacimiento":"2021-08-12","peso":347,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":4.4,"padre":"016","madre":"002-5","partos":3,"obs":"VacÃ­a Ovarios EstÃ¡ticos","_ts":1738800016000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"0001","nombre":"0001","categoria":"Novilla","raza":"","composicion":[],"color":"","nacimiento":"","peso":299,"cc":"3.3","estado":"gestante","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"","partos":0,"obs":"DÃ­as gestaciÃ³n: 114","_ts":1738800017000,"_dx":"(+) 114","_categoria_repro":"PreÃ±ada (confirmada)","_dias_gest":132,"_dias_rest":151,"_fecha_parto":"2026-07-24"},{"id":"036/8","nombre":"ENEIDA CARAMELO","categoria":"Vaca","raza":"Cebuino (CebÃº Comerc. 100%)","composicion":[{"raza":"CebÃº Comercial","pct":100.0}],"color":"Blanco","nacimiento":"2018-04-22","peso":446,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":3.16,"padre":"199-1","madre":"215-1","partos":3,"obs":"VOE â€” posible reabsorciÃ³n | Servicio 29/01/26 â€” OB Zafnat de Oro T.E. #717/43 | Seguimiento reproductivo","_ts":1738800018000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"0013","nombre":"0013","categoria":"Vaca","raza":"","composicion":[],"color":"","nacimiento":"","peso":351,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":2.61,"padre":"","madre":"","partos":2,"obs":"VacÃ­a Ovarios EstÃ¡ticos","_ts":1738800019000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"038/8","nombre":"ALVARACO PECOSO DILUVIO","categoria":"Vaca","raza":"Indeterminado (GYR 10.94%, Holstein 7.82%, Brahman 0.40%, CebÃº Comerc. 30.86%)","composicion":[{"raza":"GYR","pct":10.94},{"raza":"Holstein Neg.","pct":7.82},{"raza":"Brahman Gr.","pct":0.4},{"raza":"CebÃº Comercial","pct":30.86}],"color":"Osco","nacimiento":"2018-04-04","peso":509,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":3.97,"padre":"195-3","madre":"226/4","partos":2,"obs":"VacÃ­a Ovarios EstÃ¡ticos","_ts":1738800020000,"_dx":"VOE","_categoria_repro":"VacÃ­a (VOE)","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"023/7","nombre":"EMILIA CARAMELO","categoria":"Vaca","raza":"Cebuino (CebÃº Comerc. 75.00%, GYR 25.00%)","composicion":[{"raza":"CebÃº Comercial","pct":75.0},{"raza":"GYR","pct":25.0}],"color":"Rojo","nacimiento":"2017-05-12","peso":398,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":4.32,"padre":"199-1","madre":"214-9","partos":1,"obs":"Parto 21/01/2026 â€” crÃ­a hembra roja activa | InvoluciÃ³n postparto","_ts":1738800021000,"_dx":"InvoluciÃ³n","_categoria_repro":"InvoluciÃ³n","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"04/34","nombre":"SANTANA OA DULCE T.E.","categoria":"Novilla","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Blanco y Rojo","nacimiento":"2024-03-09","peso":290,"cc":"3.0","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"DISCRETO FIV CABO VERDE JCVL/2848 (MGY2848Z)","madre":"SANTANA OA NEVADA T.E. 013/77 (HGY047406)","partos":0,"obs":"Cert. AsocebÃº HGY096174 | Hembra PU Gyr 100% | FIV | NaciÃ³ 09/03/2024 | GenotipificaciÃ³n: SI (NEOGEN) | GenÃ³mica: SI (NEOGEN) | Padre: DISCRETO FIV CABO VERDE JCVL/2848 (MGY2848Z) | Madre: SANTANA OA NEVADA T.E. 013/77 (HGY047406) | Criador: Alejandro OrdÃ³Ã±ez Alvarado â€” Hda Santa Ana, Toluviejo, Sucre","_ts":1738800022000,"_dx":"FOD","_categoria_repro":"FOD","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"registro":"HGY096174","tipo_reg":"FIV","tipo_animal":"PU","marca":"PIERNA DERECHA â€” ANCA DERECHA","c_lechero":false,"genotipificacion":true,"genomica":true,"lab_genomica":"NEOGEN","criador":"Alejandro OrdÃ³Ã±ez Alvarado â€” Hda Santa Ana, Toluviejo, Sucre","genealogia":{"padre":{"nombre":"DISCRETO FIV CABO VERDE","numero":"JCVL/2848","registro":"MGY2848Z","padre_paterno":"C.A. SANSAO 472 (MGY000529)","madre_paterna":"FABRICA FIV DE BRAS. RRP/5921 (HGY5921Z)"},"madre":{"nombre":"SANTANA OA NEVADA T.E.","numero":"013/77","registro":"HGY047406","padre_materno":"JAGUAR TE DO GAVIAO GAV/291 (MGY1009566)","madre_materna":"MOIRA BJS BJAS/1715 (HGY1715Z)"},"abuelos_paternos":{"pp":"C.A. EVEREST B/805 (MGY000106)","pm":"C.A. HEURECA X/468 (HGY000468Z)","mp":"MODELO TE BRASILIA B/5213 (MGY000904)","mm":"TATICA TE DE BRAS. RRP/4891 (HGY004891Z)"},"abuelos_maternos":{"pp":"S.C. UACAI JAGUAR B/4010 (MGY004010Z)","pm":"UMIDADE V/1642 (HGY001642Z)","mp":"RENOVADO DOS POCOES APPG/1294 (MGY1294Z)","mm":"RECITA DE BRAS. RRP/4596 (HGY004596Z)"}}},{"id":"0016","nombre":"0016","categoria":"Novilla","raza":"","composicion":[],"color":"","nacimiento":"","peso":398,"cc":"3.0","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Vendida 22/11/2025","_ts":1738800025000,"_dx":"(-) CLD","_categoria_repro":"CLD","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"272/18","nombre":"JFH SAN PABLO MELY GENHIS T.E.","categoria":"Vaca","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Rojo y Blanco","nacimiento":"2018-01-11","peso":484,"cc":"3.3","estado":"gestante","potrero":"P11 â€” La Casa","litros":0,"padre":"GENGIS KHAN DE BRASILIA RRP/6097 (MGY020627)","madre":"HDV. ESTAÃ‘O ELENA 121/9 (HGY010492)","partos":1,"obs":"Reg. AsocebÃº HGY044826 | PU | FIV | Lechero: SÃ­ | Criador: Johen Francisco Herrera DÃ­az - Hda San Pablo, Corozal, Sucre","_ts":1738800026000,"_dx":"(+) 114","_categoria_repro":"PreÃ±ada (confirmada)","_dias_gest":132,"_dias_rest":151,"_fecha_parto":"2026-07-24","registro":"HGY044826"},{"id":"1378 N3","nombre":"JJBT MONICA T.E.","categoria":"Novilla","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Blanco y Rojo","nacimiento":"2023-11-28","peso":262,"cc":"3.0","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"DORITOS FIV CABO VERDE JCVL/2889 (MGY2889Z)","madre":"EL TESORO FARINA 454/0 (HGY055313)","partos":0,"obs":"Reg. AsocebÃº HGY096706 | PU | FIV | Lechero: No | Criador: Jose Juan Barrios Torres - Hda El Esfuerzo, SanjuÃ¡n de Betulia, Sucre | FOD/FOI â€” seguimiento folicular recomendado","_ts":1738800027000,"_dx":"FOD / FOI","_categoria_repro":"FOD","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"registro":"HGY096706"},{"id":"007/6","nombre":"LUZ MOROCHA CARAMELO","categoria":"Vaca","peso":420,"partos":2,"estado":"activa","obs":"Parto 03/08/2025 â€” crÃ­a macho activa","raza":"Cebuino (CebÃº Comerc. 87.50%, Holstein 12.50%)","composicion":[{"raza":"CebÃº Comercial","pct":87.5},{"raza":"Holstein Neg.","pct":12.5}],"color":"Bayo","nacimiento":"2016-06-21","cc":"3.3","potrero":"P01 â€” La Herencia","litros":3.9,"padre":"199-1","madre":"203-8","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200000000},{"id":"039/8","nombre":"CARMENCITA DILUVIO MENCHO","categoria":"Vaca","peso":407,"partos":2,"estado":"activa","obs":"Parto 25/11/2025 â€” crÃ­a hembra activa","raza":"Cebuino (GYR 32.82%, Holstein 4.69%, Brahman 26.16%, CebÃº Comerc. 36.33%)","composicion":[{"raza":"GYR","pct":32.82},{"raza":"Holstein Neg.","pct":4.69},{"raza":"Brahman Gr.","pct":26.16},{"raza":"CebÃº Comercial","pct":36.33}],"color":"Rojo","nacimiento":"2018-11-15","cc":"3.0","potrero":"P01 â€” La Herencia","litros":1.55,"padre":"195-3","madre":"249-0","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200001000},{"id":"041/8","nombre":"COROCITOCHICUACO","categoria":"Vaca","peso":432,"partos":3,"estado":"activa","obs":"Parto 16/09/2025 â€” crÃ­a hembra activa | Servicio 29/01/26 â€” OB Zafnat de Oro T.E. #717/43 | ğŸŸ¡ Eco programada 28/02â€“05/03/2026","raza":"Cebuino (CebÃº Comerc. 87.50%, Holstein R. 12.50%)","composicion":[{"raza":"CebÃº Comercial","pct":87.5},{"raza":"Holstein R.","pct":12.5}],"color":"Negro","nacimiento":"2018-03-01","cc":"3.0","potrero":"P01 â€” La Herencia","litros":3.11,"padre":"196-3","madre":"232-0","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200002000},{"id":"128/3","nombre":"JJBT RENACER","categoria":"Novilla","peso":289,"partos":0,"estado":"activa","obs":"Reg. AsocebÃº HGY086701 | PU | MN | Lechero: No | Criador: Jose Juan Barrios Torres - Hda El Esfuerzo, SanjuÃ¡n de Betulia, Sucre | ğŸ”´ Eco urgente: confirmar vesÃ­cula embrionaria y CL funcional | Servicio 12/01/26 â€” OB Zafnat de Oro T.E. #717/43","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Rojo y Blanco","nacimiento":"2023-02-28","cc":"3.0","potrero":"P11 â€” La Casa","litros":0,"padre":"JJBT DUQUE 601/9 (MGY054083)","madre":"JJBT FRAMBUESA T.E. 318/17 (HGY042877)","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200003000,"registro":"HGY086701"},{"id":"0003","nombre":"0003","categoria":"Vaca","peso":374,"partos":1,"estado":"baja","obs":"Parto 19/02/2026 â€” crÃ­a hembra R.lucero activa | ğŸŸ¢ InvoluciÃ³n uterina fisiolÃ³gica â€” evaluar a los 25-30 dÃ­as postparto | Baja â€” no figura en inventario oficial","raza":"","composicion":[],"color":"","nacimiento":"","cc":"3.0","potrero":"P11 â€” La Casa","litros":0,"padre":"","madre":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200004000},{"id":"070/7","nombre":"070/7","categoria":"Vaca","peso":0,"partos":2,"estado":"baja","obs":"Animal salido del hato | Baja del hato.","raza":"","composicion":[],"color":"","nacimiento":"","cc":"3.0","potrero":"","litros":4.22,"padre":"","madre":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200008000},{"id":"009/6","nombre":"009/6","categoria":"Vaca","peso":0,"partos":2,"estado":"baja","obs":"Vendida 31/10/2025 â€” ingreso $2.437.500","raza":"","composicion":[],"color":"","nacimiento":"","cc":"3.0","potrero":"","litros":3.9,"padre":"","madre":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200010000},{"id":"122/15","nombre":"Ternera de 236-4","categoria":"Ternera","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-01-11","peso":83,"cc":"2.5","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"","madre":"236/4","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013500,"madreId":"236/4","madreNom":"236/4"},{"id":"123/15","nombre":"Ternera de 226-4","categoria":"Ternera","raza":"","composicion":[],"color":"Baya","nacimiento":"2025-01-21","peso":82,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"226/4","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013501,"madreId":"226/4","madreNom":"226/4"},{"id":"CRI-003","nombre":"Ternero de 009-6","categoria":"Ternero","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-02-16","peso":0,"cc":"2.5","estado":"baja","potrero":"","litros":0,"padre":"","madre":"009/6","partos":0,"obs":"CrÃ­a vendida 22/11/25 â€” 144kg â€” $1.224.000","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013502,"madreId":"009/6","madreNom":"009/6"},{"id":"718/45","nombre":"SAUDITA ODISEO DE INKA","categoria":"Ternero","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Rojo y Blanco","nacimiento":"2025-04-04","peso":93,"cc":"2.5","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"EL TESORO GENECO 433/7 (MGY042037)","madre":"272/18","partos":0,"obs":"Cert. AsocebÃº MGY110280 | Toro PU Gyr 100% | MN | NaciÃ³ 04/04/2025 | Padre: EL TESORO GENECO 433/7 (MGY042037) | Madre: JFH SAN PABLO MELY GENHIS T.E. 272/18 (HGY044826) | Marca: Pierna Derecha / Anca Derecha | Criador: Hermanos Arabia Torres SAS","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013503,"madreId":"272/18","madreNom":"JFH SAN PABLO MELY GENHIS T.E.","sexo":"Macho","registro":"MGY110280","tipo_reg":"MN","tipo_animal":"PU","marca":"PIERNA DERECHA â€” ANCA DERECHA","c_lechero":false,"criador":"Hermanos Arabia Torres SAS â€” Hda La Fortuna, Arjona, BolÃ­var","genealogia":{"padre":{"nombre":"EL TESORO GENECO","numero":"433/7","registro":"MGY042037","padre_paterno":"COWBOY TE DE BRAS. RRP/5395 (MGY009625)","madre_paterna":"EL TESORO GINEBRA T.E. 106/5 (HGY042036)"},"madre":{"nombre":"JFH SAN PABLO MELY GENHIS T.E.","numero":"272/18","registro":"HGY044826","padre_materno":"GENGIS KHAN DE BRASILIA RRP/6097 (MGY020627)","madre_materna":"HDV. ESTAÃ‘O ELENA 121/9 (HGY010492)"},"abuelos_paternos":{"pp":"FANTOCHE DE BRASILIA A/9658 (MGY000086)","pm":"PROFANA DE BRAS. RRP/4352 (HGY4352Z)","mp":"GABINETE SILVANIA EFC/946 (MGY015971)","mm":"CV LIMONES SANSAO PALETA T.E. 954/98 (HGY009507)"},"abuelos_maternos":{"pp":"C.A. SANSAO 472 (MGY000529)","pm":"SETIBA DE BRASILIA RRP/4751 (HGY4751Z)","mp":"ESTANHO TE KUBERA ACFG/813 (MGY005205)","mm":"HDV. RABINO TE RAPERA 352/6 (HGY005340)"}}},{"id":"124/75","nombre":"SAUDITA HYDRA DE INKA","categoria":"Ternera","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Blanco y Rojo","nacimiento":"2025-07-11","peso":47,"cc":"2.5","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"BOLSONARO COND. FENIX FNIX/1956 (MGY1956Z)","madre":"012/1","partos":0,"obs":"Cert. AsocebÃº HGY115584 | Hembra PU Gyr 100% | IA | NaciÃ³ 11/07/2025 | Padre: BOLSONARO COND. FENIX FNIX/1956 (MGY1956Z) | Madre: SAUDITA GALAXIA 012/1 (HGY066183) | Marca: Pierna Derecha / Anca Derecha | Criador: Hermanos Arabia Torres SAS","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013504,"madreId":"012/1","madreNom":"SAUDITA GALAXIA","sexo":"Hembra","registro":"HGY115584","tipo_reg":"IA","tipo_animal":"PU","marca":"PIERNA DERECHA â€” ANCA DERECHA","c_lechero":false,"criador":"Hermanos Arabia Torres SAS â€” Hda La Fortuna, Arjona, BolÃ­var","genealogia":{"padre":{"nombre":"BOLSONARO COND. FENIX","numero":"FNIX/1956","registro":"MGY1956Z","padre_paterno":"EDANK TE JABAQUARA EVPF/444 (MGY444Z)","madre_paterna":"MIKI FIV CAL CAL/12893 (HGY12893Z)"},"madre":{"nombre":"SAUDITA GALAXIA","numero":"012/1","registro":"HGY066183","padre_materno":"EL TESORO GENECO 433/7 (MGY042037)","madre_materna":"RIO GRANDE 2573/17 T.E. (HGY041554)"},"abuelos_paternos":{"pp":"TABU TE CAL CAL/6557 (MGY1022744)","pm":"HIRANA FIV DE BRAS. RRP/6393 (HGY6393Z)","mp":"GOLDEN FIV CAL CAL/11281 (MGY11281Z)","mm":"EMPRESARIA FIV CAL CAL/9912 (HGY9912Z)"},"abuelos_maternos":{"pp":"COWBOY TE DE BRAS. RRP/5395 (MGY009625)","pm":"EL TESORO GINEBRA T.E. 106/5 (HGY042036)","mp":"C.A. SANSAO 472 (MGY000529)","mm":"IV IMPRESOR GALAXIA T.E. 111/57 (HGY006139)"}}},{"id":"125/75","nombre":"Ternera de 069-1","categoria":"Ternera","raza":"","composicion":[],"color":"Careta","nacimiento":"2025-07-24","peso":50,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"069/1","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013505,"madreId":"069/1","madreNom":"069/1"},{"id":"719/85","nombre":"Ternero de 007-6","categoria":"Ternero","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-08-03","peso":60,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"007/6","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013506,"madreId":"007/6","madreNom":"007/6"},{"id":"127/85","nombre":"Ternera de 038-8","categoria":"Ternera","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-08-06","peso":53,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"038/8","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013507,"madreId":"038/8","madreNom":"038/8"},{"id":"128/85","nombre":"Ternera de 071-1","categoria":"Ternera","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-08-06","peso":49,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"071/1","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013508,"madreId":"071/1","madreNom":"071/1"},{"id":"720/85","nombre":"Ternero de 001-6","categoria":"Ternero","raza":"","composicion":[],"color":"Bl. lucero","nacimiento":"2025-08-21","peso":37,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"001/6","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013509,"madreId":"001/6","madreNom":"001/6"},{"id":"130/85","nombre":"Ternera de 036-8","categoria":"Ternera","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-08-31","peso":46,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"036/8","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013510,"madreId":"036/8","madreNom":"036/8"},{"id":"131/95","nombre":"Ternera de 041-8","categoria":"Ternera","raza":"","composicion":[],"color":"Blanco","nacimiento":"2025-09-16","peso":46,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"041/8","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013511,"madreId":"041/8","madreNom":"041/8"},{"id":"721/95","nombre":"Ternero de 0013","categoria":"Ternero","raza":"","composicion":[],"color":"â€”","nacimiento":"2025-09-22","peso":46,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"0013","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013512,"madreId":"0013","madreNom":"0013"},{"id":"722/05","nombre":"Ternero de 010-7","categoria":"Ternero","raza":"","composicion":[],"color":"Rojo lucero","nacimiento":"2025-10-07","peso":33,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"010/7","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013513,"madreId":"010/7","madreNom":"010/7"},{"id":"134/15","nombre":"Ternera de 241-42","categoria":"Ternera","raza":"","composicion":[],"color":"Baya","nacimiento":"2025-10-27","peso":21,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"241/42","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013514,"madreId":"241/42","madreNom":"241/42"},{"id":"135/15","nombre":"Ternera de 0015","categoria":"Ternera","raza":"","composicion":[],"color":"Roja","nacimiento":"2025-11-21","peso":31,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"0015","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013515,"madreId":"0015","madreNom":"0015"},{"id":"136/15","nombre":"Ternera de 039-8","categoria":"Ternera","raza":"","composicion":[],"color":"Roja","nacimiento":"2025-11-25","peso":24,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"039/8","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013516,"madreId":"039/8","madreNom":"039/8"},{"id":"137/25","nombre":"Ternera de 015-7","categoria":"Ternera","raza":"","composicion":[],"color":"Roja","nacimiento":"2025-12-14","peso":27,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"015/7","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013517,"madreId":"015/7","madreNom":"015/7"},{"id":"138/25","nombre":"Ternera de 0007","categoria":"Ternera","raza":"","composicion":[],"color":"Roja","nacimiento":"2025-12-15","peso":26,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"0007","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013518,"madreId":"0007","madreNom":"0007"},{"id":"723/16","nombre":"Ternero de 026-4","categoria":"Ternero","raza":"","composicion":[],"color":"Rojo","nacimiento":"2026-01-07","peso":23,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"026/4","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013519,"madreId":"026/4","madreNom":"026/4"},{"id":"CRI-021","nombre":"Ternero de 031-7","categoria":"Ternero","raza":"","composicion":[],"color":"Rojo","nacimiento":"2026-01-12","peso":0,"cc":"2.5","estado":"baja","potrero":"","litros":0,"padre":"","madre":"031/7","partos":0,"obs":"Distocia â€” crÃ­a muerta e inflamada","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013520,"madreId":"031/7","madreNom":"031/7"},{"id":"CRI-022","nombre":"Ternero de 0010","categoria":"Ternero","raza":"","composicion":[],"color":"Blanco","nacimiento":"2026-01-25","peso":37,"cc":"2.5","estado":"baja","potrero":"","litros":0,"padre":"","madre":"0010","partos":0,"obs":"CrÃ­a muerta 29/01/26","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013521,"madreId":"0010","madreNom":"0010"},{"id":"141/26","nombre":"Ternera de 0003","categoria":"Ternera","raza":"","composicion":[],"color":"R. lucero","nacimiento":"2026-02-19","peso":22,"cc":"2.5","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"","madre":"0003","partos":0,"obs":"","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1736200013522,"madreId":"0003","madreNom":"0003"},{"id":"716/43","nombre":"OB INDRA DE ORO T.E.","categoria":"Novilla","raza":"Gyr 100%","composicion":[{"raza":"Gyr","pct":100}],"color":"Blanco y Rojo","nacimiento":"2023-06-27","peso":0,"cc":"3.0","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"IVA FIV DE BRAS. RRP/6668 (MGY6668Z)","madre":"OB RABINA DE ORO 005/1/17 (HGY036353)","partos":0,"obs":"Reg. AsocebÃº HGY091384 | PU | TE | Lechero: No | Criador: Inversiones Agroganadera Oro Blanco - Hda Oro Blanco, Toluviejo, Sucre | ğŸŸ¡ Eco programada 26/02â€“03/03/2026 | Servicio 27/01/26 â€” OB Zafnat de Oro T.E. #717/43","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1740000001000,"registro":"HGY091384"},{"id":"717/43","nombre":"OB ZAFNAT DE ORO","categoria":"Toro","raza":"Gyr","composicion":[{"raza":"Gyr","pct":100}],"color":"Rojo","nacimiento":"2023-04-07","peso":427,"cc":"3.0","estado":"activa","potrero":"P11 â€” La Casa","litros":0,"padre":"JOGRAL FIV DE BRAS. RRP/6968 (MGY6968Z)","madre":"OB SANTILLANA DE ORO T.E. 053/7/15 (HGY028253)","partos":0,"obs":"Cert. AsocebÃº MGY085782 | Tipo: PU Gyr 100% | NaciÃ³ 07/04/2023 | Marca: Pierna Derecha / Anca Derecha | Padre: JOGRAL FIV DE BRAS. RRP/6968 (MGY6968Z) | Madre: OB SANTILLANA DE ORO T.E. 053/7/15 (HGY028253) | Usado en servicios: 236-4 (20/12/25), 128-3 (12/01/26), OB Indra de Oro (27/01/26), 041-8 (29/01/26), 036-8 (29/01/26)","_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null,"_ts":1740000002000,"registro":"MGY085782","tipo_reg":"IA","tipo_animal":"PU","marca":"PIERNA DERECHA â€” ANCA DERECHA","c_lechero":false,"genotipificado":false,"genealogia":{"padre":{"nombre":"JOGRAL FIV DE BRAS.","numero":"RRP/6968","registro":"MGY6968Z","padre_paterno":"SUPRA-SUMO DE BRASILIA RRP/4718 (MGY000953)","madre_paterna":"SURPRESA DE BRAS. RRP/4706 (HGY4706Z)"},"madre":{"nombre":"OB SANTILLANA DE ORO T.E.","numero":"053/7/15","registro":"HGY028253","padre_materno":"KALIKA FIV VILA RICA GIVR/195 (MGY015964)","madre_materna":"HDV. EVEREST EVANGELINA T.E. 152/4 (HGY002714)"},"abuelos_paternos":{"pp":"EMBAIXADOR DE BRAS A/9552 (MGY000535)","pm":"INDIA DE BRAS AA/3325 (HGY3325Z)","mp":"GARIMPO TE DE BRAS A/9657 (MGY000092)","mm":"LUZIADA DE BRASILIA AA/8638 (HGY008638Z)"},"abuelos_maternos":{"pp":"RADAR DOS POCOES A/7368 (MGY000473)","pm":"SOLUCAO DE BRAS. RRP/4693 (HGY04693Z)","mp":"C.A. EVEREST B/805 (MGY000106)","mm":"HDV BENFEITOR BAILARINA 035/00 (HGY000988)"}},"criador":"Inversiones Agroganadera Oro Blanco â€” Hda Oro Blanco, Toluviejo, Sucre"},{"id":"139/16","nombre":"Ternera de 023-7","categoria":"Ternera","raza":"","composicion":[],"color":"Roja","nacimiento":"2026-01-21","peso":25,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"023/7","partos":0,"obs":"Nacida 21/01/2026 | Color: Roja","_ts":1740100000001,"madreId":"023/7","madreNom":"023/7"},{"id":"140/16","nombre":"Ternera de 012/72","categoria":"Ternera","raza":"","composicion":[],"color":"Roja","nacimiento":"2026-01-27","peso":40,"cc":"2.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"012/72","partos":0,"obs":"Nacida 27/01/2026 | Color: Roja","_ts":1740100000002,"madreId":"012/72","madreNom":"012/72"},{"id":"000/9","nombre":"000/9","categoria":"Vaca","raza":"Doble PropÃ³sito","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Receptora TE ciclo Phoenix 30/09/25 â€” Dx sincronizaciÃ³n: CLD â€” Vendida por no quedar preÃ±ada"},{"id":"0002","nombre":"0002","categoria":"Vaca","raza":"Doble PropÃ³sito","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Receptora TE ciclo Phoenix 30/09/25 â€” Dx sincronizaciÃ³n: CLE â€” Vendida por no quedar preÃ±ada"},{"id":"0004","nombre":"0004","categoria":"Vaca","raza":"Doble PropÃ³sito","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Receptora TE ciclo Phoenix 30/09/25 â€” Dx sincronizaciÃ³n: CLI â€” Vendida por no quedar preÃ±ada"},{"id":"0011","nombre":"0011","categoria":"Vaca","raza":"Doble PropÃ³sito","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Receptora TE ciclo Phoenix 30/09/25 â€” Dx sincronizaciÃ³n:  â€” Vendida por no quedar preÃ±ada"},{"id":"0027","nombre":"0027","categoria":"Vaca","raza":"Doble PropÃ³sito","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Receptora TE ciclo Phoenix 30/09/25 â€” Dx sincronizaciÃ³n: CLO â€” Vendida por no quedar preÃ±ada"},{"id":"245/3","nombre":"245/3","categoria":"Novilla","raza":"Doble PropÃ³sito","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"baja","potrero":"","litros":0,"padre":"","madre":"","partos":0,"obs":"Receptora TE ciclo Phoenix 30/09/25 â€” Dx sincronizaciÃ³n: CLI â€” Vendida por no quedar preÃ±ada"},{"id":"126/85","nombre":"Ternera de 007-6","categoria":"Ternera","raza":"Cebuino (CebÃº Comerc. 87.50%, Holstein 12.50%)","composicion":[{"raza":"CebÃº Comercial","pct":87.5},{"raza":"Holstein Neg.","pct":12.5}],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"007/6","partos":0,"obs":"Ternera hembra de 007-6 (LUZ MOROCHA CARAMELO)"},{"id":"129/85","nombre":"Ternera de 001-6","categoria":"Ternera","raza":"Cebuino (GYR 21.88%, Holstein 26.57%, Brahman 25.77%, CebÃº Comerc. 25.78%)","composicion":[{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":26.57},{"raza":"Brahman Gr.","pct":25.77},{"raza":"CebÃº Comercial","pct":25.78}],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"001/6","partos":0,"obs":"Ternera hembra de 001-6 (FRENTONA DILUVIO MENCHO)"},{"id":"132/95","nombre":"Ternera de 0013","categoria":"Ternera","raza":"","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"0013","partos":0,"obs":"Ternera hembra de 0013 (0013)"},{"id":"133/05","nombre":"Ternera de 010-7","categoria":"Ternera","raza":"","composicion":[],"color":"â€”","nacimiento":"","peso":0,"cc":"â€”","estado":"activa","potrero":"P01 â€” La Herencia","litros":0,"padre":"","madre":"010/7","partos":0,"obs":"Ternera hembra de 010-7 (010/7)"},{"id":"012/72","nombre":"COROCITO CHICUACO","categoria":"Vaca","raza":"Cebuino (CebÃº Comerc. 87.50%, Holstein R. 12.50%)","composicion":[{"raza":"CebÃº Comercial","pct":87.5},{"raza":"Holstein R.","pct":12.5}],"color":"Rojo","nacimiento":"2017-02-05","peso":383,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":3.62,"padre":"196-3","madre":"232-0","partos":2,"obs":"Parto 27/01/2026 â€” crÃ­a hembra roja activa | InvoluciÃ³n postparto â€” sucia | Vaca parida - Palpada. 1,315 dÃ­as abtos (al 30/01/26). Hierro HHH","_ts":1738800023000,"_dx":"InvoluciÃ³n","_categoria_repro":"InvoluciÃ³n","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"226/4","nombre":"ALVARACO","categoria":"Vaca","nacimiento":"2015-06-28","color":"Osco","padre":"","madre":"200-8","raza":"Indeterminado (CebÃº Comerc. 37.50%, Holstein 12.50%)","composicion":[{"raza":"CebÃº Comercial","pct":37.5},{"raza":"Holstein Neg.","pct":12.5}],"peso":444,"cc":"3.5","estado":"activa","potrero":"P01 â€” La Herencia","litros":4.47,"partos":4,"obs":"Vaca parida - VacÃ­a sin palpar. 1,270 dÃ­as abtos (al 30/01/26) | Ternera 123/15 nacida 21/01/2025","_ts":1738800100000,"_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null},{"id":"241/42","nombre":"AMADA DIEGO DILUVIO MENCHO","categoria":"Vaca","nacimiento":"2014-12-04","color":"Negro","padre":"","madre":"198-8","raza":"Taurino (GYR 21.88%, Holstein 51.55%, Brahman 0.79%, CebÃº Comerc. 25.78%)","composicion":[{"raza":"GYR","pct":21.88},{"raza":"Holstein Neg.","pct":51.55},{"raza":"Brahman Gr.","pct":0.79},{"raza":"CebÃº Comercial","pct":25.78}],"peso":425,"cc":"3.0","estado":"activa","potrero":"P01 â€” La Herencia","litros":0.05,"partos":4,"obs":"Vaca parida - Palpada. 1,310 dÃ­as abtos (al 30/01/26). Hierro FHH | VacÃ­a Ovarios EstÃ¡ticos | Ternera 134/15 nacida 27/10/2025","_ts":1738800101000,"_dx":"","_categoria_repro":"","_dias_gest":null,"_dias_rest":null,"_fecha_parto":null}];
  const _SS=[{"id":693127923,"fecha":"2025-10-14","animalId":"638/3","animalNombre":"638/3","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","diagnostico":"preÃ±ada","inseminador":"","obs":"DX: (+) 114 â€” 114 dÃ­as gestaciÃ³n al 05/Feb/2026","raza_toro":"Holstein"},{"id":1022255764,"fecha":"2025-09-23","animalId":"0018","animalNombre":"0018","metodo":"TE â€” Transferencia Embriones","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"reemplazado por TE","inseminador":"","obs":"DX: (+) 135 â€” 135 dÃ­as gestaciÃ³n al 05/Feb/2026 | REEMPLAZADO: se transfiriÃ³ embriÃ³n Phoenix/012-1 el 30/09/25","resultado":"reemplazado por TE"},{"id":2023893628,"fecha":"2026-01-06","animalId":"010/7","animalNombre":"010/7","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"preÃ±ada","inseminador":"","obs":"DX: +30 â€” 30 dÃ­as gestaciÃ³n al 05/Feb/2026"},{"id":2056546205,"fecha":"2025-10-14","animalId":"0001","animalNombre":"0001","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","diagnostico":"preÃ±ada","inseminador":"","obs":"DX: (+) 114 â€” 114 dÃ­as gestaciÃ³n al 05/Feb/2026","raza_toro":"Holstein"},{"id":1197367103,"fecha":"2025-10-14","animalId":"272/18","animalNombre":"272/18","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","diagnostico":"preÃ±ada","inseminador":"","obs":"DX: (+) 114 â€” 114 dÃ­as gestaciÃ³n al 05/Feb/2026","raza_toro":"Holstein"},{"fecha":"2025-12-20","animalId":"236/4","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"","inseminador":"Zafnat","obs":"Ventana eco 30-35d ya pasada â€” re-evaluar","id":20648,"animalNombre":"236/4"},{"fecha":"2026-01-12","animalId":"128/3","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"","inseminador":"Zafnat","obs":"Ventana eco 11-16/02/26","id":3985,"animalNombre":"128/3"},{"fecha":"2026-01-27","animalId":"716/43","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"","inseminador":"Zafnat","obs":"Ventana eco 26/02-03/03/26","id":14438,"animalNombre":"716/43"},{"fecha":"2026-01-29","animalId":"041/8","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"","inseminador":"Zafnat","obs":"Ventana eco 28/02-05/03/26","id":12465,"animalNombre":"041/8"},{"fecha":"2026-01-29","animalId":"036/8","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"OB Zafnat de Oro T.E. #717/43","diagnostico":"","inseminador":"Zafnat","obs":"Seguimiento reproductivo","id":60708,"animalNombre":"036/8"},{"id":2056546206,"fecha":"2025-10-14","animalId":"007/6","animalNombre":"LUZ MOROCHA CARAMELO","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"no preÃ±ada","resultado":"no preÃ±ada","ovario":"OI","cc":"3.3","obs":"IA Mercury Holstein â€” OI â€” CC 3.3"},{"id":2056546207,"fecha":"2025-10-14","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"no preÃ±ada","resultado":"no preÃ±ada","ovario":"OI","cc":"3.0","obs":"IA Mercury Holstein â€” OI â€” CC 3.0"},{"id":2056546208,"fecha":"2025-10-14","animalId":"012/1","animalNombre":"SAUDITA GALAXIA","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"no preÃ±ada","resultado":"no preÃ±ada","ovario":"OD","cc":"2.5","obs":"IA Mercury Holstein â€” OD â€” CC 2.5"},{"id":2056546209,"fecha":"2025-10-14","animalId":"272/18","animalNombre":"JFH SAN PABLO MELY GENHIS T.E.","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"preÃ±ada","resultado":"preÃ±ada","ovario":"OI","cc":"3.3","obs":"IA Mercury Holstein â€” OI â€” CC 3.3 â€” CL I (Cuerpo LÃºteo)"},{"id":2056546210,"fecha":"2025-10-14","animalId":"638/3","animalNombre":"JJBT SIRENITA T.E.","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"preÃ±ada","resultado":"preÃ±ada","ovario":"OD","cc":"3.5","obs":"IA Mercury Holstein â€” OD â€” CC 3.5"},{"id":2056546211,"fecha":"2025-10-14","animalId":"038/8","animalNombre":"ALVARACO PECOSO DILUVIO","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"no preÃ±ada","resultado":"no preÃ±ada","ovario":"OD","cc":"3.0","obs":"IA Mercury Holstein â€” OD â€” CC 3.0"},{"id":2056546212,"fecha":"2025-10-14","animalId":"0001","animalNombre":"0001","metodo":"IA â€” InseminaciÃ³n Artificial","toro":"AGRONOMÃA METRO MERCURY (REG 13162)","raza_toro":"Holstein","inseminador":"Carlos Villa (C.C. 1.233.339.499)","diagnostico":"preÃ±ada","resultado":"preÃ±ada","ovario":"OI","cc":"3.3","obs":"IA Mercury Holstein â€” OI â€” CC 3.3 â€” 3 pajillas"},{"id":2056546213,"fecha":"2025-09-22","animalId":"012/1","animalNombre":"SAUDITA GALAXIA","metodo":"OPU â€” AspiraciÃ³n Folicular FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado","inseminador":"Embriones del SinÃº â€” Equipo JoaquÃ­n/AndrÃ©s","diagnostico":"Donante OPU | Oocitos: 23 | Clivaje: 5 (22%) | Emb D6: 2 | MÃ³rulas D6: 1","obs":"OPU FIV Embriones del SinÃº 22/09/25 | TÃ©cnico FIV: Carolina V. (23/09/25) | Semen sexado lote 11124"},{"id":2056546214,"fecha":"2025-09-22","animalId":"716/43","animalNombre":"OB INDRA DE ORO T.E.","metodo":"OPU â€” AspiraciÃ³n Folicular FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado","inseminador":"Embriones del SinÃº â€” Equipo JoaquÃ­n/AndrÃ©s","diagnostico":"Donante OPU | Oocitos: 48 | Clivaje: 25 (52%) | Emb D6: 5 | MÃ³rulas D6: 5","obs":"OPU FIV Embriones del SinÃº 22/09/25 | TÃ©cnico FIV: Carolina V. (23/09/25) | Semen sexado lote 11124"},{"id":2056546215,"fecha":"2025-09-22","animalId":"272/18","animalNombre":"JFH SAN PABLO MELY GENHIS T.E.","metodo":"OPU â€” AspiraciÃ³n Folicular FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado","inseminador":"Embriones del SinÃº â€” Equipo JoaquÃ­n/AndrÃ©s","diagnostico":"Donante OPU | Oocitos: 12 | Clivaje: 8 (67%) | Emb D6: 2 | MÃ³rulas D6: 1","obs":"OPU FIV Embriones del SinÃº 22/09/25 | TÃ©cnico FIV: Carolina V. (23/09/25) | Semen sexado lote 11124"},{"id":2056546216,"fecha":"2025-09-22","animalId":"638/3","animalNombre":"JJBT SIRENITA T.E.","metodo":"OPU â€” AspiraciÃ³n Folicular FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado","inseminador":"Embriones del SinÃº â€” Equipo JoaquÃ­n/AndrÃ©s","diagnostico":"Donante OPU | Oocitos: 7 | Clivaje: 6 (86%) | Emb D6: 0 | MÃ³rulas D6: 1","obs":"OPU FIV Embriones del SinÃº 22/09/25 | TÃ©cnico FIV: Carolina V. (23/09/25) | Semen sexado lote 11124"},{"id":2056546217,"fecha":"2025-09-30","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","metodo":"TE â€” Transferencia de EmbriÃ³n FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado A2A2","inseminador":"Isaul Castillo â€” Embriones del SinÃº","diagnostico":"","donante_genetica":"716/43","lado_cl":"OI","obs":"TE FIV | EmbriÃ³n BX de 716-63 Ã— Phoenix | Receptora evaluada 12/09/25 | Transferidor: Isaul Castillo | Temp: 37.1Â°C | CIV 37.1Â°C"},{"id":2056546218,"fecha":"2025-09-30","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","metodo":"TE â€” Transferencia de EmbriÃ³n FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado A2A2","inseminador":"Isaul Castillo â€” Embriones del SinÃº","diagnostico":"","donante_genetica":"716/43","lado_cl":"OD","obs":"TE FIV | EmbriÃ³n BX de 716-63 Ã— Phoenix | Receptora evaluada 12/09/25 | Transferidor: Isaul Castillo | Temp: 37.1Â°C | CIV 37.1Â°C"},{"id":2056546219,"fecha":"2025-09-30","animalId":"071/1","animalNombre":"DELFINA LA LEYENDA FAR","metodo":"TE â€” Transferencia de EmbriÃ³n FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado A2A2","inseminador":"Isaul Castillo â€” Embriones del SinÃº","diagnostico":"","donante_genetica":"716/43","lado_cl":"OD","obs":"TE FIV | EmbriÃ³n BX de 716-63 Ã— Phoenix | Receptora evaluada 12/09/25 | Transferidor: Isaul Castillo | Temp: 37.1Â°C | CIV 37.1Â°C"},{"id":2056546220,"fecha":"2025-09-30","animalId":"000/9","animalNombre":"000/9","metodo":"TE â€” Transferencia de EmbriÃ³n FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado A2A2","inseminador":"Isaul Castillo â€” Embriones del SinÃº","diagnostico":"","donante_genetica":"272/18","lado_cl":"OD","obs":"TE FIV | EmbriÃ³n BX de 272-18 Ã— Phoenix | Receptora evaluada 12/09/25 | Transferidor: Isaul Castillo | Temp: 37.1Â°C | CIV 37.1Â°C"},{"id":2056546221,"fecha":"2025-09-30","animalId":"0011","animalNombre":"0011","metodo":"TE â€” Transferencia de EmbriÃ³n FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado A2A2","inseminador":"Isaul Castillo â€” Embriones del SinÃº","diagnostico":"","donante_genetica":"272/18","lado_cl":"OD","obs":"TE FIV | EmbriÃ³n BX de 272-18 Ã— Phoenix | Receptora evaluada 12/09/25 | Transferidor: Isaul Castillo | Temp: 37.1Â°C | CIV 37.1Â°C"},{"id":2056546222,"fecha":"2025-09-30","animalId":"0018","animalNombre":"0018","metodo":"TE â€” Transferencia de EmbriÃ³n FIV","toro":"PHOENIX 7HO16468 (T-Spruce Phoenix 2176-ET)","raza_toro":"Holstein Sexado A2A2","inseminador":"Isaul Castillo â€” Embriones del SinÃº","diagnostico":"","donante_genetica":"012/1","lado_cl":"OD","obs":"TE FIV | EmbriÃ³n BX de 012-1 Ã— Phoenix | Receptora evaluada 12/09/25 | Transferidor: Isaul Castillo | Temp: 37.1Â°C | CIV 37.1Â°C"}];
  const _SP=[{"id":1736200013000,"fecha":"2025-01-11","madreId":"236/4","madreNombre":"236/4","criaId":"122/15","criaNombre":"CrÃ­a de 236-4","sexo":"Hembra","peso":0,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013001,"fecha":"2025-01-21","madreId":"226/4","madreNombre":"226/4","criaId":"123/15","criaNombre":"CrÃ­a de 226-4","sexo":"Hembra","peso":26,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013002,"fecha":"2025-02-16","madreId":"009/6","madreNombre":"009/6","criaId":"CRI-003","criaNombre":"CrÃ­a de 009-6","sexo":"Macho","peso":0,"tipo":"Natural","facilidad":1,"obs":"CrÃ­a vendida 22/11/25 â€” 144kg â€” $1.224.000"},{"id":1736200013003,"fecha":"2025-04-04","madreId":"272/18","madreNombre":"272/18","criaId":"718/45","criaNombre":"SAUDITA ODISEO DE INKA","sexo":"Macho","peso":23,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013004,"fecha":"2025-07-11","madreId":"012/1","madreNombre":"012/1","criaId":"124/75","criaNombre":"SAUDITA HYDRA DE INKA","sexo":"Hembra","peso":23,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013005,"fecha":"2025-07-24","madreId":"069/1","madreNombre":"069/1","criaId":"125/75","criaNombre":"CrÃ­a de 069-1","sexo":"Hembra","peso":33,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013006,"fecha":"2025-08-03","madreId":"007/6","madreNombre":"007/6","criaId":"719/85","criaNombre":"CrÃ­a de 007-6","sexo":"Macho","peso":0,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013007,"fecha":"2025-08-06","madreId":"038/8","madreNombre":"038/8","criaId":"127/85","criaNombre":"CrÃ­a de 038-8","sexo":"Hembra","peso":0,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013008,"fecha":"2025-08-06","madreId":"071/1","madreNombre":"071/1","criaId":"128/85","criaNombre":"CrÃ­a de 071-1","sexo":"Hembra","peso":0,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013009,"fecha":"2025-08-21","madreId":"001/6","madreNombre":"001/6","criaId":"720/85","criaNombre":"CrÃ­a de 001-6","sexo":"Macho","peso":24,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013010,"fecha":"2025-08-31","madreId":"036/8","madreNombre":"036/8","criaId":"130/85","criaNombre":"CrÃ­a de 036-8","sexo":"Hembra","peso":0,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013011,"fecha":"2025-09-16","madreId":"041/8","madreNombre":"041/8","criaId":"131/95","criaNombre":"CrÃ­a de 041-8","sexo":"Hembra","peso":25,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013012,"fecha":"2025-09-22","madreId":"0013","madreNombre":"0013","criaId":"721/95","criaNombre":"CrÃ­a de 0013","sexo":"Macho","peso":35,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013013,"fecha":"2025-10-07","madreId":"010/7","madreNombre":"010/7","criaId":"722/05","criaNombre":"CrÃ­a de 010-7","sexo":"Macho","peso":33,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013014,"fecha":"2025-10-27","madreId":"241/42","madreNombre":"241/42","criaId":"134/15","criaNombre":"CrÃ­a de 241-42","sexo":"Hembra","peso":21,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013015,"fecha":"2025-11-21","madreId":"0015","madreNombre":"0015","criaId":"135/15","criaNombre":"CrÃ­a de 0015","sexo":"Hembra","peso":31,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013016,"fecha":"2025-11-25","madreId":"039/8","madreNombre":"039/8","criaId":"136/15","criaNombre":"CrÃ­a de 039-8","sexo":"Hembra","peso":24,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013017,"fecha":"2025-12-14","madreId":"015/7","madreNombre":"015/7","criaId":"137/25","criaNombre":"CrÃ­a de 015-7","sexo":"Hembra","peso":27,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013018,"fecha":"2025-12-15","madreId":"0007","madreNombre":"0007","criaId":"138/25","criaNombre":"CrÃ­a de 0007","sexo":"Hembra","peso":26,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013019,"fecha":"2026-01-07","madreId":"026/4","madreNombre":"026/4","criaId":"723/16","criaNombre":"CrÃ­a de 026-4","sexo":"Macho","peso":23,"tipo":"Natural","facilidad":1,"obs":""},{"id":1736200013020,"fecha":"2026-01-12","madreId":"031/7","madreNombre":"031/7","criaId":"CRI-021","criaNombre":"CrÃ­a de 031-7","sexo":"Macho","peso":0,"tipo":"Asistido","facilidad":3,"obs":"Distocia â€” crÃ­a muerta e inflamada"},{"id":1736200013021,"fecha":"2026-01-25","madreId":"0010","madreNombre":"0010","criaId":"CRI-022","criaNombre":"CrÃ­a de 0010","sexo":"Macho","peso":37,"tipo":"Natural","facilidad":1,"obs":"CrÃ­a muerta 29/01/26"},{"id":1736200013022,"fecha":"2026-02-19","madreId":"0003","madreNombre":"0003","criaId":"141/26","criaNombre":"CrÃ­a de 0003","sexo":"Hembra","peso":22,"tipo":"Natural","facilidad":1,"obs":""},{"id":1740100000001,"fecha":"2026-01-21","madreId":"023/7","madreNombre":"023/7","criaId":"139/16","criaNombre":"CrÃ­a de 023-7","sexo":"Hembra","peso":25,"tipo":"Natural","facilidad":1,"obs":"Color: Roja"},{"id":1740100000002,"fecha":"2026-01-27","madreId":"012/72","madreNombre":"012/72","criaId":"140/16","criaNombre":"CrÃ­a de 012/72","sexo":"Hembra","peso":40,"tipo":"Natural","facilidad":1,"obs":"Color: Roja"},{"id":1741000000000,"fecha":"2025-12-08","madreId":"0013","madreNombre":"0013","criaNombre":"CrÃ­a de 0013 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000001000,"fecha":"2025-01-13","madreId":"003/5","madreNombre":"003/5","criaNombre":"CrÃ­a de 003-5 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000002000,"fecha":"2025-12-08","madreId":"007/6","madreNombre":"007/6","criaNombre":"CrÃ­a de 007-6 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000003000,"fecha":"2025-12-08","madreId":"009/6","madreNombre":"009/6","criaNombre":"CrÃ­a de 009-6 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000004000,"fecha":"2025-01-13","madreId":"012/72","madreNombre":"012/72","criaNombre":"CrÃ­a de 012/72 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000005000,"fecha":"2025-01-13","madreId":"015/7","madreNombre":"015/7","criaNombre":"CrÃ­a de 015-7 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000006000,"fecha":"2025-01-13","madreId":"026/4","madreNombre":"026/4","criaNombre":"CrÃ­a de 026-4 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000007000,"fecha":"2025-01-13","madreId":"031/7","madreNombre":"031/7","criaNombre":"CrÃ­a de 031-7 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000008000,"fecha":"2025-01-13","madreId":"036/8","madreNombre":"036/8","criaNombre":"CrÃ­a de 036-8 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000009000,"fecha":"2025-12-08","madreId":"036/8","madreNombre":"036/8","criaNombre":"CrÃ­a de 036-8 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000010000,"fecha":"2025-12-08","madreId":"038/8","madreNombre":"038/8","criaNombre":"CrÃ­a de 038-8 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000011000,"fecha":"2025-01-13","madreId":"039/8","madreNombre":"039/8","criaNombre":"CrÃ­a de 039-8 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000012000,"fecha":"2025-01-13","madreId":"041/8","madreNombre":"041/8","criaNombre":"CrÃ­a de 041-8 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000013000,"fecha":"2025-12-08","madreId":"041/8","madreNombre":"041/8","criaNombre":"CrÃ­a de 041-8 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000014000,"fecha":"2025-01-13","madreId":"069/1","madreNombre":"069/1","criaNombre":"CrÃ­a de 069-1 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000015000,"fecha":"2025-12-08","madreId":"069/1","madreNombre":"069/1","criaNombre":"CrÃ­a de 069-1 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000016000,"fecha":"2025-01-13","madreId":"070/7","madreNombre":"070/7","criaNombre":"CrÃ­a de 070-7 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000017000,"fecha":"2025-12-08","madreId":"070/7","madreNombre":"070/7","criaNombre":"CrÃ­a de 070-7 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000018000,"fecha":"2025-12-08","madreId":"071/1","madreNombre":"071/1","criaNombre":"CrÃ­a de 071-1 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."},{"id":1741000019000,"fecha":"2025-12-08","madreId":"236/4","madreNombre":"236/4","criaNombre":"CrÃ­a de 236-4 (estimada)","sexoCria":"?","peso":0,"color":"â€”","obs":"Parto deducido del historial de leche (estimado). Registrar datos reales si se dispone."}];
  const _SL=[{"id":1735000000000,"fecha":"2024-12-25","animalId":"003/5","animalNombre":"003/5","o1":3.53,"o2":0,"total":3.53,"obs":"Control lechero â€” 3.64 kg"},{"id":1735000001000,"fecha":"2024-12-25","animalId":"015/7","animalNombre":"015/7","o1":3.61,"o2":0,"total":3.61,"obs":"Control lechero â€” 3.725 kg"},{"id":1735000002000,"fecha":"2024-12-25","animalId":"069/1","animalNombre":"069/1","o1":2.96,"o2":0,"total":2.96,"obs":"Control lechero â€” 3.05 kg"},{"id":1735000003000,"fecha":"2024-12-25","animalId":"031/7","animalNombre":"031/7","o1":2.39,"o2":0,"total":2.39,"obs":"Control lechero â€” 2.47 kg"},{"id":1735000004000,"fecha":"2024-12-25","animalId":"041/8","animalNombre":"041/8","o1":2.42,"o2":0,"total":2.42,"obs":"Control lechero â€” 2.5 kg"},{"id":1735000005000,"fecha":"2024-12-25","animalId":"026/4","animalNombre":"026/4","o1":2.93,"o2":0,"total":2.93,"obs":"Control lechero â€” 3.025 kg"},{"id":1735000006000,"fecha":"2024-12-25","animalId":"012/72","animalNombre":"012/72","o1":3.47,"o2":0,"total":3.47,"obs":"Control lechero â€” 3.58 kg"},{"id":1735000007000,"fecha":"2024-12-25","animalId":"241/42","animalNombre":"241/42","o1":2.1,"o2":0,"total":2.1,"obs":"Control lechero â€” 2.17 kg"},{"id":1735000008000,"fecha":"2024-12-25","animalId":"039/8","animalNombre":"039/8","o1":1.66,"o2":0,"total":1.66,"obs":"Control lechero â€” 1.715 kg"},{"id":1735000009000,"fecha":"2024-12-25","animalId":"036/8","animalNombre":"036/8","o1":2.69,"o2":0,"total":2.69,"obs":"Control lechero â€” 2.775 kg"},{"id":1735000010000,"fecha":"2024-12-25","animalId":"070/7","animalNombre":"070/7","o1":4.24,"o2":0,"total":4.24,"obs":"Control lechero â€” 4.38 kg"},{"id":1735000011000,"fecha":"2025-02-12","animalId":"026/4","animalNombre":"026/4","o1":2.14,"o2":0,"total":2.14,"obs":"Control lechero â€” 2.21 kg"},{"id":1735000012000,"fecha":"2025-02-12","animalId":"039/8","animalNombre":"039/8","o1":1.53,"o2":0,"total":1.53,"obs":"Control lechero â€” 1.58 kg"},{"id":1735000013000,"fecha":"2025-02-12","animalId":"003/5","animalNombre":"003/5","o1":4.65,"o2":0,"total":4.65,"obs":"Control lechero â€” 4.795 kg"},{"id":1735000014000,"fecha":"2025-02-12","animalId":"036/8","animalNombre":"036/8","o1":2.86,"o2":0,"total":2.86,"obs":"Control lechero â€” 2.955 kg"},{"id":1735000015000,"fecha":"2025-02-12","animalId":"236/4","animalNombre":"236/4","o1":5.86,"o2":0,"total":5.86,"obs":"Control lechero â€” 6.05 kg"},{"id":1735000016000,"fecha":"2025-02-12","animalId":"015/7","animalNombre":"015/7","o1":3.39,"o2":0,"total":3.39,"obs":"Control lechero â€” 3.5 kg"},{"id":1735000017000,"fecha":"2025-02-12","animalId":"012/72","animalNombre":"012/72","o1":2.91,"o2":0,"total":2.91,"obs":"Control lechero â€” 3.0 kg"},{"id":1735000018000,"fecha":"2025-02-12","animalId":"031/7","animalNombre":"031/7","o1":1.82,"o2":0,"total":1.82,"obs":"Control lechero â€” 1.88 kg"},{"id":1735000019000,"fecha":"2025-02-12","animalId":"070/7","animalNombre":"070/7","o1":3.49,"o2":0,"total":3.49,"obs":"Control lechero â€” 3.605 kg"},{"id":1735000020000,"fecha":"2025-02-12","animalId":"041/8","animalNombre":"041/8","o1":2.72,"o2":0,"total":2.72,"obs":"Control lechero â€” 2.805 kg"},{"id":1735000021000,"fecha":"2025-02-12","animalId":"226/4","animalNombre":"226/4","o1":4.73,"o2":0,"total":4.73,"obs":"Control lechero â€” 4.885 kg"},{"id":1735000022000,"fecha":"2025-02-12","animalId":"069/1","animalNombre":"069/1","o1":3.31,"o2":0,"total":3.31,"obs":"Control lechero â€” 3.415 kg"},{"id":1735000023000,"fecha":"2025-02-19","animalId":"003/5","animalNombre":"003/5","o1":2.33,"o2":0,"total":2.33,"obs":"Control lechero â€” 2.405 kg"},{"id":1735000024000,"fecha":"2025-02-19","animalId":"026/4","animalNombre":"026/4","o1":2.42,"o2":0,"total":2.42,"obs":"Control lechero â€” 2.5 kg"},{"id":1735000025000,"fecha":"2025-02-19","animalId":"036/8","animalNombre":"036/8","o1":2.67,"o2":0,"total":2.67,"obs":"Control lechero â€” 2.755 kg"},{"id":1735000026000,"fecha":"2025-02-19","animalId":"015/7","animalNombre":"015/7","o1":2.87,"o2":0,"total":2.87,"obs":"Control lechero â€” 2.96 kg"},{"id":1735000027000,"fecha":"2025-02-19","animalId":"012/72","animalNombre":"012/72","o1":4.17,"o2":0,"total":4.17,"obs":"Control lechero â€” 4.305 kg"},{"id":1735000028000,"fecha":"2025-02-19","animalId":"031/7","animalNombre":"031/7","o1":1.44,"o2":0,"total":1.44,"obs":"Control lechero â€” 1.49 kg"},{"id":1735000029000,"fecha":"2025-02-19","animalId":"041/8","animalNombre":"041/8","o1":2.68,"o2":0,"total":2.68,"obs":"Control lechero â€” 2.77 kg"},{"id":1735000030000,"fecha":"2025-02-19","animalId":"226/4","animalNombre":"226/4","o1":4.64,"o2":0,"total":4.64,"obs":"Control lechero â€” 4.79 kg"},{"id":1735000031000,"fecha":"2025-02-19","animalId":"069/1","animalNombre":"069/1","o1":5.86,"o2":0,"total":5.86,"obs":"Control lechero â€” 6.049 kg"},{"id":1735000032000,"fecha":"2025-02-19","animalId":"236/4","animalNombre":"236/4","o1":5.77,"o2":0,"total":5.77,"obs":"Control lechero â€” 5.95 kg"},{"id":1735000033000,"fecha":"2025-02-19","animalId":"070/7","animalNombre":"070/7","o1":2.8,"o2":0,"total":2.8,"obs":"Control lechero â€” 2.885 kg"},{"id":1735000034000,"fecha":"2025-02-19","animalId":"039/8","animalNombre":"039/8","o1":1.63,"o2":0,"total":1.63,"obs":"Control lechero â€” 1.685 kg"},{"id":1735000035000,"fecha":"2025-02-26","animalId":"026/4","animalNombre":"026/4","o1":2.42,"o2":0,"total":2.42,"obs":"Control lechero â€” 2.5 kg"},{"id":1735000036000,"fecha":"2025-02-26","animalId":"031/7","animalNombre":"031/7","o1":1.44,"o2":0,"total":1.44,"obs":"Control lechero â€” 1.49 kg"},{"id":1735000037000,"fecha":"2025-02-26","animalId":"003/5","animalNombre":"003/5","o1":2.33,"o2":0,"total":2.33,"obs":"Control lechero â€” 2.405 kg"},{"id":1735000038000,"fecha":"2025-02-26","animalId":"036/8","animalNombre":"036/8","o1":2.86,"o2":0,"total":2.86,"obs":"Control lechero â€” 2.955 kg"},{"id":1735000039000,"fecha":"2025-02-26","animalId":"236/4","animalNombre":"236/4","o1":5.77,"o2":0,"total":5.77,"obs":"Control lechero â€” 5.952 kg"},{"id":1735000040000,"fecha":"2025-02-26","animalId":"015/7","animalNombre":"015/7","o1":2.87,"o2":0,"total":2.87,"obs":"Control lechero â€” 2.96 kg"},{"id":1735000041000,"fecha":"2025-02-26","animalId":"012/72","animalNombre":"012/72","o1":4.23,"o2":0,"total":4.23,"obs":"Control lechero â€” 4.365 kg"},{"id":1735000042000,"fecha":"2025-02-26","animalId":"069/1","animalNombre":"069/1","o1":2.88,"o2":0,"total":2.88,"obs":"Control lechero â€” 2.97 kg"},{"id":1735000043000,"fecha":"2025-02-26","animalId":"226/4","animalNombre":"226/4","o1":4.64,"o2":0,"total":4.64,"obs":"Control lechero â€” 4.79 kg"},{"id":1735000044000,"fecha":"2025-02-26","animalId":"070/7","animalNombre":"070/7","o1":2.8,"o2":0,"total":2.8,"obs":"Control lechero â€” 2.885 kg"},{"id":1735000045000,"fecha":"2025-02-26","animalId":"041/8","animalNombre":"041/8","o1":2.2,"o2":0,"total":2.2,"obs":"Control lechero â€” 2.27 kg"},{"id":1735000046000,"fecha":"2025-03-12","animalId":"003/5","animalNombre":"003/5","o1":3.68,"o2":0,"total":3.68,"obs":"Control lechero â€” 3.8 kg"},{"id":1735000047000,"fecha":"2025-03-12","animalId":"031/7","animalNombre":"031/7","o1":1.23,"o2":0,"total":1.23,"obs":"Control lechero â€” 1.27 kg"},{"id":1735000048000,"fecha":"2025-03-12","animalId":"009/6","animalNombre":"009/6","o1":5.69,"o2":0,"total":5.69,"obs":"Control lechero â€” 5.87 kg"},{"id":1735000049000,"fecha":"2025-03-12","animalId":"036/8","animalNombre":"036/8","o1":2.23,"o2":0,"total":2.23,"obs":"Control lechero â€” 2.3 kg"},{"id":1735000050000,"fecha":"2025-03-12","animalId":"070/7","animalNombre":"070/7","o1":2.79,"o2":0,"total":2.79,"obs":"Control lechero â€” 2.88 kg"},{"id":1735000051000,"fecha":"2025-03-12","animalId":"226/4","animalNombre":"226/4","o1":4.84,"o2":0,"total":4.84,"obs":"Control lechero â€” 5.0 kg"},{"id":1735000052000,"fecha":"2025-03-12","animalId":"041/8","animalNombre":"041/8","o1":1.07,"o2":0,"total":1.07,"obs":"Control lechero â€” 1.105 kg"},{"id":1735000053000,"fecha":"2025-03-12","animalId":"069/1","animalNombre":"069/1","o1":1.94,"o2":0,"total":1.94,"obs":"Control lechero â€” 2.0 kg"},{"id":1735000054000,"fecha":"2025-03-12","animalId":"012/72","animalNombre":"012/72","o1":2.81,"o2":0,"total":2.81,"obs":"Control lechero â€” 2.9 kg"},{"id":1735000055000,"fecha":"2025-03-12","animalId":"015/7","animalNombre":"015/7","o1":2.67,"o2":0,"total":2.67,"obs":"Control lechero â€” 2.755 kg"},{"id":1735000056000,"fecha":"2025-03-12","animalId":"236/4","animalNombre":"236/4","o1":4.12,"o2":0,"total":4.12,"obs":"Control lechero â€” 4.255 kg"},{"id":1735000057000,"fecha":"2025-03-12","animalId":"026/4","animalNombre":"026/4","o1":2.59,"o2":0,"total":2.59,"obs":"Control lechero â€” 2.67 kg"},{"id":1735000058000,"fecha":"2025-03-12","animalId":"039/8","animalNombre":"039/8","o1":1.62,"o2":0,"total":1.62,"obs":"Control lechero â€” 1.675 kg"},{"id":1735000059000,"fecha":"2025-03-19","animalId":"026/4","animalNombre":"026/4","o1":2.94,"o2":0,"total":2.94,"obs":"Control lechero â€” 3.035 kg"},{"id":1735000060000,"fecha":"2025-03-19","animalId":"039/8","animalNombre":"039/8","o1":1.34,"o2":0,"total":1.34,"obs":"Control lechero â€” 1.38 kg"},{"id":1735000061000,"fecha":"2025-03-19","animalId":"003/5","animalNombre":"003/5","o1":3.65,"o2":0,"total":3.65,"obs":"Control lechero â€” 3.77 kg"},{"id":1735000062000,"fecha":"2025-03-19","animalId":"036/8","animalNombre":"036/8","o1":1.99,"o2":0,"total":1.99,"obs":"Control lechero â€” 2.05 kg"},{"id":1735000063000,"fecha":"2025-03-19","animalId":"236/4","animalNombre":"236/4","o1":4.68,"o2":0,"total":4.68,"obs":"Control lechero â€” 4.83 kg"},{"id":1735000064000,"fecha":"2025-03-19","animalId":"015/7","animalNombre":"015/7","o1":3.29,"o2":0,"total":3.29,"obs":"Control lechero â€” 3.4 kg"},{"id":1735000065000,"fecha":"2025-03-19","animalId":"012/72","animalNombre":"012/72","o1":2.42,"o2":0,"total":2.42,"obs":"Control lechero â€” 2.495 kg"},{"id":1735000066000,"fecha":"2025-03-19","animalId":"031/7","animalNombre":"031/7","o1":1.49,"o2":0,"total":1.49,"obs":"Control lechero â€” 1.54 kg"},{"id":1735000067000,"fecha":"2025-03-19","animalId":"070/7","animalNombre":"070/7","o1":3.18,"o2":0,"total":3.18,"obs":"Control lechero â€” 3.28 kg"},{"id":1735000068000,"fecha":"2025-03-19","animalId":"041/8","animalNombre":"041/8","o1":1.98,"o2":0,"total":1.98,"obs":"Control lechero â€” 2.045 kg"},{"id":1735000069000,"fecha":"2025-03-19","animalId":"226/4","animalNombre":"226/4","o1":4.73,"o2":0,"total":4.73,"obs":"Control lechero â€” 4.88 kg"},{"id":1735000070000,"fecha":"2025-03-19","animalId":"069/1","animalNombre":"069/1","o1":2.69,"o2":0,"total":2.69,"obs":"Control lechero â€” 2.775 kg"},{"id":1735000071000,"fecha":"2025-03-26","animalId":"009/6","animalNombre":"009/6","o1":4.14,"o2":0,"total":4.14,"obs":"Control lechero â€” 4.275 kg"},{"id":1735000072000,"fecha":"2025-03-26","animalId":"039/8","animalNombre":"039/8","o1":0.94,"o2":0,"total":0.94,"obs":"Control lechero â€” 0.975 kg"},{"id":1735000073000,"fecha":"2025-03-26","animalId":"236/4","animalNombre":"236/4","o1":3.52,"o2":0,"total":3.52,"obs":"Control lechero â€” 3.63 kg"},{"id":1735000074000,"fecha":"2025-03-26","animalId":"070/7","animalNombre":"070/7","o1":0.61,"o2":0,"total":0.61,"obs":"Control lechero â€” 0.63 kg"},{"id":1735000075000,"fecha":"2025-03-26","animalId":"015/7","animalNombre":"015/7","o1":2.31,"o2":0,"total":2.31,"obs":"Control lechero â€” 2.385 kg"},{"id":1735000076000,"fecha":"2025-03-26","animalId":"012/72","animalNombre":"012/72","o1":2.68,"o2":0,"total":2.68,"obs":"Control lechero â€” 2.77 kg"},{"id":1735000077000,"fecha":"2025-03-26","animalId":"026/4","animalNombre":"026/4","o1":2.39,"o2":0,"total":2.39,"obs":"Control lechero â€” 2.469 kg"},{"id":1735000078000,"fecha":"2025-03-26","animalId":"069/1","animalNombre":"069/1","o1":1.86,"o2":0,"total":1.86,"obs":"Control lechero â€” 1.92 kg"},{"id":1735000079000,"fecha":"2025-03-26","animalId":"003/5","animalNombre":"003/5","o1":2.65,"o2":0,"total":2.65,"obs":"Control lechero â€” 2.73 kg"},{"id":1735000080000,"fecha":"2025-03-26","animalId":"036/8","animalNombre":"036/8","o1":2.64,"o2":0,"total":2.64,"obs":"Control lechero â€” 2.725 kg"},{"id":1735000081000,"fecha":"2025-03-26","animalId":"031/7","animalNombre":"031/7","o1":1.05,"o2":0,"total":1.05,"obs":"Control lechero â€” 1.085 kg"},{"id":1735000082000,"fecha":"2025-03-26","animalId":"226/4","animalNombre":"226/4","o1":4.0,"o2":0,"total":4.0,"obs":"Control lechero â€” 4.125 kg"},{"id":1735000083000,"fecha":"2025-04-16","animalId":"009/6","animalNombre":"009/6","o1":4.63,"o2":0,"total":4.63,"obs":"Control lechero â€” 4.775 kg"},{"id":1735000084000,"fecha":"2025-04-16","animalId":"236/4","animalNombre":"236/4","o1":4.55,"o2":0,"total":4.55,"obs":"Control lechero â€” 4.7 kg"},{"id":1735000085000,"fecha":"2025-04-16","animalId":"039/8","animalNombre":"039/8","o1":0.96,"o2":0,"total":0.96,"obs":"Control lechero â€” 0.995 kg"},{"id":1735000086000,"fecha":"2025-04-16","animalId":"015/7","animalNombre":"015/7","o1":2.44,"o2":0,"total":2.44,"obs":"Control lechero â€” 2.52 kg"},{"id":1735000087000,"fecha":"2025-04-16","animalId":"012/72","animalNombre":"012/72","o1":2.8,"o2":0,"total":2.8,"obs":"Control lechero â€” 2.89 kg"},{"id":1735000088000,"fecha":"2025-04-16","animalId":"026/4","animalNombre":"026/4","o1":2.98,"o2":0,"total":2.98,"obs":"Control lechero â€” 3.08 kg"},{"id":1735000089000,"fecha":"2025-04-16","animalId":"003/5","animalNombre":"003/5","o1":4.69,"o2":0,"total":4.69,"obs":"Control lechero â€” 4.845 kg"},{"id":1735000090000,"fecha":"2025-04-16","animalId":"036/8","animalNombre":"036/8","o1":1.52,"o2":0,"total":1.52,"obs":"Control lechero â€” 1.57 kg"},{"id":1735000091000,"fecha":"2025-04-16","animalId":"226/4","animalNombre":"226/4","o1":4.23,"o2":0,"total":4.23,"obs":"Control lechero â€” 4.37 kg"},{"id":1735000092000,"fecha":"2025-04-30","animalId":"003/5","animalNombre":"003/5","o1":5.35,"o2":0,"total":5.35,"obs":"Control lechero â€” 5.52 kg"},{"id":1735000093000,"fecha":"2025-04-30","animalId":"009/6","animalNombre":"009/6","o1":4.6,"o2":0,"total":4.6,"obs":"Control lechero â€” 4.745 kg"},{"id":1735000094000,"fecha":"2025-04-30","animalId":"226/4","animalNombre":"226/4","o1":4.04,"o2":0,"total":4.04,"obs":"Control lechero â€” 4.17 kg"},{"id":1735000095000,"fecha":"2025-04-30","animalId":"015/7","animalNombre":"015/7","o1":2.99,"o2":0,"total":2.99,"obs":"Control lechero â€” 3.09 kg"},{"id":1735000096000,"fecha":"2025-04-30","animalId":"039/8","animalNombre":"039/8","o1":1.62,"o2":0,"total":1.62,"obs":"Control lechero â€” 1.675 kg"},{"id":1735000097000,"fecha":"2025-04-30","animalId":"026/4","animalNombre":"026/4","o1":3.39,"o2":0,"total":3.39,"obs":"Control lechero â€” 3.5 kg"},{"id":1735000098000,"fecha":"2025-04-30","animalId":"012/72","animalNombre":"012/72","o1":3.62,"o2":0,"total":3.62,"obs":"Control lechero â€” 3.735 kg"},{"id":1735000099000,"fecha":"2025-04-30","animalId":"236/4","animalNombre":"236/4","o1":5.01,"o2":0,"total":5.01,"obs":"Control lechero â€” 5.175 kg"},{"id":1735000100000,"fecha":"2025-05-07","animalId":"003/5","animalNombre":"003/5","o1":4.4,"o2":0,"total":4.4,"obs":"Control lechero â€” 4.54 kg"},{"id":1735000101000,"fecha":"2025-05-07","animalId":"009/6","animalNombre":"009/6","o1":3.94,"o2":0,"total":3.94,"obs":"Control lechero â€” 4.065 kg"},{"id":1735000102000,"fecha":"2025-05-07","animalId":"236/4","animalNombre":"236/4","o1":4.35,"o2":0,"total":4.35,"obs":"Control lechero â€” 4.485 kg"},{"id":1735000103000,"fecha":"2025-05-07","animalId":"015/7","animalNombre":"015/7","o1":2.77,"o2":0,"total":2.77,"obs":"Control lechero â€” 2.86 kg"},{"id":1735000104000,"fecha":"2025-05-07","animalId":"039/8","animalNombre":"039/8","o1":1.55,"o2":0,"total":1.55,"obs":"Control lechero â€” 1.6 kg"},{"id":1735000105000,"fecha":"2025-05-07","animalId":"226/4","animalNombre":"226/4","o1":3.42,"o2":0,"total":3.42,"obs":"Control lechero â€” 3.525 kg"},{"id":1735000106000,"fecha":"2025-05-07","animalId":"012/72","animalNombre":"012/72","o1":3.62,"o2":0,"total":3.62,"obs":"Control lechero â€” 3.74 kg"},{"id":1735000107000,"fecha":"2025-05-07","animalId":"026/4","animalNombre":"026/4","o1":2.91,"o2":0,"total":2.91,"obs":"Control lechero â€” 3.0 kg"},{"id":1748000000000,"fecha":"2025-10-01","animalId":"036/8","animalNombre":"036/8","o1":5.03,"o2":0,"total":5.03,"obs":"Control lechero â€” 5.19 kg"},{"id":1748000001000,"fecha":"2025-10-01","animalId":"009/6","animalNombre":"009/6","o1":2.35,"o2":0,"total":2.35,"obs":"Control lechero â€” 2.43 kg"},{"id":1748000002000,"fecha":"2025-10-01","animalId":"041/8","animalNombre":"041/8","o1":5.2,"o2":0,"total":5.2,"obs":"Control lechero â€” 5.37 kg"},{"id":1748000003000,"fecha":"2025-10-01","animalId":"001/6","animalNombre":"001/6","o1":5.83,"o2":0,"total":5.83,"obs":"Control lechero â€” 6.02 kg"},{"id":1748000004000,"fecha":"2025-10-01","animalId":"236/4","animalNombre":"236/4","o1":2.89,"o2":0,"total":2.89,"obs":"Control lechero â€” 2.98 kg"},{"id":1748000005000,"fecha":"2025-10-01","animalId":"038/8","animalNombre":"038/8","o1":6.06,"o2":0,"total":6.06,"obs":"Control lechero â€” 6.25 kg"},{"id":1748000006000,"fecha":"2025-10-01","animalId":"069/1","animalNombre":"069/1","o1":5.9,"o2":0,"total":5.9,"obs":"Control lechero â€” 6.085 kg"},{"id":1748000007000,"fecha":"2025-10-01","animalId":"071/1","animalNombre":"071/1","o1":3.37,"o2":0,"total":3.37,"obs":"Control lechero â€” 3.475 kg"},{"id":1748000008000,"fecha":"2025-10-01","animalId":"007/6","animalNombre":"007/6","o1":5.21,"o2":0,"total":5.21,"obs":"Control lechero â€” 5.38 kg"},{"id":1748000009000,"fecha":"2025-10-01","animalId":"012/1","animalNombre":"012/1","o1":3.76,"o2":0,"total":3.76,"obs":"Control lechero â€” 3.885 kg"},{"id":1748000010000,"fecha":"2025-10-01","animalId":"0013","animalNombre":"0013","o1":3.27,"o2":0,"total":3.27,"obs":"Control lechero â€” 3.375 kg"},{"id":1748000011000,"fecha":"2025-10-08","animalId":"036/8","animalNombre":"036/8","o1":3.88,"o2":0,"total":3.88,"obs":"Control lechero â€” 4.0 kg"},{"id":1748000012000,"fecha":"2025-10-08","animalId":"009/6","animalNombre":"009/6","o1":2.52,"o2":0,"total":2.52,"obs":"Control lechero â€” 2.6 kg"},{"id":1748000013000,"fecha":"2025-10-08","animalId":"041/8","animalNombre":"041/8","o1":5.26,"o2":0,"total":5.26,"obs":"Control lechero â€” 5.425 kg"},{"id":1748000014000,"fecha":"2025-10-08","animalId":"001/6","animalNombre":"001/6","o1":4.67,"o2":0,"total":4.67,"obs":"Control lechero â€” 4.815 kg"},{"id":1748000015000,"fecha":"2025-10-08","animalId":"236/4","animalNombre":"236/4","o1":3.33,"o2":0,"total":3.33,"obs":"Control lechero â€” 3.435 kg"},{"id":1748000016000,"fecha":"2025-10-08","animalId":"038/8","animalNombre":"038/8","o1":5.26,"o2":0,"total":5.26,"obs":"Control lechero â€” 5.425 kg"},{"id":1748000017000,"fecha":"2025-10-08","animalId":"069/1","animalNombre":"069/1","o1":5.14,"o2":0,"total":5.14,"obs":"Control lechero â€” 5.3 kg"},{"id":1748000018000,"fecha":"2025-10-08","animalId":"071/1","animalNombre":"071/1","o1":4.84,"o2":0,"total":4.84,"obs":"Control lechero â€” 5.0 kg"},{"id":1748000019000,"fecha":"2025-10-08","animalId":"007/6","animalNombre":"007/6","o1":4.16,"o2":0,"total":4.16,"obs":"Control lechero â€” 4.29 kg"},{"id":1748000020000,"fecha":"2025-10-08","animalId":"012/1","animalNombre":"012/1","o1":3.19,"o2":0,"total":3.19,"obs":"Control lechero â€” 3.29 kg"},{"id":1748000021000,"fecha":"2025-10-08","animalId":"0013","animalNombre":"0013","o1":2.6,"o2":0,"total":2.6,"obs":"Control lechero â€” 2.685 kg"},{"id":1748000022000,"fecha":"2025-11-05","animalId":"036/8","animalNombre":"036/8","o1":4.61,"o2":0,"total":4.61,"obs":"Control lechero â€” 4.755 kg"},{"id":1748000023000,"fecha":"2025-11-05","animalId":"007/6","animalNombre":"007/6","o1":5.58,"o2":0,"total":5.58,"obs":"Control lechero â€” 5.755 kg"},{"id":1748000024000,"fecha":"2025-11-05","animalId":"041/8","animalNombre":"041/8","o1":4.13,"o2":0,"total":4.13,"obs":"Control lechero â€” 4.26 kg"},{"id":1748000025000,"fecha":"2025-11-05","animalId":"236/4","animalNombre":"236/4","o1":2.55,"o2":0,"total":2.55,"obs":"Control lechero â€” 2.63 kg"},{"id":1748000026000,"fecha":"2025-11-05","animalId":"038/8","animalNombre":"038/8","o1":4.37,"o2":0,"total":4.37,"obs":"Control lechero â€” 4.505 kg"},{"id":1748000027000,"fecha":"2025-11-05","animalId":"069/1","animalNombre":"069/1","o1":5.31,"o2":0,"total":5.31,"obs":"Control lechero â€” 5.475 kg"},{"id":1748000028000,"fecha":"2025-11-05","animalId":"071/1","animalNombre":"071/1","o1":4.24,"o2":0,"total":4.24,"obs":"Control lechero â€” 4.375 kg"},{"id":1748000029000,"fecha":"2025-11-05","animalId":"0013","animalNombre":"0013","o1":4.59,"o2":0,"total":4.59,"obs":"Control lechero â€” 4.735 kg"},{"id":1748000030000,"fecha":"2025-11-05","animalId":"070/7","animalNombre":"070/7","o1":4.86,"o2":0,"total":4.86,"obs":"Control lechero â€” 5.02 kg"},{"id":1748000031000,"fecha":"2025-11-05","animalId":"241/42","animalNombre":"241/42","o1":5.84,"o2":0,"total":5.84,"obs":"Control lechero â€” 6.025 kg"},{"id":1748000032000,"fecha":"2025-11-19","animalId":"036/8","animalNombre":"036/8","o1":2.5,"o2":0,"total":2.5,"obs":"Control lechero â€” 2.577 kg"},{"id":1748000033000,"fecha":"2025-11-19","animalId":"001/6","animalNombre":"001/6","o1":5.69,"o2":0,"total":5.69,"obs":"Control lechero â€” 5.87 kg"},{"id":1748000034000,"fecha":"2025-11-19","animalId":"041/8","animalNombre":"041/8","o1":5.17,"o2":0,"total":5.17,"obs":"Control lechero â€” 5.335 kg"},{"id":1748000035000,"fecha":"2025-11-19","animalId":"236/4","animalNombre":"236/4","o1":3.23,"o2":0,"total":3.23,"obs":"Control lechero â€” 3.335 kg"},{"id":1748000036000,"fecha":"2025-11-19","animalId":"038/8","animalNombre":"038/8","o1":4.47,"o2":0,"total":4.47,"obs":"Control lechero â€” 4.615 kg"},{"id":1748000037000,"fecha":"2025-11-19","animalId":"069/1","animalNombre":"069/1","o1":6.11,"o2":0,"total":6.11,"obs":"Control lechero â€” 6.305 kg"},{"id":1748000038000,"fecha":"2025-11-19","animalId":"071/1","animalNombre":"071/1","o1":5.01,"o2":0,"total":5.01,"obs":"Control lechero â€” 5.17 kg"},{"id":1748000039000,"fecha":"2025-11-19","animalId":"0013","animalNombre":"0013","o1":3.71,"o2":0,"total":3.71,"obs":"Control lechero â€” 3.83 kg"},{"id":1748000040000,"fecha":"2025-11-19","animalId":"070/7","animalNombre":"070/7","o1":5.89,"o2":0,"total":5.89,"obs":"Control lechero â€” 6.075 kg"},{"id":1748000041000,"fecha":"2025-11-19","animalId":"241/42","animalNombre":"241/42","o1":7.54,"o2":0,"total":7.54,"obs":"Control lechero â€” 7.785 kg"},{"id":1748000042000,"fecha":"2025-11-19","animalId":"007/6","animalNombre":"007/6","o1":5.01,"o2":0,"total":5.01,"obs":"Control lechero â€” 5.17 kg"},{"id":1748000043000,"fecha":"2025-11-26","animalId":"038/8","animalNombre":"038/8","o1":5.24,"o2":0,"total":5.24,"obs":"Control lechero â€” 5.405 kg"},{"id":1748000044000,"fecha":"2025-11-26","animalId":"036/8","animalNombre":"036/8","o1":3.7,"o2":0,"total":3.7,"obs":"Control lechero â€” 3.82 kg"},{"id":1748000045000,"fecha":"2025-11-26","animalId":"001/6","animalNombre":"001/6","o1":5.36,"o2":0,"total":5.36,"obs":"Control lechero â€” 5.535 kg"},{"id":1748000046000,"fecha":"2025-11-26","animalId":"041/8","animalNombre":"041/8","o1":4.09,"o2":0,"total":4.09,"obs":"Control lechero â€” 4.22 kg"},{"id":1748000047000,"fecha":"2025-11-26","animalId":"236/4","animalNombre":"236/4","o1":2.79,"o2":0,"total":2.79,"obs":"Control lechero â€” 2.875 kg"},{"id":1748000048000,"fecha":"2025-11-26","animalId":"241/42","animalNombre":"241/42","o1":7.33,"o2":0,"total":7.33,"obs":"Control lechero â€” 7.56 kg"},{"id":1748000049000,"fecha":"2025-11-26","animalId":"069/1","animalNombre":"069/1","o1":5.37,"o2":0,"total":5.37,"obs":"Control lechero â€” 5.54 kg"},{"id":1748000050000,"fecha":"2025-11-26","animalId":"071/1","animalNombre":"071/1","o1":4.82,"o2":0,"total":4.82,"obs":"Control lechero â€” 4.975 kg"},{"id":1748000051000,"fecha":"2025-11-26","animalId":"0013","animalNombre":"0013","o1":3.55,"o2":0,"total":3.55,"obs":"Control lechero â€” 3.665 kg"},{"id":1748000052000,"fecha":"2025-11-26","animalId":"070/7","animalNombre":"070/7","o1":6.41,"o2":0,"total":6.41,"obs":"Control lechero â€” 6.615 kg"},{"id":1748000053000,"fecha":"2025-11-26","animalId":"0015","animalNombre":"0015","o1":0.13,"o2":0,"total":0.13,"obs":"Control lechero â€” 0.135 kg"},{"id":1748000054000,"fecha":"2025-11-26","animalId":"007/6","animalNombre":"007/6","o1":5.53,"o2":0,"total":5.53,"obs":"Control lechero â€” 5.705 kg"},{"id":1736200000000,"fecha":"2026-01-07","animalId":"015/7","animalNombre":"015/7","o1":5.06,"o2":0,"total":5.06,"obs":"Control lechero â€” 5.225 kg"},{"id":1736200007000,"fecha":"2026-01-07","animalId":"069/1","animalNombre":"069/1","o1":4.42,"o2":0,"total":4.42,"obs":"Control lechero â€” 4.56 kg"},{"id":1736200011000,"fecha":"2026-01-07","animalId":"070/7","animalNombre":"070/7","o1":4.35,"o2":0,"total":4.35,"obs":"Control lechero â€” 4.485 kg"},{"id":1736200015000,"fecha":"2026-01-07","animalId":"0007","animalNombre":"0007","o1":4.22,"o2":0,"total":4.22,"obs":"Control lechero â€” 4.36 kg"},{"id":1736200018000,"fecha":"2026-01-07","animalId":"241/42","animalNombre":"241/42","o1":4.22,"o2":0,"total":4.22,"obs":"Control lechero â€” 4.355 kg"},{"id":1736200022000,"fecha":"2026-01-07","animalId":"007/6","animalNombre":"007/6","o1":3.74,"o2":0,"total":3.74,"obs":"Control lechero â€” 3.855 kg"},{"id":1736200026000,"fecha":"2026-01-07","animalId":"038/8","animalNombre":"038/8","o1":3.37,"o2":0,"total":3.37,"obs":"Control lechero â€” 3.475 kg"},{"id":1736200030000,"fecha":"2026-01-07","animalId":"071/1","animalNombre":"071/1","o1":3.94,"o2":0,"total":3.94,"obs":"Control lechero â€” 4.065 kg"},{"id":1736200034000,"fecha":"2026-01-07","animalId":"009/6","animalNombre":"009/6","o1":3.49,"o2":0,"total":3.49,"obs":"Control lechero â€” 3.605 kg"},{"id":1736200038000,"fecha":"2026-01-07","animalId":"041/8","animalNombre":"041/8","o1":3.28,"o2":0,"total":3.28,"obs":"Control lechero â€” 3.39 kg"},{"id":1736200042000,"fecha":"2026-01-07","animalId":"036/8","animalNombre":"036/8","o1":2.83,"o2":0,"total":2.83,"obs":"Control lechero â€” 2.925 kg"},{"id":1736200046000,"fecha":"2026-01-07","animalId":"236/4","animalNombre":"236/4","o1":2.37,"o2":0,"total":2.37,"obs":"Control lechero â€” 2.445 kg"},{"id":1736200050000,"fecha":"2026-01-07","animalId":"0013","animalNombre":"0013","o1":2.44,"o2":0,"total":2.44,"obs":"Control lechero â€” 2.515 kg"},{"id":1736200054000,"fecha":"2026-01-07","animalId":"0015","animalNombre":"0015","o1":2.17,"o2":0,"total":2.17,"obs":"Control lechero â€” 2.235 kg"},{"id":1736200001000,"fecha":"2026-01-14","animalId":"015/7","animalNombre":"015/7","o1":5.38,"o2":0,"total":5.38,"obs":"Control lechero â€” 5.555 kg"},{"id":1736200004000,"fecha":"2026-01-14","animalId":"026/4","animalNombre":"026/4","o1":5.71,"o2":0,"total":5.71,"obs":"Control lechero â€” 5.89 kg"},{"id":1736200008000,"fecha":"2026-01-14","animalId":"069/1","animalNombre":"069/1","o1":4.56,"o2":0,"total":4.56,"obs":"Control lechero â€” 4.705 kg"},{"id":1736200012000,"fecha":"2026-01-14","animalId":"070/7","animalNombre":"070/7","o1":3.22,"o2":0,"total":3.22,"obs":"Control lechero â€” 3.325 kg"},{"id":1736200016000,"fecha":"2026-01-14","animalId":"0007","animalNombre":"0007","o1":4.16,"o2":0,"total":4.16,"obs":"Control lechero â€” 4.29 kg"},{"id":1736200019000,"fecha":"2026-01-14","animalId":"241/42","animalNombre":"241/42","o1":4.06,"o2":0,"total":4.06,"obs":"Control lechero â€” 4.19 kg"},{"id":1736200023000,"fecha":"2026-01-14","animalId":"007/6","animalNombre":"007/6","o1":3.6,"o2":0,"total":3.6,"obs":"Control lechero â€” 3.715 kg"},{"id":1736200027000,"fecha":"2026-01-14","animalId":"038/8","animalNombre":"038/8","o1":3.56,"o2":0,"total":3.56,"obs":"Control lechero â€” 3.675 kg"},{"id":1736200031000,"fecha":"2026-01-14","animalId":"071/1","animalNombre":"071/1","o1":3.75,"o2":0,"total":3.75,"obs":"Control lechero â€” 3.865 kg"},{"id":1736200035000,"fecha":"2026-01-14","animalId":"009/6","animalNombre":"009/6","o1":3.76,"o2":0,"total":3.76,"obs":"Control lechero â€” 3.88 kg"},{"id":1736200039000,"fecha":"2026-01-14","animalId":"041/8","animalNombre":"041/8","o1":2.59,"o2":0,"total":2.59,"obs":"Control lechero â€” 2.67 kg"},{"id":1736200043000,"fecha":"2026-01-14","animalId":"036/8","animalNombre":"036/8","o1":3.19,"o2":0,"total":3.19,"obs":"Control lechero â€” 3.29 kg"},{"id":1736200047000,"fecha":"2026-01-14","animalId":"236/4","animalNombre":"236/4","o1":2.11,"o2":0,"total":2.11,"obs":"Control lechero â€” 2.18 kg"},{"id":1736200051000,"fecha":"2026-01-14","animalId":"0013","animalNombre":"0013","o1":2.34,"o2":0,"total":2.34,"obs":"Control lechero â€” 2.42 kg"},{"id":1736200055000,"fecha":"2026-01-14","animalId":"0015","animalNombre":"0015","o1":2.23,"o2":0,"total":2.23,"obs":"Control lechero â€” 2.3 kg"},{"id":1736200002000,"fecha":"2026-01-27","animalId":"015/7","animalNombre":"015/7","o1":5.38,"o2":0,"total":5.38,"obs":"Control lechero â€” 5.555 kg"},{"id":1736200005000,"fecha":"2026-01-27","animalId":"026/4","animalNombre":"026/4","o1":5.71,"o2":0,"total":5.71,"obs":"Control lechero â€” 5.89 kg"},{"id":1736200009000,"fecha":"2026-01-27","animalId":"069/1","animalNombre":"069/1","o1":4.56,"o2":0,"total":4.56,"obs":"Control lechero â€” 4.705 kg"},{"id":1736200013000,"fecha":"2026-01-27","animalId":"070/7","animalNombre":"070/7","o1":3.22,"o2":0,"total":3.22,"obs":"Control lechero â€” 3.325 kg"},{"id":1736200017000,"fecha":"2026-01-27","animalId":"0007","animalNombre":"0007","o1":4.16,"o2":0,"total":4.16,"obs":"Control lechero â€” 4.29 kg"},{"id":1736200020000,"fecha":"2026-01-27","animalId":"241/42","animalNombre":"241/42","o1":4.06,"o2":0,"total":4.06,"obs":"Control lechero â€” 4.19 kg"},{"id":1736200024000,"fecha":"2026-01-27","animalId":"007/6","animalNombre":"007/6","o1":3.6,"o2":0,"total":3.6,"obs":"Control lechero â€” 3.715 kg"},{"id":1736200028000,"fecha":"2026-01-27","animalId":"038/8","animalNombre":"038/8","o1":3.56,"o2":0,"total":3.56,"obs":"Control lechero â€” 3.675 kg"},{"id":1736200032000,"fecha":"2026-01-27","animalId":"071/1","animalNombre":"071/1","o1":3.75,"o2":0,"total":3.75,"obs":"Control lechero â€” 3.865 kg"},{"id":1736200036000,"fecha":"2026-01-27","animalId":"009/6","animalNombre":"009/6","o1":3.76,"o2":0,"total":3.76,"obs":"Control lechero â€” 3.88 kg"},{"id":1736200040000,"fecha":"2026-01-27","animalId":"041/8","animalNombre":"041/8","o1":2.59,"o2":0,"total":2.59,"obs":"Control lechero â€” 2.67 kg"},{"id":1736200044000,"fecha":"2026-01-27","animalId":"036/8","animalNombre":"036/8","o1":3.19,"o2":0,"total":3.19,"obs":"Control lechero â€” 3.29 kg"},{"id":1736200048000,"fecha":"2026-01-27","animalId":"236/4","animalNombre":"236/4","o1":2.69,"o2":0,"total":2.69,"obs":"Control lechero â€” 2.78 kg"},{"id":1736200052000,"fecha":"2026-01-27","animalId":"0013","animalNombre":"0013","o1":2.23,"o2":0,"total":2.23,"obs":"Control lechero â€” 2.3 kg"},{"id":1736200056000,"fecha":"2026-01-27","animalId":"0015","animalNombre":"0015","o1":2.23,"o2":0,"total":2.23,"obs":"Control lechero â€” 2.3 kg"},{"id":1736200003000,"fecha":"2026-01-28","animalId":"015/7","animalNombre":"015/7","o1":4.92,"o2":0,"total":4.92,"obs":"Control lechero â€” 5.075 kg"},{"id":1736200006000,"fecha":"2026-01-28","animalId":"026/4","animalNombre":"026/4","o1":5.58,"o2":0,"total":5.58,"obs":"Control lechero â€” 5.755 kg"},{"id":1736200010000,"fecha":"2026-01-28","animalId":"069/1","animalNombre":"069/1","o1":4.4,"o2":0,"total":4.4,"obs":"Control lechero â€” 4.54 kg"},{"id":1736200014000,"fecha":"2026-01-28","animalId":"070/7","animalNombre":"070/7","o1":4.22,"o2":0,"total":4.22,"obs":"Control lechero â€” 4.35 kg"},{"id":1736200021000,"fecha":"2026-01-28","animalId":"241/42","animalNombre":"241/42","o1":0.05,"o2":0,"total":0.05,"obs":"Control lechero â€” 0.05 kg"},{"id":1736200025000,"fecha":"2026-01-28","animalId":"007/6","animalNombre":"007/6","o1":3.9,"o2":0,"total":3.9,"obs":"Control lechero â€” 4.025 kg"},{"id":1736200029000,"fecha":"2026-01-28","animalId":"038/8","animalNombre":"038/8","o1":3.97,"o2":0,"total":3.97,"obs":"Control lechero â€” 4.095 kg"},{"id":1736200033000,"fecha":"2026-01-28","animalId":"071/1","animalNombre":"071/1","o1":2.91,"o2":0,"total":2.91,"obs":"Control lechero â€” 3.005 kg"},{"id":1736200037000,"fecha":"2026-01-28","animalId":"009/6","animalNombre":"009/6","o1":3.9,"o2":0,"total":3.9,"obs":"Control lechero â€” 4.025 kg"},{"id":1736200041000,"fecha":"2026-01-28","animalId":"041/8","animalNombre":"041/8","o1":3.11,"o2":0,"total":3.11,"obs":"Control lechero â€” 3.205 kg"},{"id":1736200045000,"fecha":"2026-01-28","animalId":"036/8","animalNombre":"036/8","o1":3.16,"o2":0,"total":3.16,"obs":"Control lechero â€” 3.265 kg"},{"id":1736200049000,"fecha":"2026-01-28","animalId":"236/4","animalNombre":"236/4","o1":1.96,"o2":0,"total":1.96,"obs":"Control lechero â€” 2.02 kg"},{"id":1736200053000,"fecha":"2026-01-28","animalId":"0013","animalNombre":"0013","o1":2.61,"o2":0,"total":2.61,"obs":"Control lechero â€” 2.695 kg"},{"id":1736200057000,"fecha":"2026-01-28","animalId":"0015","animalNombre":"0015","o1":2.14,"o2":0,"total":2.14,"obs":"Control lechero â€” 2.21 kg"},{"id":1736200058000,"fecha":"2026-01-28","animalId":"023/7","animalNombre":"023/7","o1":4.32,"o2":0,"total":4.32,"obs":"Control lechero â€” 4.455 kg"},{"id":1736200059000,"fecha":"2026-01-28","animalId":"0010","animalNombre":"0010","o1":3.89,"o2":0,"total":3.89,"obs":"Control lechero â€” 4.015 kg"},{"id":1736200060000,"fecha":"2026-01-28","animalId":"226/4","animalNombre":"226/4","o1":4.47,"o2":0,"total":4.47,"obs":"Control lechero â€” 4.615 kg"},{"id":1749000000000,"fecha":"2025-06-18","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.54,"o2":0,"total":4.54,"obs":"Control lechero â€” 4.54 L"},{"id":1749000001000,"fecha":"2025-06-18","animalId":"009/6","animalNombre":"009/6","o1":4.065,"o2":0,"total":4.065,"obs":"Control lechero â€” 4.07 L"},{"id":1749000002000,"fecha":"2025-06-18","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.6,"o2":0,"total":1.6,"obs":"Control lechero â€” 1.60 L"},{"id":1749000003000,"fecha":"2025-06-18","animalId":"226/4","animalNombre":"ALVARACO","o1":3.525,"o2":0,"total":3.525,"obs":"Control lechero â€” 3.52 L"},{"id":1749000004000,"fecha":"2025-06-18","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":3.0,"o2":0,"total":3.0,"obs":"Control lechero â€” 3.00 L"},{"id":1749000005000,"fecha":"2025-06-18","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.485,"o2":0,"total":4.485,"obs":"Control lechero â€” 4.49 L"},{"id":1749000006000,"fecha":"2025-06-25","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.305,"o2":0,"total":2.305,"obs":"Control lechero â€” 2.31 L"},{"id":1749000007000,"fecha":"2025-06-25","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.73,"o2":0,"total":3.73,"obs":"Control lechero â€” 3.73 L"},{"id":1749000008000,"fecha":"2025-06-25","animalId":"226/4","animalNombre":"ALVARACO","o1":2.97,"o2":0,"total":2.97,"obs":"Control lechero â€” 2.97 L"},{"id":1749000009000,"fecha":"2025-06-25","animalId":"009/6","animalNombre":"009/6","o1":5.35,"o2":0,"total":5.35,"obs":"Control lechero â€” 5.35 L"},{"id":1749000010000,"fecha":"2025-06-25","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":5.21,"o2":0,"total":5.21,"obs":"Control lechero â€” 5.21 L"},{"id":1749000011000,"fecha":"2025-07-09","animalId":"226/4","animalNombre":"ALVARACO","o1":0.39,"o2":0,"total":0.39,"obs":"Control lechero â€” 0.39 L"},{"id":1749000012000,"fecha":"2025-07-09","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":0.329,"o2":0,"total":0.329,"obs":"Control lechero â€” 0.33 L"},{"id":1749000013000,"fecha":"2025-07-09","animalId":"009/6","animalNombre":"009/6","o1":0.375,"o2":0,"total":0.375,"obs":"Control lechero â€” 0.38 L"},{"id":1749000014000,"fecha":"2025-07-09","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.27,"o2":0,"total":4.27,"obs":"Control lechero â€” 4.27 L"},{"id":1749000015000,"fecha":"2025-07-09","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":5.79,"o2":0,"total":5.79,"obs":"Control lechero â€” 5.79 L"},{"id":1749000016000,"fecha":"2025-07-16","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.86,"o2":0,"total":3.86,"obs":"Control lechero â€” 3.86 L"},{"id":1749000017000,"fecha":"2025-07-16","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.97,"o2":0,"total":3.97,"obs":"Control lechero â€” 3.97 L"},{"id":1749000018000,"fecha":"2025-07-16","animalId":"226/4","animalNombre":"ALVARACO","o1":7.718,"o2":0,"total":7.718,"obs":"Control lechero â€” 7.72 L"},{"id":1749000019000,"fecha":"2025-07-16","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.577,"o2":0,"total":4.577,"obs":"Control lechero â€” 4.58 L"},{"id":1749000020000,"fecha":"2025-07-16","animalId":"009/6","animalNombre":"009/6","o1":7.816,"o2":0,"total":7.816,"obs":"Control lechero â€” 7.82 L"},{"id":1749000021000,"fecha":"2025-07-16","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":7.022,"o2":0,"total":7.022,"obs":"Control lechero â€” 7.02 L"},{"id":1749000022000,"fecha":"2025-07-23","animalId":"009/6","animalNombre":"009/6","o1":7.615,"o2":0,"total":7.615,"obs":"Control lechero â€” 7.62 L"},{"id":1749000023000,"fecha":"2025-07-23","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.37,"o2":0,"total":4.37,"obs":"Control lechero â€” 4.37 L"},{"id":1749000024000,"fecha":"2025-07-23","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.702,"o2":0,"total":1.702,"obs":"Control lechero â€” 1.70 L"},{"id":1749000025000,"fecha":"2025-07-23","animalId":"226/4","animalNombre":"ALVARACO","o1":2.23,"o2":0,"total":2.23,"obs":"Control lechero â€” 2.23 L"},{"id":1749000026000,"fecha":"2025-07-23","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":7.02,"o2":0,"total":7.02,"obs":"Control lechero â€” 7.02 L"},{"id":1749000027000,"fecha":"2025-08-06","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.005,"o2":0,"total":3.005,"obs":"Control lechero â€” 3.00 L"},{"id":1749000028000,"fecha":"2025-08-06","animalId":"009/6","animalNombre":"009/6","o1":3.27,"o2":0,"total":3.27,"obs":"Control lechero â€” 3.27 L"},{"id":1749000029000,"fecha":"2025-08-06","animalId":"226/4","animalNombre":"ALVARACO","o1":1.89,"o2":0,"total":1.89,"obs":"Control lechero â€” 1.89 L"},{"id":1749000030000,"fecha":"2025-08-06","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":0.37,"o2":0,"total":0.37,"obs":"Control lechero â€” 0.37 L"},{"id":1749000031000,"fecha":"2025-08-06","animalId":"007/6","animalNombre":"LUZ MOROCHA CARAMELO","o1":4.47,"o2":0,"total":4.47,"obs":"Control lechero â€” 4.47 L"},{"id":1749000032000,"fecha":"2025-08-06","animalId":"071/1","animalNombre":"DELFINA LA LEYENDA FAR","o1":5.22,"o2":0,"total":5.22,"obs":"Control lechero â€” 5.22 L"},{"id":1749000033000,"fecha":"2025-08-06","animalId":"038/8","animalNombre":"ALVARACO PECOSO DILUVIO","o1":3.73,"o2":0,"total":3.73,"obs":"Control lechero â€” 3.73 L"},{"id":1749000034000,"fecha":"2025-08-13","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":0.717,"o2":0,"total":0.717,"obs":"Control lechero â€” 0.72 L"},{"id":1749000035000,"fecha":"2025-08-13","animalId":"226/4","animalNombre":"ALVARACO","o1":2.432,"o2":0,"total":2.432,"obs":"Control lechero â€” 2.43 L"},{"id":1749000036000,"fecha":"2025-08-13","animalId":"009/6","animalNombre":"009/6","o1":7.819,"o2":0,"total":7.819,"obs":"Control lechero â€” 7.82 L"},{"id":1749000037000,"fecha":"2025-08-13","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.477,"o2":0,"total":4.477,"obs":"Control lechero â€” 4.48 L"},{"id":1749000038000,"fecha":"2025-08-13","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":7.227,"o2":0,"total":7.227,"obs":"Control lechero â€” 7.23 L"},{"id":1749000039000,"fecha":"2025-08-13","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.903,"o2":0,"total":1.903,"obs":"Control lechero â€” 1.90 L"},{"id":1749000040000,"fecha":"2025-08-20","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.575,"o2":0,"total":2.575,"obs":"Control lechero â€” 2.58 L"},{"id":1749000041000,"fecha":"2025-08-20","animalId":"009/6","animalNombre":"009/6","o1":2.99,"o2":0,"total":2.99,"obs":"Control lechero â€” 2.99 L"},{"id":1749000042000,"fecha":"2025-08-20","animalId":"226/4","animalNombre":"ALVARACO","o1":1.91,"o2":0,"total":1.91,"obs":"Control lechero â€” 1.91 L"},{"id":1749000043000,"fecha":"2025-08-20","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":3.675,"o2":0,"total":3.675,"obs":"Control lechero â€” 3.67 L"},{"id":1749000044000,"fecha":"2025-08-20","animalId":"071/1","animalNombre":"DELFINA LA LEYENDA FAR","o1":4.315,"o2":0,"total":4.315,"obs":"Control lechero â€” 4.32 L"},{"id":1749000045000,"fecha":"2025-08-20","animalId":"038/8","animalNombre":"ALVARACO PECOSO DILUVIO","o1":4.25,"o2":0,"total":4.25,"obs":"Control lechero â€” 4.25 L"},{"id":1749000046000,"fecha":"2025-08-27","animalId":"038/8","animalNombre":"ALVARACO PECOSO DILUVIO","o1":3.735,"o2":0,"total":3.735,"obs":"Control lechero â€” 3.73 L"},{"id":1749000047000,"fecha":"2025-08-27","animalId":"007/6","animalNombre":"LUZ MOROCHA CARAMELO","o1":4.99,"o2":5.185,"total":10.175,"obs":"Control lechero â€” 10.18 L"},{"id":1749000048000,"fecha":"2025-08-27","animalId":"071/1","animalNombre":"DELFINA LA LEYENDA FAR","o1":5.605,"o2":0,"total":5.605,"obs":"Control lechero â€” 5.61 L"},{"id":1749000049000,"fecha":"2025-08-27","animalId":"009/6","animalNombre":"009/6","o1":3.755,"o2":0,"total":3.755,"obs":"Control lechero â€” 3.75 L"},{"id":1749000050000,"fecha":"2025-08-27","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":3.08,"o2":0,"total":3.08,"obs":"Control lechero â€” 3.08 L"},{"id":1749000051000,"fecha":"2025-08-27","animalId":"226/4","animalNombre":"ALVARACO","o1":1.67,"o2":0,"total":1.67,"obs":"Control lechero â€” 1.67 L"},{"id":1749500000000,"fecha":"2025-06-18","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.74,"o2":0,"total":3.74,"obs":"Control lechero â€” 3.740 L"},{"id":1749500001000,"fecha":"2025-06-18","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.86,"o2":0,"total":2.86,"obs":"Control lechero â€” 2.860 L"},{"id":1749500002000,"fecha":"2025-07-23","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":0.316,"o2":0,"total":0.316,"obs":"Control lechero â€” 0.316 L"},{"id":1749500003000,"fecha":"2025-08-06","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.735,"o2":0,"total":2.735,"obs":"Control lechero â€” 2.735 L"},{"id":1749500004000,"fecha":"2025-08-06","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":3.325,"o2":0,"total":3.325,"obs":"Control lechero â€” 3.325 L"},{"id":1749500005000,"fecha":"2025-08-20","animalId":"007/6","animalNombre":"LUZ MOROCHA CARAMELO","o1":3.835,"o2":0,"total":3.835,"obs":"Control lechero â€” 3.835 L"},{"id":1749500006000,"fecha":"2025-08-20","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":3.72,"o2":0,"total":3.72,"obs":"Control lechero â€” 3.720 L"},{"id":1749500007000,"fecha":"2025-08-27","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":4.08,"o2":0,"total":4.08,"obs":"Control lechero â€” 4.080 L"},{"id":1740000000000,"fecha":"2025-02-19","animalId":"245/3","animalNombre":"245/3","o1":2.93,"o2":0,"total":2.93,"obs":"Control lechero â€” 2.930 L"},{"id":1740000001000,"fecha":"2025-03-05","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.795,"o2":0,"total":4.795,"obs":"Control lechero â€” 4.795 L"},{"id":1740000002000,"fecha":"2025-03-05","animalId":"009/6","animalNombre":"009/6","o1":4.36,"o2":0,"total":4.36,"obs":"Control lechero â€” 4.360 L"},{"id":1740000003000,"fecha":"2025-03-05","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.4,"o2":0,"total":3.4,"obs":"Control lechero â€” 3.400 L"},{"id":1740000004000,"fecha":"2025-03-05","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":5.21,"o2":0,"total":5.21,"obs":"Control lechero â€” 5.210 L"},{"id":1740000005000,"fecha":"2025-03-05","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":1.88,"o2":0,"total":1.88,"obs":"Control lechero â€” 1.880 L"},{"id":1740000006000,"fecha":"2025-03-05","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.58,"o2":0,"total":1.58,"obs":"Control lechero â€” 1.580 L"},{"id":1740000007000,"fecha":"2025-03-05","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":2.805,"o2":0,"total":2.805,"obs":"Control lechero â€” 2.805 L"},{"id":1740000008000,"fecha":"2025-03-05","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":3.415,"o2":0,"total":3.415,"obs":"Control lechero â€” 3.415 L"},{"id":1740000009000,"fecha":"2025-03-05","animalId":"070/7","animalNombre":"070/7","o1":4.855,"o2":0,"total":4.855,"obs":"Control lechero â€” 4.855 L (valor Ãºnico, 507-0=070/7)"},{"id":1740000010000,"fecha":"2025-03-05","animalId":"226/4","animalNombre":"ALVARACO","o1":4.885,"o2":0,"total":4.885,"obs":"Control lechero â€” 4.885 L"},{"id":1740000011000,"fecha":"2025-03-05","animalId":"245/3","animalNombre":"245/3","o1":2.955,"o2":0,"total":2.955,"obs":"Control lechero â€” 2.955 L"},{"id":1740000012000,"fecha":"2025-04-02","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":2.737,"o2":0,"total":2.737,"obs":"Control lechero â€” 2.737 L"},{"id":1740000013000,"fecha":"2025-04-02","animalId":"009/6","animalNombre":"009/6","o1":4.376,"o2":0,"total":4.376,"obs":"Control lechero â€” 4.376 L"},{"id":1740000014000,"fecha":"2025-04-02","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.711,"o2":0,"total":2.711,"obs":"Control lechero â€” 2.711 L"},{"id":1740000015000,"fecha":"2025-04-02","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.387,"o2":0,"total":2.387,"obs":"Control lechero â€” 2.387 L"},{"id":1740000016000,"fecha":"2025-04-02","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.77,"o2":0,"total":2.77,"obs":"Control lechero â€” 2.770 L"},{"id":1740000017000,"fecha":"2025-04-02","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":7.285,"o2":0,"total":7.285,"obs":"Control lechero â€” 7.285 L"},{"id":1740000018000,"fecha":"2025-04-02","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.226,"o2":0,"total":2.226,"obs":"Control lechero â€” 2.226 L"},{"id":1740000019000,"fecha":"2025-04-02","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":0.974,"o2":0,"total":0.974,"obs":"Control lechero â€” 0.974 L"},{"id":1740000020000,"fecha":"2025-04-02","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":7.929,"o2":0,"total":7.929,"obs":"Control lechero â€” 7.929 L"},{"id":1740000021000,"fecha":"2025-04-02","animalId":"070/7","animalNombre":"070/7","o1":7.98,"o2":0,"total":7.98,"obs":"Control lechero â€” 7.980 L"},{"id":1740000022000,"fecha":"2025-04-02","animalId":"226/4","animalNombre":"ALVARACO","o1":4.227,"o2":0,"total":4.227,"obs":"Control lechero â€” 4.227 L"},{"id":1740000023000,"fecha":"2025-04-02","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":3.63,"o2":0,"total":3.63,"obs":"Control lechero â€” 3.630 L"},{"id":1740000024000,"fecha":"2025-04-02","animalId":"245/3","animalNombre":"245/3","o1":2.407,"o2":0,"total":2.407,"obs":"Control lechero â€” 2.407 L"},{"id":1740000025000,"fecha":"2025-04-09","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":5.39,"o2":0,"total":5.39,"obs":"Control lechero â€” 5.390 L"},{"id":1740000026000,"fecha":"2025-04-09","animalId":"009/6","animalNombre":"009/6","o1":4.365,"o2":0,"total":4.365,"obs":"Control lechero â€” 4.365 L"},{"id":1740000027000,"fecha":"2025-04-09","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.555,"o2":0,"total":3.555,"obs":"Control lechero â€” 3.555 L"},{"id":1740000028000,"fecha":"2025-04-09","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":3.445,"o2":0,"total":3.445,"obs":"Control lechero â€” 3.445 L"},{"id":1740000029000,"fecha":"2025-04-09","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":3.35,"o2":0,"total":3.35,"obs":"Control lechero â€” 3.350 L"},{"id":1740000030000,"fecha":"2025-04-09","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.095,"o2":0,"total":2.095,"obs":"Control lechero â€” 2.095 L"},{"id":1740000031000,"fecha":"2025-04-09","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.545,"o2":0,"total":1.545,"obs":"Control lechero â€” 1.545 L"},{"id":1740000032000,"fecha":"2025-04-09","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":7.005,"o2":0,"total":7.005,"obs":"Control lechero â€” 7.005 L"},{"id":1740000033000,"fecha":"2025-04-09","animalId":"070/7","animalNombre":"070/7","o1":1.29,"o2":0,"total":1.29,"obs":"Control lechero â€” 1.290 L"},{"id":1740000034000,"fecha":"2025-04-09","animalId":"226/4","animalNombre":"ALVARACO","o1":4.07,"o2":0,"total":4.07,"obs":"Control lechero â€” 4.070 L"},{"id":1740000035000,"fecha":"2025-04-09","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":5.135,"o2":0,"total":5.135,"obs":"Control lechero â€” 5.135 L"},{"id":1740000036000,"fecha":"2025-04-09","animalId":"245/3","animalNombre":"245/3","o1":3.995,"o2":0,"total":3.995,"obs":"Control lechero â€” 3.995 L"},{"id":1740000037000,"fecha":"2025-04-23","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.035,"o2":0,"total":4.035,"obs":"Control lechero â€” 4.035 L"},{"id":1740000038000,"fecha":"2025-04-23","animalId":"009/6","animalNombre":"009/6","o1":5.025,"o2":0,"total":5.025,"obs":"Control lechero â€” 5.025 L"},{"id":1740000039000,"fecha":"2025-04-23","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.065,"o2":0,"total":3.065,"obs":"Control lechero â€” 3.065 L"},{"id":1740000040000,"fecha":"2025-04-23","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.8,"o2":0,"total":2.8,"obs":"Control lechero â€” 2.800 L"},{"id":1740000041000,"fecha":"2025-04-23","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.925,"o2":0,"total":2.925,"obs":"Control lechero â€” 2.925 L"},{"id":1740000042000,"fecha":"2025-04-23","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":1.83,"o2":0,"total":1.83,"obs":"Control lechero â€” 1.830 L"},{"id":1740000043000,"fecha":"2025-04-23","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.66,"o2":0,"total":1.66,"obs":"Control lechero â€” 1.660 L"},{"id":1740000044000,"fecha":"2025-04-23","animalId":"070/7","animalNombre":"070/7","o1":0.955,"o2":0,"total":0.955,"obs":"Control lechero â€” 0.955 L"},{"id":1740000045000,"fecha":"2025-04-23","animalId":"226/4","animalNombre":"ALVARACO","o1":4.275,"o2":0,"total":4.275,"obs":"Control lechero â€” 4.275 L"},{"id":1740000046000,"fecha":"2025-04-23","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.95,"o2":0,"total":4.95,"obs":"Control lechero â€” 4.950 L"},{"id":1740000047000,"fecha":"2025-04-23","animalId":"245/3","animalNombre":"245/3","o1":2.895,"o2":0,"total":2.895,"obs":"Control lechero â€” 2.895 L"},{"id":1740000048000,"fecha":"2025-05-14","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.4,"o2":0,"total":4.4,"obs":"Control lechero â€” 4.400 L"},{"id":1740000049000,"fecha":"2025-05-14","animalId":"009/6","animalNombre":"009/6","o1":4.73,"o2":0,"total":4.73,"obs":"Control lechero â€” 4.730 L"},{"id":1740000050000,"fecha":"2025-05-14","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.06,"o2":0,"total":3.06,"obs":"Control lechero â€” 3.060 L"},{"id":1740000051000,"fecha":"2025-05-14","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.325,"o2":0,"total":2.325,"obs":"Control lechero â€” 2.325 L"},{"id":1740000052000,"fecha":"2025-05-14","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.69,"o2":0,"total":2.69,"obs":"Control lechero â€” 2.690 L"},{"id":1740000053000,"fecha":"2025-05-14","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.58,"o2":0,"total":1.58,"obs":"Control lechero â€” 1.580 L"},{"id":1740000054000,"fecha":"2025-05-14","animalId":"226/4","animalNombre":"ALVARACO","o1":3.47,"o2":0,"total":3.47,"obs":"Control lechero â€” 3.470 L"},{"id":1740000055000,"fecha":"2025-05-14","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.825,"o2":0,"total":4.825,"obs":"Control lechero â€” 4.825 L"},{"id":1740000056000,"fecha":"2025-05-14","animalId":"245/3","animalNombre":"245/3","o1":3.175,"o2":0,"total":3.175,"obs":"Control lechero â€” 3.175 L"},{"id":1740000057000,"fecha":"2025-05-21","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.539,"o2":0,"total":4.539,"obs":"Control lechero â€” 4.539 L"},{"id":1740000058000,"fecha":"2025-05-21","animalId":"009/6","animalNombre":"009/6","o1":4.731,"o2":0,"total":4.731,"obs":"Control lechero â€” 4.731 L"},{"id":1740000059000,"fecha":"2025-05-21","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.76,"o2":0,"total":3.76,"obs":"Control lechero â€” 3.760 L"},{"id":1740000060000,"fecha":"2025-05-21","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.597,"o2":0,"total":2.597,"obs":"Control lechero â€” 2.597 L"},{"id":1740000061000,"fecha":"2025-05-21","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.68,"o2":0,"total":1.68,"obs":"Control lechero â€” 1.680 L"},{"id":1740000062000,"fecha":"2025-05-21","animalId":"226/4","animalNombre":"ALVARACO","o1":3.57,"o2":0,"total":3.57,"obs":"Control lechero â€” 3.570 L"},{"id":1740000063000,"fecha":"2025-05-21","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.725,"o2":0,"total":4.725,"obs":"Control lechero â€” 4.725 L"},{"id":1740000064000,"fecha":"2025-05-21","animalId":"245/3","animalNombre":"245/3","o1":3.374,"o2":0,"total":3.374,"obs":"Control lechero â€” 3.374 L"},{"id":1740000065000,"fecha":"2025-05-28","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.337,"o2":0,"total":4.337,"obs":"Control lechero â€” 4.337 L"},{"id":1740000066000,"fecha":"2025-05-28","animalId":"009/6","animalNombre":"009/6","o1":4.53,"o2":0,"total":4.53,"obs":"Control lechero â€” 4.530 L"},{"id":1740000067000,"fecha":"2025-05-28","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.261,"o2":0,"total":3.261,"obs":"Control lechero â€” 3.261 L"},{"id":1740000068000,"fecha":"2025-05-28","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.589,"o2":0,"total":2.589,"obs":"Control lechero â€” 2.589 L"},{"id":1740000069000,"fecha":"2025-05-28","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.579,"o2":0,"total":1.579,"obs":"Control lechero â€” 1.579 L"},{"id":1740000070000,"fecha":"2025-05-28","animalId":"226/4","animalNombre":"ALVARACO","o1":3.469,"o2":0,"total":3.469,"obs":"Control lechero â€” 3.469 L"},{"id":1740000071000,"fecha":"2025-05-28","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.625,"o2":0,"total":4.625,"obs":"Control lechero â€” 4.625 L"},{"id":1740000072000,"fecha":"2025-05-28","animalId":"245/3","animalNombre":"245/3","o1":3.275,"o2":0,"total":3.275,"obs":"Control lechero â€” 3.275 L"},{"id":1740000073000,"fecha":"2025-06-04","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.236,"o2":0,"total":4.236,"obs":"Control lechero â€” 4.236 L"},{"id":1740000074000,"fecha":"2025-06-04","animalId":"009/6","animalNombre":"009/6","o1":4.529,"o2":0,"total":4.529,"obs":"Control lechero â€” 4.529 L"},{"id":1740000075000,"fecha":"2025-06-04","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":3.57,"o2":0,"total":3.57,"obs":"Control lechero â€” 3.570 L"},{"id":1740000076000,"fecha":"2025-06-04","animalId":"226/4","animalNombre":"ALVARACO","o1":3.559,"o2":0,"total":3.559,"obs":"Control lechero â€” 3.559 L"},{"id":1740000077000,"fecha":"2025-06-04","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.527,"o2":0,"total":4.527,"obs":"Control lechero â€” 4.527 L"},{"id":1740000078000,"fecha":"2025-06-04","animalId":"245/3","animalNombre":"245/3","o1":3.274,"o2":0,"total":3.274,"obs":"Control lechero â€” 3.274 L"},{"id":1740000079000,"fecha":"2025-06-11","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.4,"o2":0,"total":4.4,"obs":"Control lechero â€” 4.400 L"},{"id":1740000080000,"fecha":"2025-06-11","animalId":"009/6","animalNombre":"009/6","o1":4.73,"o2":0,"total":4.73,"obs":"Control lechero â€” 4.730 L"},{"id":1740000081000,"fecha":"2025-06-11","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.06,"o2":0,"total":3.06,"obs":"Control lechero â€” 3.060 L"},{"id":1740000082000,"fecha":"2025-06-11","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.325,"o2":0,"total":2.325,"obs":"Control lechero â€” 2.325 L"},{"id":1740000083000,"fecha":"2025-06-11","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.64,"o2":0,"total":2.64,"obs":"Control lechero â€” 2.640 L"},{"id":1740000084000,"fecha":"2025-06-11","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.5,"o2":0,"total":1.5,"obs":"Control lechero â€” 1.500 L"},{"id":1740000085000,"fecha":"2025-06-11","animalId":"226/4","animalNombre":"ALVARACO","o1":3.47,"o2":0,"total":3.47,"obs":"Control lechero â€” 3.470 L"},{"id":1740000086000,"fecha":"2025-06-11","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.825,"o2":0,"total":4.825,"obs":"Control lechero â€” 4.825 L"},{"id":1740000087000,"fecha":"2025-06-11","animalId":"245/3","animalNombre":"245/3","o1":3.775,"o2":0,"total":3.775,"obs":"Control lechero â€” 3.775 L"},{"id":1735000000000,"fecha":"2024-01-07","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":2.835,"o2":0,"total":2.835,"obs":"Control lechero â€” 2.835 L"},{"id":1735000001000,"fecha":"2024-01-07","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.66,"o2":0,"total":3.66,"obs":"Control lechero â€” 3.660 L"},{"id":1735000002000,"fecha":"2024-01-07","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":3.3,"o2":0,"total":3.3,"obs":"Control lechero â€” 3.300 L"},{"id":1735000003000,"fecha":"2024-01-07","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.5,"o2":0,"total":2.5,"obs":"Control lechero â€” 2.500 L"},{"id":1735000004000,"fecha":"2024-01-07","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":2.275,"o2":0,"total":2.275,"obs":"Control lechero â€” 2.275 L"},{"id":1735000005000,"fecha":"2024-01-07","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.975,"o2":0,"total":2.975,"obs":"Control lechero â€” 2.975 L"},{"id":1735000006000,"fecha":"2024-01-07","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":7.39,"o2":0,"total":7.39,"obs":"Control lechero â€” 7.390 L"},{"id":1735000007000,"fecha":"2024-01-07","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":2.605,"o2":0,"total":2.605,"obs":"Control lechero â€” 2.605 L"},{"id":1735000008000,"fecha":"2024-01-07","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":3.7,"o2":0,"total":3.7,"obs":"Control lechero â€” 3.700 L"},{"id":1735000009000,"fecha":"2024-01-07","animalId":"070/7","animalNombre":"070/7","o1":1.67,"o2":3.445,"total":5.115,"obs":"Control lechero â€” 5.115 L"},{"id":1735000010000,"fecha":"2024-01-07","animalId":"245/3","animalNombre":"245/3","o1":2.495,"o2":0,"total":2.495,"obs":"Control lechero â€” 2.495 L"},{"id":1735000011000,"fecha":"2025-01-07","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.18,"o2":0,"total":3.18,"obs":"Control lechero â€” 3.180 L"},{"id":1735000012000,"fecha":"2025-01-07","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":3.275,"o2":0,"total":3.275,"obs":"Control lechero â€” 3.275 L"},{"id":1735000013000,"fecha":"2025-01-07","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":3.345,"o2":0,"total":3.345,"obs":"Control lechero â€” 3.345 L"},{"id":1735000014000,"fecha":"2025-01-07","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.33,"o2":0,"total":2.33,"obs":"Control lechero â€” 2.330 L"},{"id":1735000015000,"fecha":"2025-01-07","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":2.425,"o2":0,"total":2.425,"obs":"Control lechero â€” 2.425 L"},{"id":1735000016000,"fecha":"2025-01-07","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.44,"o2":0,"total":2.44,"obs":"Control lechero â€” 2.440 L"},{"id":1735000017000,"fecha":"2025-01-07","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":2.025,"o2":0,"total":2.025,"obs":"Control lechero â€” 2.025 L"},{"id":1735000018000,"fecha":"2025-01-07","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":2.89,"o2":0,"total":2.89,"obs":"Control lechero â€” 2.890 L"},{"id":1735000019000,"fecha":"2025-01-07","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":2.805,"o2":0,"total":2.805,"obs":"Control lechero â€” 2.805 L"},{"id":1735000020000,"fecha":"2025-01-07","animalId":"070/7","animalNombre":"070/7","o1":3.88,"o2":1.925,"total":5.805,"obs":"Control lechero â€” 5.805 L"},{"id":1735000021000,"fecha":"2025-01-07","animalId":"245/3","animalNombre":"245/3","o1":3.64,"o2":0,"total":3.64,"obs":"Control lechero â€” 3.640 L"},{"id":1735000022000,"fecha":"2025-01-15","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":4.325,"o2":0,"total":4.325,"obs":"Control lechero â€” 4.325 L"},{"id":1735000023000,"fecha":"2025-01-15","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.97,"o2":0,"total":2.97,"obs":"Control lechero â€” 2.970 L"},{"id":1735000024000,"fecha":"2025-01-15","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":3.765,"o2":0,"total":3.765,"obs":"Control lechero â€” 3.765 L"},{"id":1735000025000,"fecha":"2025-01-15","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.2,"o2":0,"total":2.2,"obs":"Control lechero â€” 2.200 L"},{"id":1735000026000,"fecha":"2025-01-15","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":2.355,"o2":0,"total":2.355,"obs":"Control lechero â€” 2.355 L"},{"id":1735000027000,"fecha":"2025-01-15","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.58,"o2":0,"total":2.58,"obs":"Control lechero â€” 2.580 L"},{"id":1735000028000,"fecha":"2025-01-15","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.455,"o2":0,"total":1.455,"obs":"Control lechero â€” 1.455 L"},{"id":1735000029000,"fecha":"2025-01-15","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":1.945,"o2":0,"total":1.945,"obs":"Control lechero â€” 1.945 L"},{"id":1735000030000,"fecha":"2025-01-15","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":3.59,"o2":0,"total":3.59,"obs":"Control lechero â€” 3.590 L"},{"id":1735000031000,"fecha":"2025-01-15","animalId":"070/7","animalNombre":"070/7","o1":1.425,"o2":4.575,"total":6.0,"obs":"Control lechero â€” 6.000 L"},{"id":1735000032000,"fecha":"2025-01-15","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":4.63,"o2":0,"total":4.63,"obs":"Control lechero â€” 4.630 L"},{"id":1735000033000,"fecha":"2025-01-15","animalId":"245/3","animalNombre":"245/3","o1":4.09,"o2":0,"total":4.09,"obs":"Control lechero â€” 4.090 L"},{"id":1735000034000,"fecha":"2025-01-22","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.555,"o2":0,"total":3.555,"obs":"Control lechero â€” 3.555 L"},{"id":1735000035000,"fecha":"2025-01-22","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.85,"o2":0,"total":2.85,"obs":"Control lechero â€” 2.850 L"},{"id":1735000036000,"fecha":"2025-01-22","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.9,"o2":0,"total":2.9,"obs":"Control lechero â€” 2.900 L"},{"id":1735000037000,"fecha":"2025-01-22","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.2,"o2":0,"total":2.2,"obs":"Control lechero â€” 2.200 L"},{"id":1735000038000,"fecha":"2025-01-22","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":7.875,"o2":0,"total":7.875,"obs":"Control lechero â€” 7.875 L"},{"id":1735000039000,"fecha":"2025-01-22","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.475,"o2":0,"total":2.475,"obs":"Control lechero â€” 2.475 L"},{"id":1735000040000,"fecha":"2025-01-22","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":1.395,"o2":0,"total":1.395,"obs":"Control lechero â€” 1.395 L"},{"id":1735000041000,"fecha":"2025-01-22","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":2.33,"o2":0,"total":2.33,"obs":"Control lechero â€” 2.330 L"},{"id":1735000042000,"fecha":"2025-01-22","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":2.4,"o2":0,"total":2.4,"obs":"Control lechero â€” 2.400 L"},{"id":1735000043000,"fecha":"2025-01-22","animalId":"070/7","animalNombre":"070/7","o1":3.55,"o2":1.345,"total":4.895,"obs":"Control lechero â€” 4.895 L"},{"id":1735000044000,"fecha":"2025-01-22","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":5.275,"o2":0,"total":5.275,"obs":"Control lechero â€” 5.275 L"},{"id":1735000045000,"fecha":"2025-01-22","animalId":"245/3","animalNombre":"245/3","o1":3.225,"o2":0,"total":3.225,"obs":"Control lechero â€” 3.225 L"},{"id":1735000046000,"fecha":"2025-01-29","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.39,"o2":0,"total":3.39,"obs":"Control lechero â€” 3.390 L"},{"id":1735000047000,"fecha":"2025-01-29","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.77,"o2":0,"total":2.77,"obs":"Control lechero â€” 2.770 L"},{"id":1735000048000,"fecha":"2025-01-29","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.69,"o2":0,"total":2.69,"obs":"Control lechero â€” 2.690 L"},{"id":1735000049000,"fecha":"2025-01-29","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.7,"o2":0,"total":2.7,"obs":"Control lechero â€” 2.700 L"},{"id":1735000050000,"fecha":"2025-01-29","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":7.88,"o2":0,"total":7.88,"obs":"Control lechero â€” 7.880 L"},{"id":1735000051000,"fecha":"2025-01-29","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.39,"o2":0,"total":2.39,"obs":"Control lechero â€” 2.390 L"},{"id":1735000052000,"fecha":"2025-01-29","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":7.385,"o2":0,"total":7.385,"obs":"Control lechero â€” 7.385 L"},{"id":1735000053000,"fecha":"2025-01-29","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":2.035,"o2":0,"total":2.035,"obs":"Control lechero â€” 2.035 L"},{"id":1735000054000,"fecha":"2025-01-29","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":2.28,"o2":0,"total":2.28,"obs":"Control lechero â€” 2.280 L"},{"id":1735000055000,"fecha":"2025-01-29","animalId":"070/7","animalNombre":"070/7","o1":7.63,"o2":0,"total":7.63,"obs":"Control lechero â€” 7.630 L (valor Ãºnico, 507-0=070/7)"},{"id":1735000056000,"fecha":"2025-01-29","animalId":"226/4","animalNombre":"ALVARACO","o1":5.555,"o2":0,"total":5.555,"obs":"Control lechero â€” 5.555 L"},{"id":1735000057000,"fecha":"2025-01-29","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":6.04,"o2":0,"total":6.04,"obs":"Control lechero â€” 6.040 L"},{"id":1735000058000,"fecha":"2025-01-29","animalId":"245/3","animalNombre":"245/3","o1":3.58,"o2":0,"total":3.58,"obs":"Control lechero â€” 3.580 L"},{"id":1735000059000,"fecha":"2025-02-05","animalId":"003/5","animalNombre":"PANQUEMAO DILUVIO MENCHO","o1":3.39,"o2":0,"total":3.39,"obs":"Control lechero â€” 3.390 L"},{"id":1735000060000,"fecha":"2025-02-05","animalId":"012/72","animalNombre":"COROCITO CHICUACO","o1":2.772,"o2":0,"total":2.772,"obs":"Control lechero â€” 2.772 L"},{"id":1735000061000,"fecha":"2025-02-05","animalId":"015/7","animalNombre":"TURCA DILUVIO MENCHO CARAMEL","o1":2.79,"o2":0,"total":2.79,"obs":"Control lechero â€” 2.790 L"},{"id":1735000062000,"fecha":"2025-02-05","animalId":"026/4","animalNombre":"CANDY DILUVIO MENCHO","o1":2.702,"o2":0,"total":2.702,"obs":"Control lechero â€” 2.702 L"},{"id":1735000063000,"fecha":"2025-02-05","animalId":"031/7","animalNombre":"CANDY CARAMELO DILUVIO MENCHO","o1":7.881,"o2":0,"total":7.881,"obs":"Control lechero â€” 7.881 L"},{"id":1735000064000,"fecha":"2025-02-05","animalId":"036/8","animalNombre":"ENEIDA CARAMELO","o1":2.397,"o2":0,"total":2.397,"obs":"Control lechero â€” 2.397 L"},{"id":1735000065000,"fecha":"2025-02-05","animalId":"039/8","animalNombre":"CARMENCITA DILUVIO MENCHO","o1":7.485,"o2":0,"total":7.485,"obs":"Control lechero â€” 7.485 L"},{"id":1735000066000,"fecha":"2025-02-05","animalId":"041/8","animalNombre":"COROCITOCHICUACO","o1":2.735,"o2":0,"total":2.735,"obs":"Control lechero â€” 2.735 L"},{"id":1735000067000,"fecha":"2025-02-05","animalId":"069/1","animalNombre":"REBECA JB LAREDO SUGA","o1":2.282,"o2":0,"total":2.282,"obs":"Control lechero â€” 2.282 L"},{"id":1735000068000,"fecha":"2025-02-05","animalId":"070/7","animalNombre":"070/7","o1":7.73,"o2":0,"total":7.73,"obs":"Control lechero â€” 7.730 L (valor Ãºnico, 507-0=070/7)"},{"id":1735000069000,"fecha":"2025-02-05","animalId":"226/4","animalNombre":"ALVARACO","o1":5.655,"o2":0,"total":5.655,"obs":"Control lechero â€” 5.655 L"},{"id":1735000070000,"fecha":"2025-02-05","animalId":"236/4","animalNombre":"LA NENA MAÃ‘OGENICO DILUVIO","o1":6.241,"o2":0,"total":6.241,"obs":"Control lechero â€” 6.241 L"},{"id":1735000071000,"fecha":"2025-02-05","animalId":"245/3","animalNombre":"245/3","o1":3.68,"o2":0,"total":3.68,"obs":"Control lechero â€” 3.680 L"},{"id":1735000072000,"fecha":"2025-02-12","animalId":"245/3","animalNombre":"245/3","o1":3.09,"o2":0,"total":3.09,"obs":"Control lechero â€” 3.090 L"}];
  const _SSH=[{"id":1736200022001,"fecha":"2026-01-12","animalId":"031/7","animalNombre":"031/7","diagnostico":"Distocia â€” parto distÃ³cico, crÃ­a muerta","tratamiento":"Benzoato estradiol 8ml + Cloprostenol 2ml + Edo Adesel 8ml + Fluvipen 6.000.000 UI","retiroLeche":5,"retiroCarne":10,"fechaRetiroLeche":"2026-01-17","fechaRetiroCarne":"2026-01-22","veterinario":"","estado":"En tratamiento","obs":"Alto riesgo clÃ­nico. Seguimiento urgente: temperatura, loquios, antibiÃ³tico/antiinflamatorio"},{"id":1740500000001,"fecha":"2025-12-16","animalId":"0007","animalNombre":"0007","diagnostico":"DesparasitaciÃ³n","tratamiento":"Albendazol 8 cm (vaca) | Ivermectina 1% 1 cm subcutÃ¡neo (crÃ­a)","retiroLeche":0,"retiroCarne":0,"fechaRetiroLeche":"","fechaRetiroCarne":"","veterinario":"Julio CÃ©sar HernÃ¡ndez","estado":"Finalizado","obs":"DesparasitaciÃ³n rutinaria. Albendazol 8 cc a la vaca. Ivermectina al 1% 1 cc subcutÃ¡neo a la crÃ­a. (Fuente: chat 16/12/25)"},{"id":1740500000002,"fecha":"2025-12-16","animalId":"012/1","animalNombre":"012/1","diagnostico":"Tratamiento antiparasitario â€” Edo-antripan","tratamiento":"Edo-antripan: dosis Ãºnica IM profunda, dividida en 4 sitios de aplicaciÃ³n","retiroLeche":0,"retiroCarne":0,"fechaRetiroLeche":"","fechaRetiroCarne":"","veterinario":"Julio CÃ©sar HernÃ¡ndez","estado":"Finalizado","obs":"Edo-antripan dosis Ãºnica, vÃ­a intramuscular profunda, dividida en cuatro sitios. (Fuente: chat 16/12/25)"},{"id":1740500000003,"fecha":"2026-02-20","animalId":"0003","animalNombre":"0003","diagnostico":"DesparasitaciÃ³n","tratamiento":"Albendazol 8 cm (vaca) | Ivermectina 1% 1 cm subcutÃ¡neo (crÃ­a)","retiroLeche":0,"retiroCarne":0,"fechaRetiroLeche":"","fechaRetiroCarne":"","veterinario":"Julio CÃ©sar HernÃ¡ndez","estado":"Finalizado","obs":"DesparasitaciÃ³n rutinaria. Albendazol 8 cc a la vaca. Ivermectina al 1% 1 cc subcutÃ¡neo a la crÃ­a. (Fuente: chat 20/02/26)"}];
  const _SG=[{"id": 1736200021001, "fecha": "2025-10-31", "categoria": "Venta animal", "concepto": "Venta vaca 009-6", "monto": -2437500, "proveedor": ""}, {"id": 1736200021002, "fecha": "2025-11-22", "categoria": "Venta animal", "concepto": "Venta crÃ­a de 009-6 (144kg)", "monto": -1224000, "proveedor": ""}, {"id": 1736200021003, "fecha": "2025-11-22", "categoria": "Venta animal", "concepto": "Venta 9 novillas (0009,0016,0011,0005,0006,0002,0004,0008,0014)", "monto": -21754370, "proveedor": ""}];
  try{
    if(!localStorage.getItem('sg_animales')||JSON.parse(localStorage.getItem('sg_animales')).length===0){
      localStorage.setItem('sg_animales',JSON.stringify(_SA));
      localStorage.setItem('sg_servicios',JSON.stringify(_SS));
      localStorage.setItem('sg_partos',JSON.stringify(_SP));
      localStorage.setItem('sg_leche',JSON.stringify(_SL));
      localStorage.setItem('sg_salud',JSON.stringify(_SSH));
      localStorage.setItem('sg_gastos',JSON.stringify(_SG));
      localStorage.setItem('sg_pesos','[]');
      // Registros de peso histÃ³ricos de animales Gyr
      const _peso_seed = JSON.parse(localStorage.getItem('sg_pesos')||'[]');
      _peso_seed.push(
        {id:1728000000000,fecha:'2025-10-04',animalId:'036/8',animalNombre:'ENEIDA CARAMELO',categoria:'Vaca',peso:446,cc:'3.0',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 08:16'},
        {id:1728000000001,fecha:'2025-10-04',animalId:'069/1',animalNombre:'REBECA JB LAREDO SUGA',categoria:'Vaca',peso:347,cc:'3.0',obs:'Pesaje 04/10/25 â€” Zafnat/Gyr â€” hora 08:23'},
        {id:1728000000002,fecha:'2025-10-04',animalId:'001/6',animalNombre:'FRENTONA DILUVIO MENCHO',categoria:'Vaca',peso:417,cc:'3.0',obs:'Pesaje 04/10/25 â€” Zafnat/Gyr â€” hora 08:27'},
        {id:1728000000003,fecha:'2025-10-04',animalId:'038/8',animalNombre:'ALVARACO PECOSO DILUVIO',categoria:'Vaca',peso:509,cc:'3.0',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 08:34'},
        {id:1728000000004,fecha:'2025-10-04',animalId:'007/6',animalNombre:'LUZ MOROCHA CARAMELO',categoria:'Vaca',peso:420,cc:'3.3',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 08:39'},
        {id:1728000000005,fecha:'2025-10-04',animalId:'012/1',animalNombre:'SAUDITA GALAXIA',categoria:'Vaca',peso:292,cc:'2.5',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 08:53'},
        {id:1728000000006,fecha:'2025-10-04',animalId:'0001',animalNombre:'0001',categoria:'Novilla',peso:299,cc:'3.3',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 09:03'},
        {id:1728000000007,fecha:'2025-10-04',animalId:'272/18',animalNombre:'JFH SAN PABLO MELY GENHIS T.E.',categoria:'Vaca',peso:484,cc:'3.3',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 09:12'},
        {id:1728000000008,fecha:'2025-10-04',animalId:'638/3',animalNombre:'JJBT SIRENITA T.E.',categoria:'Novilla',peso:276,cc:'3.5',obs:'Pesaje 04/10/25 â€” Mercury/Holstein â€” hora 09:18'},
        {id:1740100001,fecha:'2025-09-01',animalId:'717/43',animalNombre:'OB ZAFNAT DE ORO',categoria:'Toro',peso:357,cc:'3.0',obs:'Pesaje 01/09/25'},
        {id:1740100003,fecha:'2025-10-25',animalId:'717/43',animalNombre:'OB ZAFNAT DE ORO',categoria:'Toro',peso:414,cc:'3.0',obs:'Pesaje 25/10/25'},
        {id:1740100004,fecha:'2025-11-13',animalId:'717/43',animalNombre:'OB ZAFNAT DE ORO',categoria:'Toro',peso:390,cc:'3.0',obs:'Pesaje 13/11/25'},
        {id:1740100005,fecha:'2025-12-23',animalId:'717/43',animalNombre:'OB ZAFNAT DE ORO',categoria:'Toro',peso:427,cc:'3.0',obs:'Pesaje 23/12/25'},
        {id:1740100002,fecha:'2025-12-23',animalId:'128/3',animalNombre:'JJBT RENACER',categoria:'Novilla',peso:289,cc:'3.0',obs:'Pesaje 23/12/25'}
      );
      localStorage.setItem('sg_pesos', JSON.stringify(_peso_seed));
      localStorage.setItem('sg_praderas',JSON.stringify(getDefaultPraderas()));
    }
  }catch(e){console.warn('seed',e);}
  animales       = DB.load('animales',_SA);
  registrosLeche = DB.load('leche',_SL);
  registrosPeso  = DB.load('pesos',[]);
  partos         = DB.load('partos',_SP);
  servicios      = DB.load('servicios',_SS);
  eventosS       = DB.load('salud',_SSH);
  gastos         = DB.load('gastos',_SG);
  // â”€â”€ Praderas: forzar estructura correcta siempre â”€â”€â”€â”€â”€â”€
  // Cargar lo guardado, pero si los nombres no coinciden con la estructura real
  // (p.ej. datos demo como "El Palmar"), reemplazar con getDefaultPraderas()
  const _pSaved = DB.load('praderas', []);
  const _pValid = _pSaved.length > 0 && _pSaved.some(p => p.nombre && (p.nombre.includes('La Casa') || p.nombre.includes('Herencia') || p.nombre.includes('RincÃ³n')));
  praderas = _pValid ? _pSaved : getDefaultPraderas();
  if(!_pValid) DB.save('praderas', praderas);

  // â”€â”€ Lotes: cargar o sembrar datos iniciales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  lotes = DB.load('lotes', []);
  if(!lotes.length) {
    lotes = [{"id": 1700000000, "numero": 0, "nombre": "Hato Unificado 2024", "obs": "Lote original â€” todo el hato rotando por La Casa (2024). Dividido el 11/02/2026 en Lote 1 y Lote 2.", "fechaCreacion": "2024-01-21", "miembros": [{"animalId": "638/3", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "012/1", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "04/34", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "272/18", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "1378 N3", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "128/3", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "122/15", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "718/45", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "124/75", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "141/26", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "716/43", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "717/43", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0010", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "031/7", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "015/7", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "071/1", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0012", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "236/4", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0018", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "003/5", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0015", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0007", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "001/6", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "010/7", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "026/4", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "069/1", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0001", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "036/8", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "0013", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "038/8", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "023/7", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "007/6", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "039/8", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "041/8", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "123/15", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "125/75", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "719/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "127/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "128/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "720/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "130/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "131/95", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "721/95", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "722/05", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "134/15", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "135/15", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "136/15", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "137/25", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "138/25", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "723/16", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "139/16", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "140/16", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "126/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "129/85", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "132/95", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "133/05", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "012/72", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "226/4", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}, {"animalId": "241/42", "fechaIngreso": "2024-01-21", "fechaSalida": "2026-02-11", "obs": "Dividido 11/02/2026"}], "movimientos": [{"potrero": "P05 â€” La Casa", "fechaEntrada": "2024-01-21", "fechaSalida": "2024-02-09", "obs": "", "lecheTotal": 0}, {"potrero": "P04 â€” La Casa", "fechaEntrada": "2024-02-09", "fechaSalida": "2024-02-14", "obs": "", "lecheTotal": 0}, {"potrero": "P11 â€” La Casa", "fechaEntrada": "2024-02-11", "fechaSalida": "2024-03-12", "obs": "", "lecheTotal": 0}, {"potrero": "P03 â€” La Casa", "fechaEntrada": "2024-03-12", "fechaSalida": "2024-03-15", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-03-15", "fechaSalida": "2024-03-27", "obs": "", "lecheTotal": 0}, {"potrero": "P01 â€” La Casa", "fechaEntrada": "2024-03-30", "fechaSalida": "2024-04-08", "obs": "", "lecheTotal": 0}, {"potrero": "P08 â€” La Casa", "fechaEntrada": "2024-04-05", "fechaSalida": "2024-04-05", "obs": "Entrada y salida mismo dÃ­a", "lecheTotal": 0}, {"potrero": "P07 â€” La Casa", "fechaEntrada": "2024-04-11", "fechaSalida": "2024-04-25", "obs": "", "lecheTotal": 0}, {"potrero": "P05 â€” La Casa", "fechaEntrada": "2024-04-25", "fechaSalida": "2024-04-29", "obs": "", "lecheTotal": 0}, {"potrero": "P11 â€” La Casa", "fechaEntrada": "2024-04-29", "fechaSalida": "2024-05-03", "obs": "", "lecheTotal": 0}, {"potrero": "P04 â€” La Casa", "fechaEntrada": "2024-05-03", "fechaSalida": "2024-05-05", "obs": "", "lecheTotal": 0}, {"potrero": "P10 â€” La Casa", "fechaEntrada": "2024-05-05", "fechaSalida": "2024-05-09", "obs": "", "lecheTotal": 0}, {"potrero": "P06 â€” La Casa", "fechaEntrada": "2024-05-09", "fechaSalida": "2024-05-12", "obs": "", "lecheTotal": 0}, {"potrero": "P07 â€” La Casa", "fechaEntrada": "2024-05-12", "fechaSalida": "2024-05-15", "obs": "", "lecheTotal": 0}, {"potrero": "P08 â€” La Casa", "fechaEntrada": "2024-05-15", "fechaSalida": "2024-05-21", "obs": "", "lecheTotal": 0}, {"potrero": "P03 â€” La Casa", "fechaEntrada": "2024-05-21", "fechaSalida": "2024-05-23", "obs": "", "lecheTotal": 0}, {"potrero": "P01 â€” La Casa", "fechaEntrada": "2024-05-23", "fechaSalida": "2024-05-30", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-06-04", "fechaSalida": "2024-06-08", "obs": "", "lecheTotal": 0}, {"potrero": "P04 â€” La Casa", "fechaEntrada": "2024-06-08", "fechaSalida": "2024-06-15", "obs": "", "lecheTotal": 0}, {"potrero": "P09 â€” La Casa", "fechaEntrada": "2024-06-18", "fechaSalida": "2024-07-06", "obs": "", "lecheTotal": 0}, {"potrero": "P07 â€” La Casa", "fechaEntrada": "2024-07-06", "fechaSalida": "2024-07-09", "obs": "", "lecheTotal": 0}, {"potrero": "P04 â€” La Casa", "fechaEntrada": "2024-07-09", "fechaSalida": "2024-07-11", "obs": "", "lecheTotal": 0}, {"potrero": "P01 â€” La Casa", "fechaEntrada": "2024-07-11", "fechaSalida": "2024-07-17", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-07-17", "fechaSalida": "2024-07-21", "obs": "", "lecheTotal": 0}, {"potrero": "P06 â€” La Casa", "fechaEntrada": "2024-07-21", "fechaSalida": "2024-07-23", "obs": "", "lecheTotal": 0}, {"potrero": "P11 â€” La Casa", "fechaEntrada": "2024-07-23", "fechaSalida": "2024-07-27", "obs": "", "lecheTotal": 0}, {"potrero": "P10 â€” La Casa", "fechaEntrada": "2024-07-27", "fechaSalida": "2024-07-30", "obs": "", "lecheTotal": 0}, {"potrero": "P08 â€” La Casa", "fechaEntrada": "2024-07-30", "fechaSalida": "2024-08-08", "obs": "", "lecheTotal": 0}, {"potrero": "P01 â€” La Casa", "fechaEntrada": "2024-08-05", "fechaSalida": "2024-08-08", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-08-08", "fechaSalida": "2024-08-10", "obs": "", "lecheTotal": 0}, {"potrero": "P11 â€” La Casa", "fechaEntrada": "2024-08-10", "fechaSalida": "2024-08-13", "obs": "", "lecheTotal": 0}, {"potrero": "P08 â€” La Casa", "fechaEntrada": "2024-08-13", "fechaSalida": "2024-08-16", "obs": "", "lecheTotal": 0}, {"potrero": "P07 â€” La Casa", "fechaEntrada": "2024-08-16", "fechaSalida": "2024-08-20", "obs": "", "lecheTotal": 0}, {"potrero": "P08 â€” La Casa", "fechaEntrada": "2024-09-10", "fechaSalida": "2024-09-13", "obs": "", "lecheTotal": 0}, {"potrero": "P09 â€” La Casa", "fechaEntrada": "2024-09-15", "fechaSalida": "2024-09-17", "obs": "", "lecheTotal": 0}, {"potrero": "P11 â€” La Casa", "fechaEntrada": "2024-09-17", "fechaSalida": "2024-09-19", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-09-19", "fechaSalida": "2024-09-22", "obs": "", "lecheTotal": 0}, {"potrero": "P10 â€” La Casa", "fechaEntrada": "2024-09-23", "fechaSalida": "2024-09-26", "obs": "", "lecheTotal": 0}, {"potrero": "P07 â€” La Casa", "fechaEntrada": "2024-10-08", "fechaSalida": "2024-10-14", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-10-08", "fechaSalida": "2024-10-11", "obs": "", "lecheTotal": 0}, {"potrero": "P08 â€” La Casa", "fechaEntrada": "2024-10-14", "fechaSalida": "2024-10-16", "obs": "", "lecheTotal": 0}, {"potrero": "P02 â€” La Casa", "fechaEntrada": "2024-10-16", "fechaSalida": "2024-10-21", "obs": "Herencia", "lecheTotal": 0}, {"potrero": "P07 â€” La Casa", "fechaEntrada": "2024-10-21", "fechaSalida": "2024-10-29", "obs": "De las herencias", "lecheTotal": 0}, {"potrero": "P09 â€” La Casa", "fechaEntrada": "2024-10-29", "fechaSalida": "2024-11-02", "obs": "", "lecheTotal": 0}, {"potrero": "P06 â€” La Casa", "fechaEntrada": "2024-11-02", "fechaSalida": "2024-11-04", "obs": "", "lecheTotal": 0}, {"potrero": "P11 â€” La Casa", "fechaEntrada": "2024-11-04", "fechaSalida": "2026-02-11", "obs": "Ãšltimo potrero antes de divisiÃ³n del hato", "lecheTotal": 0}]}, {"id": 1700000001, "numero": 1, "nombre": "Lote P11 La Casa", "obs": "Formado el 11/02/2026 al dividirse el hato. 12 animales.", "fechaCreacion": "2026-02-11", "miembros": [{"animalId": "638/3", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "012/1", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "04/34", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "272/18", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "1378 N3", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "128/3", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "122/15", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "718/45", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "124/75", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "141/26", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "716/43", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "717/43", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}], "movimientos": [{"potrero": "P11 â€” La Casa", "fechaEntrada": "2026-02-11", "fechaSalida": null, "obs": "Primer potrero tras divisiÃ³n del hato", "lecheTotal": 0}]}, {"id": 1700000002, "numero": 2, "nombre": "Lote P01 La Herencia", "obs": "Formado el 11/02/2026 al dividirse el hato. 47 animales.", "fechaCreacion": "2026-02-11", "miembros": [{"animalId": "0010", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "031/7", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "015/7", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "071/1", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "0012", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "236/4", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "0018", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "003/5", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "0015", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "0007", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "001/6", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "010/7", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "026/4", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "069/1", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "0001", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "036/8", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "0013", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "038/8", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "023/7", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "007/6", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "039/8", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "041/8", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "123/15", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "125/75", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "719/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "127/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "128/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "720/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "130/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "131/95", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "721/95", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "722/05", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "134/15", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "135/15", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "136/15", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "137/25", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "138/25", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "723/16", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "139/16", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "140/16", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "126/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "129/85", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "132/95", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "133/05", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "012/72", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "226/4", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}, {"animalId": "241/42", "fechaIngreso": "2026-02-11", "fechaSalida": null, "obs": ""}], "movimientos": [{"potrero": "P01 â€” La Herencia", "fechaEntrada": "2026-02-11", "fechaSalida": null, "obs": "Primer potrero tras divisiÃ³n del hato", "lecheTotal": 0}]}];
    DB.save('lotes', lotes);
  }


















  // Actualizar sidebar finca
  document.getElementById('sb-finca-name').textContent = 'ğŸ¡ '+(config.finca||'Mi Finca');
  document.getElementById('sb-finca-meta').textContent = (config.area||'â€”')+' ha Â· '+animales.length+' animales';

  // Render pÃ¡gina inicial
  renderDashboard();

  // AnimaciÃ³n entrada
  document.querySelectorAll('.sb-item').forEach((el,i)=>{
    el.style.opacity='0';
    el.style.transform='translateX(-10px)';
    setTimeout(()=>{
      el.style.transition='all .3s ease';
      el.style.opacity='1';
      el.style.transform='translateX(0)';
    }, i*20+100);
  });
}

init();
</script>
<!-- â•â•â• MODAL IMPORTADOR ASOCEBÃš â•â•â• -->
<div class="overlay" id="modalAsoceby">
  <div class="modal" style="max-width:560px;">
    <div class="modal-header">
      <div>
        <div class="modal-title">ğŸ„ Importar Certificado AsocebÃº</div>
        <div class="modal-sub">Sube el PDF de registro genealÃ³gico y se llenarÃ¡ automÃ¡ticamente</div>
      </div>
      <span class="modal-close" onclick="closeModal('modalAsoceby')">âœ•</span>
    </div>
    <div style="padding:24px;">
      <!-- Drop zone -->
      <div id="asoceby-drop" style="border:2px dashed var(--pasto);border-radius:12px;padding:40px;text-align:center;cursor:pointer;transition:.2s;background:var(--pasto-suave);"
        onclick="document.getElementById('asoceby-file').click()"
        ondragover="event.preventDefault();this.style.borderColor='var(--sol)'"
        ondragleave="this.style.borderColor='var(--pasto)'"
        ondrop="handleAsocebyDrop(event)">
        <div style="font-size:40px;margin-bottom:8px;">ğŸ“„</div>
        <div style="font-weight:700;color:var(--pasto);margin-bottom:4px;">Arrastra el PDF aquÃ­</div>
        <div style="font-size:12px;color:var(--gris-calido);">o haz clic para seleccionar el archivo</div>
        <input type="file" id="asoceby-file" accept=".pdf" style="display:none" onchange="procesarAsocebyFile(this.files[0])">
      </div>

      <!-- Preview extraÃ­do -->
      <div id="asoceby-preview" style="display:none;margin-top:20px;">
        <div style="font-weight:700;color:var(--pasto);margin-bottom:12px;font-size:13px;">âœ… Datos extraÃ­dos del certificado:</div>
        <div id="asoceby-datos" style="background:var(--crema);border-radius:10px;padding:14px;font-size:12px;"></div>
        <div style="display:flex;gap:10px;margin-top:16px;">
          <button class="btn btn-primary" onclick="aplicarDatosAsoceby()" style="flex:1;">Aplicar al animal en el sistema</button>
          <button class="btn btn-ghost" onclick="closeModal('modalAsoceby')">Cancelar</button>
        </div>
      </div>

      <div id="asoceby-error" style="display:none;margin-top:16px;padding:12px;background:#fee2e2;border-radius:8px;color:#991b1b;font-size:12px;"></div>
      <div id="asoceby-loading" style="display:none;margin-top:16px;text-align:center;color:var(--gris-calido);">â³ Procesando PDF...</div>

      <div style="margin-top:20px;padding:12px;background:#f0fdf4;border-radius:8px;font-size:11px;color:var(--gris-calido);">
        <strong style="color:var(--pasto);">Campos que se extraen automÃ¡ticamente:</strong><br>
        Nombre Â· NÃºmero (ID) Â· Color Â· Fecha de nacimiento Â· Padre Â· Madre Â· Registro AsocebÃº Â· Raza / composiciÃ³n genÃ©tica Â· Observaciones del criador
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  IMPORTADOR ASOCEBÃš PDF
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _asocebyData = null;

function abrirImportadorAsoceby() {
  document.getElementById('asoceby-preview').style.display = 'none';
  document.getElementById('asoceby-error').style.display = 'none';
  document.getElementById('asoceby-loading').style.display = 'none';
  document.getElementById('asoceby-file').value = '';
  openModal('modalAsoceby');
}

function handleAsocebyDrop(e) {
  e.preventDefault();
  document.getElementById('asoceby-drop').style.borderColor = 'var(--pasto)';
  const file = e.dataTransfer.files[0];
  if(file && file.type === 'application/pdf') procesarAsocebyFile(file);
  else mostrarErrorAsoceby('Solo se aceptan archivos PDF.');
}

function mostrarErrorAsoceby(msg) {
  const el = document.getElementById('asoceby-error');
  el.style.display = 'block';
  el.textContent = 'âš ï¸ ' + msg;
  document.getElementById('asoceby-loading').style.display = 'none';
  document.getElementById('asoceby-preview').style.display = 'none';
}

function procesarAsocebyFile(file) {
  if(!file) return;
  document.getElementById('asoceby-loading').style.display = 'block';
  document.getElementById('asoceby-error').style.display = 'none';
  document.getElementById('asoceby-preview').style.display = 'none';

  const reader = new FileReader();
  reader.onload = async function(e) {
    try {
      const base64 = e.target.result.split(',')[1];
      const resp = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          messages: [{
            role: 'user',
            content: [
              {
                type: 'document',
                source: { type: 'base64', media_type: 'application/pdf', data: base64 }
              },
              {
                type: 'text',
                text: `Extrae los datos de este certificado genealÃ³gico de AsocebÃº y responde ÃšNICAMENTE con un JSON vÃ¡lido, sin texto adicional, sin markdown, sin explicaciones. Formato exacto:
{
  "nombre": "nombre del animal",
  "numero": "nÃºmero/id del animal (convierte / a -)",
  "color": "color del animal",
  "nacimiento": "fecha en formato YYYY-MM-DD",
  "sexo": "Macho o Hembra",
  "tipo": "PU/GR/etc",
  "registro": "cÃ³digo de registro AsocebÃº (ej: HGY066183)",
  "padre": "nombre completo del padre con su registro",
  "madre": "nombre completo de la madre con su registro",
  "raza": "nombre de la raza principal (Gyr, Brahman, etc)",
  "criador": "nombre del criador",
  "propietario": "nombre del propietario",
  "hijos": nÃºmero de hijos registrados o 0,
  "lechero": true o false,
  "obs": "observaciones relevantes del certificado"
}`
              }
            ]
          }]
        })
      });
      const json = await resp.json();
      const texto = json.content?.map(c=>c.text||'').join('') || '';
      const limpio = texto.replace(/```json|```/g,'').trim();
      const datos = JSON.parse(limpio);
      _asocebyData = datos;
      mostrarPreviewAsoceby(datos);
    } catch(err) {
      mostrarErrorAsoceby('No se pudo procesar el PDF. Verifica que sea un certificado AsocebÃº vÃ¡lido. (' + err.message + ')');
    }
  };
  reader.readAsDataURL(file);
}

function mostrarPreviewAsoceby(d) {
  document.getElementById('asoceby-loading').style.display = 'none';

  // Mapear raza a composiciÃ³n
  const RAZAS_ASOCEBY = {
    'Gyr':'Gyr','Gir':'Gyr','GYR':'Gyr',
    'Brahman':'Brahman','BRAHMAN':'Brahman',
    'Nelore':'Nelore','Guzerat':'Guzerat',
    'Girolando':'Girolando','Gyrolando':'Gyrolando',
  };
  const razaNorm = RAZAS_ASOCEBY[d.raza] || d.raza || 'Gyr';

  const campos = [
    ['Nombre',    d.nombre],
    ['NÃºmero/ID', d.numero],
    ['Sexo',      d.sexo],
    ['Color',     d.color],
    ['Nacimiento',d.nacimiento],
    ['Registro',  d.registro],
    ['Raza',      razaNorm + (d.tipo==='PU'?' 100% (Pura)':'')],
    ['Padre',     d.padre],
    ['Madre',     d.madre],
    ['Criador',   d.criador],
    ['C. Lechero',d.lechero?'SÃ­':'No'],
    ['Hijos reg.',d.hijos||0],
  ];

  document.getElementById('asoceby-datos').innerHTML = campos
    .filter(([,v])=>v)
    .map(([l,v])=>`<div style="display:flex;gap:8px;padding:4px 0;border-bottom:1px solid #e5e7eb;">
      <span style="color:var(--gris-calido);min-width:90px;">${l}</span>
      <span style="font-weight:600;">${v}</span>
    </div>`).join('');

  document.getElementById('asoceby-preview').style.display = 'block';
}

function aplicarDatosAsoceby() {
  if(!_asocebyData) return;
  const d = _asocebyData;

  // Buscar si el animal ya existe
  const idBuscado = (d.numero||'').replace('/','â€‘');
  const existente = animales.find(a =>
    a.id === d.numero ||
    a.id === idBuscado ||
    a.nombre.toUpperCase() === (d.nombre||'').toUpperCase()
  );

  const RAZAS_MAP = {'Gyr':'Gyr','Gir':'Gyr','GYR':'Gyr','Brahman':'Brahman','Nelore':'Nelore','Guzerat':'Guzerat','Girolando':'Girolando'};
  const razaNorm = RAZAS_MAP[d.raza] || d.raza || 'Gyr';
  const composicion = razaNorm ? [{raza: razaNorm, pct: 100}] : [];

  const obsPartes = [];
  if(d.registro) obsPartes.push('Reg. AsocebÃº: ' + d.registro);
  if(d.tipo) obsPartes.push('Tipo: ' + d.tipo);
  if(d.criador) obsPartes.push('Criador: ' + d.criador);
  if(d.obs) obsPartes.push(d.obs);

  if(existente) {
    // Actualizar animal existente
    if(d.nombre) existente.nombre = d.nombre;
    if(d.color) existente.color = d.color;
    if(d.nacimiento) existente.nacimiento = d.nacimiento;
    if(d.padre) existente.padre = d.padre;
    if(d.madre) existente.madre = d.madre;
    if(composicion.length) existente.composicion = composicion;
    existente.raza = razaNorm + (d.tipo==='PU'?' 100%':'');
    existente.obs = obsPartes.join(' | ');
    DB.save('animales', animales);
    toast('âœ… Animal actualizado: ' + (d.nombre||existente.id), 'success');
    closeModal('modalAsoceby');
    renderInventario();
  } else {
    // Preparar formulario de nuevo animal con datos prellenados
    closeModal('modalAsoceby');
    // Abrir modal de registro con datos
    document.getElementById('anim-edit-id').value = '';
    document.getElementById('modal-animal-title').textContent = 'Registrar Animal (desde AsocebÃº)';
    document.getElementById('anim-id').value = d.numero || '';
    document.getElementById('anim-nombre').value = d.nombre || '';
    document.getElementById('anim-color').value = d.color || '';
    document.getElementById('anim-nacimiento').value = d.nacimiento || '';
    document.getElementById('anim-padre').value = d.padre || '';
    document.getElementById('anim-madre').value = d.madre || '';
    document.getElementById('anim-obs').value = obsPartes.join(' | ');
    document.getElementById('anim-categoria').value = d.sexo==='Macho' ? 'Toro' : 'Novilla';
    cargarGeneticaEnForm(composicion);
    openModal('modalAnimal');
    toast('Datos precargados desde el certificado â€” revisa y guarda', 'info');
  }
}
</script>

</body>
</html>
